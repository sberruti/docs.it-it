---
title: Migrazione di progetti con c'è/CLI a .NET Core
description: Informazioni sul porting di progetti in .NET Core/CLI.
author: mjrousos
ms.date: 01/10/2020
ms.openlocfilehash: eb03f2a5ff42e8279fd3ebd6ee6fb6d955f6798d
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/14/2020
ms.locfileid: "75964930"
---
# <a name="how-to-port-a-ccli-project-to-net-core"></a><span data-ttu-id="436cb-103">Come eseguire il porting di un progetto in .NET Core</span><span class="sxs-lookup"><span data-stu-id="436cb-103">How to port a C++/CLI project to .NET Core</span></span>

<span data-ttu-id="436cb-104">A partire da .NET Core 3.1 e Visual Studio 2019 versione 16.4, i progetti di [C/CLI](/cpp/dotnet/dotnet-programming-with-cpp-cli-visual-cpp) possono essere destinati a .NET Core.</span><span class="sxs-lookup"><span data-stu-id="436cb-104">Beginning with .NET Core 3.1 and Visual Studio 2019 version 16.4, [C++/CLI projects](/cpp/dotnet/dotnet-programming-with-cpp-cli-visual-cpp) can target .NET Core.</span></span> <span data-ttu-id="436cb-105">Questo supporto consente di eseguire il porting delle applicazioni desktop di Windows con i livelli di interoperabilità C./CLI a .NET Core.</span><span class="sxs-lookup"><span data-stu-id="436cb-105">This support makes it possible to port Windows desktop applications with C++/CLI interop layers to .NET Core.</span></span> <span data-ttu-id="436cb-106">In questo articolo viene descritto come eseguire la porta di progetti C , C , C , E CLI da .NET Framework a .NET Core 3.1.</span><span class="sxs-lookup"><span data-stu-id="436cb-106">This article describes how to port C++/CLI projects from .NET Framework to .NET Core 3.1.</span></span>

## <a name="ccli-net-core-limitations"></a><span data-ttu-id="436cb-107">Limitazioni di .NET Core di C/CLI</span><span class="sxs-lookup"><span data-stu-id="436cb-107">C++/CLI .NET Core limitations</span></span>

<span data-ttu-id="436cb-108">Esistono alcune importanti limitazioni per il porting di progetti in .NET Core rispetto ad altri linguaggi:</span><span class="sxs-lookup"><span data-stu-id="436cb-108">There are some important limitations to porting C++/CLI projects to .NET Core compared to other languages:</span></span>

* <span data-ttu-id="436cb-109">Il supporto di C/CLI per .NET Core è solo Windows.</span><span class="sxs-lookup"><span data-stu-id="436cb-109">C++/CLI support for .NET Core is Windows only.</span></span>
* <span data-ttu-id="436cb-110">I progetti di C/CLI non possono essere destinati a .NET Standard, ma solo a .NET Core (o .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="436cb-110">C++/CLI projects can't target .NET Standard, only .NET Core (or .NET Framework).</span></span>
* <span data-ttu-id="436cb-111">I progetti di progetto di tipo C/CLI non supportano il nuovo formato di file di progetto in stile SDK.</span><span class="sxs-lookup"><span data-stu-id="436cb-111">C++/CLI projects don't support the new SDK-style project file format.</span></span> <span data-ttu-id="436cb-112">Al contrario, anche quando è destinato a .NET Core, i progetti di C/CLI utilizzano il formato di file vcxproj esistente.</span><span class="sxs-lookup"><span data-stu-id="436cb-112">Instead, even when targeting .NET Core, C++/CLI projects use the existing vcxproj file format.</span></span>
* <span data-ttu-id="436cb-113">Non è possibile eseguire più piattaforme .NET con più aree di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="436cb-113">C++/CLI projects can't multitarget multiple .NET platforms.</span></span> <span data-ttu-id="436cb-114">Se è necessario compilare un progetto in linguaggio C,NET/CLI sia per .NET Framework che per .NET Core, utilizzare file di progetto separati.</span><span class="sxs-lookup"><span data-stu-id="436cb-114">If you need to build a C++/CLI project for both .NET Framework and .NET Core, use separate project files.</span></span>
* <span data-ttu-id="436cb-115">.NET Core non `-clr:pure` supporta `-clr:safe` o la `-clr:netcore` compilazione, solo `-clr` la nuova opzione (che è equivalente a per .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="436cb-115">.NET Core doesn't support `-clr:pure` or `-clr:safe` compilation, only the new `-clr:netcore` option (which is equivalent to `-clr` for .NET Framework).</span></span>

## <a name="port-a-ccli-project"></a><span data-ttu-id="436cb-116">Convertire un progetto c/CLI</span><span class="sxs-lookup"><span data-stu-id="436cb-116">Port a C++/CLI project</span></span>

<span data-ttu-id="436cb-117">Per eseguire il porting di un progetto in .NET Core, apportare le modifiche seguenti al file vcxproj.</span><span class="sxs-lookup"><span data-stu-id="436cb-117">To port a C++/CLI project to .NET Core, make the following changes to the vcxproj file.</span></span> <span data-ttu-id="436cb-118">Questi passaggi di migrazione differiscono dai passaggi necessari per altri tipi di progetto, perché i progetti di C/CLI non utilizzano file di progetto di tipo SDK.</span><span class="sxs-lookup"><span data-stu-id="436cb-118">These migration steps differ from the steps needed for other project types because C++/CLI projects don't use SDK-style project files.</span></span>

1. <span data-ttu-id="436cb-119">Sostituire `<CLRSupport>true</CLRSupport>` le `<CLRSupport>NetCore</CLRSupport>`proprietà con .</span><span class="sxs-lookup"><span data-stu-id="436cb-119">Replace `<CLRSupport>true</CLRSupport>` properties with `<CLRSupport>NetCore</CLRSupport>`.</span></span> <span data-ttu-id="436cb-120">Questa proprietà si trova spesso in gruppi di proprietà specifici della configurazione, pertanto potrebbe essere necessario sostituirla in più posizioni.</span><span class="sxs-lookup"><span data-stu-id="436cb-120">This property is often in configuration-specific property groups, so you may need to replace it in multiple places.</span></span>
2. <span data-ttu-id="436cb-121">Sostituire `<TargetFrameworkVersion>` le `<TargetFramework>netcoreapp3.1</TargetFramework>`proprietà con .</span><span class="sxs-lookup"><span data-stu-id="436cb-121">Replace `<TargetFrameworkVersion>` properties with `<TargetFramework>netcoreapp3.1</TargetFramework>`.</span></span>
3. <span data-ttu-id="436cb-122">Rimuovere tutti i riferimenti `<Reference Include="System" />`di .NET Framework (ad esempio ).</span><span class="sxs-lookup"><span data-stu-id="436cb-122">Remove any .NET Framework references (like `<Reference Include="System" />`).</span></span> <span data-ttu-id="436cb-123">Agli assembly di .NET Core `<CLRSupport>NetCore</CLRSupport>`SDK viene fatto automaticamente riferimento quando si utilizza .</span><span class="sxs-lookup"><span data-stu-id="436cb-123">.NET Core SDK assemblies are automatically referenced when using `<CLRSupport>NetCore</CLRSupport>`.</span></span>
4. <span data-ttu-id="436cb-124">Aggiornare l'utilizzo dell'API nei file cpp, se necessario, per rimuovere le API non disponibili per .NET Core.Update API usage in cpp files, as necessary, to remove APIs unavailable to .NET Core.</span><span class="sxs-lookup"><span data-stu-id="436cb-124">Update API usage in cpp files, as necessary, to remove APIs unavailable to .NET Core.</span></span> <span data-ttu-id="436cb-125">Dal caso in cui i progetti di c'è/CLI tendano ad essere livelli di interoperabilità piuttosto sottili, spesso non sono necessarie molte modifiche.</span><span class="sxs-lookup"><span data-stu-id="436cb-125">Because C++/CLI projects tend to be fairly thin interop layers, there are often not many changes needed.</span></span> <span data-ttu-id="436cb-126">[L'analizzatore di portabilità .NET](../../standard/analyzers/portability-analyzer.md) può essere utilizzato per identificare le API .NET non supportate utilizzate dai file binari di C.NET e non solo come per i file binari puramente gestiti.</span><span class="sxs-lookup"><span data-stu-id="436cb-126">The [.NET Portability Analyzer](../../standard/analyzers/portability-analyzer.md) can be used to identify unsupported .NET APIs used by C++/CLI binaries just as with purely managed binaries.</span></span> <span data-ttu-id="436cb-127">Le linee guida per determinare la portabilità del codice e l'aggiornamento dei progetti da utilizzare con le API di .NET Core sono disponibili nelle linee guida per il porting della [libreria.](./libraries.md#determine-portability)</span><span class="sxs-lookup"><span data-stu-id="436cb-127">Guidelines for determining code portability and updating projects to work with .NET Core APIs are available in the [library porting guidance](./libraries.md#determine-portability).</span></span>

### <a name="wpf-and-windows-forms-usage"></a><span data-ttu-id="436cb-128">Utilizzo di WPF e Windows FormWPF and Windows Forms usage</span><span class="sxs-lookup"><span data-stu-id="436cb-128">WPF and Windows Forms usage</span></span>

<span data-ttu-id="436cb-129">I progetti di .NET Core di C/CLI possono utilizzare le API di Windows Form e WPF.</span><span class="sxs-lookup"><span data-stu-id="436cb-129">.NET Core C++/CLI projects can use Windows Forms and WPF APIs.</span></span> <span data-ttu-id="436cb-130">Per usare queste API desktop di Windows, è necessario aggiungere riferimenti framework espliciti alle librerie dell'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="436cb-130">To use these Windows desktop APIs, you need to add explicit framework references to the UI libraries.</span></span> <span data-ttu-id="436cb-131">I progetti in stile SDK che utilizzano le API desktop `Microsoft.NET.Sdk.WindowsDesktop` di Windows fanno automaticamente riferimento alle librerie di framework necessarie utilizzando l'SDK.</span><span class="sxs-lookup"><span data-stu-id="436cb-131">SDK-style projects that use Windows desktop APIs reference the necessary framework libraries automatically by using the `Microsoft.NET.Sdk.WindowsDesktop` SDK.</span></span> <span data-ttu-id="436cb-132">Dal momento che i progetti di c'è/CLI non utilizzano il formato di progetto di tipo SDK, è necessario aggiungere riferimenti a framework espliciti durante la destinazione di .NET Core.</span><span class="sxs-lookup"><span data-stu-id="436cb-132">Because C++/CLI projects don't use the SDK-style project format, they need to add explicit framework references when targeting .NET Core.</span></span>

<span data-ttu-id="436cb-133">Per utilizzare le API di Windows Form, aggiungere questo riferimento al file vcxproj:</span><span class="sxs-lookup"><span data-stu-id="436cb-133">To use Windows Forms APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference all of Windows Forms -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App.WindowsForms" />
```

<span data-ttu-id="436cb-134">Per usare le API WPFWPF, aggiungere questo riferimento al file vcxproj:</span><span class="sxs-lookup"><span data-stu-id="436cb-134">To use WPF APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference all of WPF -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App.WPF" />
```

<span data-ttu-id="436cb-135">Per utilizzare entrambe le API Windows Form e WPF, aggiungere questo riferimento al file vcxproj:</span><span class="sxs-lookup"><span data-stu-id="436cb-135">To use both Windows Forms and WPF APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference the entirety of the Windows desktop framework:
     Windows Forms, WPF, and the types that provide integration between them -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App" />
```

<span data-ttu-id="436cb-136">Attualmente, non è possibile aggiungere questi riferimenti utilizzando il gestore dei riferimenti di Visual Studio.Currently, it's not possible to add these references using Visual Studio's reference manager.</span><span class="sxs-lookup"><span data-stu-id="436cb-136">Currently, it's not possible to add these references using Visual Studio's reference manager.</span></span> <span data-ttu-id="436cb-137">Al contrario, aggiornare manualmente il file di progetto.</span><span class="sxs-lookup"><span data-stu-id="436cb-137">Instead, update the project file manually.</span></span> <span data-ttu-id="436cb-138">Questo aggiornamento può essere fatto in Visual Studio scaricando il progetto e quindi la modifica del file di progetto.</span><span class="sxs-lookup"><span data-stu-id="436cb-138">This update can be done in Visual Studio by unloading the project and then editing the project file.</span></span> <span data-ttu-id="436cb-139">È anche possibile usare un altro editor come VS Code.You can also use another editor like VS Code.</span><span class="sxs-lookup"><span data-stu-id="436cb-139">You can also use another editor like VS Code.</span></span>

## <a name="build-without-msbuild"></a><span data-ttu-id="436cb-140">Compilazione senza MSBuild</span><span class="sxs-lookup"><span data-stu-id="436cb-140">Build without MSBuild</span></span>

<span data-ttu-id="436cb-141">È anche possibile compilare progetti c'è/CLI senza utilizzare MSBuild.</span><span class="sxs-lookup"><span data-stu-id="436cb-141">It's also possible to build C++/CLI projects without using MSBuild.</span></span> <span data-ttu-id="436cb-142">Attenersi alla seguente procedura per compilare un progetto di C/CLI per .NET Core direttamente con *cl.exe* e *link.exe*:</span><span class="sxs-lookup"><span data-stu-id="436cb-142">Follow these steps to build a C++/CLI project for .NET Core directly with *cl.exe* and *link.exe*:</span></span>

1. <span data-ttu-id="436cb-143">Durante la compilazione, passare `-clr:netcore` a *cl.exe*.</span><span class="sxs-lookup"><span data-stu-id="436cb-143">When compiling, pass `-clr:netcore` to *cl.exe*.</span></span>
2. <span data-ttu-id="436cb-144">Fare riferimento agli assembly di riferimento .NET Core necessari.</span><span class="sxs-lookup"><span data-stu-id="436cb-144">Reference necessary .NET Core reference assemblies.</span></span>
3. <span data-ttu-id="436cb-145">Durante il collegamento, fornire la directory `LibPath` host dell'app .NET Core come (in modo che sia possibile *trovare ijwhost.lib).*</span><span class="sxs-lookup"><span data-stu-id="436cb-145">When linking, provide the .NET Core app host directory as a `LibPath` (so that *ijwhost.lib* can be found).</span></span>
4. <span data-ttu-id="436cb-146">Copiare *ijwhost.dll* (dalla directory host dell'app .NET Core) nella directory di output del progetto.</span><span class="sxs-lookup"><span data-stu-id="436cb-146">Copy *ijwhost.dll* (from the .NET Core app host directory) to the project's output directory.</span></span>
5. <span data-ttu-id="436cb-147">Assicurarsi che esista un file [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) per il primo componente dell'applicazione che eseguirà codice gestito.</span><span class="sxs-lookup"><span data-stu-id="436cb-147">Make sure a [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) file exists for the first component of the application that will run managed code.</span></span> <span data-ttu-id="436cb-148">Se l'applicazione dispone di `runtime.config` un punto di ingresso gestito, verrà creato e copiato automaticamente un file.</span><span class="sxs-lookup"><span data-stu-id="436cb-148">If the application has a managed entry point, a `runtime.config` file will be created and copied automatically.</span></span> <span data-ttu-id="436cb-149">Se l'applicazione dispone di un punto di `runtimeconfig.json` ingresso nativo, tuttavia, è necessario creare un file per la prima libreria C .</span><span class="sxs-lookup"><span data-stu-id="436cb-149">If the application has a native entry point, though, you need to create a `runtimeconfig.json` file for the first C++/CLI library to use the .NET Core runtime.</span></span>

## <a name="known-issues"></a><span data-ttu-id="436cb-150">Problemi noti</span><span class="sxs-lookup"><span data-stu-id="436cb-150">Known issues</span></span>

<span data-ttu-id="436cb-151">Ci sono un paio di problemi noti da guardare fuori per quando si lavora con i progetti di C .</span><span class="sxs-lookup"><span data-stu-id="436cb-151">There are a couple known issues to look out for when working with C++/CLI projects targeting .NET Core.</span></span>

* <span data-ttu-id="436cb-152">Un riferimento al framework WPF nei progetti .NET Core di .NET Core/CLI attualmente causa alcuni avvisi estranei sull'impossibilità di importare i simboli.</span><span class="sxs-lookup"><span data-stu-id="436cb-152">A WPF framework reference in .NET Core C++/CLI projects currently causes some extraneous warnings about being unable to import symbols.</span></span> <span data-ttu-id="436cb-153">Questi avvisi possono essere tranquillamente ignorati e devono essere corretti a breve.</span><span class="sxs-lookup"><span data-stu-id="436cb-153">These warnings can be safely ignored and should be fixed soon.</span></span>
* <span data-ttu-id="436cb-154">Se l'applicazione dispone di un punto di ingresso nativo, la libreria c'è/CLI che esegue per prima il codice gestito richiede un file [runtimeconfig.json.](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md)</span><span class="sxs-lookup"><span data-stu-id="436cb-154">If the application has a native entry point, the C++/CLI library that first executes managed code needs a [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) file.</span></span> <span data-ttu-id="436cb-155">Questo file di configurazione viene utilizzato all'avvio del runtime di .NET Core.This config file is used when the .NET Core runtime starts.</span><span class="sxs-lookup"><span data-stu-id="436cb-155">This config file is used when the .NET Core runtime starts.</span></span> <span data-ttu-id="436cb-156">I progetti di C/CLI `runtimeconfig.json` non creano ancora automaticamente i file in fase di compilazione, pertanto il file deve essere generato manualmente.</span><span class="sxs-lookup"><span data-stu-id="436cb-156">C++/CLI projects don't create `runtimeconfig.json` files automatically at build time yet, so the file must be generated manually.</span></span> <span data-ttu-id="436cb-157">Se viene chiamata una libreria c'è/CLI da un punto di ingresso gestito, `runtimeconfig.json` la libreria C/CLI non necessita di un file (poiché l'assembly del punto di ingresso ne avrà uno utilizzato all'avvio del runtime).</span><span class="sxs-lookup"><span data-stu-id="436cb-157">If a C++/CLI library is called from a managed entry point, then the C++/CLI library doesn't need a `runtimeconfig.json` file (since the entry point assembly will have one that is used when starting the runtime).</span></span> <span data-ttu-id="436cb-158">Di seguito `runtimeconfig.json` è riportato un semplice file di esempio.</span><span class="sxs-lookup"><span data-stu-id="436cb-158">A simple sample `runtimeconfig.json` file is shown below.</span></span> <span data-ttu-id="436cb-159">Per ulteriori informazioni, vedere le [specifiche in GitHub](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md).</span><span class="sxs-lookup"><span data-stu-id="436cb-159">For more information, see the [spec on GitHub](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md).</span></span>

    ```json
    {
          "runtimeOptions": {
             "tfm": "netcoreapp3.1",
             "framework": {
                "name": "Microsoft.NETCore.App",
                "version": "3.1.0"
             }
          }
    }
    ```
