---
title: Migrazione C++di progetti/CLI a .NET Core
description: Informazioni sul porting C++di progetti/CLI a .NET Core.
author: mjrousos
ms.date: 01/10/2020
ms.openlocfilehash: eb03f2a5ff42e8279fd3ebd6ee6fb6d955f6798d
ms.sourcegitcommit: c01c18755bb7b0f82c7232314ccf7955ea7834db
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/15/2020
ms.locfileid: "75964930"
---
# <a name="how-to-port-a-ccli-project-to-net-core"></a><span data-ttu-id="78ad3-103">Come trasferire un C++progetto/CLI a .NET Core</span><span class="sxs-lookup"><span data-stu-id="78ad3-103">How to port a C++/CLI project to .NET Core</span></span>

<span data-ttu-id="78ad3-104">A partire da .NET Core 3,1 e Visual Studio 2019 versione 16,4, [ C++i progetti/CLI](/cpp/dotnet/dotnet-programming-with-cpp-cli-visual-cpp) possono essere destinati a .NET Core.</span><span class="sxs-lookup"><span data-stu-id="78ad3-104">Beginning with .NET Core 3.1 and Visual Studio 2019 version 16.4, [C++/CLI projects](/cpp/dotnet/dotnet-programming-with-cpp-cli-visual-cpp) can target .NET Core.</span></span> <span data-ttu-id="78ad3-105">Questo supporto rende possibile trasferire le applicazioni desktop di Windows con C++i livelli di interoperabilità/CLI a .NET Core.</span><span class="sxs-lookup"><span data-stu-id="78ad3-105">This support makes it possible to port Windows desktop applications with C++/CLI interop layers to .NET Core.</span></span> <span data-ttu-id="78ad3-106">Questo articolo descrive come trasferire C++i progetti/cli da .NET Framework a .net core 3,1.</span><span class="sxs-lookup"><span data-stu-id="78ad3-106">This article describes how to port C++/CLI projects from .NET Framework to .NET Core 3.1.</span></span>

## <a name="ccli-net-core-limitations"></a><span data-ttu-id="78ad3-107">C++Limitazioni di .NET Core/CLI</span><span class="sxs-lookup"><span data-stu-id="78ad3-107">C++/CLI .NET Core limitations</span></span>

<span data-ttu-id="78ad3-108">Esistono alcune importanti limitazioni per il porting C++di progetti/CLI a .NET Core rispetto ad altri linguaggi:</span><span class="sxs-lookup"><span data-stu-id="78ad3-108">There are some important limitations to porting C++/CLI projects to .NET Core compared to other languages:</span></span>

* <span data-ttu-id="78ad3-109">C++Il supporto di/CLI per .NET Core è solo Windows.</span><span class="sxs-lookup"><span data-stu-id="78ad3-109">C++/CLI support for .NET Core is Windows only.</span></span>
* <span data-ttu-id="78ad3-110">C++I progetti/CLI non possono avere come destinazione .NET Standard, solo .NET Core (o .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="78ad3-110">C++/CLI projects can't target .NET Standard, only .NET Core (or .NET Framework).</span></span>
* <span data-ttu-id="78ad3-111">C++I progetti/CLI non supportano il nuovo formato di file di progetto in stile SDK.</span><span class="sxs-lookup"><span data-stu-id="78ad3-111">C++/CLI projects don't support the new SDK-style project file format.</span></span> <span data-ttu-id="78ad3-112">In alternativa, anche quando la destinazione è .NET C++core, i progetti/CLI usano il formato di file vcxproj esistente.</span><span class="sxs-lookup"><span data-stu-id="78ad3-112">Instead, even when targeting .NET Core, C++/CLI projects use the existing vcxproj file format.</span></span>
* <span data-ttu-id="78ad3-113">C++I progetti/CLI non possono usare più piattaforme .NET come destinazione.</span><span class="sxs-lookup"><span data-stu-id="78ad3-113">C++/CLI projects can't multitarget multiple .NET platforms.</span></span> <span data-ttu-id="78ad3-114">Se è necessario compilare un C++progetto/cli per .NET Framework e .NET Core, usare file di progetto distinti.</span><span class="sxs-lookup"><span data-stu-id="78ad3-114">If you need to build a C++/CLI project for both .NET Framework and .NET Core, use separate project files.</span></span>
* <span data-ttu-id="78ad3-115">.NET Core non supporta la compilazione `-clr:pure` o `-clr:safe`, ma solo la nuova opzione `-clr:netcore` (equivalente a `-clr` per .NET Framework).</span><span class="sxs-lookup"><span data-stu-id="78ad3-115">.NET Core doesn't support `-clr:pure` or `-clr:safe` compilation, only the new `-clr:netcore` option (which is equivalent to `-clr` for .NET Framework).</span></span>

## <a name="port-a-ccli-project"></a><span data-ttu-id="78ad3-116">Porta un C++progetto/CLI</span><span class="sxs-lookup"><span data-stu-id="78ad3-116">Port a C++/CLI project</span></span>

<span data-ttu-id="78ad3-117">Per trasferire un C++progetto/CLI a .NET Core, apportare le modifiche seguenti al file vcxproj.</span><span class="sxs-lookup"><span data-stu-id="78ad3-117">To port a C++/CLI project to .NET Core, make the following changes to the vcxproj file.</span></span> <span data-ttu-id="78ad3-118">Questi passaggi di migrazione sono diversi dai passaggi necessari per altri tipi di C++progetto perché i progetti/CLI non utilizzano file di progetto in stile SDK.</span><span class="sxs-lookup"><span data-stu-id="78ad3-118">These migration steps differ from the steps needed for other project types because C++/CLI projects don't use SDK-style project files.</span></span>

1. <span data-ttu-id="78ad3-119">Sostituire `<CLRSupport>true</CLRSupport>` proprietà con `<CLRSupport>NetCore</CLRSupport>`.</span><span class="sxs-lookup"><span data-stu-id="78ad3-119">Replace `<CLRSupport>true</CLRSupport>` properties with `<CLRSupport>NetCore</CLRSupport>`.</span></span> <span data-ttu-id="78ad3-120">Questa proprietà è spesso presente nei gruppi di proprietà specifici della configurazione, pertanto potrebbe essere necessario sostituirla in più posizioni.</span><span class="sxs-lookup"><span data-stu-id="78ad3-120">This property is often in configuration-specific property groups, so you may need to replace it in multiple places.</span></span>
2. <span data-ttu-id="78ad3-121">Sostituire `<TargetFrameworkVersion>` proprietà con `<TargetFramework>netcoreapp3.1</TargetFramework>`.</span><span class="sxs-lookup"><span data-stu-id="78ad3-121">Replace `<TargetFrameworkVersion>` properties with `<TargetFramework>netcoreapp3.1</TargetFramework>`.</span></span>
3. <span data-ttu-id="78ad3-122">Rimuovere tutti i riferimenti .NET Framework, ad esempio `<Reference Include="System" />`.</span><span class="sxs-lookup"><span data-stu-id="78ad3-122">Remove any .NET Framework references (like `<Reference Include="System" />`).</span></span> <span data-ttu-id="78ad3-123">Viene fatto automaticamente riferimento agli assembly .NET Core SDK quando si usa `<CLRSupport>NetCore</CLRSupport>`.</span><span class="sxs-lookup"><span data-stu-id="78ad3-123">.NET Core SDK assemblies are automatically referenced when using `<CLRSupport>NetCore</CLRSupport>`.</span></span>
4. <span data-ttu-id="78ad3-124">Aggiornare l'utilizzo dell'API nei file cpp, se necessario, per rimuovere le API non disponibili in .NET Core.</span><span class="sxs-lookup"><span data-stu-id="78ad3-124">Update API usage in cpp files, as necessary, to remove APIs unavailable to .NET Core.</span></span> <span data-ttu-id="78ad3-125">Poiché C++i progetti/CLI tendono a essere piuttosto sottili, spesso non è necessario apportare molte modifiche.</span><span class="sxs-lookup"><span data-stu-id="78ad3-125">Because C++/CLI projects tend to be fairly thin interop layers, there are often not many changes needed.</span></span> <span data-ttu-id="78ad3-126">[.NET Portability Analyzer](../../standard/analyzers/portability-analyzer.md) può essere usato per identificare le API .NET non supportate usate dai C++file binari/CLI come per i file binari puramente gestiti.</span><span class="sxs-lookup"><span data-stu-id="78ad3-126">The [.NET Portability Analyzer](../../standard/analyzers/portability-analyzer.md) can be used to identify unsupported .NET APIs used by C++/CLI binaries just as with purely managed binaries.</span></span> <span data-ttu-id="78ad3-127">Le linee guida per determinare la portabilità del codice e l'aggiornamento dei progetti da usare con le API .NET Core sono disponibili nelle linee guida per la [portabilità della libreria](./libraries.md#determine-portability).</span><span class="sxs-lookup"><span data-stu-id="78ad3-127">Guidelines for determining code portability and updating projects to work with .NET Core APIs are available in the [library porting guidance](./libraries.md#determine-portability).</span></span>

### <a name="wpf-and-windows-forms-usage"></a><span data-ttu-id="78ad3-128">Utilizzo di WPF e Windows Forms</span><span class="sxs-lookup"><span data-stu-id="78ad3-128">WPF and Windows Forms usage</span></span>

<span data-ttu-id="78ad3-129">I progetti C++.NET Core/CLI possono usare le API Windows Forms e WPF.</span><span class="sxs-lookup"><span data-stu-id="78ad3-129">.NET Core C++/CLI projects can use Windows Forms and WPF APIs.</span></span> <span data-ttu-id="78ad3-130">Per usare queste API desktop di Windows, è necessario aggiungere riferimenti espliciti ai Framework alle librerie dell'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="78ad3-130">To use these Windows desktop APIs, you need to add explicit framework references to the UI libraries.</span></span> <span data-ttu-id="78ad3-131">I progetti di tipo SDK che usano le API di Windows Desktop fanno riferimento alle librerie di Framework necessarie automaticamente usando il `Microsoft.NET.Sdk.WindowsDesktop` SDK.</span><span class="sxs-lookup"><span data-stu-id="78ad3-131">SDK-style projects that use Windows desktop APIs reference the necessary framework libraries automatically by using the `Microsoft.NET.Sdk.WindowsDesktop` SDK.</span></span> <span data-ttu-id="78ad3-132">Poiché C++i progetti/CLI non usano il formato di progetto in stile SDK, devono aggiungere riferimenti espliciti al framework quando sono destinati a .NET Core.</span><span class="sxs-lookup"><span data-stu-id="78ad3-132">Because C++/CLI projects don't use the SDK-style project format, they need to add explicit framework references when targeting .NET Core.</span></span>

<span data-ttu-id="78ad3-133">Per usare Windows Forms API, aggiungere questo riferimento al file vcxproj:</span><span class="sxs-lookup"><span data-stu-id="78ad3-133">To use Windows Forms APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference all of Windows Forms -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App.WindowsForms" />
```

<span data-ttu-id="78ad3-134">Per usare le API WPF, aggiungere questo riferimento al file vcxproj:</span><span class="sxs-lookup"><span data-stu-id="78ad3-134">To use WPF APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference all of WPF -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App.WPF" />
```

<span data-ttu-id="78ad3-135">Per usare sia Windows Forms che le API WPF, aggiungere questo riferimento al file vcxproj:</span><span class="sxs-lookup"><span data-stu-id="78ad3-135">To use both Windows Forms and WPF APIs, add this reference to the vcxproj file:</span></span>

```xml
<!-- Reference the entirety of the Windows desktop framework:
     Windows Forms, WPF, and the types that provide integration between them -->
<FrameworkReference Include="Microsoft.WindowsDesktop.App" />
```

<span data-ttu-id="78ad3-136">Attualmente, non è possibile aggiungere questi riferimenti usando Gestione riferimenti di Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="78ad3-136">Currently, it's not possible to add these references using Visual Studio's reference manager.</span></span> <span data-ttu-id="78ad3-137">Aggiornare invece manualmente il file di progetto.</span><span class="sxs-lookup"><span data-stu-id="78ad3-137">Instead, update the project file manually.</span></span> <span data-ttu-id="78ad3-138">Questo aggiornamento può essere eseguito in Visual Studio scaricando il progetto e quindi modificando il file di progetto.</span><span class="sxs-lookup"><span data-stu-id="78ad3-138">This update can be done in Visual Studio by unloading the project and then editing the project file.</span></span> <span data-ttu-id="78ad3-139">È anche possibile usare un altro editor, ad esempio VS Code.</span><span class="sxs-lookup"><span data-stu-id="78ad3-139">You can also use another editor like VS Code.</span></span>

## <a name="build-without-msbuild"></a><span data-ttu-id="78ad3-140">Compila senza MSBuild</span><span class="sxs-lookup"><span data-stu-id="78ad3-140">Build without MSBuild</span></span>

<span data-ttu-id="78ad3-141">È anche possibile compilare C++progetti/CLI senza usare MSBuild.</span><span class="sxs-lookup"><span data-stu-id="78ad3-141">It's also possible to build C++/CLI projects without using MSBuild.</span></span> <span data-ttu-id="78ad3-142">Per compilare un C++progetto/CLI per .NET Core direttamente con *CL. exe* e *link. exe*, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="78ad3-142">Follow these steps to build a C++/CLI project for .NET Core directly with *cl.exe* and *link.exe*:</span></span>

1. <span data-ttu-id="78ad3-143">Quando si esegue la compilazione, passare `-clr:netcore` a *CL. exe*.</span><span class="sxs-lookup"><span data-stu-id="78ad3-143">When compiling, pass `-clr:netcore` to *cl.exe*.</span></span>
2. <span data-ttu-id="78ad3-144">Fare riferimento agli assembly di riferimento di .NET Core necessari.</span><span class="sxs-lookup"><span data-stu-id="78ad3-144">Reference necessary .NET Core reference assemblies.</span></span>
3. <span data-ttu-id="78ad3-145">Quando si esegue il collegamento, fornire la directory host dell'app .NET Core come `LibPath` (in modo che sia possibile trovare *ijwhost. lib* ).</span><span class="sxs-lookup"><span data-stu-id="78ad3-145">When linking, provide the .NET Core app host directory as a `LibPath` (so that *ijwhost.lib* can be found).</span></span>
4. <span data-ttu-id="78ad3-146">Copiare *ijwhost. dll* (dalla directory host dell'app .NET Core) alla directory di output del progetto.</span><span class="sxs-lookup"><span data-stu-id="78ad3-146">Copy *ijwhost.dll* (from the .NET Core app host directory) to the project's output directory.</span></span>
5. <span data-ttu-id="78ad3-147">Assicurarsi che esista un file [runtimeconfig. JSON](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) per il primo componente dell'applicazione che eseguirà il codice gestito.</span><span class="sxs-lookup"><span data-stu-id="78ad3-147">Make sure a [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) file exists for the first component of the application that will run managed code.</span></span> <span data-ttu-id="78ad3-148">Se l'applicazione dispone di un punto di ingresso gestito, un file di `runtime.config` verrà creato e copiato automaticamente.</span><span class="sxs-lookup"><span data-stu-id="78ad3-148">If the application has a managed entry point, a `runtime.config` file will be created and copied automatically.</span></span> <span data-ttu-id="78ad3-149">Se l'applicazione dispone di un punto di ingresso nativo, tuttavia, è necessario creare un file di `runtimeconfig.json` per C++la prima libreria/CLI per l'uso del runtime di .NET Core.</span><span class="sxs-lookup"><span data-stu-id="78ad3-149">If the application has a native entry point, though, you need to create a `runtimeconfig.json` file for the first C++/CLI library to use the .NET Core runtime.</span></span>

## <a name="known-issues"></a><span data-ttu-id="78ad3-150">Problemi noti</span><span class="sxs-lookup"><span data-stu-id="78ad3-150">Known issues</span></span>

<span data-ttu-id="78ad3-151">Esistono un paio di problemi noti da considerare quando si usano progetti C++/CLI destinati a .NET Core.</span><span class="sxs-lookup"><span data-stu-id="78ad3-151">There are a couple known issues to look out for when working with C++/CLI projects targeting .NET Core.</span></span>

* <span data-ttu-id="78ad3-152">Un riferimento a un framework WPF nei C++progetti .NET Core/CLI causa attualmente alcuni avvisi estranei che non sono in grado di importare simboli.</span><span class="sxs-lookup"><span data-stu-id="78ad3-152">A WPF framework reference in .NET Core C++/CLI projects currently causes some extraneous warnings about being unable to import symbols.</span></span> <span data-ttu-id="78ad3-153">Questi avvisi possono essere tranquillamente ignorati e devono essere risolti a breve.</span><span class="sxs-lookup"><span data-stu-id="78ad3-153">These warnings can be safely ignored and should be fixed soon.</span></span>
* <span data-ttu-id="78ad3-154">Se l'applicazione dispone di un punto di ingresso nativo C++, la libreria/CLI che esegue per la prima volta il codice gestito necessita di un file [runtimeconfig. JSON](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) .</span><span class="sxs-lookup"><span data-stu-id="78ad3-154">If the application has a native entry point, the C++/CLI library that first executes managed code needs a [runtimeconfig.json](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md) file.</span></span> <span data-ttu-id="78ad3-155">Questo file di configurazione viene usato all'avvio del runtime di .NET Core.</span><span class="sxs-lookup"><span data-stu-id="78ad3-155">This config file is used when the .NET Core runtime starts.</span></span> <span data-ttu-id="78ad3-156">C++I progetti/CLI non creano ancora file di `runtimeconfig.json` in fase di compilazione, pertanto il file deve essere generato manualmente.</span><span class="sxs-lookup"><span data-stu-id="78ad3-156">C++/CLI projects don't create `runtimeconfig.json` files automatically at build time yet, so the file must be generated manually.</span></span> <span data-ttu-id="78ad3-157">Se una C++libreria/CLI viene chiamata da un punto di ingresso gestito, la C++libreria/CLI non necessita di un file di `runtimeconfig.json` (dal momento che l'assembly del punto di ingresso ne avrà uno usato all'avvio del Runtime).</span><span class="sxs-lookup"><span data-stu-id="78ad3-157">If a C++/CLI library is called from a managed entry point, then the C++/CLI library doesn't need a `runtimeconfig.json` file (since the entry point assembly will have one that is used when starting the runtime).</span></span> <span data-ttu-id="78ad3-158">Di seguito è riportato un semplice file di `runtimeconfig.json` di esempio.</span><span class="sxs-lookup"><span data-stu-id="78ad3-158">A simple sample `runtimeconfig.json` file is shown below.</span></span> <span data-ttu-id="78ad3-159">Per altre informazioni, vedere la [specifica su GitHub](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md).</span><span class="sxs-lookup"><span data-stu-id="78ad3-159">For more information, see the [spec on GitHub](https://github.com/dotnet/cli/blob/master/Documentation/specs/runtime-configuration-file.md).</span></span>

    ```json
    {
          "runtimeOptions": {
             "tfm": "netcoreapp3.1",
             "framework": {
                "name": "Microsoft.NETCore.App",
                "version": "3.1.0"
             }
          }
    }
    ```
