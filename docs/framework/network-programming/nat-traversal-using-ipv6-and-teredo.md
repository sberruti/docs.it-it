---
title: Attraversamento NAT con IPv6 e Teredo
ms.date: 03/30/2017
ms.assetid: 568cd245-3300-49ef-a995-d81bf845d961
ms.openlocfilehash: f617dc8912091576727b90da1e9efb9ebd5f9bda
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/15/2020
ms.locfileid: "61642178"
---
# <a name="nat-traversal-using-ipv6-and-teredo"></a><span data-ttu-id="4f85d-102">Attraversamento NAT con IPv6 e Teredo</span><span class="sxs-lookup"><span data-stu-id="4f85d-102">NAT Traversal using IPv6 and Teredo</span></span>
<span data-ttu-id="4f85d-103">Sono stati introdotti miglioramenti per il supporto dell'attraversamento NAT (Network Address Translation).</span><span class="sxs-lookup"><span data-stu-id="4f85d-103">Enhancements were made that provide support for Network Address Translation (NAT) traversal.</span></span> <span data-ttu-id="4f85d-104">Queste modifiche sono progettate per l'uso con IPv6 e Teredo, ma sono applicabili anche ad altre tecnologie di tunneling IP.</span><span class="sxs-lookup"><span data-stu-id="4f85d-104">These changes are designed for use with IPv6 and Teredo, but they are also applicable to other IP tunneling technologies.</span></span> <span data-ttu-id="4f85d-105">Questi miglioramenti hanno effetti sulle classi in <xref:System.Net> e sugli spazi dei nomi correlati.</span><span class="sxs-lookup"><span data-stu-id="4f85d-105">These enhancements affect classes in the <xref:System.Net> and related namespaces.</span></span>  
  
 <span data-ttu-id="4f85d-106">Queste modifiche possono influire sulle applicazioni client e server che prevedono di usare tecnologie di tunneling IP.</span><span class="sxs-lookup"><span data-stu-id="4f85d-106">These changes can affect client and server applications that plan to use IP tunneling technologies.</span></span>  
  
 <span data-ttu-id="4f85d-107">Le modifiche per il supporto dell'attraversamento NAT sono disponibili solo per le applicazioni che usano .NET Framework versione 4.</span><span class="sxs-lookup"><span data-stu-id="4f85d-107">The changes to support NAT traversal are available only for applications using .NET Framework version 4.</span></span> <span data-ttu-id="4f85d-108">Queste funzionalità non sono disponibili nelle versioni precedenti di .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="4f85d-108">These features are not available on earlier versions of the .NET Framework.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="4f85d-109">Panoramica</span><span class="sxs-lookup"><span data-stu-id="4f85d-109">Overview</span></span>  
 <span data-ttu-id="4f85d-110">Internet Protocol versione 4 (IPv4) definisce un indirizzo IPv4 con una lunghezza di 32 bit.</span><span class="sxs-lookup"><span data-stu-id="4f85d-110">The Internet Protocol version 4 (IPv4) defined an IPv4 address as 32 bits long.</span></span> <span data-ttu-id="4f85d-111">Di conseguenza, IPv4 supporta circa 4 miliardi di indirizzi IP univoci (2^32).</span><span class="sxs-lookup"><span data-stu-id="4f85d-111">As a result, IPv4 supports approximately 4 billion unique IP addresses (2^32).</span></span> <span data-ttu-id="4f85d-112">Con la grande crescita del numero di computer e dispositivi di rete in Internet negli anni '90 sono diventati evidenti i limiti dello spazio indirizzi IPv4.</span><span class="sxs-lookup"><span data-stu-id="4f85d-112">As the number of computers and network devices on the Internet expanded in the 1990s, the limits of the IPv4 address space became apparent.</span></span>  
  
 <span data-ttu-id="4f85d-113">Una delle diverse tecniche usate per estendere la durata di IPv4 è stata distribuire NAT per consentire a un singolo indirizzo IP pubblico univoco di rappresentare un numero elevato di indirizzi IP privati (Intranet privata).</span><span class="sxs-lookup"><span data-stu-id="4f85d-113">One of several techniques used to extend the lifetime of IPv4 has been to deploy NAT to allow a single unique public IP address to represent a large number of private IP addresses (private Intranet).</span></span> <span data-ttu-id="4f85d-114">Gli indirizzi IP privati dietro il dispositivo NAT condividono un singolo indirizzo IPv4 pubblico.</span><span class="sxs-lookup"><span data-stu-id="4f85d-114">The private IP addresses behind the NAT device share the single public IPv4 address.</span></span> <span data-ttu-id="4f85d-115">Il dispositivo NAT può essere un dispositivo hardware dedicato (ad esempio, un punto di accesso wireless e router economico) o un computer che esegue un servizio per fornire funzionalità NAT.</span><span class="sxs-lookup"><span data-stu-id="4f85d-115">The NAT device may be a dedicated hardware device (an inexpensive Wireless Access Point and router, for example) or a computer running a service to provide NAT.</span></span> <span data-ttu-id="4f85d-116">Un dispositivo o un servizio per questo indirizzo IP pubblico converte i pacchetti di rete IP tra la rete Internet pubblica e la rete Intranet privata.</span><span class="sxs-lookup"><span data-stu-id="4f85d-116">A device or service for this public IP address translates IP network packets between the public Internet and the private Intranet.</span></span>  
  
 <span data-ttu-id="4f85d-117">Questo schema è appropriato per le applicazioni client eseguite sulla rete Intranet privata che inviano richieste ad altri indirizzi IP (in genere i server) su Internet.</span><span class="sxs-lookup"><span data-stu-id="4f85d-117">This scheme works well for client applications running on the private Intranet that send requests to other IP addresses (usually servers) on the Internet.</span></span> <span data-ttu-id="4f85d-118">Il dispositivo NAT o il server può mantenere aggiornato un mapping delle richieste client, in modo che alla restituzione di una risposta sappia dove inviarla.</span><span class="sxs-lookup"><span data-stu-id="4f85d-118">The NAT device or server can keep a mapping of client requests so when a response is returned it knows where to send the response.</span></span> <span data-ttu-id="4f85d-119">Ma questo schema pone problemi per le applicazioni in esecuzione nella rete Intranet privata dietro il dispositivo NAT che vogliono fornire servizi, restare in ascolto dei pacchetti e rispondere.</span><span class="sxs-lookup"><span data-stu-id="4f85d-119">But this scheme poses problems for applications running in the private Intranet behind the NAT device that want to provide services, listen for packets, and respond.</span></span> <span data-ttu-id="4f85d-120">Ciò è vero in particolare per le applicazioni peer-to-peer.</span><span class="sxs-lookup"><span data-stu-id="4f85d-120">This is particularly the case for peer-to-peer applications.</span></span>  
  
 <span data-ttu-id="4f85d-121">Il protocollo IPv6 definisce un indirizzo IPv4 con una lunghezza di 128 bit.</span><span class="sxs-lookup"><span data-stu-id="4f85d-121">The IPv6 protocol defined an IPv4 address as 128 bits long.</span></span> <span data-ttu-id="4f85d-122">Di conseguenza, IPv6 supporta uno spazio indirizzi IP molto grande, pari a 3,2 x 10^38 indirizzi univoci (2^128).</span><span class="sxs-lookup"><span data-stu-id="4f85d-122">As a result, IPv6 supports very a large IP address space of 3.2 x 10^38 unique addresses (2^128).</span></span> <span data-ttu-id="4f85d-123">Con uno spazio indirizzi di queste dimensioni, a ogni dispositivo connesso a Internet può essere assegnato un indirizzo univoco.</span><span class="sxs-lookup"><span data-stu-id="4f85d-123">With an address space of this size, it is possible for every device connected to the Internet to be given a unique address.</span></span> <span data-ttu-id="4f85d-124">Ci sono però dei problemi.</span><span class="sxs-lookup"><span data-stu-id="4f85d-124">But there are problems.</span></span> <span data-ttu-id="4f85d-125">Gran parte del mondo continua a usare solo IPv4.</span><span class="sxs-lookup"><span data-stu-id="4f85d-125">Much of the world is still using only IPv4.</span></span> <span data-ttu-id="4f85d-126">In particolare, molti dei router e dei punti di accesso wireless esistenti usati da piccole imprese, organizzazioni e privati non supportano IPv6.</span><span class="sxs-lookup"><span data-stu-id="4f85d-126">In particular, many of the existing routers and wireless access points used by small companies, organizations, and households do not support IPv6.</span></span> <span data-ttu-id="4f85d-127">Anche alcuni provider di servizi Internet che offrono i loro servizi a questo tipo di clienti non supportano o non hanno configurato il supporto per IPv6.</span><span class="sxs-lookup"><span data-stu-id="4f85d-127">Also some Internet service providers that serve these customers either do not support or have not configured support for IPv6.</span></span>  
  
 <span data-ttu-id="4f85d-128">Sono state sviluppate varie tecnologie per la transizione a IPv6 per eseguire il tunneling di indirizzi IPv6 in un pacchetto IPv4.</span><span class="sxs-lookup"><span data-stu-id="4f85d-128">Several IPv6 transition technologies have been developed to tunnel IPv6 addresses in an IPv4 packet.</span></span> <span data-ttu-id="4f85d-129">Queste tecnologie includono tunnel 6to4, ISATAP e Teredo che gestiscono l'assegnazione di indirizzi e il tunneling automatico da host a host per il traffico unicast IPv6 quando gli host IPv6 devono attraversare reti IPv4 per raggiungere altre reti IPv6.</span><span class="sxs-lookup"><span data-stu-id="4f85d-129">These technologies include 6to4, ISATAP, and Teredo tunnels that provide address assignment and host-to-host automatic tunneling for unicast IPv6 traffic when IPv6 hosts must traverse IP4 networks to reach other IPv6 networks.</span></span> <span data-ttu-id="4f85d-130">I pacchetti IPv6 vengono inviati tramite tunnel come pacchetti IPv4.</span><span class="sxs-lookup"><span data-stu-id="4f85d-130">IPv6 packets are sent tunneled as IPv4 packets.</span></span> <span data-ttu-id="4f85d-131">Sono attualmente in uso varie tecniche di tunneling per consentire l'attraversamento NAT per gli indirizzi IPv6 attraverso un dispositivo NAT.</span><span class="sxs-lookup"><span data-stu-id="4f85d-131">Several tunneling techniques are being used that allow NAT traversal for IPv6 addresses through a NAT device.</span></span>  
  
 <span data-ttu-id="4f85d-132">Teredo è una delle tecnologie per la transizione a IPv6 che rende disponibile la connettività IPv6 per le reti IPv4.</span><span class="sxs-lookup"><span data-stu-id="4f85d-132">Teredo is one of the IPv6 transition technologies which brings IPv6 connectivity to IPv4 networks.</span></span> <span data-ttu-id="4f85d-133">Teredo è documentato nella specifica RFC 4380 pubblicata da Internet Engineering Task Force (IETF).</span><span class="sxs-lookup"><span data-stu-id="4f85d-133">Teredo is documented in RFC 4380 published by the Internet Engineering Task Force (IETF).</span></span> <span data-ttu-id="4f85d-134">Windows XP SP2 e versioni successive forniscono il supporto per una scheda Teredo virtuale che può fornire un indirizzo IPv6 pubblico nell'intervallo 2001:0::/32.</span><span class="sxs-lookup"><span data-stu-id="4f85d-134">Windows XP SP2 and later provide support for a virtual Teredo adapter which can provide a public IPv6 address in the range 2001:0::/32.</span></span> <span data-ttu-id="4f85d-135">Questo indirizzo IPv6 può essere usato per l'ascolto delle connessioni in ingresso da Internet e può essere fornito ai client abilitati per IPv6 che vogliono connettersi al servizio in ascolto.</span><span class="sxs-lookup"><span data-stu-id="4f85d-135">This IPv6 address can be used to listen for incoming connections from the Internet and can be provided to IPv6 enabled clients that wish to connect to the listening service.</span></span> <span data-ttu-id="4f85d-136">In questo modo, un'applicazione non deve preoccuparsi di come gestire l'indirizzo per un computer protetto da un dispositivo NAT, dato che può semplicemente connettersi a esso tramite il relativo indirizzo Teredo IPv6.</span><span class="sxs-lookup"><span data-stu-id="4f85d-136">This frees an application from worrying about how to address a computer behind a NAT device, since the application can just connect to it using its IPv6 Teredo address.</span></span>  
  
## <a name="enhancements-to-support-nat-traversal-and-teredo"></a><span data-ttu-id="4f85d-137">Miglioramenti al supporto dell'attraversamento NAT e Teredo</span><span class="sxs-lookup"><span data-stu-id="4f85d-137">Enhancements to Support NAT Traversal and Teredo</span></span>  
 <span data-ttu-id="4f85d-138">Sono stati introdotti miglioramenti per gli spazi dei nomi <xref:System.Net>, <xref:System.Net.NetworkInformation> e <xref:System.Net.Sockets> per il supporto dell'attraversamento NAT con IPv6 e Teredo.</span><span class="sxs-lookup"><span data-stu-id="4f85d-138">Enhancements are added to the <xref:System.Net>, <xref:System.Net.NetworkInformation>, and <xref:System.Net.Sockets> namespaces for supporting NAT traversal using IPv6 and Teredo.</span></span>  
  
 <span data-ttu-id="4f85d-139">Sono stati aggiunti vari metodi alla classe <xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=nameWithType> per ottenere l'elenco di indirizzi IP unicast nell'host.</span><span class="sxs-lookup"><span data-stu-id="4f85d-139">Several methods are added to the <xref:System.Net.NetworkInformation.IPGlobalProperties?displayProperty=nameWithType> class to get the list of unicast IP addresses on the host.</span></span> <span data-ttu-id="4f85d-140">Il metodo <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A> avvia una richiesta asincrona per recuperare la tabella di indirizzi IP unicast stabili nel computer locale.</span><span class="sxs-lookup"><span data-stu-id="4f85d-140">The <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A> method begins an asynchronous request to retrieve the stable unicast IP address table on the local computer.</span></span> <span data-ttu-id="4f85d-141">Il metodo <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A> termina una richiesta asincrona in sospeso per recuperare la tabella di indirizzi IP unicast stabili nel computer locale.</span><span class="sxs-lookup"><span data-stu-id="4f85d-141">The <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A> method ends a pending asynchronous request to retrieve the stable unicast IP address table on the local computer.</span></span> <span data-ttu-id="4f85d-142">Il metodo <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A> è una richiesta sincrona per recuperare la tabella di indirizzi IP unicast stabili nel computer locale, aspettando che la tabella di indirizzi si stabilizzi se necessario.</span><span class="sxs-lookup"><span data-stu-id="4f85d-142">The <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A> method is a synchronous request to retrieve the stable unicast IP address table on the local computer, waiting until the address table stabilizes if necessary.</span></span>  
  
 <span data-ttu-id="4f85d-143">È possibile usare la proprietà <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType> per determinare se un <xref:System.Net.IPAddress> è un indirizzo IPv6 Teredo.</span><span class="sxs-lookup"><span data-stu-id="4f85d-143">The <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType> property can be used to determine if an <xref:System.Net.IPAddress> is an IPv6 Teredo address.</span></span>  
  
 <span data-ttu-id="4f85d-144">L'uso di questi nuovi metodi della classe <xref:System.Net.NetworkInformation.IPGlobalProperties> in combinazione con la proprietà <xref:System.Net.IPAddress.IsIPv6Teredo%2A> consente a un'applicazione di trovare con facilità l'indirizzo Teredo.</span><span class="sxs-lookup"><span data-stu-id="4f85d-144">Using these new <xref:System.Net.NetworkInformation.IPGlobalProperties> class methods in combination with the <xref:System.Net.IPAddress.IsIPv6Teredo%2A> property allows an application to easily find the Teredo address.</span></span> <span data-ttu-id="4f85d-145">Un'applicazione ha in genere solo l'esigenza di conoscere l'indirizzo Teredo locale se comunica queste informazioni ad applicazioni remote.</span><span class="sxs-lookup"><span data-stu-id="4f85d-145">An application normally only needs to know the local Teredo address if it is communicating this information to remote applications.</span></span> <span data-ttu-id="4f85d-146">Ad esempio, un'applicazione peer-to-peer potrebbe inviare tutti i relativi indirizzi IPv6 a un server di matchmaking che può quindi inoltrarli agli altri peer per consentire la comunicazione diretta.</span><span class="sxs-lookup"><span data-stu-id="4f85d-146">For example, a peer-to-peer application might send all of its IPv6 addresses to a matchmaking server which can then forward them to others peers to enable direct communication.</span></span>  
  
 <span data-ttu-id="4f85d-147">Un'applicazione deve impostare normalmente il servizio di ascolto per l'ascolto di <xref:System.Net.IPAddress.IPv6Any?displayProperty=nameWithType> anziché dell'indirizzo Teredo locale.</span><span class="sxs-lookup"><span data-stu-id="4f85d-147">An application should normally set its listening service to listen on <xref:System.Net.IPAddress.IPv6Any?displayProperty=nameWithType> rather than on the local Teredo address.</span></span> <span data-ttu-id="4f85d-148">In questo modo, se un client remoto o peer dispone di una route IPv6 diretta all'host del servizio di ascolto, il client o il peer può connettersi direttamente tramite IPv6 senza dover usare Teredo per il tunneling dei pacchetti.</span><span class="sxs-lookup"><span data-stu-id="4f85d-148">So if a remote client or peer has a direct IPv6 route to the host of the listening service, the client or peer can connect directly using IPv6 and not have to use Teredo to tunnel packets.</span></span>  
  
 <span data-ttu-id="4f85d-149">Per le applicazioni TCP, la classe <xref:System.Net.Sockets.TcpListener?displayProperty=nameWithType> include un metodo <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A> per abilitare l'attraversamento NAT.</span><span class="sxs-lookup"><span data-stu-id="4f85d-149">For TCP applications, the <xref:System.Net.Sockets.TcpListener?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A> method to enable NAT traversal.</span></span> <span data-ttu-id="4f85d-150">Per le applicazioni UDP, la classe <xref:System.Net.Sockets.UdpClient?displayProperty=nameWithType> include un metodo <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A> per abilitare l'attraversamento NAT.</span><span class="sxs-lookup"><span data-stu-id="4f85d-150">For UDP applications, the <xref:System.Net.Sockets.UdpClient?displayProperty=nameWithType> class has an <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A> method to enable NAT traversal.</span></span>  
  
 <span data-ttu-id="4f85d-151">Per le applicazioni che usano la classe <xref:System.Net.Sockets.Socket?displayProperty=nameWithType> e le classi correlate, è possibile usare i metodi <xref:System.Net.Sockets.Socket.GetSocketOption%2A> e <xref:System.Net.Sockets.Socket.SetSocketOption%2A> con l'opzione socket <xref:System.Net.Sockets.SocketOptionName.IPProtectionLevel?displayProperty=nameWithType> per ottenere, abilitare o disabilitare l'attraversamento NAT.</span><span class="sxs-lookup"><span data-stu-id="4f85d-151">For applications that use the <xref:System.Net.Sockets.Socket?displayProperty=nameWithType> and related classes, the <xref:System.Net.Sockets.Socket.GetSocketOption%2A> and <xref:System.Net.Sockets.Socket.SetSocketOption%2A> methods can be used with the <xref:System.Net.Sockets.SocketOptionName.IPProtectionLevel?displayProperty=nameWithType> socket option to query, enable, or disable NAT traversal.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4f85d-152">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="4f85d-152">See also</span></span>

- <xref:System.Net.IPAddress.IsIPv6Teredo%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.BeginGetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.EndGetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.NetworkInformation.IPGlobalProperties.GetUnicastAddresses%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.IPProtectionLevel?displayProperty=nameWithType>
- <xref:System.Net.Sockets.Socket.SetIPProtectionLevel%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.TcpListener.AllowNatTraversal%2A?displayProperty=nameWithType>
- <xref:System.Net.Sockets.UdpClient.AllowNatTraversal%2A?displayProperty=nameWithType>
