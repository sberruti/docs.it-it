---
title: Modifiche apportate all'autenticazione NTLM per HttpWebRequest nella versione 3.5 SP1
ms.date: 03/30/2017
ms.assetid: 8bf0b428-5a21-4299-8d6e-bf8251fd978a
ms.openlocfilehash: 388e6dc648e1fd68e24a852cb08de107f09f9c9f
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/15/2020
ms.locfileid: "64754882"
---
# <a name="changes-to-ntlm-authentication-for-httpwebrequest-in-version-35-sp1"></a><span data-ttu-id="76dd4-102">Modifiche apportate all'autenticazione NTLM per HttpWebRequest nella versione 3.5 SP1</span><span class="sxs-lookup"><span data-stu-id="76dd4-102">Changes to NTLM authentication for HttpWebRequest in Version 3.5 SP1</span></span>

<span data-ttu-id="76dd4-103">In .NET Framework 3.5 SP1 e versioni successive sono state apportate modifiche per la sicurezza che influiscono sul modo in cui l'autenticazione integrata di Windows viene gestita da <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream> e dalle classi correlate nello spazio dei nomi System.Net.</span><span class="sxs-lookup"><span data-stu-id="76dd4-103">Security changes were made in .NET Framework version 3.5 SP1 and later that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream>, and related classes in the System.Net namespace.</span></span> <span data-ttu-id="76dd4-104">Queste modifiche possono avere effetto sulle applicazioni che usano queste classi per eseguire richieste Web e ricevere risposte in cui viene usata l'autenticazione integrata di Windows basata su NTLM.</span><span class="sxs-lookup"><span data-stu-id="76dd4-104">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication based on NTLM is used.</span></span> <span data-ttu-id="76dd4-105">Possono inoltre influire sulle applicazioni client e sui server Web configurati per l'utilizzo dell'autenticazione integrata di Windows.</span><span class="sxs-lookup"><span data-stu-id="76dd4-105">This change can impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>

## <a name="overview"></a><span data-ttu-id="76dd4-106">Panoramica</span><span class="sxs-lookup"><span data-stu-id="76dd4-106">Overview</span></span>

<span data-ttu-id="76dd4-107">La progettazione dell'autenticazione integrata di Windows fa sì che alcune risposte con verifica delle credenziali siano universali, ovvero possano essere riusate o inoltrate.</span><span class="sxs-lookup"><span data-stu-id="76dd4-107">The design of integrated Windows authentication allows for some credential responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="76dd4-108">Se questa particolare funzionalità di progettazione non è necessaria, i protocolli di autenticazione dovrebbero contenere informazioni specifiche sulla destinazione e sul canale.</span><span class="sxs-lookup"><span data-stu-id="76dd4-108">If this particular design feature is not needed, then the authentication protocols should carry target specific information as well as channel specific information.</span></span> <span data-ttu-id="76dd4-109">I servizi possono quindi fornire protezione estesa per garantire che le risposte con verifica delle credenziali contengano informazioni specifiche sui servizi, ad esempio il nome di un'entità servizio (SPN).</span><span class="sxs-lookup"><span data-stu-id="76dd4-109">Services can then provide extended protection to ensure that credential responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="76dd4-110">Con queste informazioni nello scambio di credenziali, i servizi possono offrire migliore protezione contro l'utilizzo dannoso di risposte con verifica delle credenziali che potrebbero essere state ottenute in modo improprio.</span><span class="sxs-lookup"><span data-stu-id="76dd4-110">With this information in the credential exchanges, services are able to better protect against malicious use of credential responses that might have been improperly obtained.</span></span>

<span data-ttu-id="76dd4-111">Più componenti negli spazi dei nomi <xref:System.Net> e <xref:System.Net.Security> eseguono l'autenticazione integrata di Windows per conto di un'applicazione chiamante.</span><span class="sxs-lookup"><span data-stu-id="76dd4-111">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="76dd4-112">Questa sezione descrive le modifiche apportate ai componenti System.Net per aggiungere la protezione estesa quando usano l'autenticazione integrata di Windows.</span><span class="sxs-lookup"><span data-stu-id="76dd4-112">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>

## <a name="changes"></a><span data-ttu-id="76dd4-113">Modifiche</span><span class="sxs-lookup"><span data-stu-id="76dd4-113">Changes</span></span>

<span data-ttu-id="76dd4-114">Il processo di autenticazione basato su NTLM usato con l'autenticazione integrata di Windows include spesso una richiesta di verifica inviata dal computer di destinazione e quindi ritrasmessa al computer client.</span><span class="sxs-lookup"><span data-stu-id="76dd4-114">The NTLM authentication process used with integrated Windows authentication includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="76dd4-115">Quando un computer riceve una richiesta di verifica generata dal computer stesso, l'autenticazione ha esito negativo a meno che non si tratti di una connessione di loopback, ad esempio con indirizzo IPv4 127.0.0.1.</span><span class="sxs-lookup"><span data-stu-id="76dd4-115">When a computer receives a challenge it generated itself, the authentication will fail unless the connection is a loop back connection (IPv4 address 127.0.0.1, for example).</span></span>

<span data-ttu-id="76dd4-116">Quando si accede a un servizio in esecuzione su un server Web interno, viene in genere usato un URL simile a `http://contoso/service` o `https://contoso/service`.</span><span class="sxs-lookup"><span data-stu-id="76dd4-116">When accessing a service running on an internal Web server, it is common to access the service using a URL similar to `http://contoso/service` or `https://contoso/service`.</span></span> <span data-ttu-id="76dd4-117">Il nome "contoso" spesso non corrisponde al nome del computer in cui viene distribuito il servizio.</span><span class="sxs-lookup"><span data-stu-id="76dd4-117">The name "contoso" is often not the computer name of the computer on which the service is deployed.</span></span> <span data-ttu-id="76dd4-118">Per risolvere i nomi in indirizzi, <xref:System.Net> e gli spazi dei nomi correlati supportano l'utilizzo di Active Directory, DNS, NetBIOS, del file hosts del computer locale (in genere WINDOWS\system32\drivers\etc\hosts) o del file lmhosts del computer locale (in genere WINDOWS\system32\drivers\etc\lmhosts).</span><span class="sxs-lookup"><span data-stu-id="76dd4-118">The <xref:System.Net> and related namespaces support using Active Directory, DNS, NetBIOS, the local computer's hosts file (typically WINDOWS\system32\drivers\etc\hosts, for example), or the local computer's lmhosts file (typically WINDOWS\system32\drivers\etc\lmhosts, for example) to resolve names to addresses.</span></span> <span data-ttu-id="76dd4-119">Il nome "contoso" viene risolto in modo che le richieste a "contoso" vengono inviate al computer server appropriato.</span><span class="sxs-lookup"><span data-stu-id="76dd4-119">The name "contoso" is resolved so that requests sent to "contoso" are sent to the appropriate server computer.</span></span>

<span data-ttu-id="76dd4-120">Nel caso di distribuzioni di grandi dimensioni, è anche prassi comune assegnare alla distribuzione un singolo nome di server virtuale, senza che i nomi di computer sottostanti vengono mai usati dalle applicazioni client e dagli utenti finali.</span><span class="sxs-lookup"><span data-stu-id="76dd4-120">When configured for large deployments, it is also common for a single virtual server name to be given to the deployment with the underlying machine names never used by client applications and end users.</span></span> <span data-ttu-id="76dd4-121">È ad esempio possibile chiamare il server `www.contoso.com`, ma in una rete interna usare semplicemente "contoso".</span><span class="sxs-lookup"><span data-stu-id="76dd4-121">For example, you might call the server `www.contoso.com`, but on an internal network simply use "contoso".</span></span> <span data-ttu-id="76dd4-122">Questo nome è definito come intestazione Host nella richiesta Web del client.</span><span class="sxs-lookup"><span data-stu-id="76dd4-122">This name is called the Host header in the client web request.</span></span> <span data-ttu-id="76dd4-123">Come specificato dal protocollo HTTP, il campo dell'intestazione della richiesta Host specifica l'host Internet e il numero di porta della risorsa richiesta.</span><span class="sxs-lookup"><span data-stu-id="76dd4-123">As specified by the HTTP protocol, the Host request-header field specifies the Internet host and port number of the resource being requested.</span></span> <span data-ttu-id="76dd4-124">Queste informazioni vengono ottenute dall'URI di origine specificato dall'utente o dalla risorsa di riferimento, che in genere è un URL HTTP.</span><span class="sxs-lookup"><span data-stu-id="76dd4-124">This information is obtained from the original URI given by the user or referring resource (generally an HTTP URL).</span></span> <span data-ttu-id="76dd4-125">In .NET Framework versione 4 queste informazioni possono essere impostate anche dal client usando la nuova proprietà <xref:System.Net.HttpWebRequest.Host%2A>.</span><span class="sxs-lookup"><span data-stu-id="76dd4-125">On .NET Framework version 4, this information can also be set by the client using the new <xref:System.Net.HttpWebRequest.Host%2A> property.</span></span>

<span data-ttu-id="76dd4-126">La classe <xref:System.Net.AuthenticationManager> controlla i componenti di autenticazione gestita ("moduli") che vengono usati dalle classi derivate di <xref:System.Net.WebRequest> e dalla classe <xref:System.Net.WebClient>.</span><span class="sxs-lookup"><span data-stu-id="76dd4-126">The <xref:System.Net.AuthenticationManager> class controls the managed authentication components ("modules") that are used by <xref:System.Net.WebRequest> derivative classes and the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="76dd4-127">In <xref:System.Net.AuthenticationManager> è disponibile una proprietà che espone un oggetto <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType>, indicizzato in base alla stringa dell'URI, per consentire alle applicazioni di fornire una stringa SPN personalizzata da usare durante l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="76dd4-127">The <xref:System.Net.AuthenticationManager> class provides a property that exposes a <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> object, indexed by URI string, for applications to supply a custom SPN string to be used during authentication.</span></span>

<span data-ttu-id="76dd4-128">Nella versione 3.5 SP1, quando la proprietà <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> non è impostata, come stringa SPN nello scambio di autenticazione NTLM (NT LAN Manager) viene specificato per impostazione predefinita il nome host usato nell'URL della richiesta.</span><span class="sxs-lookup"><span data-stu-id="76dd4-128">Version 3.5 SP1 now defaults to specifying the host name used in the request URL in the SPN in the NTLM (NT LAN Manager) authentication exchange when the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property is not set.</span></span> <span data-ttu-id="76dd4-129">Il nome host usato nell'URL della richiesta può essere diverso dall'intestazione Host specificata in <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> nella richiesta del client.</span><span class="sxs-lookup"><span data-stu-id="76dd4-129">The host name used in the request URL may be different from the Host header specified in the <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> in the client request.</span></span> <span data-ttu-id="76dd4-130">Il nome host usato nell'URL della richiesta può essere diverso dal nome host effettivo del server, dal nome computer del server, dall'indirizzo IP del computer o dall'indirizzo di loopback.</span><span class="sxs-lookup"><span data-stu-id="76dd4-130">The host name used in the request URL may be different from the actual host name of the server, the machine name of the server, the computer's IP address, or the loopback address.</span></span> <span data-ttu-id="76dd4-131">In questi casi la richiesta di autenticazione in Windows ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="76dd4-131">In these cases, Windows will fail the authentication request.</span></span> <span data-ttu-id="76dd4-132">Per risolvere il problema, è necessario notificare a Windows che il nome host usato nell'URL della richiesta del client, ad esempio "contoso", è in realtà un nome alternativo del computer locale.</span><span class="sxs-lookup"><span data-stu-id="76dd4-132">To address the issue, we need to notify Windows that the host name used in the request URL in the client request ("contoso", for example) is actually an alternate name for the local computer.</span></span>

<span data-ttu-id="76dd4-133">Sono possibili varie soluzioni per ovviare a questa modifica in un'applicazione server.</span><span class="sxs-lookup"><span data-stu-id="76dd4-133">There are several possible methods for a server application to work around this change.</span></span> <span data-ttu-id="76dd4-134">L'approccio consigliato consiste nell'eseguire il mapping del nome host usato nell'URL della richiesta alla chiave `BackConnectionHostNames` nel Registro di sistema sul server.</span><span class="sxs-lookup"><span data-stu-id="76dd4-134">The recommended approach is to map the host name used in the request URL to the `BackConnectionHostNames` key in the registry on the server.</span></span> <span data-ttu-id="76dd4-135">La chiave `BackConnectionHostNames` viene normalmente usata per eseguire il mapping di un nome host a un indirizzo di loopback.</span><span class="sxs-lookup"><span data-stu-id="76dd4-135">The `BackConnectionHostNames` registry key is normally used to map a host name to a loopback address.</span></span> <span data-ttu-id="76dd4-136">Di seguito sono elencati i passaggi da seguire.</span><span class="sxs-lookup"><span data-stu-id="76dd4-136">The steps are listed below.</span></span>

<span data-ttu-id="76dd4-137">Per specificare i nomi host di cui è stato eseguito il mapping con l'indirizzo di loopback e che possono connettersi a siti Web in un computer locale, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="76dd4-137">To specify the host names that are mapped to the loopback address and can connect to Web sites on a local computer, follow these steps:</span></span>

1. <span data-ttu-id="76dd4-138">Fare clic su Start, scegliere Esegui, digitare regedit e quindi fare clic su OK.</span><span class="sxs-lookup"><span data-stu-id="76dd4-138">Click Start, click Run, type regedit, and then click OK.</span></span>

2. <span data-ttu-id="76dd4-139">Nell'editor del Registro di sistema cercare la chiave del Registro di sistema seguente e selezionarla:</span><span class="sxs-lookup"><span data-stu-id="76dd4-139">In Registry Editor, locate and then click the following registry key:</span></span>

    `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0`

3. <span data-ttu-id="76dd4-140">Fare clic con il pulsante destro del mouse su MSV1_0, scegliere Nuovo e quindi fare clic su Valore multistringa.</span><span class="sxs-lookup"><span data-stu-id="76dd4-140">Right-click MSV1_0, point to New, and then click Multi-String Value.</span></span>

4. <span data-ttu-id="76dd4-141">Digitare `BackConnectionHostNames` e quindi premere INVIO.</span><span class="sxs-lookup"><span data-stu-id="76dd4-141">Type `BackConnectionHostNames`, and then press ENTER.</span></span>

5. <span data-ttu-id="76dd4-142">Fare clic con il pulsante destro del mouse su `BackConnectionHostNames` e quindi scegliere Modifica.</span><span class="sxs-lookup"><span data-stu-id="76dd4-142">Right-click `BackConnectionHostNames`, and then click Modify.</span></span>

6. <span data-ttu-id="76dd4-143">Nella casella Dati valore digitare uno o più nomi host (come specificato nell'URL della richiesta) per i siti presenti nel computer locale e quindi fare clic su OK.</span><span class="sxs-lookup"><span data-stu-id="76dd4-143">In the Value data box, type the host name or the host names for the sites (the host name used in the request URL) that are on the local computer, and then click OK.</span></span>

7. <span data-ttu-id="76dd4-144">Chiudere l'editor del Registro di sistema e quindi riavviare il servizio IISAdmin ed eseguire IISReset.</span><span class="sxs-lookup"><span data-stu-id="76dd4-144">Quit Registry Editor, and then restart the IISAdmin service and run IISReset.</span></span>

<span data-ttu-id="76dd4-145">Una soluzione alternativa meno sicura consiste nel disabilitare il controllo di loopback, come descritto in <https://support.microsoft.com/kb/896861>.</span><span class="sxs-lookup"><span data-stu-id="76dd4-145">A less secure work around is to disable the loop back check, as described in <https://support.microsoft.com/kb/896861>.</span></span> <span data-ttu-id="76dd4-146">Questa operazione ha l'effetto di disabilitare la protezione contro attacchi di tipo reflection.</span><span class="sxs-lookup"><span data-stu-id="76dd4-146">This disables the protection against reflection attacks.</span></span> <span data-ttu-id="76dd4-147">È pertanto preferibile limitare l'impostazione di nomi alternativi a quelli che si presume vengano effettivamente usati dal computer.</span><span class="sxs-lookup"><span data-stu-id="76dd4-147">So it is better to constrain the set of alternate names to only those you expect the machine to actually use.</span></span>

## <a name="see-also"></a><span data-ttu-id="76dd4-148">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="76dd4-148">See also</span></span>

- <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType>
- <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType>
- <xref:System.Net.HttpWebRequest.Host%2A?displayProperty=nameWithType>
