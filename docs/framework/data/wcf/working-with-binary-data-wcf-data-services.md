---
title: Utilizzo di dati binari (WCF Data Services)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, binary data
- WCF Data Services, streams
ms.assetid: aeccc45c-d5c5-4671-ad63-a492ac8043ac
ms.openlocfilehash: aa3e58d559121aaca401e7b851a4b4fd8e7753cd
ms.sourcegitcommit: 7088f87e9a7da144266135f4b2397e611cf0a228
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/11/2020
ms.locfileid: "75900836"
---
# <a name="working-with-binary-data-wcf-data-services"></a><span data-ttu-id="46c7a-102">Utilizzo di dati binari (WCF Data Services)</span><span class="sxs-lookup"><span data-stu-id="46c7a-102">Working with Binary Data (WCF Data Services)</span></span>

<span data-ttu-id="46c7a-103">La libreria client di WCF Data Services consente di recuperare e aggiornare i dati binari da un feed di Open Data Protocol (OData) in uno dei modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="46c7a-103">The WCF Data Services client library enables you to retrieve and update binary data from an Open Data Protocol (OData) feed in one of the following ways:</span></span>

- <span data-ttu-id="46c7a-104">Come proprietà di tipo primitivo di un'entità.</span><span class="sxs-lookup"><span data-stu-id="46c7a-104">As a primitive type property of an entity.</span></span> <span data-ttu-id="46c7a-105">Si tratta del metodo consigliato per l'uso di oggetti dati binari di dimensioni ridotte che possono essere caricati facilmente in memoria.</span><span class="sxs-lookup"><span data-stu-id="46c7a-105">This is the recommended method for working with small binary data objects that can be easily loaded into memory.</span></span> <span data-ttu-id="46c7a-106">In questo caso, la proprietà binaria è una proprietà dell'entità esposta dal modello di dati e il servizio dati serializza i dati binari come codice XML binario in base 64 nel messaggio di risposta.</span><span class="sxs-lookup"><span data-stu-id="46c7a-106">In this case, the binary property is an entity property exposed by the data model, and the data service serializes the binary data as base-64 binary encoded XML in the response message.</span></span>

- <span data-ttu-id="46c7a-107">Come flusso separato di risorse binarie.</span><span class="sxs-lookup"><span data-stu-id="46c7a-107">As a separate binary resource stream.</span></span> <span data-ttu-id="46c7a-108">Si tratta del metodo consigliato per l'accesso e la modifica di dati di oggetti binari di grandi dimensioni (BLOB) che possono rappresentare una foto, un video o qualsiasi altro tipo di dati codificati binari.</span><span class="sxs-lookup"><span data-stu-id="46c7a-108">This is the recommended method for accessing and changing binary large object (BLOB) data that may represent a photo, video, or any other type of binary encoded data.</span></span>

<span data-ttu-id="46c7a-109">WCF Data Services implementa il flusso di dati binari tramite HTTP come definito in OData.</span><span class="sxs-lookup"><span data-stu-id="46c7a-109">WCF Data Services implements the streaming of binary data by using HTTP as defined in the OData.</span></span> <span data-ttu-id="46c7a-110">In questo meccanismo, i dati binari vengono considerati come una risorsa multimediale che è separata da ma correlata a un'entità, denominata voce di collegamento multimediale.</span><span class="sxs-lookup"><span data-stu-id="46c7a-110">In this mechanism, binary data is treated as a media resource that is separate from but related to an entity, which is called a media link entry.</span></span> <span data-ttu-id="46c7a-111">Per ulteriori informazioni, vedere [provider di flussi](streaming-provider-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="46c7a-111">For more information, see [Streaming Provider](streaming-provider-wcf-data-services.md).</span></span>

> [!TIP]
> <span data-ttu-id="46c7a-112">Per un esempio dettagliato di come creare un'applicazione client Windows Presentation Foundation (WPF) che Scarica i file di immagine binari da un servizio OData che archivia le foto, vedere la [serie Post Data Services Streaming provider-parte 2: accesso a un flusso di risorse multimediali dal client](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span><span class="sxs-lookup"><span data-stu-id="46c7a-112">For a step-by-step example of how to create a Windows Presentation Foundation (WPF) client application that downloads binary image files from an OData service that stores photos, see the post [Data Services Streaming Provider Series-Part 2: Accessing a Media Resource Stream from the Client](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span></span> <span data-ttu-id="46c7a-113">Per scaricare il codice di esempio per il servizio dati di foto di flusso in evidenza nel post di Blog, vedere l' [esempio streaming Photo Data Service](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) in GitHub.</span><span class="sxs-lookup"><span data-stu-id="46c7a-113">To download the sample code for the stream photo data service featured in the blog post, see the [Streaming Photo Data Service Sample](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) in GitHub.</span></span>

## <a name="entity-metadata"></a><span data-ttu-id="46c7a-114">Metadati dell'entità</span><span class="sxs-lookup"><span data-stu-id="46c7a-114">Entity Metadata</span></span>

<span data-ttu-id="46c7a-115">Un'entità che dispone di un flusso di risorsa multimediale correlato viene indicata nei metadati del servizio dati dall'attributo `HasStream` applicato a un tipo di entità che è la voce di collegamento multimediale.</span><span class="sxs-lookup"><span data-stu-id="46c7a-115">An entity that has a related media resource stream is indicated in the data service metadata by the `HasStream` attribute applied to an entity type that is the media link entry.</span></span> <span data-ttu-id="46c7a-116">Nell'esempio seguente, l'entità `PhotoInfo` è una voce di collegamento multimediale con una risorsa multimediale correlata, indicata dall'attributo `HasStream`.</span><span class="sxs-lookup"><span data-stu-id="46c7a-116">In the following example, the `PhotoInfo` entity is a media link entry that has a related media resource, indicated by the `HasStream` attribute.</span></span>

[!code-xml[Astoria Photo Streaming Service#HasStream](../../../../samples/snippets/xml/VS_Snippets_Misc/astoria_photo_streaming_service/xml/photodata.edmx#hasstream)]

<span data-ttu-id="46c7a-117">Negli esempi restanti di questo argomento viene illustrato come accedere e modificare il flusso di risorsa multimediale.</span><span class="sxs-lookup"><span data-stu-id="46c7a-117">The remaining examples in this topic show how to access and change the media resource stream.</span></span> <span data-ttu-id="46c7a-118">Per un esempio completo su come usare un flusso di risorse multimediali in un'applicazione client di .NET Framework usando la libreria client di WCF Data Services, vedere l'articolo relativo all' [accesso a un flusso di risorse multimediali dal client](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span><span class="sxs-lookup"><span data-stu-id="46c7a-118">For a complete example of how to consume a media resource stream in a .NET Framework client application by using the WCF Data Services client library, see the post [Accessing a Media Resource Stream from the Client](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span></span>

## <a name="accessing-the-binary-resource-stream"></a><span data-ttu-id="46c7a-119">Accesso al flusso di risorsa binaria</span><span class="sxs-lookup"><span data-stu-id="46c7a-119">Accessing the Binary Resource Stream</span></span>

<span data-ttu-id="46c7a-120">La libreria client di WCF Data Services fornisce metodi per l'accesso ai flussi di risorse binarie da un servizio dati basato su OData.</span><span class="sxs-lookup"><span data-stu-id="46c7a-120">The WCF Data Services client library provides methods for accessing binary resource streams from an OData-based data service.</span></span> <span data-ttu-id="46c7a-121">Quando si scarica una risorsa multimediale, è possibile usare l'URI della risorsa multimediale od ottenere un flusso binario contenente i dati della risorsa multimediale.</span><span class="sxs-lookup"><span data-stu-id="46c7a-121">When downloading a media resource, you can either use the URI of the media resource or you can get a binary stream that contains the media resource data itself.</span></span> <span data-ttu-id="46c7a-122">È possibile caricare i dati della risorsa multimediale anche come un flusso binario.</span><span class="sxs-lookup"><span data-stu-id="46c7a-122">You can also upload media resource data as a binary stream.</span></span>

> [!TIP]
> <span data-ttu-id="46c7a-123">Per un esempio dettagliato di come creare un'applicazione client Windows Presentation Foundation (WPF) che Scarica i file di immagine binari da un servizio OData che archivia le foto, vedere la [serie Post Data Services Streaming provider-parte 2: accesso a un flusso di risorse multimediali dal client](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span><span class="sxs-lookup"><span data-stu-id="46c7a-123">For a step-by-step example of how to create a Windows Presentation Foundation (WPF) client application that downloads binary image files from an OData service that stores photos, see the post [Data Services Streaming Provider Series-Part 2: Accessing a Media Resource Stream from the Client](https://docs.microsoft.com/archive/blogs/astoriateam/data-services-streaming-provider-series-part-2-accessing-a-media-resource-stream-from-the-client).</span></span> <span data-ttu-id="46c7a-124">Per scaricare il codice di esempio per il servizio dati di foto di flusso in evidenza nel post di Blog, vedere l' [esempio streaming Photo Data Service](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) in GitHub.</span><span class="sxs-lookup"><span data-stu-id="46c7a-124">To download the sample code for the stream photo data service featured in the blog post, see the [Streaming Photo Data Service Sample](https://github.com/microsoftarchive/msdn-code-gallery-community-s-z/tree/master/Streaming%20Photo%20OData%20Service%20Sample) in GitHub.</span></span>

### <a name="getting-the-uri-of-the-binary-stream"></a><span data-ttu-id="46c7a-125">Recupero dell'URI del flusso binario</span><span class="sxs-lookup"><span data-stu-id="46c7a-125">Getting the URI of the Binary Stream</span></span>

<span data-ttu-id="46c7a-126">Quando si recuperano determinati tipi di risorse multimediali, ad esempio immagini e altri file multimediali, è spesso più semplice usare l'URI della risorsa multimediale nell'applicazione anziché gestire il flusso di dati binari.</span><span class="sxs-lookup"><span data-stu-id="46c7a-126">When retrieving certain types of media resources, such as images and other media files, it is often easier to use the URI of the media resource in your application than handling the binary data stream itself.</span></span> <span data-ttu-id="46c7a-127">Per ottenere l'URI di un flusso di risorsa associato a una data voce di collegamento multimediale, è necessario chiamare il metodo <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> sull'istanza <xref:System.Data.Services.Client.DataServiceContext> che tiene traccia dell'entità.</span><span class="sxs-lookup"><span data-stu-id="46c7a-127">To get the URI of a resource stream associated with a give media link entry, you must call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the entity.</span></span> <span data-ttu-id="46c7a-128">Nell'esempio seguente viene mostrato come chiamare il metodo <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> per ottenere l'URI di un flusso di risorsa multimediale usato per creare una nuova immagine nel client:</span><span class="sxs-lookup"><span data-stu-id="46c7a-128">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStreamUri%2A> method to get the URI of a media resource stream that is used to create a new image on the client:</span></span>

[!code-csharp[Astoria Photo Streaming Client#GetReadStreamUri](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_client/cs/photowindow.xaml.cs#getreadstreamuri)]
[!code-vb[Astoria Photo Streaming Client#GetReadStreamUri](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_client/vb/photowindow.xaml.vb#getreadstreamuri)]

### <a name="downloading-the-binary-resource-stream"></a><span data-ttu-id="46c7a-129">Download del flusso di risorsa binaria</span><span class="sxs-lookup"><span data-stu-id="46c7a-129">Downloading the Binary Resource Stream</span></span>

<span data-ttu-id="46c7a-130">Quando si recupera un flusso di risorsa binaria, è necessario chiamare il metodo <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> sull'istanza di <xref:System.Data.Services.Client.DataServiceContext> che tiene traccia della voce di collegamento multimediale.</span><span class="sxs-lookup"><span data-stu-id="46c7a-130">When retrieving a binary resource stream, you must call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the media link entry.</span></span> <span data-ttu-id="46c7a-131">Questo metodo invia una richiesta al servizio dati che restituisce un oggetto <xref:System.Data.Services.Client.DataServiceStreamResponse> che presenta un riferimento al flusso contenente la risorsa.</span><span class="sxs-lookup"><span data-stu-id="46c7a-131">This method sends a request to the data service that returns a <xref:System.Data.Services.Client.DataServiceStreamResponse> object, which has a reference to the stream that contains the resource.</span></span> <span data-ttu-id="46c7a-132">Usare questo metodo quando l'applicazione richiede la risorsa binaria come <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="46c7a-132">Use this method when your application requires the binary resource as a <xref:System.IO.Stream>.</span></span> <span data-ttu-id="46c7a-133">Nell'esempio seguente viene mostrato come chiamare il metodo <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> per recuperare un flusso usato per creare una nuova immagine nel client:</span><span class="sxs-lookup"><span data-stu-id="46c7a-133">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.GetReadStream%2A> method to retrieve a stream that is used to create a new image on the client:</span></span>

[!code-csharp[Astoria Streaming Client#GetReadStreamClient](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_streaming_client/cs/customerphotowindow.xaml.cs#getreadstreamclient)]
[!code-vb[Astoria Streaming Client#GetReadStreamClient](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_streaming_client/vb/customerphotowindow.xaml.vb#getreadstreamclient)]

> [!NOTE]
> <span data-ttu-id="46c7a-134">L'intestazione Content-Length nel messaggio di risposta che contiene il flusso binario non è impostata dal servizio dati.</span><span class="sxs-lookup"><span data-stu-id="46c7a-134">The Content-Length header in the response message that contains the binary steam is not set by the data service.</span></span> <span data-ttu-id="46c7a-135">È possibile che questo valore non rifletta la lunghezza effettiva del flusso di dati binari.</span><span class="sxs-lookup"><span data-stu-id="46c7a-135">This value may not reflect the actual length of the binary data stream.</span></span>

### <a name="uploading-a-media-resource-as-a-stream"></a><span data-ttu-id="46c7a-136">Caricamento di una risorsa multimediale come flusso</span><span class="sxs-lookup"><span data-stu-id="46c7a-136">Uploading a Media Resource as a Stream</span></span>

<span data-ttu-id="46c7a-137">Per inserire o aggiornare una risorsa multimediale, chiamare il metodo <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> sull'istanza <xref:System.Data.Services.Client.DataServiceContext> che tiene traccia dell'entità.</span><span class="sxs-lookup"><span data-stu-id="46c7a-137">To insert or update a media resource, call the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method on the <xref:System.Data.Services.Client.DataServiceContext> instance that is tracking the entity.</span></span> <span data-ttu-id="46c7a-138">Questo metodo invia una richiesta al servizio dati che contiene la risorsa multimediale letta dal flusso fornito.</span><span class="sxs-lookup"><span data-stu-id="46c7a-138">This method sends a request to the data service that contains the media resource read from the supplied stream.</span></span> <span data-ttu-id="46c7a-139">Nell'esempio seguente viene indicato come chiamare il metodo <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> per inviare un'immagine al servizio dati:</span><span class="sxs-lookup"><span data-stu-id="46c7a-139">The following example shows how to call the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method to send an image to the data service:</span></span>

[!code-csharp[Astoria Photo Streaming Client#SetSaveStream](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria_photo_streaming_client/cs/photodetailswindow.xaml.cs#setsavestream)]
[!code-vb[Astoria Photo Streaming Client#SetSaveStream](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria_photo_streaming_client/vb/photodetailswindow.xaml.vb#setsavestream)]

<span data-ttu-id="46c7a-140">In questo esempio il metodo <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> viene chiamato fornendo un valore `true` per il parametro `closeStream`.</span><span class="sxs-lookup"><span data-stu-id="46c7a-140">In this example, the <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A> method is called by supplying a value of `true` for the `closeStream` parameter.</span></span> <span data-ttu-id="46c7a-141">Ciò garantisce che <xref:System.Data.Services.Client.DataServiceContext> chiuda il flusso dopo aver caricato i dati binari nel servizio dati.</span><span class="sxs-lookup"><span data-stu-id="46c7a-141">This guarantees that the <xref:System.Data.Services.Client.DataServiceContext> closes the stream after the binary data is uploaded to the data service.</span></span>

> [!NOTE]
> <span data-ttu-id="46c7a-142">Quando si chiama <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A>, il flusso non viene inviato al servizio dati fino a quando non viene chiamato il metodo <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A>.</span><span class="sxs-lookup"><span data-stu-id="46c7a-142">When you call <xref:System.Data.Services.Client.DataServiceContext.SetSaveStream%2A>, the stream is not sent to the data service until <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> is called.</span></span>

## <a name="see-also"></a><span data-ttu-id="46c7a-143">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="46c7a-143">See also</span></span>

- [<span data-ttu-id="46c7a-144">Libreria client WCF Data Services</span><span class="sxs-lookup"><span data-stu-id="46c7a-144">WCF Data Services Client Library</span></span>](wcf-data-services-client-library.md)
- [<span data-ttu-id="46c7a-145">Associazione di dati a controlli</span><span class="sxs-lookup"><span data-stu-id="46c7a-145">Binding Data to Controls</span></span>](binding-data-to-controls-wcf-data-services.md)
