---
title: Proiezioni di query (WCF Data Services)
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- projection [WCF Data Services]
- WCF Data Services, projection
- query projection [WCF Data Services]
- WCF Data Services, querying
ms.assetid: a09f4985-9f0d-48c8-b183-83d67a3dfe5f
ms.openlocfilehash: 764ea6a77ba267e691d48bc72d17c02f6b3c18ca
ms.sourcegitcommit: 7088f87e9a7da144266135f4b2397e611cf0a228
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/11/2020
ms.locfileid: "75900968"
---
# <a name="query-projections-wcf-data-services"></a><span data-ttu-id="567e5-102">Proiezioni di query (WCF Data Services)</span><span class="sxs-lookup"><span data-stu-id="567e5-102">Query Projections (WCF Data Services)</span></span>

<span data-ttu-id="567e5-103">La proiezione fornisce un meccanismo nel Open Data Protocol (OData) per ridurre la quantità di dati nel feed restituiti da una query specificando che nella risposta vengono restituite solo determinate proprietà di un'entità.</span><span class="sxs-lookup"><span data-stu-id="567e5-103">Projection provides a mechanism in the Open Data Protocol (OData) to reduce the amount of data in the feed returned by a query by specifying that only certain properties of an entity are returned in the response.</span></span> <span data-ttu-id="567e5-104">Per ulteriori informazioni, vedere la sezione 4,8.</span><span class="sxs-lookup"><span data-stu-id="567e5-104">For more information, see section 4.8.</span></span> <span data-ttu-id="567e5-105">Selezionare l'opzione query di sistema ($select) nelle [convenzioni URI (OData versione 2,0)](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span><span class="sxs-lookup"><span data-stu-id="567e5-105">Select System Query Option ($select) in [URI Conventions (OData Version 2.0)](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span></span>

<span data-ttu-id="567e5-106">In questo argomento viene descritto come definire una proiezione di query e quali sono i requisiti per i tipi di entità e non entità. Viene inoltre illustrato come eseguire gli aggiornamenti dei risultati proiettati e creare i tipi proiettati e vengono elencate alcune considerazioni sulla proiezione.</span><span class="sxs-lookup"><span data-stu-id="567e5-106">This topic describes how to define a query projection, what the requirements are for entity and non-entity types, making updates to projected results, creating projected types, and lists some projection considerations.</span></span>

## <a name="defining-a-query-projection"></a><span data-ttu-id="567e5-107">Definizione di una proiezione di query</span><span class="sxs-lookup"><span data-stu-id="567e5-107">Defining a Query Projection</span></span>

<span data-ttu-id="567e5-108">È possibile aggiungere una clausola di proiezione a una query usando l'opzione query `$select` in un URI o usando la clausola [Select](../../../csharp/language-reference/keywords/select-clause.md) ([SELECT](../../../visual-basic/language-reference/queries/select-clause.md) in Visual Basic) in una query LINQ.</span><span class="sxs-lookup"><span data-stu-id="567e5-108">You can add a projection clause to a query either by using the `$select` query option in a URI or by using the [select](../../../csharp/language-reference/keywords/select-clause.md) clause ([Select](../../../visual-basic/language-reference/queries/select-clause.md) in Visual Basic) in a LINQ query.</span></span> <span data-ttu-id="567e5-109">I dati di entità restituiti possono essere proiettati in tipi di entità o non entità sul client.</span><span class="sxs-lookup"><span data-stu-id="567e5-109">Returned entity data can be projected into either entity types or non-entity types on the client.</span></span> <span data-ttu-id="567e5-110">Negli esempi di questo argomento viene illustrato l'uso della clausola `select` in una query LINQ.</span><span class="sxs-lookup"><span data-stu-id="567e5-110">Examples in this topic demonstrate how to use the `select` clause in a LINQ query.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="567e5-111">Quando si salvano gli aggiornamenti apportati ai tipi proiettati, potrebbe verificarsi una perdita di dati nel servizio dati.</span><span class="sxs-lookup"><span data-stu-id="567e5-111">Data loss might occur in the data service when you save updates that were made to projected types.</span></span> <span data-ttu-id="567e5-112">Per altre informazioni, vedere [considerazioni sulla proiezione](#considerations).</span><span class="sxs-lookup"><span data-stu-id="567e5-112">For more information, see [Projection Considerations](#considerations).</span></span>

## <a name="requirements-for-entity-and-non-entity-types"></a><span data-ttu-id="567e5-113">Requisiti per tipi di entità e non entità</span><span class="sxs-lookup"><span data-stu-id="567e5-113">Requirements for Entity and Non-Entity Types</span></span>

<span data-ttu-id="567e5-114">I tipi di entità devono disporre di una o più proprietà Identity che costituiscono la chiave di entità.</span><span class="sxs-lookup"><span data-stu-id="567e5-114">Entity types must have one or more identity properties that make up the entity key.</span></span> <span data-ttu-id="567e5-115">I tipi di entità vengono definiti nei client usando uno dei modi riportati di seguito.</span><span class="sxs-lookup"><span data-stu-id="567e5-115">Entity types are defined on clients in one of the following ways:</span></span>

- <span data-ttu-id="567e5-116">Tramite l'applicazione di <xref:System.Data.Services.Common.DataServiceKeyAttribute> o <xref:System.Data.Services.Common.DataServiceEntityAttribute> al tipo.</span><span class="sxs-lookup"><span data-stu-id="567e5-116">By applying the <xref:System.Data.Services.Common.DataServiceKeyAttribute> or <xref:System.Data.Services.Common.DataServiceEntityAttribute> to the type.</span></span>

- <span data-ttu-id="567e5-117">Tramite la proprietà `ID` del tipo.</span><span class="sxs-lookup"><span data-stu-id="567e5-117">When the type has a property named `ID`.</span></span>

- <span data-ttu-id="567e5-118">Quando il tipo dispone di una proprietà denominata *type*`ID`, dove *Type* è il nome del tipo.</span><span class="sxs-lookup"><span data-stu-id="567e5-118">When the type has a property named *type*`ID`, where *type* is the name of the type.</span></span>

<span data-ttu-id="567e5-119">Per impostazione predefinita, quando si proiettano i risultati delle query in un tipo definito nel client, le proprietà richieste nella proiezione devono esistere nel tipo di client.</span><span class="sxs-lookup"><span data-stu-id="567e5-119">By default, when you project query results into a type defined at the client, the properties requested in the projection must exist in the client type.</span></span> <span data-ttu-id="567e5-120">Tuttavia, quando si specifica un valore `true` per la proprietà <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> di <xref:System.Data.Services.Client.DataServiceContext>, non è necessario che le proprietà specificate nella proiezione siano presenti nel tipo di client.</span><span class="sxs-lookup"><span data-stu-id="567e5-120">However, when you specify a value of `true` for the <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> property of the <xref:System.Data.Services.Client.DataServiceContext>, properties specified in the projection are not required to occur in the client type.</span></span>

### <a name="making-updates-to-projected-results"></a><span data-ttu-id="567e5-121">Aggiornamenti dei risultati proiettati</span><span class="sxs-lookup"><span data-stu-id="567e5-121">Making Updates to Projected Results</span></span>

<span data-ttu-id="567e5-122">Quando si proiettano i risultati di una query in tipi di entità nel client, <xref:System.Data.Services.Client.DataServiceContext> può rilevare gli oggetti con aggiornamenti da restituire al servizio dati quando viene chiamato il metodo <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A>.</span><span class="sxs-lookup"><span data-stu-id="567e5-122">When you project query results into entity types on the client, the <xref:System.Data.Services.Client.DataServiceContext> can track those objects with updates to be sent back to the data service when the <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> method is called.</span></span> <span data-ttu-id="567e5-123">Tuttavia, gli aggiornamenti apportati ai dati proiettati in tipi di non entità nel client non possono essere restituiti al servizio dati,</span><span class="sxs-lookup"><span data-stu-id="567e5-123">However, updates that are made to data projected into non-entity types on the client cannot be sent back to the data service.</span></span> <span data-ttu-id="567e5-124">perché il servizio dati non può aggiornare l'entità corretta nell'origine dati senza una chiave per identificare l'istanza di entità.</span><span class="sxs-lookup"><span data-stu-id="567e5-124">This is because without a key to identify the entity instance, the data service cannot update the correct entity in the data source.</span></span> <span data-ttu-id="567e5-125">I tipi di non entità non vengono associati a <xref:System.Data.Services.Client.DataServiceContext>.</span><span class="sxs-lookup"><span data-stu-id="567e5-125">Non-entity types are not attached to the <xref:System.Data.Services.Client.DataServiceContext>.</span></span>

<span data-ttu-id="567e5-126">Quando una o più proprietà di un tipo di entità definito nel servizio dati non sono presenti nel tipo di client in cui viene proiettata l'entità, gli inserimenti di nuove entità non conterranno le proprietà mancanti.</span><span class="sxs-lookup"><span data-stu-id="567e5-126">When one or more properties of an entity type defined in the data service do not occur in the client type into which the entity is projected, inserts of new entities will not contain these missing properties.</span></span> <span data-ttu-id="567e5-127">In questo caso, **anche** gli aggiornamenti apportati alle entità esistenti non includeranno le proprietà mancanti.</span><span class="sxs-lookup"><span data-stu-id="567e5-127">In this case, updates that are made to existing entities will **also** not include these missing properties.</span></span> <span data-ttu-id="567e5-128">Quando esiste un valore per la proprietà, l'aggiornamento ripristina il valore predefinito della proprietà, secondo quanto definito nell'origine dati.</span><span class="sxs-lookup"><span data-stu-id="567e5-128">When a value exists for such a property, the update resets it to the default value for the property, as defined in the data source.</span></span>

### <a name="creating-projected-types"></a><span data-ttu-id="567e5-129">Creazione di tipi proiettati</span><span class="sxs-lookup"><span data-stu-id="567e5-129">Creating Projected Types</span></span>

<span data-ttu-id="567e5-130">Nell'esempio seguente viene usata una query LINQ anonima che proietta le proprietà correlate all'indirizzo del tipo `Customers` in un nuovo tipo `CustomerAddress`, definito nel client ed attribuito come tipo di entità:</span><span class="sxs-lookup"><span data-stu-id="567e5-130">The following example uses an anonymous LINQ query that projects the address-related properties of the `Customers` type into a new `CustomerAddress` type, which is defined on the client and is attributed as an entity type:</span></span>

[!code-csharp[Astoria Northwind Client#SelectCustomerAddressSpecific](~/samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#selectcustomeraddressspecific)]
[!code-vb[Astoria Northwind Client#SelectCustomerAddressSpecific](~/samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#selectcustomeraddressspecific)]

<span data-ttu-id="567e5-131">In questo esempio, il modello dell'inizializzatore di oggetti viene usato per creare una nuova istanza del tipo `CustomerAddress`, anziché chiamare un costruttore.</span><span class="sxs-lookup"><span data-stu-id="567e5-131">In this example, the object initializer pattern is used to create a new instance of the `CustomerAddress` type instead of calling a constructor.</span></span> <span data-ttu-id="567e5-132">I costruttori non sono supportati in caso di proiezione in tipi di entità, ma possono essere usati durante la proiezione in tipi di non entità e anonimi.</span><span class="sxs-lookup"><span data-stu-id="567e5-132">Constructors are not supported when projecting into entity types, but they can be used when projecting into non-entity and anonymous types.</span></span> <span data-ttu-id="567e5-133">Poiché `CustomerAddress` è un tipo di entità, le modifiche possono essere apportate e restituite al servizio dati.</span><span class="sxs-lookup"><span data-stu-id="567e5-133">Because `CustomerAddress` is an entity type, changes can be made and sent back to the data service.</span></span>

<span data-ttu-id="567e5-134">Inoltre, i dati del tipo `Customer` vengono proiettati in un'istanza del tipo di entità `CustomerAddress`, anziché di un tipo anonimo.</span><span class="sxs-lookup"><span data-stu-id="567e5-134">Also, the data from the `Customer` type is projected into an instance of the `CustomerAddress` entity type instead of an anonymous type.</span></span> <span data-ttu-id="567e5-135">La proiezione in tipi anonimi è supportata, ma i dati sono di sola lettura perché i tipi anonimi vengono considerati come tipi di non entità.</span><span class="sxs-lookup"><span data-stu-id="567e5-135">Projection into anonymous types is supported, but the data is read-only because anonymous types are treated as non-entity types.</span></span>

<span data-ttu-id="567e5-136">Le impostazioni <xref:System.Data.Services.Client.MergeOption> di <xref:System.Data.Services.Client.DataServiceContext> vengono usate per la risoluzione di identità durante la proiezione di query.</span><span class="sxs-lookup"><span data-stu-id="567e5-136">The <xref:System.Data.Services.Client.MergeOption> settings of the <xref:System.Data.Services.Client.DataServiceContext> are used for identity resolution during query projection.</span></span> <span data-ttu-id="567e5-137">Pertanto, se un'istanza del tipo `Customer` esiste già in <xref:System.Data.Services.Client.DataServiceContext>, un'istanza di `CustomerAddress` con la stessa identità seguirà le regole di risoluzione di identità specificate da <xref:System.Data.Services.Client.MergeOption></span><span class="sxs-lookup"><span data-stu-id="567e5-137">This means that if an instance of the `Customer` type already exists in the <xref:System.Data.Services.Client.DataServiceContext>, an instance of `CustomerAddress` with the same identity will follow the identity resolution rules set by the <xref:System.Data.Services.Client.MergeOption></span></span>

<span data-ttu-id="567e5-138">Di seguito vengono descritti i comportamenti quando si proiettano i risultati in tipi di entità e non entità:</span><span class="sxs-lookup"><span data-stu-id="567e5-138">The following describes the behaviors when projecting results into entity and non-entity types:</span></span>

<span data-ttu-id="567e5-139">**Creazione di una nuova istanza proiettata tramite inizializzatori**</span><span class="sxs-lookup"><span data-stu-id="567e5-139">**Creating a new projected instance by using initializers**</span></span>

- <span data-ttu-id="567e5-140">Esempio:</span><span class="sxs-lookup"><span data-stu-id="567e5-140">Example:</span></span>

   [!code-csharp[Astoria Northwind Client#ProjectWithInitializer](~/samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#projectwithinitializer)]
   [!code-vb[Astoria Northwind Client#ProjectWithInitializer](~/samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#projectwithinitializer)]

- <span data-ttu-id="567e5-141">Tipo di entità: supportato</span><span class="sxs-lookup"><span data-stu-id="567e5-141">Entity type: Supported</span></span>

- <span data-ttu-id="567e5-142">Tipo non entità: supportato</span><span class="sxs-lookup"><span data-stu-id="567e5-142">Non-entity type: Supported</span></span>

<span data-ttu-id="567e5-143">**Creazione di una nuova istanza proiettata tramite costruttori**</span><span class="sxs-lookup"><span data-stu-id="567e5-143">**Creating a new projected instance by using constructors**</span></span>

- <span data-ttu-id="567e5-144">Esempio:</span><span class="sxs-lookup"><span data-stu-id="567e5-144">Example:</span></span>

   [!code-csharp[Astoria Northwind Client#ProjectWithConstructor](~/samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#projectwithconstructor)]
   [!code-vb[Astoria Northwind Client#ProjectWithConstructor](~/samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#projectwithconstructor)]

- <span data-ttu-id="567e5-145">Tipo di entità: viene generato un <xref:System.NotSupportedException>.</span><span class="sxs-lookup"><span data-stu-id="567e5-145">Entity type: A <xref:System.NotSupportedException> is raised.</span></span>

- <span data-ttu-id="567e5-146">Tipo non entità: supportato</span><span class="sxs-lookup"><span data-stu-id="567e5-146">Non-entity type: Supported</span></span>

<span data-ttu-id="567e5-147">**Uso della proiezione per trasformare un valore di proprietà**</span><span class="sxs-lookup"><span data-stu-id="567e5-147">**Using projection to transform a property value**</span></span>

- <span data-ttu-id="567e5-148">Esempio:</span><span class="sxs-lookup"><span data-stu-id="567e5-148">Example:</span></span>

   [!code-csharp[Astoria Northwind Client#ProjectWithTransform](~/samples/snippets/csharp/VS_Snippets_Misc/astoria_northwind_client/cs/source.cs#projectwithtransform)]
   [!code-vb[Astoria Northwind Client#ProjectWithTransform](~/samples/snippets/visualbasic/VS_Snippets_Misc/astoria_northwind_client/vb/source.vb#projectwithtransform)]

- <span data-ttu-id="567e5-149">Tipo di entità: questa trasformazione non è supportata per i tipi di entità perché può causare confusione e potenzialmente sovrascrivere i dati nell'origine dati appartenente a un'altra entità.</span><span class="sxs-lookup"><span data-stu-id="567e5-149">Entity type: This transformation is not supported for entity types because it can lead to confusion and potentially overwriting the data in the data source that belongs to another entity.</span></span> <span data-ttu-id="567e5-150">Viene generato un oggetto <xref:System.NotSupportedException>.</span><span class="sxs-lookup"><span data-stu-id="567e5-150">A <xref:System.NotSupportedException> is raised.</span></span>

- <span data-ttu-id="567e5-151">Tipo non entità: supportato</span><span class="sxs-lookup"><span data-stu-id="567e5-151">Non-entity type: Supported</span></span>

<a name="considerations"></a>

## <a name="projection-considerations"></a><span data-ttu-id="567e5-152">Considerazioni sulla proiezione</span><span class="sxs-lookup"><span data-stu-id="567e5-152">Projection Considerations</span></span>

<span data-ttu-id="567e5-153">Alla definizione di una proiezione di query si applicano le considerazioni aggiuntive seguenti:</span><span class="sxs-lookup"><span data-stu-id="567e5-153">The following additional considerations apply when defining a query projection.</span></span>

- <span data-ttu-id="567e5-154">Quando si definiscono feed personalizzati per il formato Atom, è necessario assicurarsi che tutte le proprietà dell'entità che dispongono di definizioni di mapping personalizzate vengano incluse nella proiezione.</span><span class="sxs-lookup"><span data-stu-id="567e5-154">When you define custom feeds for the Atom format, you must make sure that all entity properties that have custom mappings defined are included in the projection.</span></span> <span data-ttu-id="567e5-155">Se una proprietà di entità mappata non è inclusa nella proiezione potrebbe verificarsi una perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="567e5-155">When a mapped entity property is not included in the projection, data loss might occur.</span></span> <span data-ttu-id="567e5-156">Per altre informazioni, vedere [personalizzazione del feed](feed-customization-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="567e5-156">For more information, see [Feed Customization](feed-customization-wcf-data-services.md).</span></span>

- <span data-ttu-id="567e5-157">Quando vengono apportati inserimenti a un tipo proiettato che non contiene tutte le proprietà dell'entità nel modello di dati del servizio dati, le proprietà non incluse nella proiezione vengono impostate sui valori predefiniti nel client.</span><span class="sxs-lookup"><span data-stu-id="567e5-157">When inserts are made to a projected type that does not contain all of the properties of the entity in the data model of the data service, the properties not included in the projection at the client are set to their default values.</span></span>

- <span data-ttu-id="567e5-158">Quando vengono apportati aggiornamenti a un tipo proiettato che non contiene tutte le proprietà dell'entità nel modello di dati del servizio dati, i valori esistenti non inclusi nella proiezione vengono sovrascritti con i valori predefiniti non inizializzati nel client.</span><span class="sxs-lookup"><span data-stu-id="567e5-158">When updates are made to a projected type that does not contain all of the properties of the entity in the data model of the data service, existing values not included in the projection on the client will be overwritten with uninitialized default values.</span></span>

- <span data-ttu-id="567e5-159">Quando una proiezione include una proprietà complessa, è necessario che venga restituito l'intero oggetto complesso.</span><span class="sxs-lookup"><span data-stu-id="567e5-159">When a projection includes a complex property, the entire complex object must be returned.</span></span>

- <span data-ttu-id="567e5-160">Quando una proiezione include una proprietà di navigazione, gli oggetti correlati vengono caricati in modo implicito senza necessità di chiamare il metodo <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A>.</span><span class="sxs-lookup"><span data-stu-id="567e5-160">When a projection includes a navigation property, the related objects are loaded implicitly without having to call the <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> method.</span></span> <span data-ttu-id="567e5-161">Il metodo <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> non è supportato in una query proiettata.</span><span class="sxs-lookup"><span data-stu-id="567e5-161">The <xref:System.Data.Services.Client.DataServiceQuery%601.Expand%2A> method is not supported for use in a projected query.</span></span>

- <span data-ttu-id="567e5-162">Le proiezioni di query eseguite nel client vengono convertite per l'uso dell'opzione query `$select` nell'URI della richiesta.</span><span class="sxs-lookup"><span data-stu-id="567e5-162">Query projections queries on the client are translated to use the `$select` query option in the request URI.</span></span> <span data-ttu-id="567e5-163">Quando una query con proiezione viene eseguita su una versione precedente di WCF Data Services che non supporta l'opzione di query `$select`, viene restituito un errore.</span><span class="sxs-lookup"><span data-stu-id="567e5-163">When a query with projection is executed against a previous version of WCF Data Services that does not support the `$select` query option, an error is returned.</span></span> <span data-ttu-id="567e5-164">Questa situazione può inoltre verificarsi quando <xref:System.Data.Services.DataServiceBehavior.MaxProtocolVersion%2A> di <xref:System.Data.Services.DataServiceBehavior> per il servizio dati viene impostato su un valore pari a <xref:System.Data.Services.Common.DataServiceProtocolVersion.V1>.</span><span class="sxs-lookup"><span data-stu-id="567e5-164">This can also happen when the <xref:System.Data.Services.DataServiceBehavior.MaxProtocolVersion%2A> of the <xref:System.Data.Services.DataServiceBehavior> for the data service is set to a value of <xref:System.Data.Services.Common.DataServiceProtocolVersion.V1>.</span></span> <span data-ttu-id="567e5-165">Per ulteriori informazioni, vedere [controllo delle versioni del servizio dati](data-service-versioning-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="567e5-165">For more information, see [Data Service Versioning](data-service-versioning-wcf-data-services.md).</span></span>

<span data-ttu-id="567e5-166">Per altre informazioni, vedere [procedura: proiettare risultati di query](how-to-project-query-results-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="567e5-166">For more information, see [How to: Project Query Results](how-to-project-query-results-wcf-data-services.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="567e5-167">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="567e5-167">See also</span></span>

- [<span data-ttu-id="567e5-168">Esecuzione di query sul servizio dati</span><span class="sxs-lookup"><span data-stu-id="567e5-168">Querying the Data Service</span></span>](querying-the-data-service-wcf-data-services.md)
