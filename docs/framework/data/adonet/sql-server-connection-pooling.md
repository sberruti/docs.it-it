---
title: SQL Server pool di connessioni
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 7e51d44e-7c4e-4040-9332-f0190fe36f07
ms.openlocfilehash: 3bf0ce98b9b16b8d698a814f3bf2c4f442f3bf06
ms.sourcegitcommit: 19014f9c081ca2ff19652ca12503828db8239d48
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/04/2020
ms.locfileid: "76980041"
---
# <a name="sql-server-connection-pooling-adonet"></a><span data-ttu-id="01a12-102">Pool di connessioni SQL Server (ADO.NET)</span><span class="sxs-lookup"><span data-stu-id="01a12-102">SQL Server Connection Pooling (ADO.NET)</span></span>
<span data-ttu-id="01a12-103">Generalmente, la connessione a un server database comporta passaggi che richiedono molto tempo.</span><span class="sxs-lookup"><span data-stu-id="01a12-103">Connecting to a database server typically consists of several time-consuming steps.</span></span> <span data-ttu-id="01a12-104">È necessario, infatti, stabilire un canale fisico, ad esempio un socket oppure una named pipe. Deve verificarsi l'handshake iniziale con il server, deve essere analizzata l'informazione sulla stringa di connessione, la connessione deve essere autenticata dal server, sono necessarie verifiche per l'inserimento in un elenco nella transazione corrente e così via.</span><span class="sxs-lookup"><span data-stu-id="01a12-104">A physical channel such as a socket or a named pipe must be established, the initial handshake with the server must occur, the connection string information must be parsed, the connection must be authenticated by the server, checks must be run for enlisting in the current transaction, and so on.</span></span>  
  
 <span data-ttu-id="01a12-105">In pratica, la maggior parte delle applicazioni usa solo una o alcune configurazioni di connessione.</span><span class="sxs-lookup"><span data-stu-id="01a12-105">In practice, most applications use only one or a few different configurations for connections.</span></span> <span data-ttu-id="01a12-106">Per questo motivo, durante l'esecuzione dell'applicazione, verranno aperte e chiuse più volte connessioni identiche.</span><span class="sxs-lookup"><span data-stu-id="01a12-106">This means that during application execution, many identical connections will be repeatedly opened and closed.</span></span> <span data-ttu-id="01a12-107">Per ridurre al minimo il costo dell'apertura delle connessioni, ADO.NET usa una tecnica di ottimizzazione denominata *pool di connessioni*.</span><span class="sxs-lookup"><span data-stu-id="01a12-107">To minimize the cost of opening connections, ADO.NET uses an optimization technique called *connection pooling*.</span></span>  
  
 <span data-ttu-id="01a12-108">Il pool di connessioni riduce il numero di volte in cui è necessario aprire nuove connessioni.</span><span class="sxs-lookup"><span data-stu-id="01a12-108">Connection pooling reduces the number of times that new connections must be opened.</span></span> <span data-ttu-id="01a12-109">Il *pool* mantiene la proprietà della connessione fisica.</span><span class="sxs-lookup"><span data-stu-id="01a12-109">The *pooler* maintains ownership of the physical connection.</span></span> <span data-ttu-id="01a12-110">Gestisce le connessioni mantenendo attivo un set di connessioni attive per ogni configurazione di connessione.</span><span class="sxs-lookup"><span data-stu-id="01a12-110">It manages connections by keeping alive a set of active connections for each given connection configuration.</span></span> <span data-ttu-id="01a12-111">Quando un utente chiama `Open` su una connessione, il pool verifica la presenza di una connessione disponibile.</span><span class="sxs-lookup"><span data-stu-id="01a12-111">Whenever a user calls `Open` on a connection, the pooler looks for an available connection in the pool.</span></span> <span data-ttu-id="01a12-112">Se è disponibile una connessione, il pool la restituisce al chiamante invece di aprirne una nuova.</span><span class="sxs-lookup"><span data-stu-id="01a12-112">If a pooled connection is available, it returns it to the caller instead of opening a new connection.</span></span> <span data-ttu-id="01a12-113">Quando l'applicazione chiama `Close`, il pool restituisce la connessione al set di connessioni attive invece di chiuderla realmente.</span><span class="sxs-lookup"><span data-stu-id="01a12-113">When the application calls `Close` on the connection, the pooler returns it to the pooled set of active connections instead of closing it.</span></span> <span data-ttu-id="01a12-114">Una volta restituita al pool, la connessione può essere usata nuovamente nella successiva chiamata `Open`.</span><span class="sxs-lookup"><span data-stu-id="01a12-114">Once the connection is returned to the pool, it is ready to be reused on the next `Open` call.</span></span>  
  
 <span data-ttu-id="01a12-115">È possibile raggruppare in pool solo le connessioni che presentano la stessa configurazione.</span><span class="sxs-lookup"><span data-stu-id="01a12-115">Only connections with the same configuration can be pooled.</span></span> <span data-ttu-id="01a12-116">ADO.NET mantiene diversi pool contemporaneamente, uno per ogni configurazione.</span><span class="sxs-lookup"><span data-stu-id="01a12-116">ADO.NET keeps several pools at the same time, one for each configuration.</span></span> <span data-ttu-id="01a12-117">Le connessioni vengono divise in pool in base alla stringa di connessione e, quando si usa la sicurezza integrata, in base all'identità Windows.</span><span class="sxs-lookup"><span data-stu-id="01a12-117">Connections are separated into pools by connection string, and by Windows identity when integrated security is used.</span></span> <span data-ttu-id="01a12-118">Le connessioni vengono inserite nei pool anche in base a dove sono inserite in una transazione.</span><span class="sxs-lookup"><span data-stu-id="01a12-118">Connections are also pooled based on whether they are enlisted in a transaction.</span></span> <span data-ttu-id="01a12-119">Quando si usa un <xref:System.Data.SqlClient.SqlConnection.ChangePassword%2A>, le istanze di <xref:System.Data.SqlClient.SqlCredential> influiscono sul pool di connessioni.</span><span class="sxs-lookup"><span data-stu-id="01a12-119">When using <xref:System.Data.SqlClient.SqlConnection.ChangePassword%2A>, the <xref:System.Data.SqlClient.SqlCredential> instance affects the connection pool.</span></span> <span data-ttu-id="01a12-120">Diverse istanze di <xref:System.Data.SqlClient.SqlCredential> useranno pool di connessioni diversi, anche se l'ID utente e la password sono uguali.</span><span class="sxs-lookup"><span data-stu-id="01a12-120">Different instances of <xref:System.Data.SqlClient.SqlCredential> will use different connection pools, even if the user ID and password are the same.</span></span>  
  
 <span data-ttu-id="01a12-121">Il pool di connessioni consente di migliorare notevolmente le prestazioni e di aumentare la scalabilità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="01a12-121">Pooling connections can significantly enhance the performance and scalability of your application.</span></span> <span data-ttu-id="01a12-122">Per impostazione predefinita, il pool di connessioni è abilitato in ADO.NET.</span><span class="sxs-lookup"><span data-stu-id="01a12-122">By default, connection pooling is enabled in ADO.NET.</span></span> <span data-ttu-id="01a12-123">A meno che non venga disabilitato in modo esplicito, il pool ottimizza le connessioni che vengono aperte e chiuse nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="01a12-123">Unless you explicitly disable it, the pooler optimizes the connections as they are opened and closed in your application.</span></span> <span data-ttu-id="01a12-124">È possibile, inoltre, fornire più modificatori delle stringhe di connessione per controllare il comportamento del pool di connessioni.</span><span class="sxs-lookup"><span data-stu-id="01a12-124">You can also supply several connection string modifiers to control connection pooling behavior.</span></span> <span data-ttu-id="01a12-125">Per altre informazioni, vedere "Controllo del pool di connessioni con le parole chiave delle stringhe di connessione" in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="01a12-125">For more information, see "Controlling Connection Pooling with Connection String Keywords" later in this topic.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="01a12-126">Quando il pool di connessioni è abilitato e se si verifica un errore di timeout o un altro errore di accesso, viene generata un'eccezione e i tentativi di connessione successivi avranno esito negativo per i prossimi cinque secondi, "il periodo di blocco".</span><span class="sxs-lookup"><span data-stu-id="01a12-126">When connection pooling is enabled, and if a timeout error or other login error occurs, an exception will be thrown and subsequent connection attempts will fail for the next five seconds, the "blocking period".</span></span> <span data-ttu-id="01a12-127">Se l'applicazione tenta di connettersi durante il periodo di blocco, viene generata di nuovo la prima eccezione.</span><span class="sxs-lookup"><span data-stu-id="01a12-127">If the application attempts to connect within the blocking period, the first exception will be thrown again.</span></span> <span data-ttu-id="01a12-128">Gli errori successivi al termine del periodo di blocco causeranno nuovi periodi di blocco di lunghezza doppia rispetto al periodo di blocco precedente, fino a un massimo di un minuto.</span><span class="sxs-lookup"><span data-stu-id="01a12-128">Subsequent failures after a blocking period ends will result in a new blocking periods that is twice as long as the previous blocking period, up to a maximum of one minute.</span></span>  
  
## <a name="pool-creation-and-assignment"></a><span data-ttu-id="01a12-129">Creazione e assegnazione di pool</span><span class="sxs-lookup"><span data-stu-id="01a12-129">Pool Creation and Assignment</span></span>  
 <span data-ttu-id="01a12-130">Quando una connessione viene aperta per la prima volta, il pool di connessioni viene creato in base a un algoritmo esattamente corrispondente che associa il pool alla stringa di connessione.</span><span class="sxs-lookup"><span data-stu-id="01a12-130">When a connection is first opened, a connection pool is created based on an exact matching algorithm that associates the pool with the connection string in the connection.</span></span> <span data-ttu-id="01a12-131">Ogni pool di connessioni è associato a una stringa di connessione distinta.</span><span class="sxs-lookup"><span data-stu-id="01a12-131">Each connection pool is associated with a distinct connection string.</span></span> <span data-ttu-id="01a12-132">Quando viene aperta una nuova connessione, se la stringa di connessione non corrisponde esattamente a un pool esistente, viene creato un nuovo pool.</span><span class="sxs-lookup"><span data-stu-id="01a12-132">When a new connection is opened, if the connection string is not an exact match to an existing pool, a new pool is created.</span></span> <span data-ttu-id="01a12-133">Il pool di connessioni viene eseguito in base al processo, al dominio applicazione, alla stringa di connessione e, quando si usa la sicurezza integrata, in base all'identità Windows.</span><span class="sxs-lookup"><span data-stu-id="01a12-133">Connections are pooled per process, per application domain, per connection string and when integrated security is used, per Windows identity.</span></span> <span data-ttu-id="01a12-134">Le stringhe di connessione devono anche essere una corrispondenza esatta. Le parole chiave fornite in un ordine diverso per la stessa connessione verranno inserite in pool separatamente.</span><span class="sxs-lookup"><span data-stu-id="01a12-134">Connection strings must also be an exact match; keywords supplied in a different order for the same connection will be pooled separately.</span></span>  
  
 <span data-ttu-id="01a12-135">Nell'esempio C# seguente vengono creati tre nuovi oggetti <xref:System.Data.SqlClient.SqlConnection>, ma per gestirli bastano solo due pool di connessioni.</span><span class="sxs-lookup"><span data-stu-id="01a12-135">In the following C# example, three new <xref:System.Data.SqlClient.SqlConnection> objects are created, but only two connection pools are required to manage them.</span></span> <span data-ttu-id="01a12-136">Si noti che la differenza tra la prima e la seconda stringa di connessione consiste nel valore assegnato a `Initial Catalog`.</span><span class="sxs-lookup"><span data-stu-id="01a12-136">Note that the first and second connection strings differ by the value assigned for `Initial Catalog`.</span></span>  
  
```csharp
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=Northwind"))  
    {  
        connection.Open();        
        // Pool A is created.  
    }  
  
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=pubs"))  
    {  
        connection.Open();        
        // Pool B is created because the connection strings differ.  
    }  
  
using (SqlConnection connection = new SqlConnection(  
  "Integrated Security=SSPI;Initial Catalog=Northwind"))  
    {  
        connection.Open();        
        // The connection string matches pool A.  
    }  
```  
  
 <span data-ttu-id="01a12-137">Se `MinPoolSize` non è specificato nella stringa di connessione oppure è specificato come zero, le connessioni nel pool verranno chiuse dopo un periodo di inattività.</span><span class="sxs-lookup"><span data-stu-id="01a12-137">If `MinPoolSize` is either not specified in the connection string or is specified as zero, the connections in the pool will be closed after a period of inactivity.</span></span> <span data-ttu-id="01a12-138">Tuttavia, se il valore `MinPoolSize` specificato è maggiore di zero, il pool di connessioni verrà eliminato solo dopo lo scaricamento di `AppDomain` e la fine del processo.</span><span class="sxs-lookup"><span data-stu-id="01a12-138">However, if the specified `MinPoolSize` is greater than zero, the connection pool is not destroyed until the `AppDomain` is unloaded and the process ends.</span></span> <span data-ttu-id="01a12-139">La manutenzione di pool inattivi o vuoti implica un overhead minimo del sistema.</span><span class="sxs-lookup"><span data-stu-id="01a12-139">Maintenance of inactive or empty pools involves minimal system overhead.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="01a12-140">Il pool viene cancellato automaticamente quando si verifica un errore irreversibile, quale un failover.</span><span class="sxs-lookup"><span data-stu-id="01a12-140">The pool is automatically cleared when a fatal error occurs, such as a failover.</span></span>  
  
## <a name="adding-connections"></a><span data-ttu-id="01a12-141">Aggiunta di connessioni</span><span class="sxs-lookup"><span data-stu-id="01a12-141">Adding Connections</span></span>  
 <span data-ttu-id="01a12-142">Per ogni stringa di connessione univoca viene creato un pool di connessioni.</span><span class="sxs-lookup"><span data-stu-id="01a12-142">A connection pool is created for each unique connection string.</span></span> <span data-ttu-id="01a12-143">Quando si crea un pool, vengono creati e aggiunti al pool più oggetti connessione in modo da soddisfare il requisito relativo alle dimensioni minime del pool.</span><span class="sxs-lookup"><span data-stu-id="01a12-143">When a pool is created, multiple connection objects are created and added to the pool so that the minimum pool size requirement is satisfied.</span></span> <span data-ttu-id="01a12-144">Le connessioni sono aggiunte al pool a seconda della necessità, fino al raggiungimento delle dimensioni massime del pool (l'impostazione predefinita è 100).</span><span class="sxs-lookup"><span data-stu-id="01a12-144">Connections are added to the pool as needed, up to the maximum pool size specified (100 is the default).</span></span> <span data-ttu-id="01a12-145">Una volta chiuse o eliminate, le connessioni vengono rilasciate nel pool.</span><span class="sxs-lookup"><span data-stu-id="01a12-145">Connections are released back into the pool when they are closed or disposed.</span></span>  
  
 <span data-ttu-id="01a12-146">Quando viene richiesto un oggetto <xref:System.Data.SqlClient.SqlConnection>, esso viene ottenuto dal pool se è disponibile una connessione usabile.</span><span class="sxs-lookup"><span data-stu-id="01a12-146">When a <xref:System.Data.SqlClient.SqlConnection> object is requested, it is obtained from the pool if a usable connection is available.</span></span> <span data-ttu-id="01a12-147">Per essere utilizzabile, una connessione non deve essere in uso, deve disporre di un contesto di transazione corrispondente oppure non deve essere associata ad alcun contesto di transazione e, infine, deve disporre di un collegamento valido al server.</span><span class="sxs-lookup"><span data-stu-id="01a12-147">To be usable, a connection must be unused, have a matching transaction context or be unassociated with any transaction context, and have a valid link to the server.</span></span>  
  
 <span data-ttu-id="01a12-148">Il pool di connessioni soddisfa le richieste di connessione grazie alla riallocazione delle connessioni rilasciate nel pool.</span><span class="sxs-lookup"><span data-stu-id="01a12-148">The connection pooler satisfies requests for connections by reallocating connections as they are released back into the pool.</span></span> <span data-ttu-id="01a12-149">Se le dimensioni massime del pool sono state raggiunte e non è disponibile alcuna connessione usabile, la richiesta viene accodata.</span><span class="sxs-lookup"><span data-stu-id="01a12-149">If the maximum pool size has been reached and no usable connection is available, the request is queued.</span></span> <span data-ttu-id="01a12-150">Il pool tenta quindi di recuperare le connessioni fino alla scadenza del timeout (l'impostazione predefinita è 15 secondi).</span><span class="sxs-lookup"><span data-stu-id="01a12-150">The pooler then tries to reclaim any connections until the time-out is reached (the default is 15 seconds).</span></span> <span data-ttu-id="01a12-151">Se il pool non è in grado di soddisfare la richiesta prima che scada la connessione, viene generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="01a12-151">If the pooler cannot satisfy the request before the connection times out, an exception is thrown.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="01a12-152">Al termine dell'uso, si consiglia di chiudere sempre la connessione in modo che possa essere restituita al pool.</span><span class="sxs-lookup"><span data-stu-id="01a12-152">We strongly recommend that you always close the connection when you are finished using it so that the connection will be returned to the pool.</span></span> <span data-ttu-id="01a12-153">A tale scopo, è possibile utilizzare i metodi `Close` o `Dispose` dell'oggetto `Connection` oppure aprire tutte le connessioni all'interno di un'istruzione `using` C#in oppure un'istruzione `Using` in Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="01a12-153">You can do this using either the `Close` or `Dispose` methods of the `Connection` object, or by opening all connections inside a `using` statement in C#, or a `Using` statement in Visual Basic.</span></span> <span data-ttu-id="01a12-154">Le connessioni che non vengono chiuse in modo esplicito potrebbero non essere aggiunte o restituite al pool.</span><span class="sxs-lookup"><span data-stu-id="01a12-154">Connections that are not explicitly closed might not be added or returned to the pool.</span></span> <span data-ttu-id="01a12-155">Per ulteriori informazioni, vedere [istruzione using](../../../csharp/language-reference/keywords/using-statement.md) o [procedura: eliminare una risorsa di sistema](../../../visual-basic/programming-guide/language-features/control-flow/how-to-dispose-of-a-system-resource.md) per Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="01a12-155">For more information, see [using Statement](../../../csharp/language-reference/keywords/using-statement.md) or [How to: Dispose of a System Resource](../../../visual-basic/programming-guide/language-features/control-flow/how-to-dispose-of-a-system-resource.md) for Visual Basic.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="01a12-156">Non chiamare `Close` o `Dispose` su un oggetto `Connection`, `DataReader` o su qualsiasi altro oggetto gestito nel metodo `Finalize` della classe.</span><span class="sxs-lookup"><span data-stu-id="01a12-156">Do not call `Close` or `Dispose` on a `Connection`, a `DataReader`, or any other managed object in the `Finalize` method of your class.</span></span> <span data-ttu-id="01a12-157">Nei finalizzatori rilasciare solo le risorse non gestite che la classe controlla direttamente.</span><span class="sxs-lookup"><span data-stu-id="01a12-157">In a finalizer, only release unmanaged resources that your class owns directly.</span></span> <span data-ttu-id="01a12-158">Se nella classe non sono presenti risorse non gestite, non includere un metodo `Finalize` nella relativa definizione della classe.</span><span class="sxs-lookup"><span data-stu-id="01a12-158">If your class does not own any unmanaged resources, do not include a `Finalize` method in your class definition.</span></span> <span data-ttu-id="01a12-159">Per altre informazioni, vedere [Garbage Collection](../../../standard/garbage-collection/index.md).</span><span class="sxs-lookup"><span data-stu-id="01a12-159">For more information, see [Garbage Collection](../../../standard/garbage-collection/index.md).</span></span>  
  
<span data-ttu-id="01a12-160">Per ulteriori informazioni sugli eventi associati all'apertura e alla chiusura delle connessioni, vedere la classe di evento Audit [login](/sql/relational-databases/event-classes/audit-login-event-class) e la classe di [evento Audit Logout](/sql/relational-databases/event-classes/audit-logout-event-class) nella documentazione di SQL Server.</span><span class="sxs-lookup"><span data-stu-id="01a12-160">For more info about the events associated with opening and closing connections, see [Audit Login Event Class](/sql/relational-databases/event-classes/audit-login-event-class) and [Audit Logout Event Class](/sql/relational-databases/event-classes/audit-logout-event-class) in the SQL Server documentation.</span></span>  
  
## <a name="removing-connections"></a><span data-ttu-id="01a12-161">Rimozione di connessioni</span><span class="sxs-lookup"><span data-stu-id="01a12-161">Removing Connections</span></span>  
 <span data-ttu-id="01a12-162">Il pool di connessioni rimuove una connessione dopo un periodo di inattività pari a circa 4-8 minuti oppure se rileva che la connessione al server è stata interrotta.</span><span class="sxs-lookup"><span data-stu-id="01a12-162">The connection pooler removes a connection from the pool after it has been idle for approximately 4-8 minutes, or if the pooler detects that the connection with the server has been severed.</span></span> <span data-ttu-id="01a12-163">Notare che una connessione interrotta può essere rilevata solo dopo che è stato effettuato il tentativo di comunicare con il server.</span><span class="sxs-lookup"><span data-stu-id="01a12-163">Note that a severed connection can be detected only after attempting to communicate with the server.</span></span> <span data-ttu-id="01a12-164">Se viene individuata una connessione al server che non è più attiva, la connessione viene contrassegnata come non valida.</span><span class="sxs-lookup"><span data-stu-id="01a12-164">If a connection is found that is no longer connected to the server, it is marked as invalid.</span></span> <span data-ttu-id="01a12-165">Le connessioni non valide vengono rimosse dal pool di connessioni solo quando vengono chiuse o recuperate.</span><span class="sxs-lookup"><span data-stu-id="01a12-165">Invalid connections are removed from the connection pool only when they are closed or reclaimed.</span></span>  
  
 <span data-ttu-id="01a12-166">Se esiste una connessione a un server non più disponibile, la connessione può essere recuperata dal pool anche se nessuna connessione è stata rilevata come interrotta e pertanto non è stata contrassegnata come non valida.</span><span class="sxs-lookup"><span data-stu-id="01a12-166">If a connection exists to a server that has disappeared, this connection can be drawn from the pool even if the connection pooler has not detected the severed connection and marked it as invalid.</span></span> <span data-ttu-id="01a12-167">In caso contrario, l'overhead per la verifica della validità della connessione annullerebbe i vantaggi derivanti dal pool provocando un'ulteriore sequenza di andata e ritorno al server.</span><span class="sxs-lookup"><span data-stu-id="01a12-167">This is the case because the overhead of checking that the connection is still valid would eliminate the benefits of having a pooler by causing another round trip to the server to occur.</span></span> <span data-ttu-id="01a12-168">In questo caso, al primo tentativo di uso della connessione verrà rilevato che la connessione è stata interrotta e verrà generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="01a12-168">When this occurs, the first attempt to use the connection will detect that the connection has been severed, and an exception is thrown.</span></span>  
  
## <a name="clearing-the-pool"></a><span data-ttu-id="01a12-169">Cancellazione del pool</span><span class="sxs-lookup"><span data-stu-id="01a12-169">Clearing the Pool</span></span>  
 <span data-ttu-id="01a12-170">In ADO.NET 2,0 sono stati introdotti due nuovi metodi per cancellare il pool: <xref:System.Data.SqlClient.SqlConnection.ClearAllPools%2A> e <xref:System.Data.SqlClient.SqlConnection.ClearPool%2A>.</span><span class="sxs-lookup"><span data-stu-id="01a12-170">ADO.NET 2.0 introduced two new methods to clear the pool: <xref:System.Data.SqlClient.SqlConnection.ClearAllPools%2A> and <xref:System.Data.SqlClient.SqlConnection.ClearPool%2A>.</span></span> <span data-ttu-id="01a12-171">`ClearAllPools` cancella i pool di connessioni per un determinato provider, mentre `ClearPool` cancella il pool di connessioni associato a una connessione specifica.</span><span class="sxs-lookup"><span data-stu-id="01a12-171">`ClearAllPools` clears the connection pools for a given provider, and `ClearPool` clears the connection pool that is associated with a specific connection.</span></span> <span data-ttu-id="01a12-172">Le connessioni in uso al momento della chiamata vengono contrassegnate in modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="01a12-172">If there are connections being used at the time of the call, they are marked appropriately.</span></span> <span data-ttu-id="01a12-173">Una volta chiuse, anziché essere restituite al pool, queste connessioni vengono eliminate.</span><span class="sxs-lookup"><span data-stu-id="01a12-173">When they are closed, they are discarded instead of being returned to the pool.</span></span>  
  
## <a name="transaction-support"></a><span data-ttu-id="01a12-174">Supporto per le transazioni</span><span class="sxs-lookup"><span data-stu-id="01a12-174">Transaction Support</span></span>  
 <span data-ttu-id="01a12-175">Le connessioni vengono recuperate dal pool e assegnate in base al contesto della transazione.</span><span class="sxs-lookup"><span data-stu-id="01a12-175">Connections are drawn from the pool and assigned based on transaction context.</span></span> <span data-ttu-id="01a12-176">Se nella stringa di connessione non è specificato `Enlist=false`, il pool di connessioni assicura che la connessione venga inserita in un elenco del contesto <xref:System.Transactions.Transaction.Current%2A>.</span><span class="sxs-lookup"><span data-stu-id="01a12-176">Unless `Enlist=false` is specified in the connection string, the connection pool makes sure that the connection is enlisted in the <xref:System.Transactions.Transaction.Current%2A> context.</span></span> <span data-ttu-id="01a12-177">Quando una connessione viene chiusa e restituita al pool con una transazione `System.Transactions` in elenco, questa connessione viene conservata in modo tale che, quando si richiederà nuovamente il pool di connessioni con la stessa transazione `System.Transactions`, verrà restituita la stessa connessione, se è disponibile.</span><span class="sxs-lookup"><span data-stu-id="01a12-177">When a connection is closed and returned to the pool with an enlisted `System.Transactions` transaction, it is set aside in such a way that the next request for that connection pool with the same `System.Transactions` transaction will return the same connection if it is available.</span></span> <span data-ttu-id="01a12-178">Se viene eseguita una richiesta di questo tipo e non sono disponibili connessioni in pool, viene prelevata e inserita in elenco una connessione della parte non transazionale del pool.</span><span class="sxs-lookup"><span data-stu-id="01a12-178">If such a request is issued, and there are no pooled connections available, a connection is drawn from the non-transacted part of the pool and enlisted.</span></span> <span data-ttu-id="01a12-179">Se non sono disponibili connessioni in alcuna area del pool, viene creata e inserita in elenco una nuova connessione.</span><span class="sxs-lookup"><span data-stu-id="01a12-179">If no connections are available in either area of the pool, a new connection is created and enlisted.</span></span>  
  
 <span data-ttu-id="01a12-180">Una volta chiusa, la connessione viene rilasciata nel pool e nella suddivisione appropriata in base al relativo contesto di transazione.</span><span class="sxs-lookup"><span data-stu-id="01a12-180">When a connection is closed, it is released back into the pool and into the appropriate subdivision based on its transaction context.</span></span> <span data-ttu-id="01a12-181">La connessione può quindi essere chiusa senza generare un errore anche se è ancora in sospeso una transazione distribuita.</span><span class="sxs-lookup"><span data-stu-id="01a12-181">Therefore, you can close the connection without generating an error, even though a distributed transaction is still pending.</span></span> <span data-ttu-id="01a12-182">In questo modo è possibile eseguire il commit o interrompere la transazione distribuita in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="01a12-182">This allows you to commit or abort the distributed transaction later.</span></span>  
  
## <a name="controlling-connection-pooling-with-connection-string-keywords"></a><span data-ttu-id="01a12-183">Controllo del pool di connessioni con parole chiave delle stringhe di connessione</span><span class="sxs-lookup"><span data-stu-id="01a12-183">Controlling Connection Pooling with Connection String Keywords</span></span>  
 <span data-ttu-id="01a12-184">La proprietà `ConnectionString` dell'oggetto <xref:System.Data.SqlClient.SqlConnection> supporta le coppie chiave/valore della stringa di connessione che possono essere usare per regolare il comportamento della logica del pool di connessioni.</span><span class="sxs-lookup"><span data-stu-id="01a12-184">The `ConnectionString` property of the <xref:System.Data.SqlClient.SqlConnection> object supports connection string key/value pairs that can be used to adjust the behavior of the connection pooling logic.</span></span> <span data-ttu-id="01a12-185">Per ulteriori informazioni, vedere <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span><span class="sxs-lookup"><span data-stu-id="01a12-185">For more information, see <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
## <a name="pool-fragmentation"></a><span data-ttu-id="01a12-186">Frammentazione di pool</span><span class="sxs-lookup"><span data-stu-id="01a12-186">Pool Fragmentation</span></span>  
 <span data-ttu-id="01a12-187">La frammentazione di pool rappresenta un problema comune di varie applicazioni Web in cui l'applicazione può creare numerosi pool che vengono rilasciati solo al termine del processo.</span><span class="sxs-lookup"><span data-stu-id="01a12-187">Pool fragmentation is a common problem in many Web applications where the application can create a large number of pools that are not freed until the process exits.</span></span> <span data-ttu-id="01a12-188">In questo modo, molte connessioni vengono lasciate aperte, occupando memoria e riducendo le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="01a12-188">This leaves a large number of connections open and consuming memory, which results in poor performance.</span></span>  
  
### <a name="pool-fragmentation-due-to-integrated-security"></a><span data-ttu-id="01a12-189">Frammentazione di pool dovuta alla sicurezza integrata</span><span class="sxs-lookup"><span data-stu-id="01a12-189">Pool Fragmentation Due to Integrated Security</span></span>  
 <span data-ttu-id="01a12-190">Le connessioni vengono eseguite in pool in base alla stringa di connessione e all'identità utente.</span><span class="sxs-lookup"><span data-stu-id="01a12-190">Connections are pooled according to the connection string plus the user identity.</span></span> <span data-ttu-id="01a12-191">Di conseguenza, se nel sito Web si usa l'autenticazione di base o l'autenticazione Windows, nonché un accesso di sicurezza, si otterrà un pool per ogni utente.</span><span class="sxs-lookup"><span data-stu-id="01a12-191">Therefore, if you use Basic authentication or Windows Authentication on the Web site and an integrated security login, you get one pool per user.</span></span> <span data-ttu-id="01a12-192">Anche se in questo modo migliorano le prestazioni delle successive richieste di database per il singolo utente, l'utente non può usare le connessioni eseguite da altri.</span><span class="sxs-lookup"><span data-stu-id="01a12-192">Although this improves the performance of subsequent database requests for a single user, that user cannot take advantage of connections made by other users.</span></span> <span data-ttu-id="01a12-193">Viene generata, inoltre, almeno una connessione per utente al server database.</span><span class="sxs-lookup"><span data-stu-id="01a12-193">It also results in at least one connection per user to the database server.</span></span> <span data-ttu-id="01a12-194">Questo è un effetto collaterale di una particolare architettura di applicazione Web che gli sviluppatori devono tenere in considerazione per non compromettere i requisiti di sicurezza e controllo.</span><span class="sxs-lookup"><span data-stu-id="01a12-194">This is a side effect of a particular Web application architecture that developers must weigh against security and auditing requirements.</span></span>  
  
### <a name="pool-fragmentation-due-to-many-databases"></a><span data-ttu-id="01a12-195">Frammentazione di pool dovuta a numerosi database</span><span class="sxs-lookup"><span data-stu-id="01a12-195">Pool Fragmentation Due to Many Databases</span></span>  
 <span data-ttu-id="01a12-196">Molti provider di servizi Internet ospitano numerosi siti Web su un unico server.</span><span class="sxs-lookup"><span data-stu-id="01a12-196">Many Internet service providers host several Web sites on a single server.</span></span> <span data-ttu-id="01a12-197">Possono usare un unico database per confermare un accesso basato su form e aprire una connessione a un database specifico di un utente o di un gruppo di utenti.</span><span class="sxs-lookup"><span data-stu-id="01a12-197">They may use a single database to confirm a Forms authentication login and then open a connection to a specific database for that user or group of users.</span></span> <span data-ttu-id="01a12-198">La connessione al database di autenticazione viene eseguita in pool e può essere usata da tutti.</span><span class="sxs-lookup"><span data-stu-id="01a12-198">The connection to the authentication database is pooled and used by everyone.</span></span> <span data-ttu-id="01a12-199">Tuttavia è presente un pool di connessioni separato per ogni database, aumentando il numero di connessioni al server.</span><span class="sxs-lookup"><span data-stu-id="01a12-199">However, there is a separate pool of connections to each database, which increase the number of connections to the server.</span></span>  
  
 <span data-ttu-id="01a12-200">Anche questo è un effetto collaterale della progettazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="01a12-200">This is also a side-effect of the application design.</span></span> <span data-ttu-id="01a12-201">È relativamente semplice evitare questo effetto collaterale senza compromettere la sicurezza quando ci si connette a SQL Server.</span><span class="sxs-lookup"><span data-stu-id="01a12-201">There is a relatively simple way to avoid this side effect without compromising security when you connect to SQL Server.</span></span> <span data-ttu-id="01a12-202">Invece di connettersi a un solo database per ogni utente o gruppo, è sufficiente connettersi allo stesso database sul server e successivamente eseguire l'istruzione USE Transact-SQL per passare al database desiderato.</span><span class="sxs-lookup"><span data-stu-id="01a12-202">Instead of connecting to a separate database for each user or group, connect to the same database on the server and then execute the Transact-SQL USE statement to change to the desired database.</span></span> <span data-ttu-id="01a12-203">Nel frammento di codice seguente viene illustrata la creazione di una connessione iniziale al database `master` e il passaggio al database specificato nella variabile di tipo stringa `databaseName`.</span><span class="sxs-lookup"><span data-stu-id="01a12-203">The following code fragment demonstrates creating an initial connection to the `master` database and then switching to the desired database specified in the `databaseName` string variable.</span></span>  
  
```vb  
' Assumes that command is a valid SqlCommand object and that  
' connectionString connects to master.  
    command.Text = "USE DatabaseName"  
Using connection As New SqlConnection(connectionString)  
    connection.Open()  
    command.ExecuteNonQuery()  
End Using  
```  
  
```csharp  
// Assumes that command is a SqlCommand object and that  
// connectionString connects to master.  
command.Text = "USE DatabaseName";  
using (SqlConnection connection = new SqlConnection(  
  connectionString))  
  {  
    connection.Open();  
    command.ExecuteNonQuery();  
  }  
```  
  
## <a name="application-roles-and-connection-pooling"></a><span data-ttu-id="01a12-204">Ruoli dell'applicazione e pool di connessioni</span><span class="sxs-lookup"><span data-stu-id="01a12-204">Application Roles and Connection Pooling</span></span>  
 <span data-ttu-id="01a12-205">Dopo che un ruolo dell'applicazione SQL Server è stato attivato chiamando la stored procedure di sistema `sp_setapprole`, non è possibile impostare nuovamente il contesto di sicurezza di tale connessione.</span><span class="sxs-lookup"><span data-stu-id="01a12-205">After a SQL Server application role has been activated by calling the `sp_setapprole` system stored procedure, the security context of that connection cannot be reset.</span></span> <span data-ttu-id="01a12-206">Se è attivata la creazione di pool, la connessione verrà restituita al pool e si verificherà un errore quando la connessione in pool verrà riutilizzata.</span><span class="sxs-lookup"><span data-stu-id="01a12-206">However, if pooling is enabled, the connection is returned to the pool, and an error occurs when the pooled connection is reused.</span></span> <span data-ttu-id="01a12-207">Per ulteriori informazioni, vedere l'articolo della Knowledge Base "[errori del ruolo applicazione SQL con OLE DB pool di risorse](https://support.microsoft.com/default.aspx?scid=KB;EN-US;Q229564)".</span><span class="sxs-lookup"><span data-stu-id="01a12-207">For more information, see the Knowledge Base article, "[SQL application role errors with OLE DB resource pooling](https://support.microsoft.com/default.aspx?scid=KB;EN-US;Q229564)."</span></span>  
  
### <a name="application-role-alternatives"></a><span data-ttu-id="01a12-208">Alternative ai ruoli applicazione</span><span class="sxs-lookup"><span data-stu-id="01a12-208">Application Role Alternatives</span></span>  
 <span data-ttu-id="01a12-209">Si consiglia di trarre vantaggio dai meccanismi di sicurezza che è possibile usare al posto dei ruoli applicazione.</span><span class="sxs-lookup"><span data-stu-id="01a12-209">We recommend that you take advantage of security mechanisms that you can use instead of application roles.</span></span> <span data-ttu-id="01a12-210">Per ulteriori informazioni, vedere [creazione di ruoli applicazione in SQL Server](./sql/creating-application-roles-in-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="01a12-210">For more information, see [Creating Application Roles in SQL Server](./sql/creating-application-roles-in-sql-server.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="01a12-211">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="01a12-211">See also</span></span>

- [<span data-ttu-id="01a12-212">Pool di connessioni</span><span class="sxs-lookup"><span data-stu-id="01a12-212">Connection Pooling</span></span>](connection-pooling.md)
- [<span data-ttu-id="01a12-213">SQL Server e ADO.NET</span><span class="sxs-lookup"><span data-stu-id="01a12-213">SQL Server and ADO.NET</span></span>](./sql/index.md)
- [<span data-ttu-id="01a12-214">Performance Counters</span><span class="sxs-lookup"><span data-stu-id="01a12-214">Performance Counters</span></span>](performance-counters.md)
- [<span data-ttu-id="01a12-215">Panoramica di ADO.NET</span><span class="sxs-lookup"><span data-stu-id="01a12-215">ADO.NET Overview</span></span>](ado-net-overview.md)
