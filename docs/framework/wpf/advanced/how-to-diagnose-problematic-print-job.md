---
title: 'Procedura: diagnosticare processi di stampa problematici'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- troubleshooting print job problems [WPF]
- print jobs [WPF], troubleshooting
- print jobs [WPF], diagnosing problems
ms.assetid: b081a170-84c6-48f9-a487-5766a8d58a82
ms.openlocfilehash: 15de5d9ec8dc4016753b9d4cbed6fb0c64571774
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/12/2020
ms.locfileid: "79186036"
---
# <a name="how-to-diagnose-problematic-print-job"></a><span data-ttu-id="f176d-102">Procedura: diagnosticare processi di stampa problematici</span><span class="sxs-lookup"><span data-stu-id="f176d-102">How to: Diagnose Problematic Print Job</span></span>
<span data-ttu-id="f176d-103">Gli amministratori di rete fanno spesso fronte ai reclami degli utenti su processi di stampa lenti o che non vengono eseguiti affatto.</span><span class="sxs-lookup"><span data-stu-id="f176d-103">Network administrators often field complaints from users about print jobs that do not print or print slowly.</span></span> <span data-ttu-id="f176d-104">Il set completo di proprietà dei processi di stampa esposte nelle API di Microsoft .NET Framework fornisce un mezzo per eseguire una diagnosi remota rapida dei processi di stampa.</span><span class="sxs-lookup"><span data-stu-id="f176d-104">The rich set of print job properties exposed in the APIs of Microsoft .NET Framework provide a means for performing a rapid remote diagnosis of print jobs.</span></span>  
  
## <a name="example"></a><span data-ttu-id="f176d-105">Esempio</span><span class="sxs-lookup"><span data-stu-id="f176d-105">Example</span></span>  
 <span data-ttu-id="f176d-106">Di seguito sono indicati i passaggi principali per la creazione di questo tipo di utilità.</span><span class="sxs-lookup"><span data-stu-id="f176d-106">The major steps for creating this kind of utility are as follows.</span></span>  
  
1. <span data-ttu-id="f176d-107">Identificare il processo di stampa oggetto del reclamo dell'utente.</span><span class="sxs-lookup"><span data-stu-id="f176d-107">Identify the print job that the user is complaining about.</span></span> <span data-ttu-id="f176d-108">Gli utenti spesso non sono in grado di eseguire questa verifica con precisione.</span><span class="sxs-lookup"><span data-stu-id="f176d-108">Users often cannot do this precisely.</span></span> <span data-ttu-id="f176d-109">Non conoscono i nomi dei server di stampa o delle stampanti.</span><span class="sxs-lookup"><span data-stu-id="f176d-109">They may not know the names of the print servers or printers.</span></span> <span data-ttu-id="f176d-110">Possono descrivere la posizione della stampante in una terminologia diversa da quella utilizzata nell'impostazione della relativa <xref:System.Printing.PrintQueue.Location%2A> proprietà.</span><span class="sxs-lookup"><span data-stu-id="f176d-110">They may describe the location of the printer in different terminology than was used in setting its <xref:System.Printing.PrintQueue.Location%2A> property.</span></span> <span data-ttu-id="f176d-111">È consigliabile quindi generare un elenco dei processi inviati dall'utente.</span><span class="sxs-lookup"><span data-stu-id="f176d-111">Accordingly, it is a good idea to generate a list of the user's currently submitted jobs.</span></span> <span data-ttu-id="f176d-112">Nel caso ci siano più processi, la comunicazione tra l'utente e l'amministratore del sistema di stampa può essere quindi usata per individuare il processo problematico.</span><span class="sxs-lookup"><span data-stu-id="f176d-112">If there is more than one, then communication between the user and the print system administrator can be used to pinpoint the job that is having problems.</span></span> <span data-ttu-id="f176d-113">Di seguito sono indicati i passaggi secondari.</span><span class="sxs-lookup"><span data-stu-id="f176d-113">The substeps are as follows.</span></span>  
  
    1. <span data-ttu-id="f176d-114">Ottenere un elenco di tutti i server di stampa.</span><span class="sxs-lookup"><span data-stu-id="f176d-114">Obtain a list of all print servers.</span></span>  
  
    2. <span data-ttu-id="f176d-115">Riprodurre il ciclo dei server per eseguire una query sulle code di stampa.</span><span class="sxs-lookup"><span data-stu-id="f176d-115">Loop through the servers to query their print queues.</span></span>  
  
    3. <span data-ttu-id="f176d-116">In ogni passaggio del ciclo del server, riprodurre il ciclo di tutte le code del server per eseguire query sui processi.</span><span class="sxs-lookup"><span data-stu-id="f176d-116">Within each pass of the server loop, loop through all the server's queues to query their jobs</span></span>  
  
    4. <span data-ttu-id="f176d-117">In ogni passaggio del ciclo di code, eseguire il ciclo dei processi e raccogliere informazioni di identificazione su quelli che sono stati inviati dall'utente del reclamo.</span><span class="sxs-lookup"><span data-stu-id="f176d-117">Within each pass of the queue loop, loop through its jobs and gather identifying information about those that were submitted by the complaining user.</span></span>  
  
2. <span data-ttu-id="f176d-118">Quando viene individuato il processo di stampa problematico, esaminare le proprietà rilevanti per vedere quale potrebbe essere la causa del problema.</span><span class="sxs-lookup"><span data-stu-id="f176d-118">When the problematic print job has been identified, examine relevant properties to see what might be the problem.</span></span> <span data-ttu-id="f176d-119">Ad esempio, se si tratta di un errore di stato del processo oppure la stampante che gestisce la coda è passata alla modalità offline prima della stampa.</span><span class="sxs-lookup"><span data-stu-id="f176d-119">For example, is job in an error state or did the printer servicing the queue go offline before the job could print?</span></span>  
  
 <span data-ttu-id="f176d-120">Il codice riportato di seguito include una serie di esempi di codice.</span><span class="sxs-lookup"><span data-stu-id="f176d-120">The code below is series of code examples.</span></span> <span data-ttu-id="f176d-121">Il primo esempio di codice contiene il ciclo tra le code di stampa.</span><span class="sxs-lookup"><span data-stu-id="f176d-121">The first code example contains the loop through the print queues.</span></span> <span data-ttu-id="f176d-122">(Passaggio 1c precedente.) La `myPrintQueues` variabile <xref:System.Printing.PrintQueueCollection> è l'oggetto per il server di stampa corrente.</span><span class="sxs-lookup"><span data-stu-id="f176d-122">(Step 1c above.) The variable `myPrintQueues` is the <xref:System.Printing.PrintQueueCollection> object for the current print server.</span></span>  
  
 <span data-ttu-id="f176d-123">L'esempio di codice inizia aggiornando <xref:System.Printing.PrintQueue.Refresh%2A?displayProperty=nameWithType>l'oggetto coda di stampa corrente con .</span><span class="sxs-lookup"><span data-stu-id="f176d-123">The code example begins by refreshing the current print queue object with <xref:System.Printing.PrintQueue.Refresh%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="f176d-124">Ciò garantisce che le proprietà dell'oggetto rappresentano accuratamente lo stato della stampante fisica rappresentata.</span><span class="sxs-lookup"><span data-stu-id="f176d-124">This ensures that the object's properties accurately represent the state of the physical printer that it represents.</span></span> <span data-ttu-id="f176d-125">L'applicazione ottiene quindi la raccolta dei processi <xref:System.Printing.PrintQueue.GetPrintJobInfoCollection%2A>di stampa attualmente presenti nella coda di stampa utilizzando .</span><span class="sxs-lookup"><span data-stu-id="f176d-125">Then the application gets the collection of print jobs currently in the print queue by using <xref:System.Printing.PrintQueue.GetPrintJobInfoCollection%2A>.</span></span>  
  
 <span data-ttu-id="f176d-126">Successivamente l'applicazione scorre <xref:System.Printing.PrintSystemJobInfo> in ciclo <xref:System.Printing.PrintSystemJobInfo.Submitter%2A> la raccolta e confronta ogni proprietà con l'alias dell'utente che si lamenta.</span><span class="sxs-lookup"><span data-stu-id="f176d-126">Next the application loops through the <xref:System.Printing.PrintSystemJobInfo> collection and compares each <xref:System.Printing.PrintSystemJobInfo.Submitter%2A> property with the alias of the complaining user.</span></span> <span data-ttu-id="f176d-127">Se ci sono corrispondenze, l'applicazione aggiunge le informazioni di identificazione sul processo alla stringa che verrà visualizzata.</span><span class="sxs-lookup"><span data-stu-id="f176d-127">If they match, the application adds identifying information about the job to the string that will be presented.</span></span> <span data-ttu-id="f176d-128">Le variabili `userName` e `jobList` vengono inizializzate prima nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f176d-128">(The `userName` and `jobList` variables are initialized earlier in the application.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#enumeratejobsinqueues)]
 [!code-csharp[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#enumeratejobsinqueues)]
 [!code-vb[DiagnoseProblematicPrintJob#EnumerateJobsInQueues](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#enumeratejobsinqueues)]  
  
 <span data-ttu-id="f176d-129">L'esempio di codice successivo preleva l'applicazione al passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="f176d-129">The next code example picks up the application at Step 2.</span></span> <span data-ttu-id="f176d-130">(Vedere sopra.) Il processo problematico è stato identificato e l'applicazione richiede le informazioni che lo identificheranno.</span><span class="sxs-lookup"><span data-stu-id="f176d-130">(See above.) The problematic job has been identified and the application prompts for the information that will identify it.</span></span> <span data-ttu-id="f176d-131">Da queste informazioni <xref:System.Printing.PrintServer> <xref:System.Printing.PrintQueue>crea <xref:System.Printing.PrintSystemJobInfo> , , e gli oggetti.</span><span class="sxs-lookup"><span data-stu-id="f176d-131">From this information it creates <xref:System.Printing.PrintServer>, <xref:System.Printing.PrintQueue>, and <xref:System.Printing.PrintSystemJobInfo> objects.</span></span>  
  
 <span data-ttu-id="f176d-132">A questo punto l'applicazione contiene una struttura ramificata corrispondente ai due modi di controllo dello stato del processo di stampa:</span><span class="sxs-lookup"><span data-stu-id="f176d-132">At this point the application contains a branching structure corresponding to the two ways of checking a print job's status:</span></span>  
  
- <span data-ttu-id="f176d-133">È possibile leggere i <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> flag della <xref:System.Printing.PrintJobStatus>proprietà che è di tipo .</span><span class="sxs-lookup"><span data-stu-id="f176d-133">You can read the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property which is of type <xref:System.Printing.PrintJobStatus>.</span></span>  
  
- <span data-ttu-id="f176d-134">È possibile leggere ogni <xref:System.Printing.PrintSystemJobInfo.IsBlocked%2A> proprietà <xref:System.Printing.PrintSystemJobInfo.IsInError%2A>rilevante come e .</span><span class="sxs-lookup"><span data-stu-id="f176d-134">You can read each relevant property such as <xref:System.Printing.PrintSystemJobInfo.IsBlocked%2A> and <xref:System.Printing.PrintSystemJobInfo.IsInError%2A>.</span></span>  
  
 <span data-ttu-id="f176d-135">In questo esempio vengono illustrati entrambi i metodi, pertanto all'utente è stato precedentemente richiesto quale <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> metodo utilizzare e ha risposto con "Y" se desiderava utilizzare i flag della proprietà.</span><span class="sxs-lookup"><span data-stu-id="f176d-135">This example demonstrates both methods, so the user was previously prompted as to which method to use and responded with "Y" if they wanted to use the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property.</span></span> <span data-ttu-id="f176d-136">Per i dettagli dei due metodi, vedere di seguito.</span><span class="sxs-lookup"><span data-stu-id="f176d-136">See below for the details of the two methods.</span></span> <span data-ttu-id="f176d-137">Infine, l'applicazione usa un metodo denominato **ReportQueueAndJobAvailability** per segnalare se il processo può essere stampato all'ora indicata.</span><span class="sxs-lookup"><span data-stu-id="f176d-137">Finally, the application uses a method called **ReportQueueAndJobAvailability** to report on whether the job can be printed at this time of day.</span></span> <span data-ttu-id="f176d-138">Questo metodo viene illustrato in [Individuare se è possibile eseguire o meno un processo di stampa all'orario indicato](how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day.md).</span><span class="sxs-lookup"><span data-stu-id="f176d-138">This method is discussed in [Discover Whether a Print Job Can Be Printed At This Time of Day](how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day.md).</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#identifyanddiagnoseproblematicjob)]
 [!code-csharp[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#identifyanddiagnoseproblematicjob)]
 [!code-vb[DiagnoseProblematicPrintJob#IdentifyAndDiagnoseProblematicJob](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#identifyanddiagnoseproblematicjob)]  
  
 <span data-ttu-id="f176d-139">Per controllare lo stato del <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> processo di stampa utilizzando i flag della proprietà, controllare ogni flag pertinente per vedere se è impostato.</span><span class="sxs-lookup"><span data-stu-id="f176d-139">To check print job status using the flags of the <xref:System.Printing.PrintSystemJobInfo.JobStatus%2A> property, you check each relevant flag to see if it is set.</span></span> <span data-ttu-id="f176d-140">Il metodo standard per verificare se un bit è impostato in un set di flag di bit consiste nell'eseguire un'operazione di AND logico con il set di flag come uno degli operandi e il flag stesso come altro operando.</span><span class="sxs-lookup"><span data-stu-id="f176d-140">The standard way to see if one bit is set in a set of bit flags is to perform a logical AND operation with the set of flags as one operand and the flag itself as the other.</span></span> <span data-ttu-id="f176d-141">Poiché il flag stesso ha un solo bit impostato, il risultato dell'AND logico è che, al massimo, è impostato quello stesso bit.</span><span class="sxs-lookup"><span data-stu-id="f176d-141">Since the flag itself has only one bit set, the result of the logical AND is that, at most, that same bit is set.</span></span> <span data-ttu-id="f176d-142">Per verificare se lo è o meno, confrontare il risultato dell’AND logico con il flag stesso.</span><span class="sxs-lookup"><span data-stu-id="f176d-142">To find out whether it is or not, just compare the result of the logical AND with the flag itself.</span></span> <span data-ttu-id="f176d-143">Per ulteriori informazioni, vedere <xref:System.Printing.PrintJobStatus>, l'operatore& [(Riferimenti per C)](../../../csharp/language-reference/operators/bitwise-and-shift-operators.md#logical-and-operator-)e <xref:System.FlagsAttribute>.</span><span class="sxs-lookup"><span data-stu-id="f176d-143">For more information, see <xref:System.Printing.PrintJobStatus>, the [& Operator (C# Reference)](../../../csharp/language-reference/operators/bitwise-and-shift-operators.md#logical-and-operator-), and <xref:System.FlagsAttribute>.</span></span>  
  
 <span data-ttu-id="f176d-144">Per ogni attributo il cui bit è impostato, il codice lo riporta allo schermo della console e talvolta suggerisce un modo per rispondere.</span><span class="sxs-lookup"><span data-stu-id="f176d-144">For each attribute whose bit is set, the code reports this to the console screen and sometimes suggests a way to respond.</span></span> <span data-ttu-id="f176d-145">Il metodo **HandlePausedJob** che viene chiamato se il processo o la coda è in pausa è illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="f176d-145">(The **HandlePausedJob** method that is called if the job or queue is paused is discussed below.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#spottroubleusingjobattributes)]
 [!code-csharp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#spottroubleusingjobattributes)]
 [!code-vb[DiagnoseProblematicPrintJob#SpotTroubleUsingJobAttributes](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#spottroubleusingjobattributes)]  
  
 <span data-ttu-id="f176d-146">Per controllare lo stato del processo di stampa usando proprietà separate, è sufficiente leggere tutte le proprietà e, se la proprietà è `true`, visualizzarla nello schermo della console e suggerire possibilmente una modalità di risposta.</span><span class="sxs-lookup"><span data-stu-id="f176d-146">To check print job status using separate properties, you simply read each property and, if the property is `true`, report to the console screen and possibly suggest a way to respond.</span></span> <span data-ttu-id="f176d-147">Il metodo **HandlePausedJob** che viene chiamato se il processo o la coda è in pausa è illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="f176d-147">(The **HandlePausedJob** method that is called if the job or queue is paused is discussed below.)</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#spottroubleusingjobproperties)]
 [!code-csharp[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#spottroubleusingjobproperties)]
 [!code-vb[DiagnoseProblematicPrintJob#SpotTroubleUsingJobProperties](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#spottroubleusingjobproperties)]  
  
 <span data-ttu-id="f176d-148">Il metodo **HandlePausedJob** consente all'utente dell'applicazione di riprendere i processi sospesi in modalità remota.</span><span class="sxs-lookup"><span data-stu-id="f176d-148">The **HandlePausedJob** method enables the application's user to remotely resume paused jobs.</span></span> <span data-ttu-id="f176d-149">Poiché potrebbe esserci un motivo valido per cui è stata sospesa la coda di stampa, il metodo inizia richiedendo all'utente conferma sul riavvio.</span><span class="sxs-lookup"><span data-stu-id="f176d-149">Because there might be a good reason why the print queue was paused, the method begins by prompting for a user decision about whether to resume it.</span></span> <span data-ttu-id="f176d-150">Se la risposta è "Y", viene chiamato il <xref:System.Printing.PrintQueue.Resume%2A?displayProperty=nameWithType> metodo .</span><span class="sxs-lookup"><span data-stu-id="f176d-150">If the answer is "Y", then the <xref:System.Printing.PrintQueue.Resume%2A?displayProperty=nameWithType> method is called.</span></span>  
  
 <span data-ttu-id="f176d-151">Successivamente, verrà richiesto all'utente di decidere se deve essere ripreso il processo stesso, nel caso sia stato sospeso indipendentemente dalla coda di stampa.</span><span class="sxs-lookup"><span data-stu-id="f176d-151">Next the user is prompted to decide if the job itself should be resumed, just in case it is paused independently of the print queue.</span></span> <span data-ttu-id="f176d-152">(Confronta <xref:System.Printing.PrintQueue.IsPaused%2A?displayProperty=nameWithType> <xref:System.Printing.PrintSystemJobInfo.IsPaused%2A?displayProperty=nameWithType>e .) Se la risposta è "Y", allora <xref:System.Printing.PrintSystemJobInfo.Resume%2A?displayProperty=nameWithType> viene chiamato; in <xref:System.Printing.PrintSystemJobInfo.Cancel%2A> caso contrario viene chiamato.</span><span class="sxs-lookup"><span data-stu-id="f176d-152">(Compare <xref:System.Printing.PrintQueue.IsPaused%2A?displayProperty=nameWithType> and <xref:System.Printing.PrintSystemJobInfo.IsPaused%2A?displayProperty=nameWithType>.) If the answer is "Y", then <xref:System.Printing.PrintSystemJobInfo.Resume%2A?displayProperty=nameWithType> is called; otherwise <xref:System.Printing.PrintSystemJobInfo.Cancel%2A> is called.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#handlepausedjob)]
 [!code-csharp[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#handlepausedjob)]
 [!code-vb[DiagnoseProblematicPrintJob#HandlePausedJob](~/samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#handlepausedjob)]  
  
## <a name="see-also"></a><span data-ttu-id="f176d-153">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="f176d-153">See also</span></span>

- <xref:System.Printing.PrintJobStatus>
- <xref:System.Printing.PrintSystemJobInfo>
- <xref:System.FlagsAttribute>
- <xref:System.Printing.PrintQueue>
- [<span data-ttu-id="f176d-154">Operatore& (Riferimenti per C</span><span class="sxs-lookup"><span data-stu-id="f176d-154">& Operator (C# Reference)</span></span>](../../../csharp/language-reference/operators/bitwise-and-shift-operators.md#logical-and-operator-)
- [<span data-ttu-id="f176d-155">Documenti in WPF</span><span class="sxs-lookup"><span data-stu-id="f176d-155">Documents in WPF</span></span>](documents-in-wpf.md)
- [<span data-ttu-id="f176d-156">Cenni preliminari sulla stampa</span><span class="sxs-lookup"><span data-stu-id="f176d-156">Printing Overview</span></span>](printing-overview.md)
