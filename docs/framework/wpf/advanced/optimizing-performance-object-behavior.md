---
title: 'Ottimizzazione delle prestazioni: comportamento degli oggetti'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- user interface virtualization [WPF]
- dependency properties [WPF], performance
- event handlers [WPF]
- object performance considerations [WPF]
- Freezable objects [WPF], performance
ms.assetid: 73aa2f47-1d73-439a-be1f-78dc4ba2b5bd
ms.openlocfilehash: 67184db7fc1459e83ac7b1e6ff09ef56e43f0ca4
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/12/2020
ms.locfileid: "79187071"
---
# <a name="optimizing-performance-object-behavior"></a><span data-ttu-id="ade32-102">Ottimizzazione delle prestazioni: comportamento degli oggetti</span><span class="sxs-lookup"><span data-stu-id="ade32-102">Optimizing Performance: Object Behavior</span></span>
<span data-ttu-id="ade32-103">La comprensione del comportamento intrinseco degli oggetti [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] consente di trovare più facilmente il compromesso ideale tra funzionalità e prestazioni.</span><span class="sxs-lookup"><span data-stu-id="ade32-103">Understanding the intrinsic behavior of [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] objects will help you make the right tradeoffs between functionality and performance.</span></span>  

<a name="Not_Removing_Event_Handlers"></a>
## <a name="not-removing-event-handlers-on-objects-may-keep-objects-alive"></a><span data-ttu-id="ade32-104">La mancata rimozione di gestori eventi dagli oggetti può mantenere gli oggetti attivi</span><span class="sxs-lookup"><span data-stu-id="ade32-104">Not Removing Event Handlers on Objects may Keep Objects Alive</span></span>  
 <span data-ttu-id="ade32-105">Il delegato passato da un oggetto al relativo evento è di fatto un riferimento all'oggetto.</span><span class="sxs-lookup"><span data-stu-id="ade32-105">The delegate that an object passes to its event is effectively a reference to that object.</span></span> <span data-ttu-id="ade32-106">I gestori eventi, quindi, possono mantenere gli oggetti attivi più a lungo del previsto.</span><span class="sxs-lookup"><span data-stu-id="ade32-106">Therefore, event handlers can keep objects alive longer than expected.</span></span> <span data-ttu-id="ade32-107">Quando si esegue la pulitura di un oggetto registrato per restare in ascolto di un evento dell'oggetto, è essenziale rimuovere il delegato prima di rilasciare l'oggetto.</span><span class="sxs-lookup"><span data-stu-id="ade32-107">When performing clean up of an object that has registered to listen to an object's event, it is essential to remove that delegate before releasing the object.</span></span> <span data-ttu-id="ade32-108">Mantenere attivi oggetti non necessari aumenta il consumo di memoria dell'applicazione,</span><span class="sxs-lookup"><span data-stu-id="ade32-108">Keeping unneeded objects alive increases the application's memory usage.</span></span> <span data-ttu-id="ade32-109">soprattutto se l'oggetto è la radice di un albero logico o di una struttura ad albero visuale.</span><span class="sxs-lookup"><span data-stu-id="ade32-109">This is especially true when the object is the root of a logical tree or a visual tree.</span></span>  
  
 <span data-ttu-id="ade32-110">In [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] è stato introdotto un modello di listener di eventi debole per eventi che possono rivelarsi utili in situazioni in cui è difficile tenere traccia delle relazioni di durata degli oggetti tra l'origine e il listener.</span><span class="sxs-lookup"><span data-stu-id="ade32-110">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] introduces a weak event listener pattern for events that can be useful in situations where the object lifetime relationships between source and listener are difficult to keep track of.</span></span> <span data-ttu-id="ade32-111">Alcuni eventi [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] esistenti usano già questo modello,</span><span class="sxs-lookup"><span data-stu-id="ade32-111">Some existing [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] events use this pattern.</span></span> <span data-ttu-id="ade32-112">che può essere utile soprattutto per implementare oggetti con eventi personalizzati.</span><span class="sxs-lookup"><span data-stu-id="ade32-112">If you are implementing objects with custom events, this pattern may be of use to you.</span></span> <span data-ttu-id="ade32-113">Per informazioni dettagliate, vedere [Modelli di eventi deboli](weak-event-patterns.md).</span><span class="sxs-lookup"><span data-stu-id="ade32-113">For details, see [Weak Event Patterns](weak-event-patterns.md).</span></span>  
  
 <span data-ttu-id="ade32-114">Sono disponibili vari strumenti, ad esempio il profiler CLR e il visualizzatore del working set, in grado di fornire informazioni sul consumo di memoria di un determinato processo.</span><span class="sxs-lookup"><span data-stu-id="ade32-114">There are several tools, such as the CLR Profiler and the Working Set Viewer, that can provides information on the memory usage of a specified process.</span></span> <span data-ttu-id="ade32-115">Il profiler CLR include alcune visualizzazioni del profilo di allocazione molto utili, tra cui un istogramma dei tipi allocati, grafici delle allocazioni e delle chiamate, una cronologia delle operazioni di Garbage Collection di varie generazioni e lo stato dell'heap gestito che ne deriva e una struttura ad albero delle chiamate che mostra le allocazioni per metodo e i caricamenti degli assembly.</span><span class="sxs-lookup"><span data-stu-id="ade32-115">The CLR Profiler includes a number of very useful views of the allocation profile, including a histogram of allocated types, allocation and call graphs, a time line showing garbage collections of various generations and the resulting state of the managed heap after those collections, and a call tree showing per-method allocations and assembly loads.</span></span> <span data-ttu-id="ade32-116">Per altre informazioni, vedere [Prestazioni](https://docs.microsoft.com/previous-versions/aa497289(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="ade32-116">For more information, see [Performance](https://docs.microsoft.com/previous-versions/aa497289(v=msdn.10)).</span></span>  
  
<a name="DPs_and_Objects"></a>
## <a name="dependency-properties-and-objects"></a><span data-ttu-id="ade32-117">Proprietà e oggetti di dipendenza</span><span class="sxs-lookup"><span data-stu-id="ade32-117">Dependency Properties and Objects</span></span>  
 <span data-ttu-id="ade32-118">In generale, l'accesso a <xref:System.Windows.DependencyObject> una proprietà di dipendenza di un oggetto non è più lento dell'accesso a una proprietà CLR.</span><span class="sxs-lookup"><span data-stu-id="ade32-118">In general, accessing a dependency property of a <xref:System.Windows.DependencyObject> is not slower than accessing a CLR property.</span></span> <span data-ttu-id="ade32-119">Mentre c'è un piccolo sovraccarico delle prestazioni per l'impostazione di un valore di proprietà, ottenere un valore è veloce come ottenere il valore da una proprietà CLR.</span><span class="sxs-lookup"><span data-stu-id="ade32-119">While there is a small performance overhead for setting a property value, getting a value is as fast as getting the value from a CLR property.</span></span> <span data-ttu-id="ade32-120">Il sovraccarico delle prestazioni, infatti, è compensato dalla capacità delle proprietà di dipendenza di supportare funzionalità avanzate come il data binding, l'animazione, l'ereditarietà e l'applicazione di stili.</span><span class="sxs-lookup"><span data-stu-id="ade32-120">Offsetting the small performance overhead is the fact that dependency properties support robust features, such as data binding, animation, inheritance, and styling.</span></span> <span data-ttu-id="ade32-121">Per altre informazioni, vedere [Panoramica  sulle proprietà di dipendenza](dependency-properties-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ade32-121">For more information, see [Dependency Properties Overview](dependency-properties-overview.md).</span></span>  
  
### <a name="dependencyproperty-optimizations"></a><span data-ttu-id="ade32-122">Ottimizzazioni di DependencyProperty</span><span class="sxs-lookup"><span data-stu-id="ade32-122">DependencyProperty Optimizations</span></span>  
 <span data-ttu-id="ade32-123">È necessario definire le proprietà di dipendenza nell'applicazione con estrema attenzione.</span><span class="sxs-lookup"><span data-stu-id="ade32-123">You should define dependency properties in your application very carefully.</span></span> <span data-ttu-id="ade32-124">Se <xref:System.Windows.DependencyProperty> l'opzione esegue il rendering delle opzioni <xref:System.Windows.FrameworkPropertyMetadata.AffectsMeasure%2A>dei metadati del tipo, anziché di altre opzioni di metadati, ad esempio , è necessario contrassegnarla come tale eseguendo l'override dei relativi metadati.</span><span class="sxs-lookup"><span data-stu-id="ade32-124">If your <xref:System.Windows.DependencyProperty> affects only render type metadata options, rather than other metadata options such as <xref:System.Windows.FrameworkPropertyMetadata.AffectsMeasure%2A>, you should mark it as such by overriding its metadata.</span></span> <span data-ttu-id="ade32-125">Per altre informazioni sull'override dei metadati delle proprietà o su come ottenere i metadati delle proprietà, vedere [Metadati delle proprietà di dipendenza](dependency-property-metadata.md).</span><span class="sxs-lookup"><span data-stu-id="ade32-125">For more information about overriding or obtaining property metadata, see [Dependency Property Metadata](dependency-property-metadata.md).</span></span>  
  
 <span data-ttu-id="ade32-126">Nel caso in cui non tutte le modifiche alle proprietà influiscano effettivamente sulla misura, la disposizione e il rendering, può essere più vantaggioso avere un gestore delle modifiche alle proprietà che consenta di invalidare manualmente la misura, la disposizione e i passaggi di rendering.</span><span class="sxs-lookup"><span data-stu-id="ade32-126">It may be more efficient to have a property change handler invalidate the measure, arrange, and render passes manually if not all property changes actually affect measure, arrange, and render.</span></span> <span data-ttu-id="ade32-127">È possibile, ad esempio, decidere di eseguire nuovamente il rendering di uno sfondo solo se un valore è superiore a un limite impostato.</span><span class="sxs-lookup"><span data-stu-id="ade32-127">For instance, you might decide to re-render a background only when a value is greater than a set limit.</span></span> <span data-ttu-id="ade32-128">In questo caso, il rendering verrebbe invalidato dal gestore delle modifiche alle proprietà solo se il valore supera il limite impostato.</span><span class="sxs-lookup"><span data-stu-id="ade32-128">In this case, your property change handler would only invalidate render when the value exceeds the set limit.</span></span>  
  
### <a name="making-a-dependencyproperty-inheritable-is-not-free"></a><span data-ttu-id="ade32-129">Problemi legati alla possibilità di rendere ereditabile un oggetto DependencyProperty</span><span class="sxs-lookup"><span data-stu-id="ade32-129">Making a DependencyProperty Inheritable is Not Free</span></span>  
 <span data-ttu-id="ade32-130">Per impostazione predefinita, le proprietà di dipendenza registrate non sono ereditabili.</span><span class="sxs-lookup"><span data-stu-id="ade32-130">By default, registered dependency properties are non-inheritable.</span></span> <span data-ttu-id="ade32-131">È possibile tuttavia rendere ereditabile qualsiasi proprietà in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="ade32-131">However, you can explicitly make any property inheritable.</span></span> <span data-ttu-id="ade32-132">Sebbene possa essere utile, la conversione di una proprietà per renderla ereditabile incide sulle prestazioni, poiché aumenta la durata della procedura di annullamento della convalida della proprietà.</span><span class="sxs-lookup"><span data-stu-id="ade32-132">While this is a useful feature, converting a property to be inheritable impacts performance by increasing the length of time for property invalidation.</span></span>  
  
### <a name="use-registerclasshandler-carefully"></a><span data-ttu-id="ade32-133">Uso corretto di RegisterClassHandler</span><span class="sxs-lookup"><span data-stu-id="ade32-133">Use RegisterClassHandler Carefully</span></span>  
 <span data-ttu-id="ade32-134">Mentre <xref:System.Windows.EventManager.RegisterClassHandler%2A> la chiamata consente di salvare lo stato dell'istanza, è importante tenere presente che il gestore viene chiamato su ogni istanza, che può causare problemi di prestazioni.</span><span class="sxs-lookup"><span data-stu-id="ade32-134">While calling <xref:System.Windows.EventManager.RegisterClassHandler%2A> allows you to save your instance state, it is important to be aware that the handler is called on every instance, which can cause performance problems.</span></span> <span data-ttu-id="ade32-135">Utilizzare <xref:System.Windows.EventManager.RegisterClassHandler%2A> solo quando l'applicazione richiede il salvataggio dello stato dell'istanza.</span><span class="sxs-lookup"><span data-stu-id="ade32-135">Only use <xref:System.Windows.EventManager.RegisterClassHandler%2A> when your application requires that you save your instance state.</span></span>  
  
### <a name="set-the-default-value-for-a-dependencyproperty-during-registration"></a><span data-ttu-id="ade32-136">Impostazione del valore predefinito di un oggetto DependencyProperty durante le registrazione</span><span class="sxs-lookup"><span data-stu-id="ade32-136">Set the Default Value for a DependencyProperty during Registration</span></span>  
 <span data-ttu-id="ade32-137">Quando si <xref:System.Windows.DependencyProperty> crea un oggetto che richiede un valore predefinito, impostare il valore utilizzando i metadati predefiniti passati come parametro sul <xref:System.Windows.DependencyProperty.Register%2A> metodo dell'oggetto <xref:System.Windows.DependencyProperty>.</span><span class="sxs-lookup"><span data-stu-id="ade32-137">When creating a <xref:System.Windows.DependencyProperty> that requires a default value, set the value using the default metadata passed as a parameter to the <xref:System.Windows.DependencyProperty.Register%2A> method of the <xref:System.Windows.DependencyProperty>.</span></span> <span data-ttu-id="ade32-138">Usare questa tecnica, anziché impostare il valore della proprietà, in un costruttore o in ogni istanza di un elemento.</span><span class="sxs-lookup"><span data-stu-id="ade32-138">Use this technique rather than setting the property value in a constructor or on each instance of an element.</span></span>  
  
### <a name="set-the-propertymetadata-value-using-register"></a><span data-ttu-id="ade32-139">Impostazione del valore PropertyMetadata usando Register</span><span class="sxs-lookup"><span data-stu-id="ade32-139">Set the PropertyMetadata Value using Register</span></span>  
 <span data-ttu-id="ade32-140">Quando si <xref:System.Windows.DependencyProperty>crea un oggetto , <xref:System.Windows.PropertyMetadata> è <xref:System.Windows.DependencyProperty.Register%2A> possibile <xref:System.Windows.DependencyProperty.OverrideMetadata%2A> impostare i metodi o .</span><span class="sxs-lookup"><span data-stu-id="ade32-140">When creating a <xref:System.Windows.DependencyProperty>, you have the option of setting the <xref:System.Windows.PropertyMetadata> using either the <xref:System.Windows.DependencyProperty.Register%2A> or <xref:System.Windows.DependencyProperty.OverrideMetadata%2A> methods.</span></span> <span data-ttu-id="ade32-141">Anche se l'oggetto potrebbe <xref:System.Windows.DependencyProperty.OverrideMetadata%2A>avere un costruttore statico da chiamare , questa non è la soluzione ottimale e influirà sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="ade32-141">Although your object could have a static constructor to call <xref:System.Windows.DependencyProperty.OverrideMetadata%2A>, this is not the optimal solution and will impact performance.</span></span> <span data-ttu-id="ade32-142">Per ottenere prestazioni <xref:System.Windows.PropertyMetadata> ottimali, <xref:System.Windows.DependencyProperty.Register%2A>impostare durante la chiamata a .</span><span class="sxs-lookup"><span data-stu-id="ade32-142">For best performance, set the <xref:System.Windows.PropertyMetadata> during the call to <xref:System.Windows.DependencyProperty.Register%2A>.</span></span>  
  
<a name="Freezable_Objects"></a>
## <a name="freezable-objects"></a><span data-ttu-id="ade32-143">Oggetti Freezable</span><span class="sxs-lookup"><span data-stu-id="ade32-143">Freezable Objects</span></span>  
 <span data-ttu-id="ade32-144">A <xref:System.Windows.Freezable> è un tipo speciale di oggetto che ha due stati: non bloccato e congelato.</span><span class="sxs-lookup"><span data-stu-id="ade32-144">A <xref:System.Windows.Freezable> is a special type of object that has two states: unfrozen and frozen.</span></span> <span data-ttu-id="ade32-145">Bloccare gli oggetti ogni volta che è possibile migliora le prestazioni dell'applicazione e ne riduce il working set.</span><span class="sxs-lookup"><span data-stu-id="ade32-145">Freezing objects whenever possible improves the performance of your application and reduces its working set.</span></span> <span data-ttu-id="ade32-146">Per altre informazioni, vedere [Cenni preliminari sugli oggetti Freezable](freezable-objects-overview.md).</span><span class="sxs-lookup"><span data-stu-id="ade32-146">For more information, see [Freezable Objects Overview](freezable-objects-overview.md).</span></span>  
  
 <span data-ttu-id="ade32-147">Ognuno <xref:System.Windows.Freezable> <xref:System.Windows.Freezable.Changed> ha un evento che viene generato ogni volta che cambia.</span><span class="sxs-lookup"><span data-stu-id="ade32-147">Each <xref:System.Windows.Freezable> has a <xref:System.Windows.Freezable.Changed> event that is raised whenever it changes.</span></span> <span data-ttu-id="ade32-148">Le notifiche di modifica, tuttavia, sono molto dispendiose in termini di prestazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ade32-148">However, change notifications are costly in terms of application performance.</span></span>  
  
 <span data-ttu-id="ade32-149">Si consideri l'esempio seguente in cui ognuno utilizza lo stesso oggetto:Consider the following example in which each <xref:System.Windows.Shapes.Rectangle> uses the same <xref:System.Windows.Media.Brush> object:</span><span class="sxs-lookup"><span data-stu-id="ade32-149">Consider the following example in which each <xref:System.Windows.Shapes.Rectangle> uses the same <xref:System.Windows.Media.Brush> object:</span></span>  
  
 [!code-csharp[Performance#PerformanceSnippet2](~/samples/snippets/csharp/VS_Snippets_Wpf/Performance/CSharp/Window1.xaml.cs#performancesnippet2)]
 [!code-vb[Performance#PerformanceSnippet2](~/samples/snippets/visualbasic/VS_Snippets_Wpf/Performance/visualbasic/window1.xaml.vb#performancesnippet2)]  
  
 <span data-ttu-id="ade32-150">Per [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] impostazione predefinita, fornisce <xref:System.Windows.Media.SolidColorBrush> un <xref:System.Windows.Freezable.Changed> gestore eventi per <xref:System.Windows.Shapes.Rectangle> l'evento <xref:System.Windows.Shapes.Shape.Fill%2A> dell'oggetto per invalidare la proprietà dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="ade32-150">By default, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] provides an event handler for the <xref:System.Windows.Media.SolidColorBrush> object's <xref:System.Windows.Freezable.Changed> event in order to invalidate the <xref:System.Windows.Shapes.Rectangle> object's <xref:System.Windows.Shapes.Shape.Fill%2A> property.</span></span> <span data-ttu-id="ade32-151">In questo caso, <xref:System.Windows.Media.SolidColorBrush> ogni volta <xref:System.Windows.Freezable.Changed> che deve generare il proprio <xref:System.Windows.Shapes.Rectangle>evento è necessario richiamare la funzione di callback per ogni, ovvero l'accumulo di queste chiamate di funzione di callback impone una riduzione significativa delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="ade32-151">In this case, each time the <xref:System.Windows.Media.SolidColorBrush> has to fire its <xref:System.Windows.Freezable.Changed> event it is required to invoke the callback function for each <xref:System.Windows.Shapes.Rectangle>—the accumulation of these callback function invocations impose a significant performance penalty.</span></span> <span data-ttu-id="ade32-152">Ma non solo: per aggiungere e rimuovere gestori in questa fase, l'applicazione deve scorrere tutto l'elenco, con un considerevole dispendio di prestazioni.</span><span class="sxs-lookup"><span data-stu-id="ade32-152">In addition, it is very performance intensive to add and remove handlers at this point since the application would have to traverse the entire list to do so.</span></span> <span data-ttu-id="ade32-153">Se lo scenario dell'applicazione non modifica mai <xref:System.Windows.Media.SolidColorBrush> <xref:System.Windows.Freezable.Changed> il , si pagherà il costo della gestione dei gestori eventi inutilmente.</span><span class="sxs-lookup"><span data-stu-id="ade32-153">If your application scenario never changes the <xref:System.Windows.Media.SolidColorBrush>, you will be paying the cost of maintaining <xref:System.Windows.Freezable.Changed> event handlers unnecessarily.</span></span>  
  
 <span data-ttu-id="ade32-154">Il <xref:System.Windows.Freezable> blocco di un può migliorare le prestazioni, perché non è più necessario spendere risorse per la gestione delle notifiche di modifica.</span><span class="sxs-lookup"><span data-stu-id="ade32-154">Freezing a <xref:System.Windows.Freezable> can improve its performance, because it no longer needs to expend resources on maintaining change notifications.</span></span> <span data-ttu-id="ade32-155">La tabella seguente mostra le <xref:System.Windows.Media.SolidColorBrush> dimensioni <xref:System.Windows.Freezable.IsFrozen%2A> di un `true`elemento semplice quando la relativa proprietà è impostata su , rispetto a quando non lo è.</span><span class="sxs-lookup"><span data-stu-id="ade32-155">The table below shows the size of a simple <xref:System.Windows.Media.SolidColorBrush> when its <xref:System.Windows.Freezable.IsFrozen%2A> property is set to `true`, compared to when it is not.</span></span> <span data-ttu-id="ade32-156">Si presuppone l'applicazione di <xref:System.Windows.Shapes.Shape.Fill%2A> un <xref:System.Windows.Shapes.Rectangle> pennello alla proprietà di dieci oggetti.</span><span class="sxs-lookup"><span data-stu-id="ade32-156">This assumes applying one brush to the <xref:System.Windows.Shapes.Shape.Fill%2A> property of ten <xref:System.Windows.Shapes.Rectangle> objects.</span></span>  
  
|<span data-ttu-id="ade32-157">**Stato**</span><span class="sxs-lookup"><span data-stu-id="ade32-157">**State**</span></span>|<span data-ttu-id="ade32-158">**Dimensione**</span><span class="sxs-lookup"><span data-stu-id="ade32-158">**Size**</span></span>|  
|---------------|--------------|  
|<span data-ttu-id="ade32-159">Congelato<xref:System.Windows.Media.SolidColorBrush></span><span class="sxs-lookup"><span data-stu-id="ade32-159">Frozen <xref:System.Windows.Media.SolidColorBrush></span></span>|<span data-ttu-id="ade32-160">212 byte</span><span class="sxs-lookup"><span data-stu-id="ade32-160">212 Bytes</span></span>|  
|<span data-ttu-id="ade32-161">Non congelato<xref:System.Windows.Media.SolidColorBrush></span><span class="sxs-lookup"><span data-stu-id="ade32-161">Non-frozen <xref:System.Windows.Media.SolidColorBrush></span></span>|<span data-ttu-id="ade32-162">972 byte</span><span class="sxs-lookup"><span data-stu-id="ade32-162">972 Bytes</span></span>|  
  
 <span data-ttu-id="ade32-163">Nell'esempio di codice seguente viene dimostrato questo concetto:</span><span class="sxs-lookup"><span data-stu-id="ade32-163">The following code sample demonstrates this concept:</span></span>  
  
 [!code-csharp[Performance#PerformanceSnippet3](~/samples/snippets/csharp/VS_Snippets_Wpf/Performance/CSharp/Window1.xaml.cs#performancesnippet3)]
 [!code-vb[Performance#PerformanceSnippet3](~/samples/snippets/visualbasic/VS_Snippets_Wpf/Performance/visualbasic/window1.xaml.vb#performancesnippet3)]  
  
### <a name="changed-handlers-on-unfrozen-freezables-may-keep-objects-alive"></a><span data-ttu-id="ade32-164">Gestori modificati su oggetti Freezable non bloccati possono mantenere gli oggetti attivi</span><span class="sxs-lookup"><span data-stu-id="ade32-164">Changed Handlers on Unfrozen Freezables may Keep Objects Alive</span></span>  
 <span data-ttu-id="ade32-165">Il delegato che un <xref:System.Windows.Freezable> oggetto passa <xref:System.Windows.Freezable.Changed> all'evento di un oggetto è effettivamente un riferimento a tale oggetto.</span><span class="sxs-lookup"><span data-stu-id="ade32-165">The delegate that an object passes to a <xref:System.Windows.Freezable> object's <xref:System.Windows.Freezable.Changed> event is effectively a reference to that object.</span></span> <span data-ttu-id="ade32-166">Pertanto, <xref:System.Windows.Freezable.Changed> i gestori eventi possono mantenere gli oggetti attivi più a lungo del previsto.</span><span class="sxs-lookup"><span data-stu-id="ade32-166">Therefore, <xref:System.Windows.Freezable.Changed> event handlers can keep objects alive longer than expected.</span></span> <span data-ttu-id="ade32-167">Quando si esegue la pulizia di un <xref:System.Windows.Freezable> oggetto registrato <xref:System.Windows.Freezable.Changed> per l'ascolto dell'evento di un oggetto, è essenziale rimuovere tale delegato prima di rilasciare l'oggetto.</span><span class="sxs-lookup"><span data-stu-id="ade32-167">When performing clean up of an object that has registered to listen to a <xref:System.Windows.Freezable> object's <xref:System.Windows.Freezable.Changed> event, it is essential to remove that delegate before releasing the object.</span></span>  
  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="ade32-168">aggancia <xref:System.Windows.Freezable.Changed> gli eventi internamente.</span><span class="sxs-lookup"><span data-stu-id="ade32-168">also hooks up <xref:System.Windows.Freezable.Changed> events internally.</span></span> <span data-ttu-id="ade32-169">Ad esempio, tutte le <xref:System.Windows.Freezable> proprietà di dipendenza <xref:System.Windows.Freezable.Changed> che accettano come valore ascolteranno automaticamente gli eventi.</span><span class="sxs-lookup"><span data-stu-id="ade32-169">For example, all dependency properties which take <xref:System.Windows.Freezable> as a value will listen to <xref:System.Windows.Freezable.Changed> events automatically.</span></span> <span data-ttu-id="ade32-170">La <xref:System.Windows.Shapes.Shape.Fill%2A> proprietà , <xref:System.Windows.Media.Brush>che accetta un oggetto , illustra questo concetto.</span><span class="sxs-lookup"><span data-stu-id="ade32-170">The <xref:System.Windows.Shapes.Shape.Fill%2A> property, which takes a <xref:System.Windows.Media.Brush>, illustrates this concept.</span></span>  
  
 [!code-csharp[Performance#PerformanceSnippet4](~/samples/snippets/csharp/VS_Snippets_Wpf/Performance/CSharp/Window1.xaml.cs#performancesnippet4)]
 [!code-vb[Performance#PerformanceSnippet4](~/samples/snippets/visualbasic/VS_Snippets_Wpf/Performance/visualbasic/window1.xaml.vb#performancesnippet4)]  
  
 <span data-ttu-id="ade32-171">Nell'assegnazione `myBrush` `myRectangle.Fill`di a , un <xref:System.Windows.Shapes.Rectangle> delegato che punta <xref:System.Windows.Media.SolidColorBrush> all'oggetto <xref:System.Windows.Freezable.Changed> verrà aggiunto all'evento dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="ade32-171">On the assignment of `myBrush` to `myRectangle.Fill`, a delegate pointing back to the <xref:System.Windows.Shapes.Rectangle> object will be added to the <xref:System.Windows.Media.SolidColorBrush> object's <xref:System.Windows.Freezable.Changed> event.</span></span> <span data-ttu-id="ade32-172">Nel codice seguente, quindi, `myRect` non viene reso idoneo per operazioni di Garbage Collection:</span><span class="sxs-lookup"><span data-stu-id="ade32-172">This means the following code does not actually make `myRect` eligible for garbage collection:</span></span>  
  
 [!code-csharp[Performance#PerformanceSnippet5](~/samples/snippets/csharp/VS_Snippets_Wpf/Performance/CSharp/Window1.xaml.cs#performancesnippet5)]
 [!code-vb[Performance#PerformanceSnippet5](~/samples/snippets/visualbasic/VS_Snippets_Wpf/Performance/visualbasic/window1.xaml.vb#performancesnippet5)]  
  
 <span data-ttu-id="ade32-173">In questo `myBrush` caso `myRectangle` è ancora attivo e richiamerà <xref:System.Windows.Freezable.Changed> ad esso quando viene generato il suo evento.</span><span class="sxs-lookup"><span data-stu-id="ade32-173">In this case `myBrush` is still keeping `myRectangle` alive and will call back to it when it fires its <xref:System.Windows.Freezable.Changed> event.</span></span> <span data-ttu-id="ade32-174">Si noti `myBrush` che <xref:System.Windows.Shapes.Shape.Fill%2A> l'assegnazione alla proprietà di un nuovo <xref:System.Windows.Shapes.Rectangle> aggiungerà semplicemente un altro gestore eventi a `myBrush`.</span><span class="sxs-lookup"><span data-stu-id="ade32-174">Note that assigning `myBrush` to the <xref:System.Windows.Shapes.Shape.Fill%2A> property of a new <xref:System.Windows.Shapes.Rectangle> will simply add another event handler to `myBrush`.</span></span>  
  
 <span data-ttu-id="ade32-175">Il modo consigliato per pulire questi tipi <xref:System.Windows.Media.Brush> di <xref:System.Windows.Shapes.Shape.Fill%2A> oggetti consiste nel rimuovere <xref:System.Windows.Freezable.Changed> l'oggetto dalla proprietà, che a sua volta rimuoverà il gestore eventi.</span><span class="sxs-lookup"><span data-stu-id="ade32-175">The recommended way to clean up these types of objects is to remove the <xref:System.Windows.Media.Brush> from the <xref:System.Windows.Shapes.Shape.Fill%2A> property, which will in turn remove the <xref:System.Windows.Freezable.Changed> event handler.</span></span>  
  
 [!code-csharp[Performance#PerformanceSnippet6](~/samples/snippets/csharp/VS_Snippets_Wpf/Performance/CSharp/Window1.xaml.cs#performancesnippet6)]
 [!code-vb[Performance#PerformanceSnippet6](~/samples/snippets/visualbasic/VS_Snippets_Wpf/Performance/visualbasic/window1.xaml.vb#performancesnippet6)]  
  
<a name="User_Interface_Virtualization"></a>
## <a name="user-interface-virtualization"></a><span data-ttu-id="ade32-176">Virtualizzazione dell'interfaccia utente</span><span class="sxs-lookup"><span data-stu-id="ade32-176">User Interface Virtualization</span></span>  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="ade32-177">fornisce inoltre una <xref:System.Windows.Controls.StackPanel> variante dell'elemento che "virtualizza" automaticamente il contenuto figlio associato a dati.</span><span class="sxs-lookup"><span data-stu-id="ade32-177">also provides a variation of the <xref:System.Windows.Controls.StackPanel> element that automatically "virtualizes" data-bound child content.</span></span> <span data-ttu-id="ade32-178">In questo contesto il termine virtualizzare si riferisce a una tecnica grazie alla quale, a partire da un numero più elevato di elementi dati, viene generato un subset di oggetti in base agli elementi visibili sullo schermo.</span><span class="sxs-lookup"><span data-stu-id="ade32-178">In this context, the word virtualize refers to a technique by which a subset of objects are generated from a larger number of data items based upon which items are visible on-screen.</span></span> <span data-ttu-id="ade32-179">La generazione di un elevato numero di elementi dell'interfaccia utente, quando solo alcuni possono essere visualizzati sullo schermo in un momento specifico, richiede un consumo intensivo di risorse in termini sia di memoria sia di processore.</span><span class="sxs-lookup"><span data-stu-id="ade32-179">It is intensive, both in terms of memory and processor, to generate a large number of UI elements when only a few may be on the screen at a given time.</span></span> <span data-ttu-id="ade32-180"><xref:System.Windows.Controls.VirtualizingStackPanel>(tramite la <xref:System.Windows.Controls.VirtualizingPanel>funzionalità fornita da ) <xref:System.Windows.Controls.ItemContainerGenerator> calcola <xref:System.Windows.Controls.ItemsControl> gli <xref:System.Windows.Controls.ListBox> elementi <xref:System.Windows.Controls.ListView>visibili e utilizza l'oggetto da un (ad esempio o ) per creare elementi solo per gli elementi visibili.</span><span class="sxs-lookup"><span data-stu-id="ade32-180"><xref:System.Windows.Controls.VirtualizingStackPanel> (through functionality provided by <xref:System.Windows.Controls.VirtualizingPanel>) calculates visible items and works with the <xref:System.Windows.Controls.ItemContainerGenerator> from an <xref:System.Windows.Controls.ItemsControl> (such as <xref:System.Windows.Controls.ListBox> or <xref:System.Windows.Controls.ListView>) to only create elements for visible items.</span></span>  
  
 <span data-ttu-id="ade32-181">Per ottimizzare le prestazioni, gli oggetti visivi per questi elementi vengono generati o mantenuti attivi solo se sono visibili sullo schermo.</span><span class="sxs-lookup"><span data-stu-id="ade32-181">As a performance optimization, visual objects for these items are only generated or kept alive if they are visible on the screen.</span></span> <span data-ttu-id="ade32-182">Quando non si trovano più nell'area visualizzabile del controllo, gli oggetti visibili possono essere rimossi.</span><span class="sxs-lookup"><span data-stu-id="ade32-182">When they are no longer in the viewable area of the control, the visual objects may be removed.</span></span> <span data-ttu-id="ade32-183">Questa operazione non deve essere confusa con la virtualizzazione dei dati, in cui gli oggetti dati non sono tutti presenti nella raccolta locale, ma trasmessi a seconda delle esigenze.</span><span class="sxs-lookup"><span data-stu-id="ade32-183">This is not to be confused with data virtualization, where data objects are not all present in the local collection- rather streamed in as needed.</span></span>  
  
 <span data-ttu-id="ade32-184">La tabella seguente mostra il tempo trascorso aggiungendo <xref:System.Windows.Controls.TextBlock> e visualizzando 5000 elementi a a <xref:System.Windows.Controls.StackPanel> e a <xref:System.Windows.Controls.VirtualizingStackPanel>.</span><span class="sxs-lookup"><span data-stu-id="ade32-184">The table below shows the elapsed time adding and rendering 5000 <xref:System.Windows.Controls.TextBlock> elements to a <xref:System.Windows.Controls.StackPanel> and a <xref:System.Windows.Controls.VirtualizingStackPanel>.</span></span> <span data-ttu-id="ade32-185">In questo scenario, le misure rappresentano il tempo che <xref:System.Windows.Controls.ItemsControl.ItemsSource%2A> intersea va dall'associazione di una stringa di testo alla proprietà di un <xref:System.Windows.Controls.ItemsControl> oggetto e al momento in cui gli elementi del pannello visualizzano la stringa di testo.</span><span class="sxs-lookup"><span data-stu-id="ade32-185">In this scenario, the measurements represent the time between attaching a text string to the <xref:System.Windows.Controls.ItemsControl.ItemsSource%2A> property of an <xref:System.Windows.Controls.ItemsControl> object to the time when the panel elements display the text string.</span></span>  
  
|<span data-ttu-id="ade32-186">**Pannello host**</span><span class="sxs-lookup"><span data-stu-id="ade32-186">**Host panel**</span></span>|<span data-ttu-id="ade32-187">**Tempo di rendering (ms)**</span><span class="sxs-lookup"><span data-stu-id="ade32-187">**Render time (ms)**</span></span>|  
|--------------------|----------------------------|  
|<xref:System.Windows.Controls.StackPanel>|<span data-ttu-id="ade32-188">3210</span><span class="sxs-lookup"><span data-stu-id="ade32-188">3210</span></span>|  
|<xref:System.Windows.Controls.VirtualizingStackPanel>|<span data-ttu-id="ade32-189">46</span><span class="sxs-lookup"><span data-stu-id="ade32-189">46</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="ade32-190">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="ade32-190">See also</span></span>

- [<span data-ttu-id="ade32-191">Ottimizzazione delle prestazioni di applicazioni WPF</span><span class="sxs-lookup"><span data-stu-id="ade32-191">Optimizing WPF Application Performance</span></span>](optimizing-wpf-application-performance.md)
- [<span data-ttu-id="ade32-192">Pianificazione delle prestazioni dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="ade32-192">Planning for Application Performance</span></span>](planning-for-application-performance.md)
- [<span data-ttu-id="ade32-193">Sfruttare appieno l'hardware</span><span class="sxs-lookup"><span data-stu-id="ade32-193">Taking Advantage of Hardware</span></span>](optimizing-performance-taking-advantage-of-hardware.md)
- [<span data-ttu-id="ade32-194">Layout e progettazione</span><span class="sxs-lookup"><span data-stu-id="ade32-194">Layout and Design</span></span>](optimizing-performance-layout-and-design.md)
- [<span data-ttu-id="ade32-195">Grafica 2D e creazione di immagini</span><span class="sxs-lookup"><span data-stu-id="ade32-195">2D Graphics and Imaging</span></span>](optimizing-performance-2d-graphics-and-imaging.md)
- [<span data-ttu-id="ade32-196">Risorse dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="ade32-196">Application Resources</span></span>](optimizing-performance-application-resources.md)
- [<span data-ttu-id="ade32-197">Testo</span><span class="sxs-lookup"><span data-stu-id="ade32-197">Text</span></span>](optimizing-performance-text.md)
- [<span data-ttu-id="ade32-198">Associazione dati</span><span class="sxs-lookup"><span data-stu-id="ade32-198">Data Binding</span></span>](optimizing-performance-data-binding.md)
- [<span data-ttu-id="ade32-199">Altri suggerimenti relativi alle prestazioni</span><span class="sxs-lookup"><span data-stu-id="ade32-199">Other Performance Recommendations</span></span>](optimizing-performance-other-recommendations.md)
