---
title: Hit testing a livello visivo
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- hit testing functionality [WPF]
- visual layer [WPF], hit testing functionality
ms.assetid: b1a64b61-14be-4d75-b89a-5c67bebb2c7b
ms.openlocfilehash: 28ae983923c985050ac589166023e483721028d3
ms.sourcegitcommit: 700ea803fb06c5ce98de017c7f76463ba33ff4a9
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/19/2020
ms.locfileid: "77452617"
---
# <a name="hit-testing-in-the-visual-layer"></a><span data-ttu-id="d92e8-102">Hit testing a livello visivo</span><span class="sxs-lookup"><span data-stu-id="d92e8-102">Hit Testing in the Visual Layer</span></span>
<span data-ttu-id="d92e8-103">In questo argomento vengono forniti dei cenni preliminari sulle funzionalità di hit testing fornite dal livello visivo.</span><span class="sxs-lookup"><span data-stu-id="d92e8-103">This topic provides an overview of hit testing functionality provided by the visual layer.</span></span> <span data-ttu-id="d92e8-104">Il supporto per l'hit testing consente di determinare se un valore Geometry o Point rientra nel contenuto sottoposto a rendering di un <xref:System.Windows.Media.Visual>, consentendo di implementare il comportamento dell'interfaccia utente, ad esempio un rettangolo di selezione per selezionare più oggetti.</span><span class="sxs-lookup"><span data-stu-id="d92e8-104">Hit testing support allows you to determine whether a geometry or point value falls within the rendered content of a <xref:System.Windows.Media.Visual>, allowing you to implement user interface behavior such as a selection rectangle to select multiple objects.</span></span>  

<a name="hit_testing_scenarios"></a>   
## <a name="hit-testing-scenarios"></a><span data-ttu-id="d92e8-105">Scenari di hit Testing</span><span class="sxs-lookup"><span data-stu-id="d92e8-105">Hit Testing Scenarios</span></span>  
 <span data-ttu-id="d92e8-106">La classe <xref:System.Windows.UIElement> fornisce il metodo <xref:System.Windows.UIElement.InputHitTest%2A>, che consente di eseguire un hit test su un elemento usando un valore di coordinata specificato.</span><span class="sxs-lookup"><span data-stu-id="d92e8-106">The <xref:System.Windows.UIElement> class provides the <xref:System.Windows.UIElement.InputHitTest%2A> method, which allows you to hit test against an element using a given coordinate value.</span></span> <span data-ttu-id="d92e8-107">In molti casi, il metodo <xref:System.Windows.UIElement.InputHitTest%2A> fornisce la funzionalità desiderata per l'implementazione di hit testing di elementi.</span><span class="sxs-lookup"><span data-stu-id="d92e8-107">In many cases, the <xref:System.Windows.UIElement.InputHitTest%2A> method provides the desired functionality for implementing hit testing of elements.</span></span> <span data-ttu-id="d92e8-108">Esistono tuttavia diversi scenari nei quali potrebbe essere necessario implementare l'hit testing a livello visivo.</span><span class="sxs-lookup"><span data-stu-id="d92e8-108">However, there are several scenarios in which you may need to implement hit testing at the visual layer.</span></span>  
  
- <span data-ttu-id="d92e8-109">Hit testing su oggetti non<xref:System.Windows.UIElement>: questa condizione si applica se si esegue un hit testing di oggetti non<xref:System.Windows.UIElement>, ad esempio <xref:System.Windows.Media.DrawingVisual> o oggetti grafici.</span><span class="sxs-lookup"><span data-stu-id="d92e8-109">Hit testing against non-<xref:System.Windows.UIElement> objects: This applies if you are hit testing non-<xref:System.Windows.UIElement> objects, such as <xref:System.Windows.Media.DrawingVisual> or graphics objects.</span></span>  
  
- <span data-ttu-id="d92e8-110">Hit testing tramite una geometria: applicabile se è necessario eseguire un hit test usando un oggetto geometry anziché il valore delle coordinate di un punto.</span><span class="sxs-lookup"><span data-stu-id="d92e8-110">Hit testing using a geometry: This applies if you need to hit test using a geometry object rather than the coordinate value of a point.</span></span>  
  
- <span data-ttu-id="d92e8-111">Hit testing su più oggetti: applicabile quando è necessario eseguire un hit test su più oggetti, ad esempio oggetti sovrapposti.</span><span class="sxs-lookup"><span data-stu-id="d92e8-111">Hit testing against multiple objects: This applies when you need to hit test against multiple objects, such as overlapping objects.</span></span> <span data-ttu-id="d92e8-112">È possibile ottenere risultati per tutti gli elementi visivi che intersecano una geometria o un punto, non solo il primo.</span><span class="sxs-lookup"><span data-stu-id="d92e8-112">You can get results for all visuals intersecting a geometry or point, not just the first one.</span></span>  
  
- <span data-ttu-id="d92e8-113">Ignorando i criteri di hit testing <xref:System.Windows.UIElement>: questa condizione si applica quando è necessario ignorare i criteri di hit testing <xref:System.Windows.UIElement>, che prendono in considerazione i fattori che determinano se un elemento è disabilitato o invisibile.</span><span class="sxs-lookup"><span data-stu-id="d92e8-113">Ignoring <xref:System.Windows.UIElement> hit testing policy: This applies when you need to ignore the <xref:System.Windows.UIElement> hit testing policy, which takes into consideration such factors as whether an element is disabled or invisible.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d92e8-114">Per un esempio di codice completo che illustra l'hit testing a livello visivo, vedere [Hit Test Using DrawingVisuals Sample (Esempio di Hit Test mediante DrawingVisual)](https://github.com/Microsoft/WPF-Samples/tree/master/Visual%20Layer/DrawingVisual) e [Hit Test with Win32 Interoperation Sample (Esempio di hit test con interoperatività Win32)](https://github.com/microsoft/WPF-Samples/tree/master/Visual%20Layer/VisualsHitTesting).</span><span class="sxs-lookup"><span data-stu-id="d92e8-114">For a complete code sample illustrating hit testing at the visual layer, see [Hit Test Using DrawingVisuals Sample](https://github.com/Microsoft/WPF-Samples/tree/master/Visual%20Layer/DrawingVisual) and [Hit Test with Win32 Interoperation Sample](https://github.com/microsoft/WPF-Samples/tree/master/Visual%20Layer/VisualsHitTesting).</span></span>  
  
<a name="hit_testing_support"></a>   
## <a name="hit-testing-support"></a><span data-ttu-id="d92e8-115">Supporto per Hit Testing</span><span class="sxs-lookup"><span data-stu-id="d92e8-115">Hit Testing Support</span></span>  
 <span data-ttu-id="d92e8-116">Lo scopo dei metodi <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> nella classe <xref:System.Windows.Media.VisualTreeHelper> è determinare se un valore della coordinata di geometria o punto si trova all'interno del contenuto sottoposto a rendering di un determinato oggetto, ad esempio un controllo o un elemento grafico.</span><span class="sxs-lookup"><span data-stu-id="d92e8-116">The purpose of the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> methods in the <xref:System.Windows.Media.VisualTreeHelper> class is to determine whether a geometry or point coordinate value is within the rendered content of a given object, such as a control or graphic element.</span></span> <span data-ttu-id="d92e8-117">Ad esempio, è possibile usare l'hit testing per determinare se un clic del mouse all'interno del rettangolo di delimitazione di un oggetto avviene all'interno della geometria di un cerchio.</span><span class="sxs-lookup"><span data-stu-id="d92e8-117">For example, you could use hit testing to determine whether a mouse click within the bounding rectangle of an object falls within the geometry of a circle.</span></span> <span data-ttu-id="d92e8-118">È inoltre possibile scegliere di eseguire l'override dell'implementazione predefinita dell'hit testing per eseguire calcoli di hit testing personalizzati.</span><span class="sxs-lookup"><span data-stu-id="d92e8-118">You can also choose to override the default implementation of hit testing to perform your own custom hit test calculations.</span></span>  
  
 <span data-ttu-id="d92e8-119">La figura seguente mostra la relazione tra l'area dell'oggetto non rettangolare e il rettangolo di delimitazione.</span><span class="sxs-lookup"><span data-stu-id="d92e8-119">The following illustration shows the relationship between a non-rectangular object's region and its bounding rectangle.</span></span>  
  
 <span data-ttu-id="d92e8-120">![Diagramma dell'area di hit testing valida](./media/wcpsdk-mmgraphics-visuals-hittest-1.png "wcpsdk_mmgraphics_visuals_hittest_1")</span><span class="sxs-lookup"><span data-stu-id="d92e8-120">![Diagram of valid hit test region](./media/wcpsdk-mmgraphics-visuals-hittest-1.png "wcpsdk_mmgraphics_visuals_hittest_1")</span></span>  
<span data-ttu-id="d92e8-121">Diagramma dell'area di hit testing valida</span><span class="sxs-lookup"><span data-stu-id="d92e8-121">Diagram of valid hit test region</span></span>  
  
<a name="hit_testing_and_z-order"></a>   
## <a name="hit-testing-and-z-order"></a><span data-ttu-id="d92e8-122">Hit Testing e ordine Z</span><span class="sxs-lookup"><span data-stu-id="d92e8-122">Hit Testing and Z-Order</span></span>  
 <span data-ttu-id="d92e8-123">Il livello visivo di [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] supporta l'hit testing su tutti gli oggetti in un punto o in una geometria, non solo sull'oggetto di primo livello.</span><span class="sxs-lookup"><span data-stu-id="d92e8-123">The [!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)] visual layer supports hit testing against all objects under a point or geometry, not just the top-most object.</span></span> <span data-ttu-id="d92e8-124">I risultati vengono restituiti nell'ordine Z.</span><span class="sxs-lookup"><span data-stu-id="d92e8-124">Results are returned in z-order.</span></span> <span data-ttu-id="d92e8-125">Tuttavia, l'oggetto visivo passato come parametro al metodo <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> determina la parte della struttura ad albero visuale che verrà sottoferita a hit test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-125">However, the visual object that you pass as the parameter to the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method determines which portion of the visual tree that will be hit test.</span></span> <span data-ttu-id="d92e8-126">È possibile sottoporre a hit testing l'intera struttura ad albero visuale o parte di essa.</span><span class="sxs-lookup"><span data-stu-id="d92e8-126">You can hit test against the entire visual tree, or any portion of it.</span></span>  
  
 <span data-ttu-id="d92e8-127">Nella figura seguente, l'oggetto cerchio è sovrapposto sia al quadrato che al triangolo.</span><span class="sxs-lookup"><span data-stu-id="d92e8-127">In the following illustration, the circle object is on top of both the square and triangle objects.</span></span> <span data-ttu-id="d92e8-128">Se si è interessati solo all'hit test dell'oggetto visivo il cui valore z-order è in primo piano, è possibile impostare l'enumerazione di hit test visivi per restituire <xref:System.Windows.Media.HitTestResultBehavior.Stop> dal <xref:System.Windows.Media.HitTestResultCallback> per arrestare l'attraversamento dell'hit test dopo il primo elemento.</span><span class="sxs-lookup"><span data-stu-id="d92e8-128">If you are only interested in hit testing the visual object whose z-order value is top-most, you can set the visual hit test enumeration to return <xref:System.Windows.Media.HitTestResultBehavior.Stop> from the <xref:System.Windows.Media.HitTestResultCallback> to stop the hit test traversal after the first item.</span></span>  
  
 <span data-ttu-id="d92e8-129">![Diagramma dell'ordine Z di una struttura ad albero visuale](./media/wcpsdk-mmgraphics-visuals-hittest-2.png "wcpsdk_mmgraphics_visuals_hittest_2")</span><span class="sxs-lookup"><span data-stu-id="d92e8-129">![Diagram of the z&#45;order of a visual tree](./media/wcpsdk-mmgraphics-visuals-hittest-2.png "wcpsdk_mmgraphics_visuals_hittest_2")</span></span>  
<span data-ttu-id="d92e8-130">Diagramma dell'ordine Z di una struttura ad albero visuale</span><span class="sxs-lookup"><span data-stu-id="d92e8-130">Diagram of the z-order of a visual tree</span></span>  
  
 <span data-ttu-id="d92e8-131">Se si desidera enumerare tutti gli oggetti visivi in un punto o in una geometria specifici, restituire <xref:System.Windows.Media.HitTestResultBehavior.Continue> dalla <xref:System.Windows.Media.HitTestResultCallback>.</span><span class="sxs-lookup"><span data-stu-id="d92e8-131">If you want to enumerate all visual objects under a specific point or geometry, return <xref:System.Windows.Media.HitTestResultBehavior.Continue> from the <xref:System.Windows.Media.HitTestResultCallback>.</span></span> <span data-ttu-id="d92e8-132">Ciò significa che è possibile eseguire l'hit test per gli oggetti visivi che sono al di sotto di altri oggetti, anche se sono completamente nascosti.</span><span class="sxs-lookup"><span data-stu-id="d92e8-132">This means you can hit test for visual objects that are beneath other objects, even if they are wholly obscured.</span></span> <span data-ttu-id="d92e8-133">Per altre informazioni, vedere il codice di esempio nella sezione "Utilizzo del callback dei risultati di un hit test".</span><span class="sxs-lookup"><span data-stu-id="d92e8-133">See the sample code in the section "Using a Hit Test Results Callback" for more information.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d92e8-134">Anche un oggetto visivo trasparente può essere sottoposto a hit test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-134">A visual object that is transparent can also be hit test.</span></span>  
  
<a name="using_default_hit_testing"></a>   
## <a name="using-default-hit-testing"></a><span data-ttu-id="d92e8-135">Uso dell'hit testing predefinito</span><span class="sxs-lookup"><span data-stu-id="d92e8-135">Using Default Hit Testing</span></span>  
 <span data-ttu-id="d92e8-136">È possibile stabilire se un punto si trova all'interno della geometria di un oggetto visivo, usando il metodo <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> per specificare un oggetto visivo e un valore di coordinata del punto su cui eseguire il test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-136">You can identify whether a point is within the geometry of a visual object, by using the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method to specify a visual object and a point coordinate value to test against.</span></span> <span data-ttu-id="d92e8-137">Il parametro dell'oggetto visivo identifica il punto di avvio nella struttura ad albero visuale della ricerca dell'hit test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-137">The visual object parameter identifies the starting point in the visual tree for the hit test search.</span></span> <span data-ttu-id="d92e8-138">Se viene trovato un oggetto visivo nella struttura ad albero visuale la cui geometria contiene la coordinata, viene impostata sulla proprietà <xref:System.Windows.Media.HitTestResult.VisualHit%2A> di un oggetto <xref:System.Windows.Media.HitTestResult>.</span><span class="sxs-lookup"><span data-stu-id="d92e8-138">If a visual object is found in the visual tree whose geometry contains the coordinate, it is set to the <xref:System.Windows.Media.HitTestResult.VisualHit%2A> property of a <xref:System.Windows.Media.HitTestResult> object.</span></span> <span data-ttu-id="d92e8-139">Il <xref:System.Windows.Media.HitTestResult> viene quindi restituito dal metodo <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>.</span><span class="sxs-lookup"><span data-stu-id="d92e8-139">The <xref:System.Windows.Media.HitTestResult> is then returned from the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span> <span data-ttu-id="d92e8-140">Se il punto non è contenuto con la sottostruttura ad albero visuale di cui si esegue l'hit testing, <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> restituisce `null`.</span><span class="sxs-lookup"><span data-stu-id="d92e8-140">If the point is not contained with the visual sub-tree you are hit testing, <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> returns `null`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d92e8-141">L'hit testing predefinito restituisce sempre l'oggetto di livello superiore nell'ordine Z.</span><span class="sxs-lookup"><span data-stu-id="d92e8-141">Default hit testing always returns the top-most object in the z-order.</span></span> <span data-ttu-id="d92e8-142">Per identificare tutti gli oggetti visivi, compresi quelli che potrebbero essere parzialmente o completamente nascosti, usare un callback dei risultati dell'hit test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-142">In order to identify all visual objects, even those that may be partly or wholly obscured, use a hit test result callback.</span></span>  
  
 <span data-ttu-id="d92e8-143">Il valore della coordinata che viene passato come parametro punto per il metodo di <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> deve essere relativo allo spazio delle coordinate dell'oggetto visivo su cui si esegue l'hit testing.</span><span class="sxs-lookup"><span data-stu-id="d92e8-143">The coordinate value you pass as the point parameter for the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method has to be relative to the coordinate space of the visual object you are hit testing against.</span></span> <span data-ttu-id="d92e8-144">Ad esempio, se sono presenti oggetti visivi annidati nelle coordinate (100, 100) nello spazio delle coordinate dell'elemento padre, l'hit testing su un oggetto visivo figlio con coordinate (0, 0) è equivalente all'hit testing con coordinate (100, 100) nello spazio delle coordinate dell'elemento padre.</span><span class="sxs-lookup"><span data-stu-id="d92e8-144">For example, if you have nested visual objects defined at (100, 100) in the parent's coordinate space, then hit testing a child visual at (0, 0) is equivalent to hit testing at (100, 100) in the parent's coordinate space.</span></span>  
  
 <span data-ttu-id="d92e8-145">Nel codice seguente viene illustrato come configurare i gestori di eventi del mouse per un oggetto <xref:System.Windows.UIElement> usato per acquisire gli eventi usati per l'hit testing.</span><span class="sxs-lookup"><span data-stu-id="d92e8-145">The following code shows how to set up mouse event handlers for a <xref:System.Windows.UIElement> object that is used to capture events used for hit testing.</span></span>  
  
 [!code-csharp[HitTestingOverview#100](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#100)]
 [!code-vb[HitTestingOverview#100](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#100)]  
  
### <a name="how-the-visual-tree-affects-hit-testing"></a><span data-ttu-id="d92e8-146">Effetti della struttura ad albero visuale sull'hit testing</span><span class="sxs-lookup"><span data-stu-id="d92e8-146">How the Visual Tree Affects Hit Testing</span></span>  
 <span data-ttu-id="d92e8-147">Il punto iniziale nella struttura ad albero visuale determina quali oggetti vengono restituiti durante l'enumerazione di hit test degli oggetti.</span><span class="sxs-lookup"><span data-stu-id="d92e8-147">The starting point in the visual tree determines which objects are returned during the hit test enumeration of objects.</span></span> <span data-ttu-id="d92e8-148">Se si dispone di più oggetti da sottoporre a hit test, l'oggetto visivo usato come punto di inizio nella struttura ad albero visuale deve essere il predecessore comune di tutti gli oggetti interessati.</span><span class="sxs-lookup"><span data-stu-id="d92e8-148">If you have multiple objects you want to hit test, the visual object used as the starting point in the visual tree must be the common ancestor of all objects of interest.</span></span> <span data-ttu-id="d92e8-149">Se si desidera ad esempio sottoporre a hit test sia l'elemento pulsante che l'elemento visivo di disegno nel diagramma seguente, è necessario impostare il punto di inizio nella struttura ad albero visuale sul predecessore comune a entrambi.</span><span class="sxs-lookup"><span data-stu-id="d92e8-149">For example, if you were interested in hit testing both the button element and drawing visual in the following diagram, you would have to set the starting point in the visual tree to the common ancestor of both.</span></span> <span data-ttu-id="d92e8-150">In questo caso, l'elemento canvas è il predecessore comune di sia dell'elemento pulsante che dell'elemento visivo di disegno.</span><span class="sxs-lookup"><span data-stu-id="d92e8-150">In this case, the canvas element is the common ancestor of both the button element and the drawing visual.</span></span>  
  
 <span data-ttu-id="d92e8-151">![Diagramma della gerarchia di una struttura ad albero visuale](./media/wcpsdk-mmgraphics-visuals-overview-01.gif "wcpsdk_mmgraphics_visuals_overview_01")</span><span class="sxs-lookup"><span data-stu-id="d92e8-151">![Diagram of a visual tree hierarchy](./media/wcpsdk-mmgraphics-visuals-overview-01.gif "wcpsdk_mmgraphics_visuals_overview_01")</span></span>  
<span data-ttu-id="d92e8-152">Diagramma della gerarchia di una struttura ad albero visuale</span><span class="sxs-lookup"><span data-stu-id="d92e8-152">Diagram of a visual tree hierarchy</span></span>  
  
> [!NOTE]
> <span data-ttu-id="d92e8-153">Il <xref:System.Windows.UIElement.IsHitTestVisible%2A> proprietà Ottiene o imposta un valore che dichiara se un oggetto derivato da <xref:System.Windows.UIElement>può essere restituito come risultato dell'hit test da una parte del contenuto sottoposto a rendering.</span><span class="sxs-lookup"><span data-stu-id="d92e8-153">The <xref:System.Windows.UIElement.IsHitTestVisible%2A> property gets or sets a value that declares whether a <xref:System.Windows.UIElement>-derived object can possibly be returned as a hit test result from some portion of its rendered content.</span></span> <span data-ttu-id="d92e8-154">In questo modo è possibile modificare selettivamente la struttura ad albero visuale per determinare quali oggetti visivi sono coinvolti in un hit test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-154">This allows you to selectively alter the visual tree to determine which visual objects are involved in a hit test.</span></span>  
  
<a name="using_a_hit_test_result_callback"></a>   
## <a name="using-a-hit-test-result-callback"></a><span data-ttu-id="d92e8-155">Uso del callback dei risultati di un hit test</span><span class="sxs-lookup"><span data-stu-id="d92e8-155">Using a Hit Test Result Callback</span></span>  
 <span data-ttu-id="d92e8-156">È possibile enumerare tutti gli oggetti visivi in una struttura ad albero visuale la cui geometria contiene un valore di coordinate specificato.</span><span class="sxs-lookup"><span data-stu-id="d92e8-156">You can enumerate all visual objects in a visual tree whose geometry contains a specified coordinate value.</span></span> <span data-ttu-id="d92e8-157">Ciò consente di identificare tutti gli oggetti visivi, inclusi quelli che potrebbero essere parzialmente o completamente nascosti da altri oggetti visivi.</span><span class="sxs-lookup"><span data-stu-id="d92e8-157">This allows you to identify all visual objects, even those that may be partly or wholly obscured by other visual objects.</span></span> <span data-ttu-id="d92e8-158">Per enumerare gli oggetti visivi in una struttura ad albero visuale, usare il metodo <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> con una funzione di callback dell'hit test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-158">To enumerate visual objects in a visual tree use the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method with a hit test callback function.</span></span> <span data-ttu-id="d92e8-159">La funzione di callback dell'hit test viene chiamata dal sistema quando il valore delle coordinate specificato è contenuto in un oggetto visivo.</span><span class="sxs-lookup"><span data-stu-id="d92e8-159">The hit test callback function is called by the system when the coordinate value you specify is contained in a visual object.</span></span>  
  
 <span data-ttu-id="d92e8-160">Durante l'enumerazione dei risultati dell'hit test, evitare di eseguire operazioni che modifichino la struttura ad albero visuale.</span><span class="sxs-lookup"><span data-stu-id="d92e8-160">During the hit test results enumeration, you should not perform any operation that modifies the visual tree.</span></span> <span data-ttu-id="d92e8-161">L'aggiunta o la rimozione di un oggetto dalla struttura ad albero visuale mentre viene attraversata può produrre un comportamento imprevedibile.</span><span class="sxs-lookup"><span data-stu-id="d92e8-161">Adding or removing an object from the visual tree while it is being traversed can result in unpredictable behavior.</span></span> <span data-ttu-id="d92e8-162">È possibile modificare in modo sicuro la struttura ad albero visuale dopo il ritorno del metodo <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>.</span><span class="sxs-lookup"><span data-stu-id="d92e8-162">You can safely modify the visual tree after the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method returns.</span></span> <span data-ttu-id="d92e8-163">È possibile fornire una struttura di dati, ad esempio una <xref:System.Collections.ArrayList>, per archiviare i valori durante l'enumerazione dei risultati dell'hit test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-163">You may want to provide a data structure, such as an <xref:System.Collections.ArrayList>, to store values during the hit test results enumeration.</span></span>  
  
 [!code-csharp[HitTestingOverview#101](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#101)]
 [!code-vb[HitTestingOverview#101](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#101)]  
  
 <span data-ttu-id="d92e8-164">Il metodo di callback dell'hit test definisce le azioni eseguite quando viene identificato un hit test su un determinato oggetto visivo nella struttura ad albero visuale.</span><span class="sxs-lookup"><span data-stu-id="d92e8-164">The hit test callback method defines the actions you perform when a hit test is identified on a particular visual object in the visual tree.</span></span> <span data-ttu-id="d92e8-165">Dopo aver eseguito le azioni, viene restituito un valore <xref:System.Windows.Media.HitTestResultBehavior> che determina se continuare l'enumerazione di altri oggetti visivi.</span><span class="sxs-lookup"><span data-stu-id="d92e8-165">After you perform the actions, you return a <xref:System.Windows.Media.HitTestResultBehavior> value that determines whether to continue the enumeration of any other visual objects or not.</span></span>  
  
 [!code-csharp[HitTestingOverview#102](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#102)]
 [!code-vb[HitTestingOverview#102](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#102)]  
  
> [!NOTE]
> <span data-ttu-id="d92e8-166">L'ordine di enumerazione di oggetti visivi di hit testing è l'ordine Z.</span><span class="sxs-lookup"><span data-stu-id="d92e8-166">The order of enumeration of hit visual objects is by z-order.</span></span> <span data-ttu-id="d92e8-167">L'oggetto visivo di livello superiore nell'ordine Z viene enumerato per primo.</span><span class="sxs-lookup"><span data-stu-id="d92e8-167">The visual object at the top-most z-order level is the first object enumerated.</span></span> <span data-ttu-id="d92e8-168">Gli altri oggetti visivi vengono enumerati a livelli decrescenti nell'ordine Z.</span><span class="sxs-lookup"><span data-stu-id="d92e8-168">Any other visual objects enumerated are at decreasing z-order level.</span></span> <span data-ttu-id="d92e8-169">Questo ordine di enumerazione corrisponde all'ordine di rendering degli oggetti visivi.</span><span class="sxs-lookup"><span data-stu-id="d92e8-169">This order of enumeration corresponds to the rendering order of the visuals.</span></span>  
  
 <span data-ttu-id="d92e8-170">È possibile arrestare l'enumerazione degli oggetti visivi in qualsiasi momento nella funzione di callback dell'hit test restituendo <xref:System.Windows.Media.HitTestResultBehavior.Stop>.</span><span class="sxs-lookup"><span data-stu-id="d92e8-170">You can stop the enumeration of visual objects at any time in the hit test callback function by returning <xref:System.Windows.Media.HitTestResultBehavior.Stop>.</span></span>  
  
 [!code-csharp[HitTestingOverview#103](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#103)]
 [!code-vb[HitTestingOverview#103](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#103)]  
  
<a name="using_a_hit_test_filter_callback"></a>   
## <a name="using-a-hit-test-filter-callback"></a><span data-ttu-id="d92e8-171">Uso del callback di un filtro dell'hit test</span><span class="sxs-lookup"><span data-stu-id="d92e8-171">Using a Hit Test Filter Callback</span></span>  
 <span data-ttu-id="d92e8-172">È possibile usare un filtro dell'hit test facoltativo per limitare gli oggetti inviati ai risultati dell'hit test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-172">You can use an optional hit test filter to restrict the objects that are passed on to the hit test results.</span></span> <span data-ttu-id="d92e8-173">Ciò consente di ignorare parti della struttura ad albero visuale che non si desidera elaborare nei risultati dell'hit test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-173">This allows you to ignore parts of the visual tree that you are not interested in processing in your hit test results.</span></span> <span data-ttu-id="d92e8-174">Per implementare un filtro di hit test, è necessario definire una funzione di callback del filtro dell'hit test e passarla come valore di parametro quando si chiama il metodo <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>.</span><span class="sxs-lookup"><span data-stu-id="d92e8-174">To implement a hit test filter, you define a hit test filter callback function and pass it as a parameter value when you call the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span>  
  
 [!code-csharp[HitTestingOverview#104](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#104)]
 [!code-vb[HitTestingOverview#104](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#104)]  
  
 <span data-ttu-id="d92e8-175">Se non si desidera fornire la funzione di callback del filtro dell'hit test facoltativo, passare un valore `null` come parametro per il metodo <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>.</span><span class="sxs-lookup"><span data-stu-id="d92e8-175">If you do not want to supply the optional hit test filter callback function, pass a `null` value as its parameter for the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method.</span></span>  
  
 [!code-csharp[HitTestingOverview#105](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#105)]
 [!code-vb[HitTestingOverview#105](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#105)]  
  
 <span data-ttu-id="d92e8-176">![Eliminazione di una struttura ad albero visuale con un filtro hit test](./media/filteredvisualtree-01.png "FilteredVisualTree_01")</span><span class="sxs-lookup"><span data-stu-id="d92e8-176">![Pruning a visual tree using a hit test filter](./media/filteredvisualtree-01.png "FilteredVisualTree_01")</span></span>  
<span data-ttu-id="d92e8-177">Eliminazione di una struttura ad albero visuale</span><span class="sxs-lookup"><span data-stu-id="d92e8-177">Pruning a visual tree</span></span>  
  
 <span data-ttu-id="d92e8-178">La funzione di callback del filtro dell'hit test consente di enumerare tutti gli oggetti visivi il cui contenuto di rendering include le coordinate specificate.</span><span class="sxs-lookup"><span data-stu-id="d92e8-178">The hit test filter callback function allows you to enumerate through all the visuals whose rendered content contains the coordinates you specify.</span></span> <span data-ttu-id="d92e8-179">È possibile tuttavia decidere di ignorare determinate parti della struttura ad albero visuale che non si desidera elaborare nella funzione di callback dei risultati dell'hit test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-179">However, you may want to ignore certain branches of the visual tree that you are not interested in processing in your hit test results callback function.</span></span> <span data-ttu-id="d92e8-180">Il valore restituito dalla funzione di callback del filtro dell'hit test determina il tipo di azione che deve essere eseguita dall'enumerazione degli oggetti visivi.</span><span class="sxs-lookup"><span data-stu-id="d92e8-180">The return value of the hit test filter callback function determines what type of action the enumeration of the visual objects should take.</span></span> <span data-ttu-id="d92e8-181">Se, ad esempio, si restituisce il valore <xref:System.Windows.Media.HitTestFilterBehavior.ContinueSkipSelfAndChildren>, è possibile rimuovere l'oggetto visivo corrente e i relativi elementi figlio dall'enumerazione dei risultati dell'hit test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-181">For example, if you return the value, <xref:System.Windows.Media.HitTestFilterBehavior.ContinueSkipSelfAndChildren>, you can remove the current visual object and its children from the hit test results enumeration.</span></span> <span data-ttu-id="d92e8-182">Ciò significa che la funzione di callback dei risultati di hit test non visualizzerà questi oggetti nell'enumerazione.</span><span class="sxs-lookup"><span data-stu-id="d92e8-182">This means that the hit test results callback function will not see these objects in its enumeration.</span></span> <span data-ttu-id="d92e8-183">L'eliminazione di oggetti dalla struttura ad albero visuale consente di ridurre la quantità di elaborazione durante la fase di enumerazione dei risultati dell'hit test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-183">Pruning the visual tree of objects decreases the amount of processing during the hit test results enumeration pass.</span></span> <span data-ttu-id="d92e8-184">Nell'esempio di codice seguente il filtro ignora le etichette e i relativi discendenti e sottopone a hit test tutti gli altri elementi.</span><span class="sxs-lookup"><span data-stu-id="d92e8-184">In the following code example, the filter skips labels and their descendants and hit tests everything else.</span></span>  
  
 [!code-csharp[HitTestingOverview#106](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#106)]
 [!code-vb[HitTestingOverview#106](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#106)]  
  
> [!NOTE]
> <span data-ttu-id="d92e8-185">Verrà talvolta chiamato il callback del filtro dell'hit test nei casi in cui non viene chiamato il callback di risultati dell'hit test.</span><span class="sxs-lookup"><span data-stu-id="d92e8-185">The hit test filter callback will sometimes be called in cases where the hit test results callback is not called.</span></span>  
  
<a name="overriding_default_hit_testing"></a>   
## <a name="overriding-default-hit-testing"></a><span data-ttu-id="d92e8-186">Override dell'hit testing predefinito</span><span class="sxs-lookup"><span data-stu-id="d92e8-186">Overriding Default Hit Testing</span></span>  
 <span data-ttu-id="d92e8-187">È possibile eseguire l'override del supporto per l'hit testing predefinito di un oggetto visivo eseguendo l'override del metodo <xref:System.Windows.Media.Visual.HitTestCore%2A>.</span><span class="sxs-lookup"><span data-stu-id="d92e8-187">You can override a visual object’s default hit testing support by overriding the <xref:System.Windows.Media.Visual.HitTestCore%2A> method.</span></span> <span data-ttu-id="d92e8-188">Ciò significa che quando si richiama il metodo <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>, viene chiamata l'implementazione di <xref:System.Windows.Media.Visual.HitTestCore%2A> sottoposta a override.</span><span class="sxs-lookup"><span data-stu-id="d92e8-188">This means that when you invoke the <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A> method, your overridden implementation of <xref:System.Windows.Media.Visual.HitTestCore%2A> is called.</span></span> <span data-ttu-id="d92e8-189">Il metodo sottoposto a override viene chiamato quando un hit test viene eseguito all'interno del rettangolo delimitatore dell'oggetto visivo, anche se le coordinate non rientrano nel contenuto sottoposto a rendering dell'oggetto visivo.</span><span class="sxs-lookup"><span data-stu-id="d92e8-189">Your overridden method is called when a hit test falls within the bounding rectangle of the visual object, even if the coordinate falls outside the rendered content of the visual object.</span></span>  
  
 [!code-csharp[HitTestingOverview#107](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#107)]
 [!code-vb[HitTestingOverview#107](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#107)]  
  
 <span data-ttu-id="d92e8-190">È possibile che si desideri eseguire un hit test sia sul rettangolo di delimitazione, sia sul contenuto di rendering di un oggetto visivo.</span><span class="sxs-lookup"><span data-stu-id="d92e8-190">There may be times when you want to hit test against both the bounding rectangle and the rendered content of a visual object.</span></span> <span data-ttu-id="d92e8-191">Utilizzando il `PointHitTestParameters` valore del parametro nel metodo <xref:System.Windows.Media.Visual.HitTestCore%2A> sottoposto a override come parametro per il metodo di base <xref:System.Windows.Media.Visual.HitTestCore%2A>, è possibile eseguire azioni in base a un hit del rettangolo delimitatore di un oggetto visivo, quindi eseguire un secondo hit test sul contenuto sottoposto a rendering dell'oggetto visivo.</span><span class="sxs-lookup"><span data-stu-id="d92e8-191">By using the `PointHitTestParameters` parameter value in your overridden <xref:System.Windows.Media.Visual.HitTestCore%2A> method as the parameter to the base method <xref:System.Windows.Media.Visual.HitTestCore%2A>, you can perform actions based on a hit of the bounding rectangle of a visual object, and then perform a second hit test against the rendered content of the visual object.</span></span>  
  
 [!code-csharp[HitTestingOverview#108](~/samples/snippets/csharp/VS_Snippets_Wpf/HitTestingOverview/CSharp/Window1.xaml.cs#108)]
 [!code-vb[HitTestingOverview#108](~/samples/snippets/visualbasic/VS_Snippets_Wpf/HitTestingOverview/visualbasic/window1.xaml.vb#108)]  
  
## <a name="see-also"></a><span data-ttu-id="d92e8-192">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="d92e8-192">See also</span></span>

- <xref:System.Windows.Media.VisualTreeHelper.HitTest%2A>
- <xref:System.Windows.Media.HitTestResult>
- <xref:System.Windows.Media.HitTestResultCallback>
- <xref:System.Windows.Media.HitTestFilterCallback>
- <xref:System.Windows.UIElement.IsHitTestVisible%2A>
- [<span data-ttu-id="d92e8-193">Hit test con l'esempio DrawingVisuals</span><span class="sxs-lookup"><span data-stu-id="d92e8-193">Hit Test Using DrawingVisuals Sample</span></span>](https://github.com/Microsoft/WPF-Samples/tree/master/Visual%20Layer/DrawingVisual)
- [<span data-ttu-id="d92e8-194">Esempio di hit test con interoperatività Win32</span><span class="sxs-lookup"><span data-stu-id="d92e8-194">Hit Test with Win32 Interoperation Sample</span></span>](https://github.com/microsoft/WPF-Samples/tree/master/Visual%20Layer/VisualsHitTesting)
- [<span data-ttu-id="d92e8-195">Eseguire un hit test della geometria in un oggetto Visual</span><span class="sxs-lookup"><span data-stu-id="d92e8-195">Hit Test Geometry in a Visual</span></span>](how-to-hit-test-geometry-in-a-visual.md)
- [<span data-ttu-id="d92e8-196">Eseguire un hit test utilizzando un contenitore di host Win32</span><span class="sxs-lookup"><span data-stu-id="d92e8-196">Hit Test Using a Win32 Host Container</span></span>](how-to-hit-test-using-a-win32-host-container.md)
