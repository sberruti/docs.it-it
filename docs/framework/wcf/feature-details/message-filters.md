---
title: Filtri messaggi
ms.date: 03/30/2017
helpviewer_keywords:
- routing [WCF], message filters
ms.assetid: cb33ba49-8b1f-4099-8acb-240404a46d9a
ms.openlocfilehash: a953dea9224d75907c593d87f06a0b0888f0af2d
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/12/2020
ms.locfileid: "79184667"
---
# <a name="message-filters"></a><span data-ttu-id="02af8-102">Filtri messaggi</span><span class="sxs-lookup"><span data-stu-id="02af8-102">Message Filters</span></span>
<span data-ttu-id="02af8-103">Per implementare il routing basato sul contenuto, il servizio di routing usa implementazioni di <xref:System.ServiceModel.Dispatcher.MessageFilter> che controllano sezioni specifiche di un messaggio, ad esempio l'indirizzo, il nome dell'endpoint o un'istruzione XPath.</span><span class="sxs-lookup"><span data-stu-id="02af8-103">To implement content-based routing, the Routing Service uses <xref:System.ServiceModel.Dispatcher.MessageFilter> implementations that inspect specific sections of a message, such as the address, endpoint name, or a specific XPath statement.</span></span> <span data-ttu-id="02af8-104">Se nessuno dei filtri messaggi disponibili in [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] soddisfa le esigenze specifiche, è possibile creare un filtro personalizzato con un'implementazione della classe <xref:System.ServiceModel.Dispatcher.MessageFilter> di base.</span><span class="sxs-lookup"><span data-stu-id="02af8-104">If none of the message filters provided with [!INCLUDE[netfx_current_short](../../../../includes/netfx-current-short-md.md)] meet your needs, you can create a custom filter by creating a new implementation of the base <xref:System.ServiceModel.Dispatcher.MessageFilter> class.</span></span>  
  
 <span data-ttu-id="02af8-105">Quando si configura il servizio di routing, è necessario definire gli elementi filtro (oggetti)<xref:System.ServiceModel.Routing.Configuration.FilterElement> che descrivono il tipo di **MessageFilter** e tutti i dati di supporto necessari per creare il filtro, ad esempio valori stringa specifici da cercare all'interno del messaggio.</span><span class="sxs-lookup"><span data-stu-id="02af8-105">When configuring the Routing Service, you must define filter elements (<xref:System.ServiceModel.Routing.Configuration.FilterElement> objects) that describe the type of **MessageFilter** and any supporting data required to create the filter, such as specific string values to search for within the message.</span></span> <span data-ttu-id="02af8-106">Si noti che la creazione di elementi di filtro consente solo di definire i singoli filtri messaggi. Per usare i filtri in modo da valutare e indirizzare i messaggio, è inoltre necessario definire una tabella di filtri (<xref:System.ServiceModel.Routing.Configuration.FilterTableEntryCollection>).</span><span class="sxs-lookup"><span data-stu-id="02af8-106">Note that creating the filter elements only defines the individual message filters; to use the filters to evaluate and route messages you must also define a filter table (<xref:System.ServiceModel.Routing.Configuration.FilterTableEntryCollection>).</span></span>  
  
 <span data-ttu-id="02af8-107">Ogni voce nella tabella dei filtri fa riferimento a un elemento di filtro e specifica l'endpoint client a cui indirizzare un messaggio se corrispondente ai criteri del filtro stesso.</span><span class="sxs-lookup"><span data-stu-id="02af8-107">Each entry in the filter table references a filter element and specifies the client endpoint that a message will be routed to if the message matches the filter.</span></span> <span data-ttu-id="02af8-108">Le voci della tabella dei filtri consentono inoltre di specificare una raccolta di endpoint di backup (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>) che rappresenta un elenco di endpoint a cui deve essere trasmesso il messaggio qualora si verifichi un errore di trasmissione durante l'invio all'endpoint primario.</span><span class="sxs-lookup"><span data-stu-id="02af8-108">The filter table entries also allow you to specify a collection of backup endpoints (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>), which defines a list of endpoints that the message will be transmitted to in the event of a transmission failure when sending to the primary endpoint.</span></span> <span data-ttu-id="02af8-109">Verrà infatti tentato di inviare il messaggio a tali endpoint nell'ordine in cui sono specificati finché l'operazione non ha esito positivo.</span><span class="sxs-lookup"><span data-stu-id="02af8-109">These endpoints will be tried in the order specified until one succeeds.</span></span>  
  
## <a name="message-filters"></a><span data-ttu-id="02af8-110">Filtri messaggi</span><span class="sxs-lookup"><span data-stu-id="02af8-110">Message Filters</span></span>  
 <span data-ttu-id="02af8-111">I filtri messaggi usati dal servizio di routing offrono funzionalità comuni di selezione dei messaggi, ad esempio la valutazione del nome dell'endpoint a cui viene inviato un messaggio, l'azione SOAP oppure l'indirizzo o il prefisso dell'indirizzo a cui è inviato il messaggio.</span><span class="sxs-lookup"><span data-stu-id="02af8-111">The message filters used by the Routing Service provide common message selection functionality, such as evaluating the name of the endpoint that a message was sent to, the SOAP action, or the address or address prefix that the message was sent to.</span></span> <span data-ttu-id="02af8-112">È inoltre possibile unire i filtri con una condizione `AND` affinché i messaggi vengano indirizzati a un endpoint solo se corrispondono a entrambi i filtri.</span><span class="sxs-lookup"><span data-stu-id="02af8-112">Filters can also be joined with an `AND` condition, so that messages will only be routed to an endpoint if the message matches both filters.</span></span> <span data-ttu-id="02af8-113">È inoltre possibile definire filtri personalizzati creando un'implementazione personalizzata di <xref:System.ServiceModel.Dispatcher.MessageFilter>.</span><span class="sxs-lookup"><span data-stu-id="02af8-113">You can also create custom filters by creating your own implementation of <xref:System.ServiceModel.Dispatcher.MessageFilter>.</span></span>  
  
 <span data-ttu-id="02af8-114">Nella tabella seguente vengono indicati l'elemento <xref:System.ServiceModel.Routing.Configuration.FilterType> usato dal servizio di routing, la classe che implementa il filtro messaggi specificato e i parametri <xref:System.ServiceModel.Routing.Configuration.FilterElement.FilterData%2A> necessari.</span><span class="sxs-lookup"><span data-stu-id="02af8-114">The following table lists the <xref:System.ServiceModel.Routing.Configuration.FilterType> used by the Routing Service, the class that implements the specific message filter, and the required <xref:System.ServiceModel.Routing.Configuration.FilterElement.FilterData%2A> parameters.</span></span>  
  
|<span data-ttu-id="02af8-115">Tipo di filtro</span><span class="sxs-lookup"><span data-stu-id="02af8-115">Filter  Type</span></span>|<span data-ttu-id="02af8-116">Descrizione</span><span class="sxs-lookup"><span data-stu-id="02af8-116">Description</span></span>|<span data-ttu-id="02af8-117">Significato dei dati del filtro</span><span class="sxs-lookup"><span data-stu-id="02af8-117">Filter Data Meaning</span></span>|<span data-ttu-id="02af8-118">Filtro di esempio</span><span class="sxs-lookup"><span data-stu-id="02af8-118">Example Filter</span></span>|  
|------------------|-----------------|-------------------------|--------------------|  
|<span data-ttu-id="02af8-119">Azione</span><span class="sxs-lookup"><span data-stu-id="02af8-119">Action</span></span>|<span data-ttu-id="02af8-120">Usa la classe <xref:System.ServiceModel.Dispatcher.ActionMessageFilter> per individuare i messaggi contenenti un'azione specifica.</span><span class="sxs-lookup"><span data-stu-id="02af8-120">Uses the <xref:System.ServiceModel.Dispatcher.ActionMessageFilter> class to match messages containing a specific action.</span></span>|<span data-ttu-id="02af8-121">L'azione in base a cui filtrare.</span><span class="sxs-lookup"><span data-stu-id="02af8-121">The action to filter upon.</span></span>|<span data-ttu-id="02af8-122">\<nome del filtro: "action1" filterType ""Action" filterData "http://namespace/contract/operation> /</span><span class="sxs-lookup"><span data-stu-id="02af8-122">\<filter name="action1" filterType="Action" filterData="http://namespace/contract/operation" /></span></span>|  
|<span data-ttu-id="02af8-123">EndpointAddress</span><span class="sxs-lookup"><span data-stu-id="02af8-123">EndpointAddress</span></span>|<span data-ttu-id="02af8-124">Utilizza <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter> la classe <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter.IncludeHostNameInComparison%2A>  ==  `true` , con per trovare una corrispondenza con i messaggi contenenti un indirizzo specifico.</span><span class="sxs-lookup"><span data-stu-id="02af8-124">Uses the <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter> class, with <xref:System.ServiceModel.Dispatcher.EndpointAddressMessageFilter.IncludeHostNameInComparison%2A> == `true` to match messages containing a specific address.</span></span>|<span data-ttu-id="02af8-125">Indirizzo in base al quale applicare il filtro (nell'intestazione To).</span><span class="sxs-lookup"><span data-stu-id="02af8-125">The address to filter upon (in the To header).</span></span>|<span data-ttu-id="02af8-126">\<nome del filtro: "indirizzo1" filterType "IndirizzoEndpoint" filterData "http://host/vdir/s.svc/b/ ></span><span class="sxs-lookup"><span data-stu-id="02af8-126">\<filter name="address1" filterType="EndpointAddress" filterData="http://host/vdir/s.svc/b"  /></span></span>|  
|<span data-ttu-id="02af8-127">EndpointAddressPrefix</span><span class="sxs-lookup"><span data-stu-id="02af8-127">EndpointAddressPrefix</span></span>|<span data-ttu-id="02af8-128">Utilizza <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter> la classe <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter.IncludeHostNameInComparison%2A>  ==  `true` , con per trovare una corrispondenza con i messaggi contenenti un prefisso di indirizzo specifico.</span><span class="sxs-lookup"><span data-stu-id="02af8-128">Uses the <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter> class, with <xref:System.ServiceModel.Dispatcher.PrefixEndpointAddressMessageFilter.IncludeHostNameInComparison%2A> == `true` to match messages containing a specific address prefix.</span></span>|<span data-ttu-id="02af8-129">Indirizzo in base al quale applicare il filtro usando la corrispondenza del prefisso più lunga.</span><span class="sxs-lookup"><span data-stu-id="02af8-129">The address to filter upon using longest prefix matching.</span></span>|<span data-ttu-id="02af8-130">\<nome del filtro: "prefisso1" filterType "EndpointAddressPrefix" filterData "http://host// /></span><span class="sxs-lookup"><span data-stu-id="02af8-130">\<filter name="prefix1" filterType="EndpointAddressPrefix" filterData="http://host/" /></span></span>|  
|<span data-ttu-id="02af8-131">e</span><span class="sxs-lookup"><span data-stu-id="02af8-131">And</span></span>|<span data-ttu-id="02af8-132">Usa la classe <xref:System.ServiceModel.Dispatcher.StrictAndMessageFilter> che esegue sempre la valutazione di entrambe le condizioni prima della restituzione.</span><span class="sxs-lookup"><span data-stu-id="02af8-132">Uses the <xref:System.ServiceModel.Dispatcher.StrictAndMessageFilter> class that always evaluates both conditions before returning.</span></span>|<span data-ttu-id="02af8-133">filterData non viene utilizzato; invece filter1 e filter2 hanno i nomi dei filtri messaggi corrispondenti (anche nella tabella), che devono essere **ed**insieme.</span><span class="sxs-lookup"><span data-stu-id="02af8-133">filterData is not used; instead filter1 and filter2 have the names of the corresponding message filters (also in the table), which should be **AND**ed together.</span></span>|<span data-ttu-id="02af8-134">\<nome filtro "and1" filterType "E" filtro1 "indirizzo1" filtro2 "azione1" /></span><span class="sxs-lookup"><span data-stu-id="02af8-134">\<filter name="and1" filterType="And" filter1="address1" filter2="action1" /></span></span>|  
|<span data-ttu-id="02af8-135">Personalizzato</span><span class="sxs-lookup"><span data-stu-id="02af8-135">Custom</span></span>|<span data-ttu-id="02af8-136">Tipo definito dall'utente che estende la classe <xref:System.ServiceModel.Dispatcher.MessageFilter> e dispone di un costruttore che accetta una stringa.</span><span class="sxs-lookup"><span data-stu-id="02af8-136">A user-defined type that extends the <xref:System.ServiceModel.Dispatcher.MessageFilter> class and has a constructor taking a string.</span></span>|<span data-ttu-id="02af8-137">L'attributo customType rappresenta il nome completo del tipo della classe da creare; filterData corrisponde alla stringa da passare al costruttore per la creazione del filtro.</span><span class="sxs-lookup"><span data-stu-id="02af8-137">The customType attribute is the fully qualified type name of the class to create; filterData is the string to pass to the constructor when creating the filter.</span></span>|<span data-ttu-id="02af8-138">\<nome del filtro: "custom1" filterType "Custom" customType "CustomAssembly.CustomMsgFilter, CustomAssembly" filterData "Dati personalizzati" /></span><span class="sxs-lookup"><span data-stu-id="02af8-138">\<filter name="custom1" filterType="Custom" customType="CustomAssembly.CustomMsgFilter, CustomAssembly" filterData="Custom Data" /></span></span>|  
|<span data-ttu-id="02af8-139">EndpointName</span><span class="sxs-lookup"><span data-stu-id="02af8-139">EndpointName</span></span>|<span data-ttu-id="02af8-140">Usa la classe <xref:System.ServiceModel.Dispatcher.EndpointNameMessageFilter> per individuar i messaggi in base al nome dell'endpoint del servizio su cui arrivano.</span><span class="sxs-lookup"><span data-stu-id="02af8-140">Uses the <xref:System.ServiceModel.Dispatcher.EndpointNameMessageFilter> class to match messages based on the name of the service endpoint they arrived on.</span></span>|<span data-ttu-id="02af8-141">Il nome dell'endpoint del servizio, ad esempio: "serviceEndpoint1".</span><span class="sxs-lookup"><span data-stu-id="02af8-141">The name of the service endpoint, for example: "serviceEndpoint1".</span></span>  <span data-ttu-id="02af8-142">Deve essere uno degli endpoint esposti sul servizio di routing.</span><span class="sxs-lookup"><span data-stu-id="02af8-142">This should be one of the endpoints exposed on the Routing Service.</span></span>|<span data-ttu-id="02af8-143">\<nome del filtro: "stock1" filterType " "Endpoint" filterData "SvcEndpoint" /></span><span class="sxs-lookup"><span data-stu-id="02af8-143">\<filter name="stock1" filterType="Endpoint" filterData="SvcEndpoint" /></span></span>|  
|<span data-ttu-id="02af8-144">MatchAll</span><span class="sxs-lookup"><span data-stu-id="02af8-144">MatchAll</span></span>|<span data-ttu-id="02af8-145">Usa la classe <xref:System.ServiceModel.Dispatcher.MatchAllMessageFilter>.</span><span class="sxs-lookup"><span data-stu-id="02af8-145">Uses the <xref:System.ServiceModel.Dispatcher.MatchAllMessageFilter> class.</span></span> <span data-ttu-id="02af8-146">Questo filtro corrisponde a tutti i messaggi in arrivo.</span><span class="sxs-lookup"><span data-stu-id="02af8-146">This filter matches all arriving messages.</span></span>|<span data-ttu-id="02af8-147">filterData non è usato.</span><span class="sxs-lookup"><span data-stu-id="02af8-147">filterData is not used.</span></span> <span data-ttu-id="02af8-148">Questo filtro corrisponderà sempre a tutti i messaggi.</span><span class="sxs-lookup"><span data-stu-id="02af8-148">This filter will always match all messages.</span></span>|<span data-ttu-id="02af8-149">\<nome del filtro: "matchAll1" filterType "MatchAll" /></span><span class="sxs-lookup"><span data-stu-id="02af8-149">\<filter name="matchAll1" filterType="MatchAll" /></span></span>|  
|<span data-ttu-id="02af8-150">XPath</span><span class="sxs-lookup"><span data-stu-id="02af8-150">XPath</span></span>|<span data-ttu-id="02af8-151">Usa la classe <xref:System.ServiceModel.Dispatcher.XPathMessageFilter> per individuare la corrispondenza con query XPath specifiche all'interno del messaggio.</span><span class="sxs-lookup"><span data-stu-id="02af8-151">Uses the <xref:System.ServiceModel.Dispatcher.XPathMessageFilter> class to match specific XPath queries within the message.</span></span>|<span data-ttu-id="02af8-152">Query XPath da usare per verificare la corrispondenza di messaggi.</span><span class="sxs-lookup"><span data-stu-id="02af8-152">The XPath query to use when matching messages.</span></span>|<span data-ttu-id="02af8-153">\<nome del filtro: "XPath1" filterType "XPath" filterData "//ns:element" /></span><span class="sxs-lookup"><span data-stu-id="02af8-153">\<filter name="XPath1" filterType="XPath" filterData="//ns:element" /></span></span>|  
  
 <span data-ttu-id="02af8-154">Nell'esempio seguente vengono definite voci di filtro che usano i filtri messaggi XPath, EndpointName e PrefixEndpointAddress.</span><span class="sxs-lookup"><span data-stu-id="02af8-154">The following example defines filter entries that use the XPath, EndpointName, and PrefixEndpointAddress message filters.</span></span> <span data-ttu-id="02af8-155">In questo esempio viene illustrato l'uso di un filtro personalizzato per le voci RoundRobinFilter1 e RoundRobinFilter2.</span><span class="sxs-lookup"><span data-stu-id="02af8-155">This example also demonstrates using a custom filter for the RoundRobinFilter1 and RoundRobinFilter2 entries.</span></span>  
  
```xml  
<filters>  
     <filter name="XPathFilter" filterType="XPath"
             filterData="/s12:Envelope/s12:Header/custom:RoundingCalculator = 1"/>  
     <filter name="EndpointNameFilter" filterType="EndpointName"
             filterData="calculatorEndpoint"/>  
     <filter name="PrefixAddressFilter" filterType="PrefixEndpointAddress"
             filterData="http://localhost/routingservice/router/rounding/"/>  
     <filter name="RoundRobinFilter1" filterType="Custom"
             customType="RoutingServiceFilters.RoundRobinMessageFilter,
             RoutingService" filterData="group1"/>  
     <filter name="RoundRobinFilter2" filterType="Custom"
             customType="RoutingServiceFilters.RoundRobinMessageFilter,
             RoutingService" filterData="group1"/>  
</filters>  
```  
  
> [!NOTE]
> <span data-ttu-id="02af8-156">La definizione di un filtro non è sufficiente a determinare la valutazione dei messaggi in base al filtro stesso.</span><span class="sxs-lookup"><span data-stu-id="02af8-156">Simply defining a filter does not cause messages to be evaluated against the filter.</span></span> <span data-ttu-id="02af8-157">È necessario aggiungere il filtro a una tabella di filtri associato all'endpoint servizio esposto dal servizio di routing.</span><span class="sxs-lookup"><span data-stu-id="02af8-157">The filter must be added to a filter table, which is then associated with the service endpoint exposed by the Routing Service.</span></span>  
  
### <a name="namespace-table"></a><span data-ttu-id="02af8-158">Tabella degli spazi dei nomi</span><span class="sxs-lookup"><span data-stu-id="02af8-158">Namespace Table</span></span>  
 <span data-ttu-id="02af8-159">Se si usa un filtro XPath, i relativi dati contenenti la query XPath possono diventare di dimensioni notevoli a causa dell'uso degli spazi dei nomi.</span><span class="sxs-lookup"><span data-stu-id="02af8-159">When using an XPath filter, the filter data that contains the XPath query can become extremely large due to the use of namespaces.</span></span> <span data-ttu-id="02af8-160">Per risolvere questo problema, il servizio di routing consente di definire prefissi degli spazi dei nomi personalizzati mediante un'apposita tabella.</span><span class="sxs-lookup"><span data-stu-id="02af8-160">To alleviate this problem the Routing Service provides the ability to define your own namespace prefixes by using the namespace table.</span></span>  
  
 <span data-ttu-id="02af8-161">La tabella degli spazi dei nomi è una raccolta di oggetti <xref:System.ServiceModel.Routing.Configuration.NamespaceElement> che definisce i prefissi degli spazi dei nomi comuni usabili in una query XPath.</span><span class="sxs-lookup"><span data-stu-id="02af8-161">The namespace table is a collection of <xref:System.ServiceModel.Routing.Configuration.NamespaceElement> objects that defines the namespace prefixes for common namespaces that can be used in an XPath.</span></span> <span data-ttu-id="02af8-162">Di seguito sono indicati gli spazi dei nomi predefiniti e i relativi prefissi contenuti nella tabella.</span><span class="sxs-lookup"><span data-stu-id="02af8-162">The following are the default namespaces and namespace prefixes that are contained in the namespace table.</span></span>  
  
|<span data-ttu-id="02af8-163">Prefisso</span><span class="sxs-lookup"><span data-stu-id="02af8-163">Prefix</span></span>|<span data-ttu-id="02af8-164">Spazio dei nomi</span><span class="sxs-lookup"><span data-stu-id="02af8-164">Namespace</span></span>|  
|------------|---------------|  
|<span data-ttu-id="02af8-165">s11</span><span class="sxs-lookup"><span data-stu-id="02af8-165">s11</span></span>|`http://schemas.xmlsoap.org/soap/envelope`|  
|<span data-ttu-id="02af8-166">s12</span><span class="sxs-lookup"><span data-stu-id="02af8-166">s12</span></span>|`http://www.w3.org/2003/05/soap-envelope`|  
|<span data-ttu-id="02af8-167">wsaAugust2004</span><span class="sxs-lookup"><span data-stu-id="02af8-167">wsaAugust2004</span></span>|`http://schemas.xmlsoap.org/ws/2004/08/addressing`|  
|<span data-ttu-id="02af8-168">wsa10</span><span class="sxs-lookup"><span data-stu-id="02af8-168">wsa10</span></span>|`http://www.w3.org/2005/08/addressing`|  
|<span data-ttu-id="02af8-169">sm</span><span class="sxs-lookup"><span data-stu-id="02af8-169">sm</span></span>|`http://schemas.microsoft.com/serviceModel/2004/05/xpathfunctions`|  
|<span data-ttu-id="02af8-170">tempuri</span><span class="sxs-lookup"><span data-stu-id="02af8-170">tempuri</span></span>|`http://tempuri.org`|  
|<span data-ttu-id="02af8-171">ser</span><span class="sxs-lookup"><span data-stu-id="02af8-171">ser</span></span>|`http://schemas.microsoft.com/2003/10/Serialization`|  
  
 <span data-ttu-id="02af8-172">Se si prevede di usare uno specifico spazio dei nomi nelle query XPath, è possibile aggiungerlo alla tabella degli spazi dei nomi insieme a un prefisso univoco e usare quindi nella query XPath tale prefisso invece dello spazio dei nomi completo.</span><span class="sxs-lookup"><span data-stu-id="02af8-172">When you know that you will be using a specific namespace in your XPath queries, you can add it to the namespace table along with a unique namespace prefix and use the prefix in any XPath query instead of the full namespace.</span></span> <span data-ttu-id="02af8-173">Nell'esempio seguente viene definito un prefisso `"http://my.custom.namespace"`"custom" per lo spazio dei nomi , che viene quindi utilizzato nella query XPath contenuta in filterData.</span><span class="sxs-lookup"><span data-stu-id="02af8-173">The following example defines a prefix of "custom" for the namespace `"http://my.custom.namespace"`, which is then used in the XPath query contained in filterData.</span></span>  
  
```xml  
<namespaceTable>  
     <add prefix="custom" namespace="http://my.custom.namespace/"/>  
</namespaceTable>  
<filters>  
     <filter name="XPathFilter" filterType="XPath" filterData="/s12:Envelope/s12:Header/custom:RoundingCalculator = 1"/>  
</filters>  
```  
  
## <a name="filter-tables"></a><span data-ttu-id="02af8-174">Tabelle dei filtri</span><span class="sxs-lookup"><span data-stu-id="02af8-174">Filter Tables</span></span>  
 <span data-ttu-id="02af8-175">Sebbene ogni elemento di filtro definisca un confronto logico da applicare a un messaggio, la tabella dei filtri consente l'associazione tra l'elemento di filtro e l'endpoint client di destinazione.</span><span class="sxs-lookup"><span data-stu-id="02af8-175">While each filter element defines a logical comparison that can be applied to a message, the filter table provides the association between the filter element and the destination client endpoint.</span></span> <span data-ttu-id="02af8-176">Una tabella dei filtri è una raccolta denominata di oggetti <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement> che definiscono un'associazione tra un filtro, un endpoint di destinazione principale e un elenco di endpoint del backup alternativi.</span><span class="sxs-lookup"><span data-stu-id="02af8-176">A filter table is a named collection of <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement> objects that define the association between a filter, a primary destination endpoint, and a list of alternative backup endpoints.</span></span> <span data-ttu-id="02af8-177">Le voci della tabella di filtro consentono inoltre di specificare facoltativamente una priorità per ogni condizione di filtro.</span><span class="sxs-lookup"><span data-stu-id="02af8-177">The filter table entries also allow you to specify an optional priority for each filter condition.</span></span> <span data-ttu-id="02af8-178">Nell'esempio seguente vengono definiti due filtri, quindi viene definita una tabella che associa ogni filtro a un endpoint di destinazione.</span><span class="sxs-lookup"><span data-stu-id="02af8-178">The following example defines two filters and then defines a filter table that associates each filter with a destination endpoint.</span></span>  
  
```xml  
<routing>  
     <filters>  
       <filter name="AddAction" filterType="Action" filterData="Add" />  
       <filter name="SubtractAction" filterType="Action" filterData="Subtract" />  
     </filters>  
     <filterTables>  
       <table name="routingTable1">  
         <filters>  
           <add filterName="AddAction" endpointName="Addition" />  
           <add filterName="SubtractAction" endpointName="Subtraction" />  
         </filters>  
       </table>  
     </filterTables>
</routing>  
```  
  
### <a name="filter-evaluation-priority"></a><span data-ttu-id="02af8-179">Priorità di valutazione dei filtri</span><span class="sxs-lookup"><span data-stu-id="02af8-179">Filter Evaluation Priority</span></span>  
 <span data-ttu-id="02af8-180">Per impostazione predefinita, tutte le voci della tabella dei filtri vengono valutate contemporaneamente e il messaggio esaminato viene indirizzato agli endpoint associati con le voci di filtri che corrispondono.</span><span class="sxs-lookup"><span data-stu-id="02af8-180">By default, all entries in the filter table are evaluated simultaneously, and the message being evaluated is routed to the endpoint(s) associated with each matching filter entry.</span></span> <span data-ttu-id="02af8-181">Se più filtri restituiscono `true` ed il messaggio è unidirezionale o duplex, il messaggio è inviato in modalità multicast agli endpoint associati a tutti i filtri corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="02af8-181">If multiple filters evaluate to `true`, and the message is one-way or duplex, the message is multicast to the endpoints for all matching filters.</span></span> <span data-ttu-id="02af8-182">I messaggi di tipo request/reply non possono essere multicast perché al client può essere restituita una sola risposta.</span><span class="sxs-lookup"><span data-stu-id="02af8-182">Request-reply messages cannot be multicast because only one reply can be returned to the client.</span></span>  
  
 <span data-ttu-id="02af8-183">È possibile implementare logica di routing più complessa specificando livelli di priorità per ogni filtro. Il servizio di routing valuterà quindi prima tutti i filtri con priorità massima.</span><span class="sxs-lookup"><span data-stu-id="02af8-183">More complex routing logic can be implemented by specifying priority levels for each filter; the Routing Service evaluates all filters at the highest priority level first.</span></span> <span data-ttu-id="02af8-184">Se un messaggio corrisponde a un filtro di questo livello, i filtri con priorità inferiore non vengono elaborati.</span><span class="sxs-lookup"><span data-stu-id="02af8-184">If a message matches a filter of this level, no filters of a lower priority are processed.</span></span> <span data-ttu-id="02af8-185">Ad esempio, un messaggio unidirezionale in ingresso viene prima valutato rispetto a tutti i filtri con priorità 2.</span><span class="sxs-lookup"><span data-stu-id="02af8-185">For example, an incoming one-way message is first evaluated against all filters with a priority of 2.</span></span> <span data-ttu-id="02af8-186">Il messaggio non corrisponde ad alcuno filtro di tale livello, pertanto il messaggio viene confrontato con i filtri di priorità 1.</span><span class="sxs-lookup"><span data-stu-id="02af8-186">The message does not match any filter at this priority level, so next the message is compared against filters with a priority of 1.</span></span> <span data-ttu-id="02af8-187">Due filtri di priorità 1 corrispondono al messaggio, pertanto si tratta di un messaggio unidirezionale inviato a entrambi gli endpoint di destinazione.</span><span class="sxs-lookup"><span data-stu-id="02af8-187">Two priority 1 filters match the message, and because it is a one-way message it is routed to both destination endpoints.</span></span>  <span data-ttu-id="02af8-188">Poiché è stata individuata una corrispondenza con i filtri di priorità 1, non vengono visualizzati quelli con priorità 0.</span><span class="sxs-lookup"><span data-stu-id="02af8-188">Because a match was found among the priority 1 filters, no filters of priority 0 are evaluated.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="02af8-189">Se non viene specificata alcuna priorità, viene usata quella predefinita, ovvero 0.</span><span class="sxs-lookup"><span data-stu-id="02af8-189">If no priority is specified, the default priority of 0 is used.</span></span>  
  
 <span data-ttu-id="02af8-190">Nell'esempio seguente viene definita una tabella di filtri con le priorità 2, 1 e 0 assegnate ai filtri a cui viene fatto riferimento.</span><span class="sxs-lookup"><span data-stu-id="02af8-190">The following example defines a filter table that specifies priorities of 2, 1, and 0 for the filters referenced in the table.</span></span>  
  
```xml  
<filterTables>  
     <filterTable name="filterTable1">  
          <add filterName="XPathFilter" endpointName="roundingCalcEndpoint"
               priority="2"/>  
          <add filterName="EndpointNameFilter" endpointName="regularCalcEndpoint"
               priority="1"/>  
          <add filterName="PrefixAddressFilter" endpointName="roundingCalcEndpoint"
               priority="1"/>  
          <add filterName="MatchAllMessageFilter" endpointName="defaultCalcEndpoint"
               priority="0"/>  
     </filterTable>  
</filterTables>  
```  
  
 <span data-ttu-id="02af8-191">Nell'esempio precedente, se un messaggio corrisponde a XPathFilter, sarà indirizzato a roundingCalcEndpoint e non verrà valutato nessun altro filtro in quanto di priorità inferiore.</span><span class="sxs-lookup"><span data-stu-id="02af8-191">In the preceding example, if a message matches the XPathFilter, it will be routed to the roundingCalcEndpoint and no further filters in the table will be evaluated because all other filters are of a lower priority.</span></span> <span data-ttu-id="02af8-192">Se tuttavia il messaggio non corrisponde a XPathFilter esso sarà valutato rispetto a tutti i filtri del livello di priorità immediatamente successivo, ovvero EndpointNameFilter e PrefixAddressFilter.</span><span class="sxs-lookup"><span data-stu-id="02af8-192">However, if the message does not match the XPathFilter it will then be evaluated against all filters of the next lower priority, EndpointNameFilter and PrefixAddressFilter.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="02af8-193">Se possibile, usare filtri esclusivi anziché priorità perché la valutazione in base alla priorità può influire negativamente sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="02af8-193">When possible, use exclusive filters instead of specifying a priority because priority evaluation can result in performance degradation.</span></span>  
  
### <a name="backup-lists"></a><span data-ttu-id="02af8-194">Elenchi di backup</span><span class="sxs-lookup"><span data-stu-id="02af8-194">Backup Lists</span></span>  
 <span data-ttu-id="02af8-195">Per ogni filtro nella tabella dei filtri può essere specificato un elenco di backup, ovvero una raccolta denominata di endpoint (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>).</span><span class="sxs-lookup"><span data-stu-id="02af8-195">Each filter in the filter table can optionally specify a backup list, which is a named collection of endpoints (<xref:System.ServiceModel.Routing.Configuration.BackupEndpointCollection>).</span></span> <span data-ttu-id="02af8-196">Tale raccolta contiene un elenco ordinato di endpoint a cui trasmettere il messaggio qualora si verifichi un'eccezione <xref:System.ServiceModel.CommunicationException> durante l'invio all'endpoint primario specificato in <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement.EndpointName%2A>.</span><span class="sxs-lookup"><span data-stu-id="02af8-196">This collection contains an ordered list of endpoints that the message will be transmitted to in the event of a <xref:System.ServiceModel.CommunicationException> when sending to the primary endpoint specified in <xref:System.ServiceModel.Routing.Configuration.FilterTableEntryElement.EndpointName%2A>.</span></span> <span data-ttu-id="02af8-197">Nell'esempio seguente viene definito un elenco di backup denominato "backupServiceEndpoints" che contiene due endpoint.</span><span class="sxs-lookup"><span data-stu-id="02af8-197">The following example defines a backup list named "backupServiceEndpoints" that contains two endpoints.</span></span>  
  
```xml  
<filterTables>  
     <filterTable name="filterTable1">  
          <add filterName="MatchAllFilter1" endpointName="Destination" backupList="backupEndpointList"/>  
     </filterTable>  
</filterTables>  
<backupLists>  
     <backupList name="backupEndpointList">  
          <add endpointName="backupServiceQueue" />  
          <add endpointName="alternateServiceQueue" />  
     </backupList>  
</backupLists>  
```  
  
 <span data-ttu-id="02af8-198">Nell'esempio precedente, se un invio all'endpoint primario "Destinazione" ha esito negativo, il servizio di routing tenterà di inviare a ogni endpoint nella sequenza in cui sono elencati, inviando prima a backupServiceQueue e successivamente inviando a alternateServiceQueue se il invio a backupServiceQueue ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="02af8-198">In the preceding example, if a send to the primary endpoint "Destination" fails, the Routing Service will try sending to each endpoint in the sequence they are listed, first sending to backupServiceQueue and subsequently sending to alternateServiceQueue if the send to backupServiceQueue fails.</span></span> <span data-ttu-id="02af8-199">Se l'operazione non riesce con nessuno degli endpoint di backup, viene restituito un errore.</span><span class="sxs-lookup"><span data-stu-id="02af8-199">If all backup endpoints fail, a fault is returned.</span></span>
