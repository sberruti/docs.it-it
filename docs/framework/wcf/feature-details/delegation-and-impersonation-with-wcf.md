---
title: Delega e rappresentazione con WCF
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- impersonation [WCF]
- delegation [WCF]
ms.assetid: 110e60f7-5b03-4b69-b667-31721b8e3152
ms.openlocfilehash: 3fd90cde16afdfe32b9bd0533ba04e35928d2706
ms.sourcegitcommit: cdf5084648bf5e77970cbfeaa23f1cab3e6e234e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/01/2020
ms.locfileid: "76920206"
---
# <a name="delegation-and-impersonation-with-wcf"></a><span data-ttu-id="3246c-102">Delega e rappresentazione con WCF</span><span class="sxs-lookup"><span data-stu-id="3246c-102">Delegation and Impersonation with WCF</span></span>
<span data-ttu-id="3246c-103">La*rappresentazione* è una tecnica comune utilizzata dai servizi per limitare l'accesso dei client alle risorse del dominio del servizio.</span><span class="sxs-lookup"><span data-stu-id="3246c-103">*Impersonation* is a common technique that services use to restrict client access to a service domain's resources.</span></span> <span data-ttu-id="3246c-104">Tali risorse possono essere risorse del computer, ad esempio file locali (rappresentazione), o risorse in un'altro computer, ad esempio una condivisione file (delega).</span><span class="sxs-lookup"><span data-stu-id="3246c-104">Service domain resources can either be machine resources, such as local files (impersonation), or a resource on another machine, such as a file share (delegation).</span></span> <span data-ttu-id="3246c-105">Per un'applicazione di esempio, vedere [Impersonating the Client](../../../../docs/framework/wcf/samples/impersonating-the-client.md).</span><span class="sxs-lookup"><span data-stu-id="3246c-105">For a sample application, see [Impersonating the Client](../../../../docs/framework/wcf/samples/impersonating-the-client.md).</span></span> <span data-ttu-id="3246c-106">Per un esempio di come usare la rappresentazione, vedere [How to: Impersonate a Client on a Service](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md).</span><span class="sxs-lookup"><span data-stu-id="3246c-106">For an example of how to use impersonation, see [How to: Impersonate a Client on a Service](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md).</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="3246c-107">Tenere presente che, in caso di rappresentazione di un client in un servizio, il servizio viene eseguito con le credenziali client, che potrebbero prevedere privilegi più elevati rispetto al processo server.</span><span class="sxs-lookup"><span data-stu-id="3246c-107">Be aware that when impersonating a client on a service, the service runs with the client's credentials, which may have higher privileges than the server process.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="3246c-108">Panoramica di</span><span class="sxs-lookup"><span data-stu-id="3246c-108">Overview</span></span>  
 <span data-ttu-id="3246c-109">In genere, i client chiamano un servizio per l’esecuzione di determinate operazioni da parte del servizio stesso per loro conto.</span><span class="sxs-lookup"><span data-stu-id="3246c-109">Typically, clients call a service to have the service perform some action on the client’s behalf.</span></span> <span data-ttu-id="3246c-110">La rappresentazione consente al servizio di eseguire azioni per conto del client.</span><span class="sxs-lookup"><span data-stu-id="3246c-110">Impersonation allows the service to act as the client while performing the action.</span></span> <span data-ttu-id="3246c-111">La delega consente a un servizio front end di inoltrare le richieste del client ad un servizio back end in modo tale che quest'ultimo possa anche rappresentare il client.</span><span class="sxs-lookup"><span data-stu-id="3246c-111">Delegation allows a front-end service to forward the client’s request to a back-end service in such a way that the back-end service can also impersonate the client.</span></span> <span data-ttu-id="3246c-112">La rappresentazione, in genere, viene utilizzata per controllare se un client è autorizzato ad eseguire una particolare azione, mentre la delega è un modo per propagare ad un servizio back end le funzionalità della rappresentazione insieme all'identità del client.</span><span class="sxs-lookup"><span data-stu-id="3246c-112">Impersonation is most commonly used as a way of checking whether a client is authorized to perform a particular action, while delegation is a way of flowing impersonation capabilities, along with the client’s identity, to a back-end service.</span></span> <span data-ttu-id="3246c-113">La delega è una funzionalità di dominio Windows che può essere utilizzata quando viene eseguita l'autenticazione basata su Kerberos.</span><span class="sxs-lookup"><span data-stu-id="3246c-113">Delegation is a Windows domain feature that can be used when Kerberos-based authentication is performed.</span></span> <span data-ttu-id="3246c-114">La delega si differenzia dal flusso dell'identità ed è un'operazione con privilegi maggiori in quanto trasferisce la possibilità di rappresentare il client senza il possesso della relativa password.</span><span class="sxs-lookup"><span data-stu-id="3246c-114">Delegation is distinct from identity flow and, because delegation transfers the ability to impersonate the client without possession of the client’s password, it is a much higher privileged operation than identity flow.</span></span>  
  
 <span data-ttu-id="3246c-115">Sia la rappresentazione che la delega richiedono che il client abbia una identità di Windows.</span><span class="sxs-lookup"><span data-stu-id="3246c-115">Both impersonation and delegation require that the client have a Windows identity.</span></span> <span data-ttu-id="3246c-116">Se un client non possiede un'identità di Windows, l'unica opzione disponibile è propagare l'identità del client al secondo servizio.</span><span class="sxs-lookup"><span data-stu-id="3246c-116">If a client does not possess a Windows identity, then the only option available is to flow the client’s identity to the second service.</span></span>  
  
## <a name="impersonation-basics"></a><span data-ttu-id="3246c-117">Nozioni fondamentali sulla rappresentazione</span><span class="sxs-lookup"><span data-stu-id="3246c-117">Impersonation Basics</span></span>  
 <span data-ttu-id="3246c-118">Windows Communication Foundation (WCF) supporta la rappresentazione per un'ampia gamma di credenziali client.</span><span class="sxs-lookup"><span data-stu-id="3246c-118">Windows Communication Foundation (WCF) supports impersonation for a variety of client credentials.</span></span> <span data-ttu-id="3246c-119">In questo argomento viene descritto il supporto del modello di servizio per la rappresentazione del chiamante durante l'implementazione di un metodo del servizio.</span><span class="sxs-lookup"><span data-stu-id="3246c-119">This topic describes service model support for impersonating the caller during the implementation of a service method.</span></span> <span data-ttu-id="3246c-120">Sono inoltre illustrati gli scenari di distribuzione comuni che coinvolgono la rappresentazione e la sicurezza SOAP e le opzioni WCF in questi scenari.</span><span class="sxs-lookup"><span data-stu-id="3246c-120">Also discussed are common deployment scenarios involving impersonation and SOAP security and WCF options in these scenarios.</span></span>  
  
 <span data-ttu-id="3246c-121">Questo argomento è incentrato sulla rappresentazione e la delega in WCF quando si utilizza la sicurezza SOAP.</span><span class="sxs-lookup"><span data-stu-id="3246c-121">This topic focuses on impersonation and delegation in WCF when using SOAP security.</span></span> <span data-ttu-id="3246c-122">È inoltre possibile utilizzare la rappresentazione e la delega con WCF quando si utilizza la sicurezza del trasporto, come descritto in [utilizzo della rappresentazione con la sicurezza del trasporto](../../../../docs/framework/wcf/feature-details/using-impersonation-with-transport-security.md).</span><span class="sxs-lookup"><span data-stu-id="3246c-122">You can also use impersonation and delegation with WCF when using transport security, as described in [Using Impersonation with Transport Security](../../../../docs/framework/wcf/feature-details/using-impersonation-with-transport-security.md).</span></span>  
  
## <a name="two-methods"></a><span data-ttu-id="3246c-123">Due metodi</span><span class="sxs-lookup"><span data-stu-id="3246c-123">Two Methods</span></span>  
 <span data-ttu-id="3246c-124">La sicurezza SOAP WCF prevede due metodi distinti per eseguire la rappresentazione.</span><span class="sxs-lookup"><span data-stu-id="3246c-124">WCF SOAP security has two distinct methods for performing impersonation.</span></span> <span data-ttu-id="3246c-125">Il metodo utilizzato dipende dall'associazione.</span><span class="sxs-lookup"><span data-stu-id="3246c-125">The method used depends on the binding.</span></span> <span data-ttu-id="3246c-126">Il primo consiste nella rappresentazione da un token di Windows ottenuto dall'autenticazione Security Support Provider Interface (SSPI) o Kerberos, che viene quindi memorizzato nella cache del servizio.</span><span class="sxs-lookup"><span data-stu-id="3246c-126">One is impersonation from a Windows token obtained from the Security Support Provider Interface (SSPI) or Kerberos authentication, which is then cached on the service.</span></span> <span data-ttu-id="3246c-127">Il secondo consiste nella rappresentazione da un token di Windows ottenuto dalle estensioni Kerberos, collettivamente denominate *Service-for-User* (S4U).</span><span class="sxs-lookup"><span data-stu-id="3246c-127">The second is impersonation from a Windows token obtained from the Kerberos extensions, collectively called *Service-for-User* (S4U).</span></span>  
  
### <a name="cached-token-impersonation"></a><span data-ttu-id="3246c-128">Rappresentazione con un token memorizzato nella cache</span><span class="sxs-lookup"><span data-stu-id="3246c-128">Cached Token Impersonation</span></span>  
 <span data-ttu-id="3246c-129">È possibile eseguire la rappresentazione con un token memorizzato nella cache con gli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="3246c-129">You can perform cached-token impersonation with the following:</span></span>  
  
- <span data-ttu-id="3246c-130"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>e <xref:System.ServiceModel.NetTcpBinding> con una credenziale client di Windows.</span><span class="sxs-lookup"><span data-stu-id="3246c-130"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, and <xref:System.ServiceModel.NetTcpBinding> with a Windows client credential.</span></span>  
  
- <span data-ttu-id="3246c-131"><xref:System.ServiceModel.BasicHttpBinding> con l'enumerazione <xref:System.ServiceModel.BasicHttpSecurityMode> impostata sulla credenziale <xref:System.ServiceModel.BasicHttpSecurityMode.TransportWithMessageCredential> o qualsiasi altra associazione standard in cui il client presenta una credenziale basata sul nome utente di cui il servizio può eseguire il mapping a un account di Windows valido.</span><span class="sxs-lookup"><span data-stu-id="3246c-131"><xref:System.ServiceModel.BasicHttpBinding> with a <xref:System.ServiceModel.BasicHttpSecurityMode> set to the <xref:System.ServiceModel.BasicHttpSecurityMode.TransportWithMessageCredential> credential, or any other standard binding where the client presents a user name credential that the service can map to a valid Windows account.</span></span>  
  
- <span data-ttu-id="3246c-132">Qualsiasi <xref:System.ServiceModel.Channels.CustomBinding> che utilizza una credenziale client di Windows con la proprietà `requireCancellation` impostata su `true`</span><span class="sxs-lookup"><span data-stu-id="3246c-132">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a Windows client credential with the `requireCancellation` set to `true`.</span></span> <span data-ttu-id="3246c-133">(La proprietà è disponibile nelle classi seguenti: <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters>, <xref:System.ServiceModel.Security.Tokens.SslSecurityTokenParameters>e <xref:System.ServiceModel.Security.Tokens.SspiSecurityTokenParameters>.) Se per l'associazione viene utilizzata una conversazione protetta, è necessario che anche la proprietà `requireCancellation` sia impostata su `true`.</span><span class="sxs-lookup"><span data-stu-id="3246c-133">(The property is available on the following classes: <xref:System.ServiceModel.Security.Tokens.SecureConversationSecurityTokenParameters>, <xref:System.ServiceModel.Security.Tokens.SslSecurityTokenParameters>, and <xref:System.ServiceModel.Security.Tokens.SspiSecurityTokenParameters>.) If a secure conversation is used on the binding, it must also have the `requireCancellation` property set to `true`.</span></span>  
  
- <span data-ttu-id="3246c-134">Qualsiasi <xref:System.ServiceModel.Channels.CustomBinding> in cui il client presenta una credenziale basata sul nome utente.</span><span class="sxs-lookup"><span data-stu-id="3246c-134">Any <xref:System.ServiceModel.Channels.CustomBinding> where the client presents a user name credential.</span></span> <span data-ttu-id="3246c-135">Se si utilizza una conversazione protetta sull'associazione, è necessario che abbia la proprietà `requireCancellation` impostata su `true`.</span><span class="sxs-lookup"><span data-stu-id="3246c-135">If secure conversation is used on the binding, it must also have the `requireCancellation` property set to `true`.</span></span>  
  
### <a name="s4u-based-impersonation"></a><span data-ttu-id="3246c-136">Rappresentazione basata su S4U.</span><span class="sxs-lookup"><span data-stu-id="3246c-136">S4U-Based Impersonation</span></span>  
 <span data-ttu-id="3246c-137">È possibile eseguire la rappresentazione basata su S4U con gli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="3246c-137">You can perform S4U-based impersonation with the following:</span></span>  
  
- <span data-ttu-id="3246c-138"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>e <xref:System.ServiceModel.NetTcpBinding> con una credenziale client basata su certificato di cui il servizio può eseguire il mapping a un account di Windows valido.</span><span class="sxs-lookup"><span data-stu-id="3246c-138"><xref:System.ServiceModel.WSHttpBinding>, <xref:System.ServiceModel.WSDualHttpBinding>, and <xref:System.ServiceModel.NetTcpBinding> with a certificate client credential that the service can map to a valid Windows account.</span></span>  
  
- <span data-ttu-id="3246c-139">Qualsiasi <xref:System.ServiceModel.Channels.CustomBinding> che utilizza una credenziale client di Windows con la proprietà `requireCancellation` impostata su `false`</span><span class="sxs-lookup"><span data-stu-id="3246c-139">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a Windows client credential with the `requireCancellation` property set to `false`.</span></span>  
  
- <span data-ttu-id="3246c-140">Qualsiasi <xref:System.ServiceModel.Channels.CustomBinding> che utilizza una credenziale client di Windows o basata sul nome utente e una conversazione protetta con la proprietà `requireCancellation` impostata su `false`.</span><span class="sxs-lookup"><span data-stu-id="3246c-140">Any <xref:System.ServiceModel.Channels.CustomBinding> that uses a user name or Windows client credential and secure conversation with the `requireCancellation` property set to `false`.</span></span>  
  
 <span data-ttu-id="3246c-141">La misura in cui il servizio può eseguire la rappresentazione del client dipende dai privilegi di cui dispone l'account del servizio quando tenta la rappresentazione, dal tipo di rappresentazione utilizzato ed eventualmente dall'ambito di rappresentazione consentito dal client.</span><span class="sxs-lookup"><span data-stu-id="3246c-141">The extent to which the service can impersonate the client depends on the privileges the service account holds when it attempts impersonation, the type of impersonation used, and possibly the extent of impersonation the client permits.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="3246c-142">Quando il client e il servizio sono in esecuzione nello stesso computer e il client è in esecuzione con un account del sistema (ad esempio `Local System` o `Network Service`), il client non può essere rappresentato quando viene stabilita una sessione protetta con token del contesto di sicurezza con stato.</span><span class="sxs-lookup"><span data-stu-id="3246c-142">When the client and service are running on the same computer and the client is running under a system account (for example, `Local System` or `Network Service`), the client cannot be impersonated when a secure session is established with stateful Security Context tokens.</span></span> <span data-ttu-id="3246c-143">Un'applicazione Windows Form o console viene in genere eseguita con l'account attualmente connesso e quindi l'account può essere rappresentato per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="3246c-143">A Windows Form or console application typically runs under the currently logged-in account, so that account can be impersonated by default.</span></span> <span data-ttu-id="3246c-144">Tuttavia, quando il client è una pagina ASP.NET e tale pagina è ospitata in IIS 6,0 o IIS 7,0, il client viene eseguito con l'account `Network Service` per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="3246c-144">However, when the client is an ASP.NET page and that page is hosted in IIS 6.0 or IIS 7.0, then the client does run under the `Network Service` account by default.</span></span> <span data-ttu-id="3246c-145">Tutte le associazioni fornite dal sistema che supportano le sessioni protette utilizzano un token del contesto di sicurezza (SCT) senza stato per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="3246c-145">All of the system-provided bindings that support secure sessions use a stateless security context token (SCT) by default.</span></span> <span data-ttu-id="3246c-146">Tuttavia, se il client è una pagina ASP.NET e vengono usate sessioni sicure con SCT con stato, non è possibile rappresentare il client.</span><span class="sxs-lookup"><span data-stu-id="3246c-146">However, if the client is an ASP.NET page, and secure sessions with stateful SCTs are used, the client cannot be impersonated.</span></span> <span data-ttu-id="3246c-147">Per altre informazioni sull'uso di SCT con stato in una sessione protetta, vedere [procedura: creare un token del contesto di sicurezza per una sessione protetta](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md).</span><span class="sxs-lookup"><span data-stu-id="3246c-147">For more information about using stateful SCTs in a secure session, see [How to: Create a Security Context Token for a Secure Session](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md).</span></span>  
  
## <a name="impersonation-in-a-service-method-declarative-model"></a><span data-ttu-id="3246c-148">Rappresentazione in un metodo del servizio: modello dichiarativo</span><span class="sxs-lookup"><span data-stu-id="3246c-148">Impersonation in a Service Method: Declarative Model</span></span>  
 <span data-ttu-id="3246c-149">La maggior parte degli scenari di rappresentazione implicano l'esecuzione del metodo del servizio nel contesto del chiamante.</span><span class="sxs-lookup"><span data-stu-id="3246c-149">Most impersonation scenarios involve executing the service method in the caller context.</span></span> <span data-ttu-id="3246c-150">WCF fornisce una funzionalità di rappresentazione che semplifica questa operazione consentendo all'utente di specificare il requisito di rappresentazione nell'attributo <xref:System.ServiceModel.OperationBehaviorAttribute>.</span><span class="sxs-lookup"><span data-stu-id="3246c-150">WCF provides an impersonation feature that makes this easy to do by allowing the user to specify the impersonation requirement in the <xref:System.ServiceModel.OperationBehaviorAttribute> attribute.</span></span> <span data-ttu-id="3246c-151">Nel codice seguente, ad esempio, l'infrastruttura WCF rappresenta il chiamante prima di eseguire il metodo `Hello`.</span><span class="sxs-lookup"><span data-stu-id="3246c-151">For example, in the following code, the WCF infrastructure impersonates the caller before executing the `Hello` method.</span></span> <span data-ttu-id="3246c-152">Qualsiasi tentativo di accedere a risorse native nel metodo `Hello` ha esito positivo solo se l'elenco di controllo di accesso (ACL) della risorsa consente al chiamante i privilegi di accesso.</span><span class="sxs-lookup"><span data-stu-id="3246c-152">Any attempt to access native resources inside the `Hello` method succeed only if the access control list (ACL) of the resource allows the caller access privileges.</span></span> <span data-ttu-id="3246c-153">Per attivare la rappresentazione, impostare la proprietà <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> su uno dei valori dell'enumerazione <xref:System.ServiceModel.ImpersonationOption> , ovvero <xref:System.ServiceModel.ImpersonationOption.Required?displayProperty=nameWithType> o <xref:System.ServiceModel.ImpersonationOption.Allowed?displayProperty=nameWithType>, come illustrato nell'esempio seguente.</span><span class="sxs-lookup"><span data-stu-id="3246c-153">To enable impersonation, set the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property to one of the <xref:System.ServiceModel.ImpersonationOption> enumeration values, either <xref:System.ServiceModel.ImpersonationOption.Required?displayProperty=nameWithType> or <xref:System.ServiceModel.ImpersonationOption.Allowed?displayProperty=nameWithType>, as shown in the following example.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="3246c-154">Quando un servizio dispone di credenziali più elevate del client remoto, vengono utilizzate le credenziali del servizio se la proprietà <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> è impostata su <xref:System.ServiceModel.ImpersonationOption.Allowed>.</span><span class="sxs-lookup"><span data-stu-id="3246c-154">When a service has higher credentials than the remote client, the credentials of the service are used if the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property is set to <xref:System.ServiceModel.ImpersonationOption.Allowed>.</span></span> <span data-ttu-id="3246c-155">In altri termini, se un utente con privilegi di basso livello fornisce le sue credenziali, un servizio con privilegi di livello più elevato esegue il metodo con le credenziali del servizio e può utilizzare risorse che l'utente con privilegi di basso livello non sarebbe altrimenti in grado di utilizzare.</span><span class="sxs-lookup"><span data-stu-id="3246c-155">That is, if a low-privileged user provides its credentials, a higher-privileged service executes the method with the credentials of the service, and can use resources that the low-privileged user would otherwise not be able to use.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#1)]
 [!code-vb[c_ImpersonationAndDelegation#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#1)]  
  
 <span data-ttu-id="3246c-156">L'infrastruttura WCF può rappresentare il chiamante solo se il chiamante viene autenticato con credenziali di cui è possibile eseguire il mapping a un account utente di Windows.</span><span class="sxs-lookup"><span data-stu-id="3246c-156">The WCF infrastructure can impersonate the caller only if the caller is authenticated with credentials that can be mapped to a Windows user account.</span></span> <span data-ttu-id="3246c-157">Se il servizio è configurato per l'autenticazione con una credenziale di cui non è possibile eseguire il mapping a un account di Windows, il metodo del servizio non viene eseguito.</span><span class="sxs-lookup"><span data-stu-id="3246c-157">If the service is configured to authenticate using a credential that cannot be mapped to a Windows account, the service method is not executed.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="3246c-158">In Windows XP, la rappresentazione ha esito negativo se viene creato un token SCT con stato, ottenendo un <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="3246c-158">On Windows XP, impersonation fails if a stateful SCT is created, resulting in an <xref:System.InvalidOperationException>.</span></span> <span data-ttu-id="3246c-159">Per altre informazioni, vedere [scenari non supportati](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="3246c-159">For more information, see [Unsupported Scenarios](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md).</span></span>  
  
## <a name="impersonation-in-a-service-method-imperative-model"></a><span data-ttu-id="3246c-160">Rappresentazione in un metodo del servizio: modello imperativo</span><span class="sxs-lookup"><span data-stu-id="3246c-160">Impersonation in a Service Method: Imperative Model</span></span>  
 <span data-ttu-id="3246c-161">Talvolta, per funzionare, non è necessario che un chiamante rappresenti l'intero metodo del servizio, ma solo una parte.</span><span class="sxs-lookup"><span data-stu-id="3246c-161">Sometimes a caller does not need to impersonate the entire service method to function, but for only a portion of it.</span></span> <span data-ttu-id="3246c-162">In questo caso, è possibile ottenere l'identità Windows del chiamante nel metodo del servizio ed eseguire la rappresentazione in modo imperativo.</span><span class="sxs-lookup"><span data-stu-id="3246c-162">In this case, obtain the Windows identity of the caller inside the service method and imperatively perform the impersonation.</span></span> <span data-ttu-id="3246c-163">A tale scopo, utilizzare la proprietà <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A> della classe <xref:System.ServiceModel.ServiceSecurityContext> per restituire un'istanza della classe <xref:System.Security.Principal.WindowsIdentity> e chiamare il metodo <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> prima di utilizzare l'istanza.</span><span class="sxs-lookup"><span data-stu-id="3246c-163">Do this by using the <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A> property of the <xref:System.ServiceModel.ServiceSecurityContext> to return an instance of the <xref:System.Security.Principal.WindowsIdentity> class and calling the <xref:System.Security.Principal.WindowsIdentity.Impersonate%2A> method before using the instance.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="3246c-164">Assicurarsi di utilizzare l'istruzione Visual Basic`Using` o l' C# istruzione `using` per ripristinare automaticamente l'azione di rappresentazione.</span><span class="sxs-lookup"><span data-stu-id="3246c-164">Be sure to use the Visual Basic`Using` statement or the C# `using` statement to automatically revert the impersonation action.</span></span> <span data-ttu-id="3246c-165">Se non si utilizza l'istruzione o se si utilizza un linguaggio di programmazione diverso da Visual Basic o C#, assicurarsi di ripristinare il livello di rappresentazione.</span><span class="sxs-lookup"><span data-stu-id="3246c-165">If you do not use the statement, or if you use a programming language other than Visual Basic or C#, be sure to revert the impersonation level.</span></span> <span data-ttu-id="3246c-166">In caso contrario, si stabilisce la base per attacchi Denial of service e di elevazione del privilegio.</span><span class="sxs-lookup"><span data-stu-id="3246c-166">Failure to do this can form the basis for denial of service and elevation of privilege attacks.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#2)]
 [!code-vb[c_ImpersonationAndDelegation#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#2)]  
  
## <a name="impersonation-for-all-service-methods"></a><span data-ttu-id="3246c-167">Rappresentazione per tutti i metodi del servizio</span><span class="sxs-lookup"><span data-stu-id="3246c-167">Impersonation for All Service Methods</span></span>  
 <span data-ttu-id="3246c-168">In alcuni casi, è necessario eseguire tutti i metodi di un servizio nel contesto del chiamante.</span><span class="sxs-lookup"><span data-stu-id="3246c-168">In some cases, you must perform all the methods of a service in the caller’s context.</span></span> <span data-ttu-id="3246c-169">Anziché attivare in modo esplicito questa funzionalità sulla base di ciascun metodo, utilizzare la classe <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>.</span><span class="sxs-lookup"><span data-stu-id="3246c-169">Instead of explicitly enabling this feature on a per-method basis, use the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>.</span></span> <span data-ttu-id="3246c-170">Impostare la proprietà <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A> su `true`, come illustrato nel codice seguente.</span><span class="sxs-lookup"><span data-stu-id="3246c-170">As shown in the following code, set the <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A> property to `true`.</span></span> <span data-ttu-id="3246c-171">La classe <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> viene recuperata dalle raccolte di comportamenti della classe <xref:System.ServiceModel.ServiceHost> .</span><span class="sxs-lookup"><span data-stu-id="3246c-171">The <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior> is retrieved from the collections of behaviors of the <xref:System.ServiceModel.ServiceHost> class.</span></span> <span data-ttu-id="3246c-172">Si noti inoltre che anche la proprietà `Impersonation` della classe <xref:System.ServiceModel.OperationBehaviorAttribute> applicata a ogni metodo deve essere impostata su <xref:System.ServiceModel.ImpersonationOption.Allowed> o <xref:System.ServiceModel.ImpersonationOption.Required>.</span><span class="sxs-lookup"><span data-stu-id="3246c-172">Also note that the `Impersonation` property of the <xref:System.ServiceModel.OperationBehaviorAttribute> applied to each method must also be set to either <xref:System.ServiceModel.ImpersonationOption.Allowed> or <xref:System.ServiceModel.ImpersonationOption.Required>.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#3)]
 [!code-vb[c_ImpersonationAndDelegation#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#3)]  
  
 <span data-ttu-id="3246c-173">Nella tabella seguente viene descritto il comportamento WCF per tutte le possibili combinazioni di `ImpersonationOption` e `ImpersonateCallerForAllServiceOperations`.</span><span class="sxs-lookup"><span data-stu-id="3246c-173">The following table describes WCF behavior for all possible combinations of `ImpersonationOption` and `ImpersonateCallerForAllServiceOperations`.</span></span>  
  
|`ImpersonationOption`|`ImpersonateCallerForAllServiceOperations`|<span data-ttu-id="3246c-174">Comportamento di</span><span class="sxs-lookup"><span data-stu-id="3246c-174">Behavior</span></span>|  
|---------------------------|------------------------------------------------|--------------|  
|<span data-ttu-id="3246c-175">Richiesto</span><span class="sxs-lookup"><span data-stu-id="3246c-175">Required</span></span>|<span data-ttu-id="3246c-176">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-176">n/a</span></span>|<span data-ttu-id="3246c-177">WCF rappresenta il chiamante</span><span class="sxs-lookup"><span data-stu-id="3246c-177">WCF impersonates the caller</span></span>|  
|<span data-ttu-id="3246c-178">Allowed</span><span class="sxs-lookup"><span data-stu-id="3246c-178">Allowed</span></span>|<span data-ttu-id="3246c-179">false</span><span class="sxs-lookup"><span data-stu-id="3246c-179">false</span></span>|<span data-ttu-id="3246c-180">WCF non rappresenta il chiamante</span><span class="sxs-lookup"><span data-stu-id="3246c-180">WCF does not impersonate the caller</span></span>|  
|<span data-ttu-id="3246c-181">Allowed</span><span class="sxs-lookup"><span data-stu-id="3246c-181">Allowed</span></span>|<span data-ttu-id="3246c-182">true</span><span class="sxs-lookup"><span data-stu-id="3246c-182">true</span></span>|<span data-ttu-id="3246c-183">WCF rappresenta il chiamante</span><span class="sxs-lookup"><span data-stu-id="3246c-183">WCF impersonates the caller</span></span>|  
|<span data-ttu-id="3246c-184">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="3246c-184">NotAllowed</span></span>|<span data-ttu-id="3246c-185">false</span><span class="sxs-lookup"><span data-stu-id="3246c-185">false</span></span>|<span data-ttu-id="3246c-186">WCF non rappresenta il chiamante</span><span class="sxs-lookup"><span data-stu-id="3246c-186">WCF does not impersonate the caller</span></span>|  
|<span data-ttu-id="3246c-187">NotAllowed</span><span class="sxs-lookup"><span data-stu-id="3246c-187">NotAllowed</span></span>|<span data-ttu-id="3246c-188">true</span><span class="sxs-lookup"><span data-stu-id="3246c-188">true</span></span>|<span data-ttu-id="3246c-189">Non consentita</span><span class="sxs-lookup"><span data-stu-id="3246c-189">Disallowed.</span></span> <span data-ttu-id="3246c-190">(verrà generata un'eccezione <xref:System.InvalidOperationException> ).</span><span class="sxs-lookup"><span data-stu-id="3246c-190">(An <xref:System.InvalidOperationException> is thrown.)</span></span>|  
  
## <a name="impersonation-level-obtained-from-windows-credentials-and-cached-token-impersonation"></a><span data-ttu-id="3246c-191">Livello di rappresentazione ottenuto dalla rappresentazione con credenziali di Windows e con un token memorizzato nella cache</span><span class="sxs-lookup"><span data-stu-id="3246c-191">Impersonation Level Obtained from Windows Credentials and Cached Token Impersonation</span></span>  
 <span data-ttu-id="3246c-192">In alcuni scenari il client dispone di un controllo parziale sul livello di rappresentazione eseguito dal servizio quando si utilizza una credenziale client di Windows.</span><span class="sxs-lookup"><span data-stu-id="3246c-192">In some scenarios the client has partial control over the level of impersonation the service performs when a Windows client credential is used.</span></span> <span data-ttu-id="3246c-193">Uno scenario si ha quando il client specifica un livello di rappresentazione anonimo,</span><span class="sxs-lookup"><span data-stu-id="3246c-193">One scenario occurs when the client specifies an Anonymous impersonation level.</span></span> <span data-ttu-id="3246c-194">l'altro quando si esegue la rappresentazione con un token memorizzato nella cache.</span><span class="sxs-lookup"><span data-stu-id="3246c-194">The other occurs when performing impersonation with a cached token.</span></span> <span data-ttu-id="3246c-195">A tale scopo, impostare la proprietà <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> della classe <xref:System.ServiceModel.Security.WindowsClientCredential> , a cui si accede come proprietà della classe generica <xref:System.ServiceModel.ChannelFactory%601> .</span><span class="sxs-lookup"><span data-stu-id="3246c-195">This is done by setting the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property of the <xref:System.ServiceModel.Security.WindowsClientCredential> class, which is accessed as a property of the generic <xref:System.ServiceModel.ChannelFactory%601> class.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="3246c-196">Quando si specifica un livello di rappresentazione anonimo, il client accede al servizio in modo anonimo.</span><span class="sxs-lookup"><span data-stu-id="3246c-196">Specifying an impersonation level of Anonymous causes the client to log on to the service anonymously.</span></span> <span data-ttu-id="3246c-197">Il servizio deve pertanto consentire gli accessi anonimi, indipendentemente dal fatto che venga eseguita o meno la rappresentazione.</span><span class="sxs-lookup"><span data-stu-id="3246c-197">The service must therefore allow anonymous logons, regardless of whether impersonation is performed.</span></span>  
  
 <span data-ttu-id="3246c-198">Il client può specificare il livello di rappresentazione come <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, <xref:System.Security.Principal.TokenImpersonationLevel.Identification>, <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>o <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="3246c-198">The client can specify the impersonation level as <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, <xref:System.Security.Principal.TokenImpersonationLevel.Identification>, <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, or <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span> <span data-ttu-id="3246c-199">Al livello specificato viene prodotto solo un token, come illustrato nel codice seguente.</span><span class="sxs-lookup"><span data-stu-id="3246c-199">Only a token at the specified level is produced, as shown in the following code.</span></span>  
  
 [!code-csharp[c_ImpersonationAndDelegation#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_impersonationanddelegation/cs/source.cs#4)]
 [!code-vb[c_ImpersonationAndDelegation#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_impersonationanddelegation/vb/source.vb#4)]  
  
 <span data-ttu-id="3246c-200">Nella tabella seguente viene indicato il livello di rappresentazione ottenuto dal servizio in caso di rappresentazione da un token memorizzato nella cache.</span><span class="sxs-lookup"><span data-stu-id="3246c-200">The following table specifies the impersonation level the service obtains when impersonating from a cached token.</span></span>  
  
|<span data-ttu-id="3246c-201">Valore di `AllowedImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="3246c-201">`AllowedImpersonationLevel` value</span></span>|<span data-ttu-id="3246c-202">Il servizio dispone di `SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="3246c-202">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="3246c-203">Servizio e client con funzionalità di delega</span><span class="sxs-lookup"><span data-stu-id="3246c-203">Service and client are capable of delegation</span></span>|<span data-ttu-id="3246c-204">`ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="3246c-204">Cached token `ImpersonationLevel`</span></span>|  
|---------------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="3246c-205">Anonymous</span><span class="sxs-lookup"><span data-stu-id="3246c-205">Anonymous</span></span>|<span data-ttu-id="3246c-206">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-206">Yes</span></span>|<span data-ttu-id="3246c-207">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-207">n/a</span></span>|<span data-ttu-id="3246c-208">rappresentazione</span><span class="sxs-lookup"><span data-stu-id="3246c-208">Impersonation</span></span>|  
|<span data-ttu-id="3246c-209">Anonymous</span><span class="sxs-lookup"><span data-stu-id="3246c-209">Anonymous</span></span>|<span data-ttu-id="3246c-210">No</span><span class="sxs-lookup"><span data-stu-id="3246c-210">No</span></span>|<span data-ttu-id="3246c-211">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-211">n/a</span></span>|<span data-ttu-id="3246c-212">Identification</span><span class="sxs-lookup"><span data-stu-id="3246c-212">Identification</span></span>|  
|<span data-ttu-id="3246c-213">Identification</span><span class="sxs-lookup"><span data-stu-id="3246c-213">Identification</span></span>|<span data-ttu-id="3246c-214">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-214">n/a</span></span>|<span data-ttu-id="3246c-215">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-215">n/a</span></span>|<span data-ttu-id="3246c-216">Identification</span><span class="sxs-lookup"><span data-stu-id="3246c-216">Identification</span></span>|  
|<span data-ttu-id="3246c-217">rappresentazione</span><span class="sxs-lookup"><span data-stu-id="3246c-217">Impersonation</span></span>|<span data-ttu-id="3246c-218">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-218">Yes</span></span>|<span data-ttu-id="3246c-219">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-219">n/a</span></span>|<span data-ttu-id="3246c-220">rappresentazione</span><span class="sxs-lookup"><span data-stu-id="3246c-220">Impersonation</span></span>|  
|<span data-ttu-id="3246c-221">rappresentazione</span><span class="sxs-lookup"><span data-stu-id="3246c-221">Impersonation</span></span>|<span data-ttu-id="3246c-222">No</span><span class="sxs-lookup"><span data-stu-id="3246c-222">No</span></span>|<span data-ttu-id="3246c-223">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-223">n/a</span></span>|<span data-ttu-id="3246c-224">Identification</span><span class="sxs-lookup"><span data-stu-id="3246c-224">Identification</span></span>|  
|<span data-ttu-id="3246c-225">Delegation</span><span class="sxs-lookup"><span data-stu-id="3246c-225">Delegation</span></span>|<span data-ttu-id="3246c-226">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-226">Yes</span></span>|<span data-ttu-id="3246c-227">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-227">Yes</span></span>|<span data-ttu-id="3246c-228">Delegation</span><span class="sxs-lookup"><span data-stu-id="3246c-228">Delegation</span></span>|  
|<span data-ttu-id="3246c-229">Delegation</span><span class="sxs-lookup"><span data-stu-id="3246c-229">Delegation</span></span>|<span data-ttu-id="3246c-230">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-230">Yes</span></span>|<span data-ttu-id="3246c-231">No</span><span class="sxs-lookup"><span data-stu-id="3246c-231">No</span></span>|<span data-ttu-id="3246c-232">rappresentazione</span><span class="sxs-lookup"><span data-stu-id="3246c-232">Impersonation</span></span>|  
|<span data-ttu-id="3246c-233">Delegation</span><span class="sxs-lookup"><span data-stu-id="3246c-233">Delegation</span></span>|<span data-ttu-id="3246c-234">No</span><span class="sxs-lookup"><span data-stu-id="3246c-234">No</span></span>|<span data-ttu-id="3246c-235">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-235">n/a</span></span>|<span data-ttu-id="3246c-236">Identification</span><span class="sxs-lookup"><span data-stu-id="3246c-236">Identification</span></span>|  
  
## <a name="impersonation-level-obtained-from-user-name-credentials-and-cached-token-impersonation"></a><span data-ttu-id="3246c-237">Livello di rappresentazione ottenuto dalla rappresentazione con credenziali basate sul nome utente e con un token memorizzato nella cache</span><span class="sxs-lookup"><span data-stu-id="3246c-237">Impersonation Level Obtained from User Name Credentials and Cached Token Impersonation</span></span>  
 <span data-ttu-id="3246c-238">Passando al servizio il nome utente e la password, un client consente a WCF di accedere come tale utente, che equivale a impostare la proprietà `AllowedImpersonationLevel` su <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="3246c-238">By passing the service its user name and password, a client enables WCF to log on as that user, which is equivalent to setting the `AllowedImpersonationLevel` property to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span> <span data-ttu-id="3246c-239">Il `AllowedImpersonationLevel` è disponibile nelle classi <xref:System.ServiceModel.Security.WindowsClientCredential> e <xref:System.ServiceModel.Security.HttpDigestClientCredential>. Nella tabella seguente viene fornito il livello di rappresentazione ottenuto quando il servizio riceve le credenziali del nome utente.</span><span class="sxs-lookup"><span data-stu-id="3246c-239">(The `AllowedImpersonationLevel` is available on the <xref:System.ServiceModel.Security.WindowsClientCredential> and <xref:System.ServiceModel.Security.HttpDigestClientCredential> classes.) The following table provides the impersonation level obtained when the service receives user name credentials.</span></span>  
  
|`AllowedImpersonationLevel`|<span data-ttu-id="3246c-240">Il servizio dispone di `SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="3246c-240">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="3246c-241">Servizio e client con funzionalità di delega</span><span class="sxs-lookup"><span data-stu-id="3246c-241">Service and client are capable of delegation</span></span>|<span data-ttu-id="3246c-242">`ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="3246c-242">Cached token `ImpersonationLevel`</span></span>|  
|---------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="3246c-243">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-243">n/a</span></span>|<span data-ttu-id="3246c-244">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-244">Yes</span></span>|<span data-ttu-id="3246c-245">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-245">Yes</span></span>|<span data-ttu-id="3246c-246">Delegation</span><span class="sxs-lookup"><span data-stu-id="3246c-246">Delegation</span></span>|  
|<span data-ttu-id="3246c-247">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-247">n/a</span></span>|<span data-ttu-id="3246c-248">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-248">Yes</span></span>|<span data-ttu-id="3246c-249">No</span><span class="sxs-lookup"><span data-stu-id="3246c-249">No</span></span>|<span data-ttu-id="3246c-250">rappresentazione</span><span class="sxs-lookup"><span data-stu-id="3246c-250">Impersonation</span></span>|  
|<span data-ttu-id="3246c-251">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-251">n/a</span></span>|<span data-ttu-id="3246c-252">No</span><span class="sxs-lookup"><span data-stu-id="3246c-252">No</span></span>|<span data-ttu-id="3246c-253">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-253">n/a</span></span>|<span data-ttu-id="3246c-254">Identification</span><span class="sxs-lookup"><span data-stu-id="3246c-254">Identification</span></span>|  
  
## <a name="impersonation-level-obtained-from-s4u-based-impersonation"></a><span data-ttu-id="3246c-255">Livello di rappresentazione ottenuto dalla rappresentazione basata su S4U</span><span class="sxs-lookup"><span data-stu-id="3246c-255">Impersonation Level Obtained from S4U-Based Impersonation</span></span>  
  
|<span data-ttu-id="3246c-256">Il servizio dispone di `SeTcbPrivilege`</span><span class="sxs-lookup"><span data-stu-id="3246c-256">Service has `SeTcbPrivilege`</span></span>|<span data-ttu-id="3246c-257">Il servizio dispone di `SeImpersonatePrivilege`</span><span class="sxs-lookup"><span data-stu-id="3246c-257">Service has `SeImpersonatePrivilege`</span></span>|<span data-ttu-id="3246c-258">Servizio e client con funzionalità di delega</span><span class="sxs-lookup"><span data-stu-id="3246c-258">Service and client are capable of delegation</span></span>|<span data-ttu-id="3246c-259">`ImpersonationLevel`</span><span class="sxs-lookup"><span data-stu-id="3246c-259">Cached token `ImpersonationLevel`</span></span>|  
|----------------------------------|------------------------------------------|--------------------------------------------------|---------------------------------------|  
|<span data-ttu-id="3246c-260">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-260">Yes</span></span>|<span data-ttu-id="3246c-261">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-261">Yes</span></span>|<span data-ttu-id="3246c-262">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-262">n/a</span></span>|<span data-ttu-id="3246c-263">rappresentazione</span><span class="sxs-lookup"><span data-stu-id="3246c-263">Impersonation</span></span>|  
|<span data-ttu-id="3246c-264">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-264">Yes</span></span>|<span data-ttu-id="3246c-265">No</span><span class="sxs-lookup"><span data-stu-id="3246c-265">No</span></span>|<span data-ttu-id="3246c-266">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-266">n/a</span></span>|<span data-ttu-id="3246c-267">Identification</span><span class="sxs-lookup"><span data-stu-id="3246c-267">Identification</span></span>|  
|<span data-ttu-id="3246c-268">No</span><span class="sxs-lookup"><span data-stu-id="3246c-268">No</span></span>|<span data-ttu-id="3246c-269">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-269">n/a</span></span>|<span data-ttu-id="3246c-270">N/D</span><span class="sxs-lookup"><span data-stu-id="3246c-270">n/a</span></span>|<span data-ttu-id="3246c-271">Identification</span><span class="sxs-lookup"><span data-stu-id="3246c-271">Identification</span></span>|  
  
## <a name="mapping-a-client-certificate-to-a-windows-account"></a><span data-ttu-id="3246c-272">Mapping di un certificato client a un account di Windows</span><span class="sxs-lookup"><span data-stu-id="3246c-272">Mapping a Client Certificate to a Windows Account</span></span>  
 <span data-ttu-id="3246c-273">È possibile effettuare l'autenticazione di un client a un servizio tramite un certificato e fare in modo che il servizio esegua il mapping del client a un account esistente tramite Active Directory.</span><span class="sxs-lookup"><span data-stu-id="3246c-273">It is possible for a client to authenticate itself to a service using a certificate, and to have the service map the client to an existing account through Active Directory.</span></span> <span data-ttu-id="3246c-274">Nel codice XML seguente viene illustrato come configurare il servizio affinché esegua il mapping del certificato.</span><span class="sxs-lookup"><span data-stu-id="3246c-274">The following XML shows how to configure the service to map the certificate.</span></span>  
  
```xml  
<behaviors>  
  <serviceBehaviors>  
    <behavior name="MapToWindowsAccount">  
      <serviceCredentials>  
        <clientCertificate>  
          <authentication mapClientCertificateToWindowsAccount="true" />  
        </clientCertificate>  
      </serviceCredentials>  
    </behavior>  
  </serviceBehaviors>  
</behaviors>  
```  
  
 <span data-ttu-id="3246c-275">Nel codice seguente viene illustrato come configurare il servizio.</span><span class="sxs-lookup"><span data-stu-id="3246c-275">The following code shows how to configure the service.</span></span>  
  
```csharp
// Create a binding that sets a certificate as the client credential type.  
WSHttpBinding b = new WSHttpBinding();  
b.Security.Message.ClientCredentialType = MessageCredentialType.Certificate;  
  
// Create a service host that maps the certificate to a Windows account.  
Uri httpUri = new Uri("http://localhost/Calculator");  
ServiceHost sh = new ServiceHost(typeof(HelloService), httpUri);  
sh.Credentials.ClientCertificate.Authentication.MapClientCertificateToWindowsAccount = true;  
```  
  
## <a name="delegation"></a><span data-ttu-id="3246c-276">Delegation</span><span class="sxs-lookup"><span data-stu-id="3246c-276">Delegation</span></span>  
 <span data-ttu-id="3246c-277">Per delegare ad un servizio back end, è necessario che un servizio esegua l'autenticazione multifase Kerberos (SSPI senza fallback NTLM) o l'autenticazione Kerberos diretta ad un servizio back end utilizzando l'identità Windows del client.</span><span class="sxs-lookup"><span data-stu-id="3246c-277">To delegate to a back-end service, a service must perform Kerberos multi-leg (SSPI without NTLM fallback) or Kerberos direct authentication to the back-end service using the client’s Windows identity.</span></span> <span data-ttu-id="3246c-278">Per delegare ad un servizio back-end, creare una classe <xref:System.ServiceModel.ChannelFactory%601> e un canale, quindi comunicare tramite il canale durante la rappresentazione del client.</span><span class="sxs-lookup"><span data-stu-id="3246c-278">To delegate to a back-end service, create a <xref:System.ServiceModel.ChannelFactory%601> and a channel, and then communicate through the channel while impersonating the client.</span></span> <span data-ttu-id="3246c-279">Con questo tipo di delega, la distanza con la quale deve essere posizionato il servizio back end dal servizio front end dipende dal livello di rappresentazione raggiunto dal servizio front end.</span><span class="sxs-lookup"><span data-stu-id="3246c-279">With this form of delegation, the distance at which the back-end service can be located from the front-end service depends on the impersonation level achieved by the front-end service.</span></span> <span data-ttu-id="3246c-280">Se il livello di rappresentazione è <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, è necessario che i servizi front end e back end vengano eseguiti nello stesso computer.</span><span class="sxs-lookup"><span data-stu-id="3246c-280">When the impersonation level is <xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>, the front-end and back-end services must be running on the same machine.</span></span> <span data-ttu-id="3246c-281">Se il livello di rappresentazione è <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>, i servizi front end e back end possono essere eseguiti in computer diversi o nello stesso computer.</span><span class="sxs-lookup"><span data-stu-id="3246c-281">When the impersonation level is <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>, the front-end and back-end services can be on separate machines or on the same machine.</span></span> <span data-ttu-id="3246c-282">L'attivazione della rappresentazione a livello di delega richiede che, per consentire la delega, i criteri di dominio di Windows siano configurati.</span><span class="sxs-lookup"><span data-stu-id="3246c-282">Enabling delegation-level impersonation requires that Windows domain policy be configured to permit delegation.</span></span> <span data-ttu-id="3246c-283">Per altre informazioni sulla configurazione di Active Directory per il supporto della delega, vedere la pagina sull' [abilitazione dell'autenticazione delegata](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc780217(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="3246c-283">For more information about configuring Active Directory for delegation support, see [Enabling Delegated Authentication](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc780217(v=ws.10)).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="3246c-284">Se il client esegue l'autenticazione al servizio front end utilizzando un nome utente e una password corrispondenti a un account di Windows nel servizio back end, il servizio front end può autenticarsi al servizio back end riutilizzando il nome utente e la password del client.</span><span class="sxs-lookup"><span data-stu-id="3246c-284">When a client authenticates to the front-end service using a user name and password that correspond to a Windows account on the back-end service, the front-end service can authenticate to the back-end service by reusing the client’s user name and password.</span></span> <span data-ttu-id="3246c-285">Questa è una forma di flusso di identità particolarmente utile in quanto il trasferimento del nome utente e della password al servizio back-end consente a quest'ultimo di eseguire la rappresentazione, ma non costituisce una delega perché Kerberos non viene utilizzato.</span><span class="sxs-lookup"><span data-stu-id="3246c-285">This is a particularly powerful form of identity flow, because passing user name and password to the back-end service enables the back-end service to perform impersonation, but it does not constitute delegation because Kerberos is not used.</span></span> <span data-ttu-id="3246c-286">I controlli di Active Directory sulla delega non vengono applicati all'autenticazione del nome utente e della password.</span><span class="sxs-lookup"><span data-stu-id="3246c-286">Active Directory controls on delegation do not apply to user name and password authentication.</span></span>  
  
### <a name="delegation-ability-as-a-function-of-impersonation-level"></a><span data-ttu-id="3246c-287">Capacità di delega come funzione del livello di rappresentazione.</span><span class="sxs-lookup"><span data-stu-id="3246c-287">Delegation Ability as a Function of Impersonation Level</span></span>  
  
|<span data-ttu-id="3246c-288">Livello di rappresentazione</span><span class="sxs-lookup"><span data-stu-id="3246c-288">Impersonation level</span></span>|<span data-ttu-id="3246c-289">Il servizio può eseguire la delega tra processi.</span><span class="sxs-lookup"><span data-stu-id="3246c-289">Service can perform cross-process delegation</span></span>|<span data-ttu-id="3246c-290">Il servizio può eseguire la delega tra computer.</span><span class="sxs-lookup"><span data-stu-id="3246c-290">Service can perform cross-machine delegation</span></span>|  
|-------------------------|---------------------------------------------------|---------------------------------------------------|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Identification>|<span data-ttu-id="3246c-291">No</span><span class="sxs-lookup"><span data-stu-id="3246c-291">No</span></span>|<span data-ttu-id="3246c-292">No</span><span class="sxs-lookup"><span data-stu-id="3246c-292">No</span></span>|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Impersonation>|<span data-ttu-id="3246c-293">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-293">Yes</span></span>|<span data-ttu-id="3246c-294">No</span><span class="sxs-lookup"><span data-stu-id="3246c-294">No</span></span>|  
|<xref:System.Security.Principal.TokenImpersonationLevel.Delegation>|<span data-ttu-id="3246c-295">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-295">Yes</span></span>|<span data-ttu-id="3246c-296">Sì</span><span class="sxs-lookup"><span data-stu-id="3246c-296">Yes</span></span>|  
  
 <span data-ttu-id="3246c-297">Nell'esempio di codice riportato di seguito viene illustrato come utilizzare la delega.</span><span class="sxs-lookup"><span data-stu-id="3246c-297">The following code example demonstrates how to use delegation.</span></span>  
  
 [!code-csharp[c_delegation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_delegation/cs/source.cs#1)]
 [!code-vb[c_delegation#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_delegation/vb/source.vb#1)]  
  
### <a name="how-to-configure-an-application-to-use-constrained-delegation"></a><span data-ttu-id="3246c-298">Procedura: configurare un'applicazione per utilizzare una delega vincolata.</span><span class="sxs-lookup"><span data-stu-id="3246c-298">How to Configure an Application to Use Constrained Delegation</span></span>  
 <span data-ttu-id="3246c-299">Prima di utilizzare una delega vincolata, è necessario che il mittente, il destinatario e il controller di dominio siano configurati per raggiungere tale obiettivo.</span><span class="sxs-lookup"><span data-stu-id="3246c-299">Before you can use constrained delegation, the sender, receiver, and the domain controller must be configured to do so.</span></span> <span data-ttu-id="3246c-300">La procedura riportata di seguito elenca i passaggi che consentono la delega vincolata.</span><span class="sxs-lookup"><span data-stu-id="3246c-300">The following procedure lists the steps that enable constrained delegation.</span></span> <span data-ttu-id="3246c-301">Per altre informazioni sulle differenze tra la delega e la delega vincolata, vedere la parte che descrive gli argomenti vincolati nella pagina sulle [estensioni Kerberos di Windows Server 2003](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc738207(v=ws.10)) .</span><span class="sxs-lookup"><span data-stu-id="3246c-301">For details about the differences between delegation and constrained delegation, see the portion of [Windows Server 2003 Kerberos Extensions](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc738207(v=ws.10)) that discusses constrained discussion.</span></span>  
  
1. <span data-ttu-id="3246c-302">Nel controller di dominio, cancellare la casella di controllo **L'account è sensibile e non può essere delegato** selezionata per l'account nel quale viene eseguita l'applicazione del client.</span><span class="sxs-lookup"><span data-stu-id="3246c-302">On the domain controller, clear the **Account is sensitive and cannot be delegated** check box for the account under which the client application is running.</span></span>  
  
2. <span data-ttu-id="3246c-303">Nel controller di dominio, selezionare la casella di controllo **L'account è attendibile per la delega** selezionata per l'account nel quale viene eseguita l'applicazione del client.</span><span class="sxs-lookup"><span data-stu-id="3246c-303">On the domain controller, select the **Account is trusted for delegation** check box for the account under which the client application is running.</span></span>  
  
3. <span data-ttu-id="3246c-304">Nel controller di dominio, configurare il computer di livello intermedio in modo che sia attendibile per la delega facendo clic sull'opzione **Computer attendibili per la delega** .</span><span class="sxs-lookup"><span data-stu-id="3246c-304">On the domain controller, configure the middle tier computer so that it is trusted for delegation, by clicking the **Trust computer for delegation** option.</span></span>  
  
4. <span data-ttu-id="3246c-305">Nel controller di dominio, configurare il computer di livello intermedio per l'utilizzo della delega vincolata facendo clic sull'opzione **Computer attendibili per la delega solo ai servizi specificati** .</span><span class="sxs-lookup"><span data-stu-id="3246c-305">On the domain controller, configure the middle tier computer to use constrained delegation, by clicking the **Trust this computer for delegation to specified services only** option.</span></span>  
  
 <span data-ttu-id="3246c-306">Per istruzioni più dettagliate sulla configurazione della delega vincolata, vedere [transizione del protocollo Kerberos e delega vincolata](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc739587(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="3246c-306">For more detailed instructions about configuring constrained delegation, see [Kerberos Protocol Transition and Constrained Delegation](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc739587(v=ws.10)).</span></span>
  
## <a name="see-also"></a><span data-ttu-id="3246c-307">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="3246c-307">See also</span></span>

- <xref:System.ServiceModel.OperationBehaviorAttribute>
- <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A>
- <xref:System.ServiceModel.ImpersonationOption>
- <xref:System.ServiceModel.ServiceSecurityContext.WindowsIdentity%2A>
- <xref:System.ServiceModel.ServiceSecurityContext>
- <xref:System.Security.Principal.WindowsIdentity>
- <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior>
- <xref:System.ServiceModel.Description.ServiceAuthorizationBehavior.ImpersonateCallerForAllOperations%2A>
- <xref:System.ServiceModel.ServiceHost>
- <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A>
- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.ChannelFactory%601>
- <xref:System.Security.Principal.TokenImpersonationLevel.Identification>
- [<span data-ttu-id="3246c-308">Uso della rappresentazione con la sicurezza del trasporto</span><span class="sxs-lookup"><span data-stu-id="3246c-308">Using Impersonation with Transport Security</span></span>](../../../../docs/framework/wcf/feature-details/using-impersonation-with-transport-security.md)
- [<span data-ttu-id="3246c-309">Rappresentazione del client</span><span class="sxs-lookup"><span data-stu-id="3246c-309">Impersonating the Client</span></span>](../../../../docs/framework/wcf/samples/impersonating-the-client.md)
- [<span data-ttu-id="3246c-310">Procedura: Rappresentare un client in un servizio</span><span class="sxs-lookup"><span data-stu-id="3246c-310">How to: Impersonate a Client on a Service</span></span>](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md)
- [<span data-ttu-id="3246c-311">Strumento ServiceModel Metadata Utility Tool (Svcutil.exe)</span><span class="sxs-lookup"><span data-stu-id="3246c-311">ServiceModel Metadata Utility Tool (Svcutil.exe)</span></span>](../../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md)
