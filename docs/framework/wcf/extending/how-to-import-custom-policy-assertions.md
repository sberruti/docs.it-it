---
title: 'Procedura: importare asserzioni di criteri personalizzati'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 1f41d787-accb-4a10-bfc6-a807671d1581
ms.openlocfilehash: ed8aae30875e3b17f65be5857c7d93af98db9b3e
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/12/2020
ms.locfileid: "79185563"
---
# <a name="how-to-import-custom-policy-assertions"></a><span data-ttu-id="c02ab-102">Procedura: importare asserzioni di criteri personalizzati</span><span class="sxs-lookup"><span data-stu-id="c02ab-102">How to: Import Custom Policy Assertions</span></span>
<span data-ttu-id="c02ab-103">Le asserzioni di criteri descrivono le funzionalità e i requisiti di un endpoint del servizio.</span><span class="sxs-lookup"><span data-stu-id="c02ab-103">Policy assertions describe the capabilities and requirements of a service endpoint.</span></span>  <span data-ttu-id="c02ab-104">Le applicazioni client possono utilizzare asserzioni di criteri nei metadati del servizio per configurare l'associazione del client o per personalizzare il contratto di servizio per un endpoint del servizio.</span><span class="sxs-lookup"><span data-stu-id="c02ab-104">Client applications can use policy assertions in service metadata to configure the client binding or to customize the service contract for a service endpoint.</span></span>  
  
 <span data-ttu-id="c02ab-105">Le asserzioni di criteri personalizzate vengono importate implementando l'interfaccia <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> e passando quell'oggetto al sistema di metadati o registrando il tipo di implementazione nel file di configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="c02ab-105">Custom policy assertions are imported by implementing the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface and passing that object to the metadata system or by registering the implementation type in your application configuration file.</span></span>  <span data-ttu-id="c02ab-106">Le implementazioni <xref:System.ServiceModel.Description.IPolicyImportExtension> dell'interfaccia devono fornire un costruttore senza parametri.</span><span class="sxs-lookup"><span data-stu-id="c02ab-106">Implementations of the <xref:System.ServiceModel.Description.IPolicyImportExtension> interface must provide a parameterless constructor.</span></span>  
  
### <a name="to-import-custom-policy-assertions"></a><span data-ttu-id="c02ab-107">Per importare asserzioni di criteri personalizzati</span><span class="sxs-lookup"><span data-stu-id="c02ab-107">To import custom policy assertions</span></span>  
  
1. <span data-ttu-id="c02ab-108">Implementare l'interfaccia <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> in una classe.</span><span class="sxs-lookup"><span data-stu-id="c02ab-108">Implement the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface on a class.</span></span> <span data-ttu-id="c02ab-109">Vedere le procedure seguenti.</span><span class="sxs-lookup"><span data-stu-id="c02ab-109">See the following procedures.</span></span>  
  
2. <span data-ttu-id="c02ab-110">Inserire l'unità di importazione dei criteri personalizzati tramite uno dei modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="c02ab-110">Insert the custom policy importer either by:</span></span>  
  
3. <span data-ttu-id="c02ab-111">Utilizzando un file di configurazione.</span><span class="sxs-lookup"><span data-stu-id="c02ab-111">Using a configuration file.</span></span> <span data-ttu-id="c02ab-112">Vedere le procedure seguenti.</span><span class="sxs-lookup"><span data-stu-id="c02ab-112">See the following procedures.</span></span>  
  
4. <span data-ttu-id="c02ab-113">Utilizzo di un file di configurazione con [lo strumento ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="c02ab-113">Using a configuration file with [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span> <span data-ttu-id="c02ab-114">Vedere le procedure seguenti.</span><span class="sxs-lookup"><span data-stu-id="c02ab-114">See the following procedures.</span></span>  
  
5. <span data-ttu-id="c02ab-115">Inserendo a livello di programmazione l'unità di importazione dei criteri.</span><span class="sxs-lookup"><span data-stu-id="c02ab-115">Programmatically inserting the policy importer.</span></span> <span data-ttu-id="c02ab-116">Vedere le procedure seguenti.</span><span class="sxs-lookup"><span data-stu-id="c02ab-116">See the following procedures.</span></span>  
  
### <a name="to-implement-the-systemservicemodeldescriptionipolicyimportextension-interface-on-any-class"></a><span data-ttu-id="c02ab-117">Per implementare l'interfaccia System.ServiceModel.Description.IPolicyImportExtension in qualsiasi classe</span><span class="sxs-lookup"><span data-stu-id="c02ab-117">To implement the System.ServiceModel.Description.IPolicyImportExtension interface on any class</span></span>  
  
1. <span data-ttu-id="c02ab-118">Nel metodo <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType>, per ogni oggetto criterio a cui si è interessati, individuare le asserzioni dei criteri che si desidera importare chiamando il metodo appropriato (in base all'ambito dell'asserzione desiderata) nell'oggetto <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> passato al metodo.</span><span class="sxs-lookup"><span data-stu-id="c02ab-118">In the <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> method, for each policy subject that you are interested in, find the policy assertions that you want to import by calling the appropriate method (depending upon the scope of the assertion that you want) on the <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> object passed to the method.</span></span> <span data-ttu-id="c02ab-119">Nell'esempio di codice seguente viene illustrato come utilizzare il metodo <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> per individuare l'asserzione del criterio personalizzato e rimuoverla dalla raccolta in un passaggio.</span><span class="sxs-lookup"><span data-stu-id="c02ab-119">The following code example shows how to use the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step.</span></span> <span data-ttu-id="c02ab-120">Se si utilizza il metodo di rimozione per individuare e rimuovere l'asserzione, non è necessario eseguire il passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="c02ab-120">If you use the remove method to locate and remove the assertion, you do not have to perform step 4.</span></span>  
  
     [!code-csharp[CustomPolicySample#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/policyimporter.cs#9)]
     [!code-vb[CustomPolicySample#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/policyimporter.vb#9)]  
  
2. <span data-ttu-id="c02ab-121">Elaborare le asserzioni dei criteri.</span><span class="sxs-lookup"><span data-stu-id="c02ab-121">Process the policy assertions.</span></span> <span data-ttu-id="c02ab-122">Si noti che il sistema del criterio non normalizza i criteri annidati e `wsp:optional`.</span><span class="sxs-lookup"><span data-stu-id="c02ab-122">Note that the policy system does not normalize nested policies and `wsp:optional`.</span></span> <span data-ttu-id="c02ab-123">È necessario elaborare questi costrutti nell'implementazione di un'estensione di importazione del criterio.</span><span class="sxs-lookup"><span data-stu-id="c02ab-123">You must process these constructs in your policy import extension implementation.</span></span>  
  
3. <span data-ttu-id="c02ab-124">Eseguire la personalizzazione dell'associazione o del contratto che supporta la funzionalità o il requisito specificato dall'asserzione del criterio.</span><span class="sxs-lookup"><span data-stu-id="c02ab-124">Perform the customization to the binding or contract that supports the capability or requirement specified by the policy assertion.</span></span> <span data-ttu-id="c02ab-125">In genere, le asserzioni indicano che un'associazione richiede una particolare configurazione o uno specifico elemento di associazione.</span><span class="sxs-lookup"><span data-stu-id="c02ab-125">Typically assertions indicate that a binding requires a particular configuration or a specific binding element.</span></span> <span data-ttu-id="c02ab-126">Apportare queste modifiche accedendo alla proprietà <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="c02ab-126">Make these modifications by accessing the <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="c02ab-127">Le altre asserzioni richiedono che si modifichi il contratto.</span><span class="sxs-lookup"><span data-stu-id="c02ab-127">Other assertions require that you modify the contract.</span></span>  <span data-ttu-id="c02ab-128">È possibile accedere e modificare il contratto utilizzando la proprietà <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="c02ab-128">You can access and modify the contract using the <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> property.</span></span>  <span data-ttu-id="c02ab-129">Si noti che l'unità di importazione dei criteri può venire chiamata più volte per la stessa associazione e per lo stesso contratto, ma per alternative criteri diverse se l'importazione di un'alternativa criterio non riesce.</span><span class="sxs-lookup"><span data-stu-id="c02ab-129">Note that your policy importer may get called multiple times for the same binding and contract, but different policy alternatives if importing a policy alternative fails.</span></span> <span data-ttu-id="c02ab-130">Il codice deve adattarsi a questo comportamento.</span><span class="sxs-lookup"><span data-stu-id="c02ab-130">Your code should be resilient to this behavior.</span></span>  
  
4. <span data-ttu-id="c02ab-131">Rimuovere l'asserzione di criteri personalizzata dalla raccolta di asserzioni.</span><span class="sxs-lookup"><span data-stu-id="c02ab-131">Remove the custom policy assertion from the assertion collection.</span></span> <span data-ttu-id="c02ab-132">Se non si rimuove l'asserzione Windows Communication Foundation (WCF) presuppone che l'importazione dei criteri non è riuscita e non importa l'associazione associata.</span><span class="sxs-lookup"><span data-stu-id="c02ab-132">If you do not remove the assertion Windows Communication Foundation (WCF) assumes that the policy import was unsuccessful and does not import the associated binding.</span></span> <span data-ttu-id="c02ab-133">Se è stato utilizzato il metodo <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> per individuare l'asserzione di criteri personalizzata e rimuoverla dalla raccolta in un unico passaggio, non è necessario eseguire questa procedura.</span><span class="sxs-lookup"><span data-stu-id="c02ab-133">If you used the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step you do not have to perform this step.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-a-configuration-file"></a><span data-ttu-id="c02ab-134">Per inserire l'unità di importazione di criteri personalizzata nel sistema di metadati utilizzando un file di configurazione</span><span class="sxs-lookup"><span data-stu-id="c02ab-134">To insert the custom policy importer into the metadata System using a configuration file</span></span>  
  
1. <span data-ttu-id="c02ab-135">Aggiungere il tipo di `<extensions>` utilità di importazione all'elemento all'interno dell'elemento [ \<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) nel file di configurazione client.</span><span class="sxs-lookup"><span data-stu-id="c02ab-135">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the client configuration file.</span></span>  
  
     [!code-xml[CustomPolicySample#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.exe.config#7)]
  
2. <span data-ttu-id="c02ab-136">Nell'applicazione client, utilizzare <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> o <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> per risolvere i metadati. L'unità di importazione viene richiamata automaticamente.</span><span class="sxs-lookup"><span data-stu-id="c02ab-136">In the client application, use the <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> to resolve the metadata and the importer is invoked automatically.</span></span>  
  
     [!code-csharp[CustomPolicySample#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.cs#10)]
     [!code-vb[CustomPolicySample#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/client.vb#10)]  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-svcutilexe"></a><span data-ttu-id="c02ab-137">Per inserire l'unità di importazione di criteri personalizzata nel sistema di metadati utilizzando Svcutil.exe</span><span class="sxs-lookup"><span data-stu-id="c02ab-137">To insert the custom policy importer into the metadata system using Svcutil.exe</span></span>  
  
1. <span data-ttu-id="c02ab-138">Aggiungere il tipo di `<extensions>` utilità di importazione all'elemento all'interno dell'elemento [ \<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) nel file di configurazione Svcutil.exe.config.</span><span class="sxs-lookup"><span data-stu-id="c02ab-138">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the Svcutil.exe.config configuration file.</span></span> <span data-ttu-id="c02ab-139">È anche possibile puntare a Svcutil.exe per caricare tipi di unità di importazione di criteri registrati in un file di configurazione diverso, utilizzando l'opzione `/svcutilConfig`.</span><span class="sxs-lookup"><span data-stu-id="c02ab-139">You can also point Svcutil.exe to load policy importer types registered in a different configuration file by using the `/svcutilConfig` option.</span></span>  
  
2. <span data-ttu-id="c02ab-140">Utilizzare [lo strumento ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) per importare i metadati e l'utilità di importazione viene richiamata automaticamente.</span><span class="sxs-lookup"><span data-stu-id="c02ab-140">Use [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) to import the metadata and the importer is invoked automatically.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-programmatically"></a><span data-ttu-id="c02ab-141">Per inserire l'unità di importazione di criteri personalizzata nel sistema di metadati a livello di programmazione</span><span class="sxs-lookup"><span data-stu-id="c02ab-141">To insert the custom policy importer into the metadata system programmatically</span></span>  
  
1. <span data-ttu-id="c02ab-142">Aggiungere l'unità di importazione alla proprietà <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> (ad esempio, se si sta utilizzando <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>) prima di importare i metadati.</span><span class="sxs-lookup"><span data-stu-id="c02ab-142">Add the importer to the <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> property (for example, if you are using the <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>) prior to importing the metadata.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="c02ab-143">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="c02ab-143">See also</span></span>

- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- [<span data-ttu-id="c02ab-144">Estensione del sistema di metadati</span><span class="sxs-lookup"><span data-stu-id="c02ab-144">Extending the Metadata System</span></span>](extending-the-metadata-system.md)
