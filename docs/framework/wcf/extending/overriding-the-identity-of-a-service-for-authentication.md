---
title: Override dell'identità di un servizio per l'autenticazione
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
ms.openlocfilehash: d1c0cc487d8deea7045ee9653d1eae9b73ec864f
ms.sourcegitcommit: 7e2128d4a4c45b4274bea3b8e5760d4694569ca1
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/14/2020
ms.locfileid: "75938022"
---
# <a name="overriding-the-identity-of-a-service-for-authentication"></a><span data-ttu-id="303f2-102">Override dell'identità di un servizio per l'autenticazione</span><span class="sxs-lookup"><span data-stu-id="303f2-102">Overriding the Identity of a Service for Authentication</span></span>
<span data-ttu-id="303f2-103">In genere non è necessario impostare l'identità in un servizio, perché la selezione del tipo di credenziale di un client impone il tipo di identità esposto nei metadati del servizio.</span><span class="sxs-lookup"><span data-stu-id="303f2-103">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="303f2-104">Il codice di configurazione seguente, ad esempio, usa l'elemento [\<wshttpbinding >](../../configure-apps/file-schema/wcf/wshttpbinding.md) e imposta l'attributo `clientCredentialType` su Windows.</span><span class="sxs-lookup"><span data-stu-id="303f2-104">For example, the following configuration code uses the [\<wsHttpBinding>](../../configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.</span></span>  

 <span data-ttu-id="303f2-105">Nel frammento WSDL (Web Services Description Language) viene mostrata l'identità dell'endpoint precedentemente definito.</span><span class="sxs-lookup"><span data-stu-id="303f2-105">The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined.</span></span> <span data-ttu-id="303f2-106">In questo esempio, il servizio viene eseguito come servizio indipendente con un determinato account utente (username@contoso.com) e pertanto l'identità del nome dell'entità utente (UPN) contiene il nome dell'account.</span><span class="sxs-lookup"><span data-stu-id="303f2-106">In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name.</span></span> <span data-ttu-id="303f2-107">L'UPN è anche noto anche come nome di accesso dell'utente in un dominio Windows.</span><span class="sxs-lookup"><span data-stu-id="303f2-107">The UPN is also known as the user logon name in a Windows domain.</span></span>  

 <span data-ttu-id="303f2-108">Per un'applicazione di esempio che illustra l'impostazione Identity, vedere [esempio di identità del servizio](../samples/service-identity-sample.md).</span><span class="sxs-lookup"><span data-stu-id="303f2-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../samples/service-identity-sample.md).</span></span> <span data-ttu-id="303f2-109">Per altre informazioni sull'identità del servizio, vedere [identità e autenticazione del servizio](../feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="303f2-109">For more information about service identity, see [Service Identity and Authentication](../feature-details/service-identity-and-authentication.md).</span></span>  
  
## <a name="kerberos-authentication-and-identity"></a><span data-ttu-id="303f2-110">Autenticazione Kerberos e identità</span><span class="sxs-lookup"><span data-stu-id="303f2-110">Kerberos Authentication and Identity</span></span>  
 <span data-ttu-id="303f2-111">Per impostazione predefinita, quando un servizio è configurato per l'utilizzo di una credenziale di Windows, in WSDL viene generato un elemento [\<identity >](../../configure-apps/file-schema/wcf/identity.md) che contiene un elemento [\<userPrincipalName >](../../configure-apps/file-schema/wcf/userprincipalname.md) o [\<servicePrincipalName >](../../configure-apps/file-schema/wcf/serviceprincipalname.md) .</span><span class="sxs-lookup"><span data-stu-id="303f2-111">By default, when a service is configured to use a Windows credential, an [\<identity>](../../configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL.</span></span> <span data-ttu-id="303f2-112">Se il servizio è in esecuzione con l'account `LocalSystem`, `LocalService`o `NetworkService`, per impostazione predefinita viene generato un nome dell'entità servizio (SPN) nel formato `host/`\<*nome host*> perché tali account hanno accesso ai dati SPN del computer.</span><span class="sxs-lookup"><span data-stu-id="303f2-112">If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data.</span></span> <span data-ttu-id="303f2-113">Se il servizio è in esecuzione con un account diverso, Windows Communication Foundation (WCF) genera un UPN nel formato \<*nomeutente*>@<*NomeDominio*`>`.</span><span class="sxs-lookup"><span data-stu-id="303f2-113">If the service is running under a different account, Windows Communication Foundation (WCF) generates a UPN in the form of \<*username*>@<*domainName*`>`.</span></span> <span data-ttu-id="303f2-114">Questo si verifica perché l'autenticazione Kerberos richiede che venga fornito un UPN o un SPN al client per l'autenticazione del servizio.</span><span class="sxs-lookup"><span data-stu-id="303f2-114">This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.</span></span>  
  
 <span data-ttu-id="303f2-115">È inoltre possibile usare lo strumento Setspn.exe per registrare un SPN aggiuntivo con l'account di un servizio in un dominio.</span><span class="sxs-lookup"><span data-stu-id="303f2-115">You can also use the Setspn.exe tool to register an additional SPN with a service's account in a domain.</span></span> <span data-ttu-id="303f2-116">È quindi possibile usare il nome SPN come identità del servizio.</span><span class="sxs-lookup"><span data-stu-id="303f2-116">You can then use the SPN as the identity of the service.</span></span> <span data-ttu-id="303f2-117">Per scaricare lo strumento, vedere [strumento del Resource Kit di Windows 2000: Setspn. exe](https://go.microsoft.com/fwlink/?LinkId=91752).</span><span class="sxs-lookup"><span data-stu-id="303f2-117">To download the tool, see [Windows 2000 Resource Kit Tool : Setspn.exe](https://go.microsoft.com/fwlink/?LinkId=91752).</span></span> <span data-ttu-id="303f2-118">Per ulteriori informazioni sullo strumento, vedere la pagina relativa alla [Panoramica di Setspn](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc773257(v=ws.10)).</span><span class="sxs-lookup"><span data-stu-id="303f2-118">For more information about the tool, see [Setspn Overview](https://docs.microsoft.com/previous-versions/windows/it-pro/windows-server-2003/cc773257(v=ws.10)).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="303f2-119">Per usare il tipo di credenziale di Windows senza negoziazione, l'account utente del servizio deve avere accesso al nome SPN registrato con il dominio Active Directory.</span><span class="sxs-lookup"><span data-stu-id="303f2-119">To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain.</span></span> <span data-ttu-id="303f2-120">È possibile eseguire questa operazione nei modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="303f2-120">You can do this in the following ways:</span></span>  
  
- <span data-ttu-id="303f2-121">Usare l'account NetworkService o LocalSystem per eseguire il servizio.</span><span class="sxs-lookup"><span data-stu-id="303f2-121">Use the NetworkService or LocalSystem account to run your service.</span></span> <span data-ttu-id="303f2-122">Poiché questi account hanno accesso al nome SPN del computer stabilito quando il computer viene aggiunto al dominio Active Directory, WCF genera automaticamente l'elemento SPN appropriato all'interno dell'endpoint del servizio nei metadati (WSDL) del servizio.</span><span class="sxs-lookup"><span data-stu-id="303f2-122">Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, WCF automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).</span></span>  
  
- <span data-ttu-id="303f2-123">Usare un account di dominio Active Directory arbitrario per eseguire il servizio.</span><span class="sxs-lookup"><span data-stu-id="303f2-123">Use an arbitrary Active Directory domain account to run your service.</span></span> <span data-ttu-id="303f2-124">In questo caso, stabilire un SPN per l'account di dominio, eventualmente usando l'utilità Setspn.exe.</span><span class="sxs-lookup"><span data-stu-id="303f2-124">In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool.</span></span> <span data-ttu-id="303f2-125">Una volta creato il nome SPN per l'account del servizio, configurare WCF per la pubblicazione di tale SPN nei client del servizio tramite i relativi metadati (WSDL).</span><span class="sxs-lookup"><span data-stu-id="303f2-125">Once you create the SPN for the service's account, configure WCF to publish that SPN to the service's clients through its metadata (WSDL).</span></span> <span data-ttu-id="303f2-126">Questa operazione viene eseguita impostando l'identità dell'endpoint esposto tramite un file di configurazione dell'applicazione o tramite codice.</span><span class="sxs-lookup"><span data-stu-id="303f2-126">This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.</span></span>  
  
 <span data-ttu-id="303f2-127">Per ulteriori informazioni sui nomi SPN, sul protocollo Kerberos e Active Directory, vedere [supplemento tecnico Kerberos per Windows](https://docs.microsoft.com/previous-versions/msp-n-p/ff649429(v=pandp.10)).</span><span class="sxs-lookup"><span data-stu-id="303f2-127">For more information about SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](https://docs.microsoft.com/previous-versions/msp-n-p/ff649429(v=pandp.10)).</span></span>  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a><span data-ttu-id="303f2-128">SPN o UPN corrispondente a una stringa vuota</span><span class="sxs-lookup"><span data-stu-id="303f2-128">When SPN or UPN Equals the Empty String</span></span>  
 <span data-ttu-id="303f2-129">Se si imposta il nome SPN o UPN come stringa vuota si verificano diverse cose, a seconda del livello di sicurezza e della modalità di autenticazione usati:</span><span class="sxs-lookup"><span data-stu-id="303f2-129">If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:</span></span>  
  
- <span data-ttu-id="303f2-130">Se si sta usando la protezione del trasporto, viene scelta l'autenticazione NT LanMan (NTLM).</span><span class="sxs-lookup"><span data-stu-id="303f2-130">If you are using transport level security, NT LanMan (NTLM) authentication is chosen.</span></span>  
  
- <span data-ttu-id="303f2-131">Se si sta usando la protezione dei messaggi, l'autenticazione potrebbe non riuscire, a seconda della modalità scelta:</span><span class="sxs-lookup"><span data-stu-id="303f2-131">If you are using message level security, authentication may fail, depending on the authentication mode:</span></span>  
  
- <span data-ttu-id="303f2-132">Se si sta usando la modalità `spnego` e l'attributo `AllowNtlm` è impostato su `false`, l'autenticazione avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="303f2-132">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fail.</span></span>  
  
- <span data-ttu-id="303f2-133">Se si sta usando la modalità `spnego` e l'attributo `AllowNtlm` è impostato su `true`, l'autenticazione avrà esito negativo se l'UPN è vuoto, ma avrà esito positivo se l'SPN è vuoto.</span><span class="sxs-lookup"><span data-stu-id="303f2-133">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty, but succeeds if the SPN is empty.</span></span>  
  
- <span data-ttu-id="303f2-134">Se si sta usando la modalità Kerberos diretta, nota anche come "monofase", l'autenticazione avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="303f2-134">If you are using Kerberos direct (also known as "one-shot"), authentication fails.</span></span>  
  
### <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="303f2-135">Uso dell'elemento \<Identity > nella configurazione</span><span class="sxs-lookup"><span data-stu-id="303f2-135">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="303f2-136">Se si imposta su Certificate il tipo di credenziale client nell'associazione descritta in precedenza`,` il codice WSDL generato conterrà un certificato X.509 con serializzazione Base64 per il valore dell'identità, come illustrato nel codice seguente.</span><span class="sxs-lookup"><span data-stu-id="303f2-136">If you change the client credential type in the binding previously shown to Certificate`,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="303f2-137">Si tratta dell'impostazione predefinita per tutti i tipi di credenziale client diversi da Windows.</span><span class="sxs-lookup"><span data-stu-id="303f2-137">This is the default for all client credential types other than Windows.</span></span>  

 <span data-ttu-id="303f2-138">È possibile modificare il valore dell'identità del servizio predefinita o modificare il tipo di identità usando il <`identity`elemento > nella configurazione o impostando l'identità nel codice.</span><span class="sxs-lookup"><span data-stu-id="303f2-138">You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="303f2-139">Nel codice di configurazione seguente viene impostata un'identità DNS (Domain Name System) con il valore `contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="303f2-139">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  

### <a name="setting-identity-programmatically"></a><span data-ttu-id="303f2-140">Impostazione dell'identità a livello di programmazione</span><span class="sxs-lookup"><span data-stu-id="303f2-140">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="303f2-141">Il servizio non deve specificare in modo esplicito un'identità, perché WCF la determina automaticamente.</span><span class="sxs-lookup"><span data-stu-id="303f2-141">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="303f2-142">Tuttavia, WCF consente di specificare un'identità in un endpoint, se necessario.</span><span class="sxs-lookup"><span data-stu-id="303f2-142">However, WCF allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="303f2-143">Nel codice seguente viene aggiunto un nuovo endpoint di servizio con un'identità DNS specifica.</span><span class="sxs-lookup"><span data-stu-id="303f2-143">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a><span data-ttu-id="303f2-144">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="303f2-144">See also</span></span>

- [<span data-ttu-id="303f2-145">Procedura: Creare un verificatore di identità client personalizzato</span><span class="sxs-lookup"><span data-stu-id="303f2-145">How to: Create a Custom Client Identity Verifier</span></span>](how-to-create-a-custom-client-identity-verifier.md)
- [<span data-ttu-id="303f2-146">Identità del servizio e autenticazione</span><span class="sxs-lookup"><span data-stu-id="303f2-146">Service Identity and Authentication</span></span>](../feature-details/service-identity-and-authentication.md)
