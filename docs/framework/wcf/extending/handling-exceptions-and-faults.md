---
title: Gestione di eccezioni ed errori
ms.date: 03/30/2017
ms.assetid: a64d01c6-f221-4f58-93e5-da4e87a5682e
ms.openlocfilehash: bca77b575be65513f9a792352e14e3f9bd7b4904
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/12/2020
ms.locfileid: "79185620"
---
# <a name="handling-exceptions-and-faults"></a><span data-ttu-id="b4821-102">Gestione di eccezioni ed errori</span><span class="sxs-lookup"><span data-stu-id="b4821-102">Handling Exceptions and Faults</span></span>
<span data-ttu-id="b4821-103">Le eccezioni vengono utilizzate per comunicare errori localmente, all'interno del servizio o nell'implementazione del client.</span><span class="sxs-lookup"><span data-stu-id="b4821-103">Exceptions are used to communicate errors locally within the service or the client implementation.</span></span> <span data-ttu-id="b4821-104">Gli errori, d'altra parte, vengono utilizzati per comunicare problemi tra servizi, ad esempio dal server al client o viceversa.</span><span class="sxs-lookup"><span data-stu-id="b4821-104">Faults, on the other hand, are used to communicate errors across service boundaries, such as from the server to the client or vice versa.</span></span> <span data-ttu-id="b4821-105">Oltre agli errori, i canali del trasporto spesso utilizzano meccanismi specifici per comunicare errori a livello di trasporto.</span><span class="sxs-lookup"><span data-stu-id="b4821-105">In addition to faults, transport channels often use transport-specific mechanisms to communicate transport-level errors.</span></span> <span data-ttu-id="b4821-106">Il trasporto HTTP, ad esempio, utilizza codici di stato, come 404, per comunicare un URL di endpoint inesistente (nessun endpoint al quale restituire un errore).</span><span class="sxs-lookup"><span data-stu-id="b4821-106">For example, HTTP transport uses status codes such as 404 to communicate a non-existing endpoint URL (there is no endpoint to send back a fault).</span></span> <span data-ttu-id="b4821-107">Questo documento è composto da tre sezioni che contengono materiale sussidiario utile per gli autori di canali personalizzati.</span><span class="sxs-lookup"><span data-stu-id="b4821-107">This document consists of three sections that provide guidance to custom channel authors.</span></span> <span data-ttu-id="b4821-108">Nella prima sezione è contenuto materiale sussidiario sulle circostanze e le modalità di definizione e generazione delle eccezioni.</span><span class="sxs-lookup"><span data-stu-id="b4821-108">The first section provides guidance on when and how to define and throw exceptions.</span></span> <span data-ttu-id="b4821-109">Nella seconda sezione sono fornite istruzioni sulla generazione e l'utilizzo di errori.</span><span class="sxs-lookup"><span data-stu-id="b4821-109">The second section provides guidance around generating and consuming faults.</span></span> <span data-ttu-id="b4821-110">Nella terza sezione viene spiegato come fornire informazioni di traccia per aiutare l'utente del canale personalizzato a risolvere i problemi delle applicazioni in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="b4821-110">The third section explains how to provide trace information to aid the user of your custom channel in troubleshooting running applications.</span></span>  
  
## <a name="exceptions"></a><span data-ttu-id="b4821-111">Eccezioni</span><span class="sxs-lookup"><span data-stu-id="b4821-111">Exceptions</span></span>  
 <span data-ttu-id="b4821-112">È necessario tenere presenti due principi per la generazione di un'eccezione: innanzitutto deve essere di tipo tale da consentire agli utenti di scrivere codice corretto in grado di reagire in modo appropriato all'eccezione.</span><span class="sxs-lookup"><span data-stu-id="b4821-112">There are two things to keep in mind when throwing an exception: First it has to be of a type that allows users to write correct code that can react appropriately to the exception.</span></span> <span data-ttu-id="b4821-113">In secondo luogo deve fornire informazioni sufficienti per consentire all'utente di capire il problema, valutare le conseguenze dell'errore e correggerlo.</span><span class="sxs-lookup"><span data-stu-id="b4821-113">Second, it has to provide enough information for the user to understand what went wrong, the failure impact, and how to fix it.</span></span> <span data-ttu-id="b4821-114">Nelle sezioni seguenti vengono fornite indicazioni sui tipi di eccezione e sui messaggi per i canali windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="b4821-114">The following sections give guidance around exception types and messages for Windows Communication Foundation (WCF) channels.</span></span> <span data-ttu-id="b4821-115">Istruzioni generali sulle eccezioni sono inoltre disponibili in .NET nel documento relativo alle linee guida di progettazione per le eccezioni.</span><span class="sxs-lookup"><span data-stu-id="b4821-115">There is also general guidance around exceptions in .NET in the Design Guidelines for Exceptions document.</span></span>  
  
### <a name="exception-types"></a><span data-ttu-id="b4821-116">Tipi di eccezione</span><span class="sxs-lookup"><span data-stu-id="b4821-116">Exception Types</span></span>  
 <span data-ttu-id="b4821-117">Tutte le eccezioni generate dai canali devono essere <xref:System.TimeoutException?displayProperty=nameWithType>, <xref:System.ServiceModel.CommunicationException?displayProperty=nameWithType> o un tipo derivato da <xref:System.ServiceModel.CommunicationException>.</span><span class="sxs-lookup"><span data-stu-id="b4821-117">All exceptions thrown by channels must be either a <xref:System.TimeoutException?displayProperty=nameWithType>, <xref:System.ServiceModel.CommunicationException?displayProperty=nameWithType>, or a type derived from <xref:System.ServiceModel.CommunicationException>.</span></span> <span data-ttu-id="b4821-118">Eccezioni come ad esempio <xref:System.ObjectDisposedException> possono essere generate ma solo per indicare che il codice chiamante ha adoperato male il canale.</span><span class="sxs-lookup"><span data-stu-id="b4821-118">(Exceptions such as <xref:System.ObjectDisposedException> may also be thrown, but only to indicate that the calling code has misused the channel.</span></span> <span data-ttu-id="b4821-119">Se un canale viene utilizzato correttamente, deve generare solo le eccezioni indicate.) WCF fornisce sette tipi <xref:System.ServiceModel.CommunicationException> di eccezione che derivano da e sono progettati per essere utilizzati dai canali.</span><span class="sxs-lookup"><span data-stu-id="b4821-119">If a channel is used correctly, it must only throw the given exceptions.) WCF provides seven exception types that derive from <xref:System.ServiceModel.CommunicationException> and are designed to be used by channels.</span></span> <span data-ttu-id="b4821-120">Esistono altre eccezioni derivate da <xref:System.ServiceModel.CommunicationException>, pensate per essere utilizzate in altre parti del sistema.</span><span class="sxs-lookup"><span data-stu-id="b4821-120">There are other <xref:System.ServiceModel.CommunicationException>-derived exceptions that are designed to be used by other parts of the system.</span></span> <span data-ttu-id="b4821-121">Questi tipi di eccezione sono elencati di seguito:</span><span class="sxs-lookup"><span data-stu-id="b4821-121">These exception types are:</span></span>  
  
|<span data-ttu-id="b4821-122">Tipo di eccezione</span><span class="sxs-lookup"><span data-stu-id="b4821-122">Exception Type</span></span>|<span data-ttu-id="b4821-123">Significato</span><span class="sxs-lookup"><span data-stu-id="b4821-123">Meaning</span></span>|<span data-ttu-id="b4821-124">Contenuto dell'eccezione interna.</span><span class="sxs-lookup"><span data-stu-id="b4821-124">Inner Exception Content</span></span>|<span data-ttu-id="b4821-125">Strategia di recupero</span><span class="sxs-lookup"><span data-stu-id="b4821-125">Recovery Strategy</span></span>|  
|--------------------|-------------|-----------------------------|-----------------------|  
|<xref:System.ServiceModel.AddressAlreadyInUseException>|<span data-ttu-id="b4821-126">L'indirizzo dell'endpoint specificato per l'ascolto è già in uso.</span><span class="sxs-lookup"><span data-stu-id="b4821-126">The endpoint address specified for listening is already in use.</span></span>|<span data-ttu-id="b4821-127">Se presente, fornisce ulteriori dettagli sull'errore del trasporto che ha provocato l'eccezione.</span><span class="sxs-lookup"><span data-stu-id="b4821-127">If present, provides more details about the transport error that caused this exception.</span></span> <span data-ttu-id="b4821-128">Ad esempio,</span><span class="sxs-lookup"><span data-stu-id="b4821-128">For example.</span></span> <span data-ttu-id="b4821-129"><xref:System.IO.PipeException>, <xref:System.Net.HttpListenerException> o <xref:System.Net.Sockets.SocketException>.</span><span class="sxs-lookup"><span data-stu-id="b4821-129"><xref:System.IO.PipeException>, <xref:System.Net.HttpListenerException>, or <xref:System.Net.Sockets.SocketException>.</span></span>|<span data-ttu-id="b4821-130">Provare un indirizzo diverso.</span><span class="sxs-lookup"><span data-stu-id="b4821-130">Try a different address.</span></span>|  
|<xref:System.ServiceModel.AddressAccessDeniedException>|<span data-ttu-id="b4821-131">Al processo non è consentito l'accesso all'indirizzo dell'endpoint specificato per l'ascolto.</span><span class="sxs-lookup"><span data-stu-id="b4821-131">The process is not allowed access to the endpoint address specified for listening.</span></span>|<span data-ttu-id="b4821-132">Se presente, fornisce ulteriori dettagli sull'errore del trasporto che ha provocato l'eccezione.</span><span class="sxs-lookup"><span data-stu-id="b4821-132">If present, provides more details about the transport error that caused this exception.</span></span> <span data-ttu-id="b4821-133">Ad esempio, <xref:System.IO.PipeException> o <xref:System.Net.HttpListenerException>.</span><span class="sxs-lookup"><span data-stu-id="b4821-133">For example, <xref:System.IO.PipeException>, or <xref:System.Net.HttpListenerException>.</span></span>|<span data-ttu-id="b4821-134">Provare con credenziali diverse.</span><span class="sxs-lookup"><span data-stu-id="b4821-134">Try with different credentials.</span></span>|  
|<xref:System.ServiceModel.CommunicationObjectFaultedException>|<span data-ttu-id="b4821-135">L'utilizzo <xref:System.ServiceModel.ICommunicationObject> si trova nello stato Faulted (per ulteriori informazioni, vedere [Understanding State Changes](understanding-state-changes.md)).</span><span class="sxs-lookup"><span data-stu-id="b4821-135">The <xref:System.ServiceModel.ICommunicationObject> being used is in the Faulted state (for more information, see [Understanding State Changes](understanding-state-changes.md)).</span></span> <span data-ttu-id="b4821-136">Si noti che quando un oggetto con più chiamate in sospeso passa allo stato Faulted, solo una chiamata genera un'eccezione riferita all'errore e il resto delle chiamate genera un'eccezione <xref:System.ServiceModel.CommunicationObjectFaultedException>.</span><span class="sxs-lookup"><span data-stu-id="b4821-136">Note that when an object with multiple pending calls transitions to the Faulted state, only one call throws an exception that is related to the failure and the rest of the calls throw a <xref:System.ServiceModel.CommunicationObjectFaultedException>.</span></span> <span data-ttu-id="b4821-137">In genere questa eccezione viene generata perché un'applicazione trascura qualche eccezione e tenta di utilizzare un oggetto già Faulted, probabilmente su un thread diverso da quello che ha rilevato l'eccezione originale.</span><span class="sxs-lookup"><span data-stu-id="b4821-137">This exception is typically thrown because an application overlooks some exception and tries to use an already faulted object, possibly on a thread other than the one that caught the original exception.</span></span>|<span data-ttu-id="b4821-138">Se presente, fornisce dettagli sull'eccezione interna.</span><span class="sxs-lookup"><span data-stu-id="b4821-138">If present provides details about the inner exception.</span></span>|<span data-ttu-id="b4821-139">Creare un nuovo oggetto.</span><span class="sxs-lookup"><span data-stu-id="b4821-139">Create a new object.</span></span> <span data-ttu-id="b4821-140">Si noti che a seconda di ciò che ha determinato in primo luogo l'errore di <xref:System.ServiceModel.ICommunicationObject>, potrebbero essere necessarie altre operazioni per la relativa correzione.</span><span class="sxs-lookup"><span data-stu-id="b4821-140">Note that depending on what caused the <xref:System.ServiceModel.ICommunicationObject> to fault in the first place, there may be other work required to recover.</span></span>|  
|<xref:System.ServiceModel.CommunicationObjectAbortedException>|<span data-ttu-id="b4821-141">L'utilizzo <xref:System.ServiceModel.ICommunicationObject> è stato interrotto (per ulteriori informazioni, vedere [Informazioni sulle modifiche dello stato](understanding-state-changes.md)).</span><span class="sxs-lookup"><span data-stu-id="b4821-141">The <xref:System.ServiceModel.ICommunicationObject> being used has been Aborted (for more information, see [Understanding State Changes](understanding-state-changes.md)).</span></span> <span data-ttu-id="b4821-142">Analogamente a <xref:System.ServiceModel.CommunicationObjectFaultedException>, questa eccezione indica che l'applicazione ha chiamato il metodo <xref:System.ServiceModel.ICommunicationObject.Abort%2A> sull'oggetto, probabilmente da un altro thread, e che l'oggetto non è più utilizzabile per questo motivo.</span><span class="sxs-lookup"><span data-stu-id="b4821-142">Similar to <xref:System.ServiceModel.CommunicationObjectFaultedException>, his exception indicates the application has called <xref:System.ServiceModel.ICommunicationObject.Abort%2A> on the object, possibly from another thread, and the object is no longer usable for that reason.</span></span>|<span data-ttu-id="b4821-143">Se presente, fornisce dettagli sull'eccezione interna.</span><span class="sxs-lookup"><span data-stu-id="b4821-143">If present provides details about the inner exception.</span></span>|<span data-ttu-id="b4821-144">Creare un nuovo oggetto.</span><span class="sxs-lookup"><span data-stu-id="b4821-144">Create a new object.</span></span> <span data-ttu-id="b4821-145">Si noti che a seconda di ciò che ha determinato in primo luogo l'interruzione di <xref:System.ServiceModel.ICommunicationObject>, potrebbero essere necessarie altre operazioni per il recupero.</span><span class="sxs-lookup"><span data-stu-id="b4821-145">Note that depending on what caused the <xref:System.ServiceModel.ICommunicationObject> to abort in the first place, there may be other work required to recover.</span></span>|  
|<xref:System.ServiceModel.EndpointNotFoundException>|<span data-ttu-id="b4821-146">L'endpoint remoto di destinazione non è in ascolto.</span><span class="sxs-lookup"><span data-stu-id="b4821-146">The target remote endpoint is not listening.</span></span> <span data-ttu-id="b4821-147">Ciò può essere dovuto a parti dell'indirizzo dell'endpoint non corrette o irresolubili oppure all'inattività dell'endpoint.</span><span class="sxs-lookup"><span data-stu-id="b4821-147">This can result from any part of the endpoint address being incorrect, irresolvable, or the endpoint being down.</span></span> <span data-ttu-id="b4821-148">Alcuni esempi sono l'errore DNS, il gestore delle code non disponibile e il servizio non in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="b4821-148">Examples include DNS error, Queue Manager not available, and service not running.</span></span>|<span data-ttu-id="b4821-149">L'eccezione interna fornisce dettagli, in genere dal trasporto sottostante.</span><span class="sxs-lookup"><span data-stu-id="b4821-149">The inner exception provides details, typically from the underlying transport.</span></span>|<span data-ttu-id="b4821-150">Provare un indirizzo diverso.</span><span class="sxs-lookup"><span data-stu-id="b4821-150">Try a different address.</span></span> <span data-ttu-id="b4821-151">In alternativa il mittente può attendere e provare di nuovo nel caso in cui il servizio non fosse attivo.</span><span class="sxs-lookup"><span data-stu-id="b4821-151">Alternatively, the sender may wait a while and try again in case the service was down</span></span>|  
|<xref:System.ServiceModel.ProtocolException>|<span data-ttu-id="b4821-152">Non esiste corrispondenza tra i protocolli di comunicazione degli endpoint, come descritto nel criterio dell'endpoint,</span><span class="sxs-lookup"><span data-stu-id="b4821-152">The communication protocols, as described by the endpoint’s policy, are mismatched between endpoints.</span></span> <span data-ttu-id="b4821-153">ad esempio mancata corrispondenza del tipo di contenuto di frame o dimensione massima del messaggio superata.</span><span class="sxs-lookup"><span data-stu-id="b4821-153">For example, framing content type mismatch or max message size exceeded.</span></span>|<span data-ttu-id="b4821-154">Se presente, fornisce ulteriori informazioni sullo specifico errore di protocollo.</span><span class="sxs-lookup"><span data-stu-id="b4821-154">If present provides more information about the specific protocol error.</span></span> <span data-ttu-id="b4821-155">Ad esempio, <xref:System.ServiceModel.QuotaExceededException> è l'eccezione interna quando la causa dell'errore supera MaxReceivedMessageSize.</span><span class="sxs-lookup"><span data-stu-id="b4821-155">For example, <xref:System.ServiceModel.QuotaExceededException> is the inner exception when the error cause is exceeding MaxReceivedMessageSize.</span></span>|<span data-ttu-id="b4821-156">Recupero: verificare che le impostazioni del protocollo del mittente e del destinatario corrispondano.</span><span class="sxs-lookup"><span data-stu-id="b4821-156">Recovery: Ensure sender and received protocol settings match.</span></span> <span data-ttu-id="b4821-157">Un modo per appurarlo consiste nel reimportare i metadati (criterio) dell'endpoint del servizio e nell'utilizzare l'associazione generata per ricreare il canale.</span><span class="sxs-lookup"><span data-stu-id="b4821-157">One way to do this is to re-import the service endpoint’s metadata (policy) and use the generated binding to recreate the channel.</span></span>|  
|<xref:System.ServiceModel.ServerTooBusyException>|<span data-ttu-id="b4821-158">L'endpoint remoto è in ascolto ma non è pronto per elaborare messaggi.</span><span class="sxs-lookup"><span data-stu-id="b4821-158">The remote endpoint is listening but is not prepared to process messages.</span></span>|<span data-ttu-id="b4821-159">Se presente, l'eccezione interna fornisce dettagli dell'errore SOAP o dell'errore a livello di trasporto.</span><span class="sxs-lookup"><span data-stu-id="b4821-159">If present, the inner Exception provides the SOAP fault or transport-level error details.</span></span>|<span data-ttu-id="b4821-160">Recupero: attendere e ripetere l'operazione in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="b4821-160">Recovery: Wait and retry the operation later.</span></span>|  
|<xref:System.TimeoutException>|<span data-ttu-id="b4821-161">L'operazione non è stata completata entro il periodo di timeout.</span><span class="sxs-lookup"><span data-stu-id="b4821-161">The operation failed to complete within the timeout period.</span></span>|<span data-ttu-id="b4821-162">Sono possibili dettagli sul timeout.</span><span class="sxs-lookup"><span data-stu-id="b4821-162">May provide details about the timeout.</span></span>|<span data-ttu-id="b4821-163">Attendere e ripetere l'operazione in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="b4821-163">Wait and retry the operation later.</span></span>|  
  
 <span data-ttu-id="b4821-164">Definire un nuovo tipo di eccezione solo se quel tipo corrisponde a una specifica strategia di recupero diversa da tutti i tipi di eccezione esistenti.</span><span class="sxs-lookup"><span data-stu-id="b4821-164">Define a new exception type only if that type corresponds to a specific recovery strategy different from all of the existing exception types.</span></span> <span data-ttu-id="b4821-165">Se si definisce un tipo di eccezione nuovo, è necessario che derivi da <xref:System.ServiceModel.CommunicationException> o da una delle classi derivate.</span><span class="sxs-lookup"><span data-stu-id="b4821-165">If you do define a new exception type, it must derive from <xref:System.ServiceModel.CommunicationException> or one of its derived classes.</span></span>  
  
### <a name="exception-messages"></a><span data-ttu-id="b4821-166">Messaggi di eccezione</span><span class="sxs-lookup"><span data-stu-id="b4821-166">Exception Messages</span></span>  
 <span data-ttu-id="b4821-167">Poiché i messaggi di eccezione sono destinati all'utente, non al programma, devono fornire informazioni sufficienti per consentire all'utente di capire il problema e risolverlo.</span><span class="sxs-lookup"><span data-stu-id="b4821-167">Exception messages are targeted at the user not the program so they should provide sufficient information to help the user understand and solve the problem.</span></span> <span data-ttu-id="b4821-168">Le tre parti essenziali di un messaggio di eccezione ben redatto sono:</span><span class="sxs-lookup"><span data-stu-id="b4821-168">The three essential parts of a good exception message are:</span></span>  
  
 <span data-ttu-id="b4821-169">L'evento che si è verificato.</span><span class="sxs-lookup"><span data-stu-id="b4821-169">What happened.</span></span> <span data-ttu-id="b4821-170">Fornire una descrizione chiara del problema utilizzando termini che rientrano nelle conoscenze dell'utente.</span><span class="sxs-lookup"><span data-stu-id="b4821-170">Provide a clear description of the problem using terms that relate to the user’s experience.</span></span> <span data-ttu-id="b4821-171">Un messaggio di eccezione errato, ad esempio, sarebbe "Sezione di configurazione non valida".</span><span class="sxs-lookup"><span data-stu-id="b4821-171">For example, a bad exception message would be "Invalid configuration section".</span></span> <span data-ttu-id="b4821-172">L'utente non avrebbe la possibilità di individuare la sezione errata della configurazione né di capire la motivazione dell'errore.</span><span class="sxs-lookup"><span data-stu-id="b4821-172">This leaves the user wondering which configuration section is incorrect and why it is incorrect.</span></span> <span data-ttu-id="b4821-173">Un messaggio migliorato sarebbe "Sezione \<di configurazione non valida customBinding>".</span><span class="sxs-lookup"><span data-stu-id="b4821-173">An improved message would be "Invalid configuration section \<customBinding>".</span></span> <span data-ttu-id="b4821-174">Una versione ancora migliore del messaggio sarebbe "Impossibile aggiungere il trasporto myTransport all'associazione myBinding perché l'associazione dispone già di un trasporto denominato myTransport".</span><span class="sxs-lookup"><span data-stu-id="b4821-174">An even better message would be "Cannot add the transport named myTransport to the binding named myBinding because the binding already has a transport named myTransport".</span></span> <span data-ttu-id="b4821-175">Si tratta di un messaggio molto specifico in cui sono utilizzati termini e nomi che l'utente può identificare facilmente nel file di configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b4821-175">This is a very specific message using terms and names that the user can easily identify in the application’s configuration file.</span></span> <span data-ttu-id="b4821-176">Alcuni componenti fondamentali, tuttavia, mancano ancora.</span><span class="sxs-lookup"><span data-stu-id="b4821-176">However, there are still a few key components missing.</span></span>  
  
 <span data-ttu-id="b4821-177">Il significato dell'errore.</span><span class="sxs-lookup"><span data-stu-id="b4821-177">The significance of the error.</span></span> <span data-ttu-id="b4821-178">A meno che il messaggio non esprima chiaramente il significato dell'errore, è probabile che l'utente si chieda se si tratta di un errore irreversibile o se può essere ignorato.</span><span class="sxs-lookup"><span data-stu-id="b4821-178">Unless the message states clearly what the error means, the user is likely to wonder whether it is a fatal error or if it can be ignored.</span></span> <span data-ttu-id="b4821-179">In genere i messaggi devono proseguire con il significato dell'errore.</span><span class="sxs-lookup"><span data-stu-id="b4821-179">In general, messages should lead with the meaning or significance of the error.</span></span> <span data-ttu-id="b4821-180">Per migliorare l'esempio precedente, il messaggio potrebbe recitare "Impossibile aprire ServiceHost a causa di un errore di configurazione: impossibile aggiungere il trasporto myTransport all'associazione myBinding perché l'associazione dispone già di un trasporto denominato myTransport".</span><span class="sxs-lookup"><span data-stu-id="b4821-180">To improve the previous example, the message could be "ServiceHost failed to Open due to a configuration error: Cannot add the transport named myTransport to the binding named myBinding because the binding already has a transport named myTransport".</span></span>  
  
 <span data-ttu-id="b4821-181">Modalità di correzione del problema da parte dell'utente.</span><span class="sxs-lookup"><span data-stu-id="b4821-181">How the user should correct the problem.</span></span> <span data-ttu-id="b4821-182">La parte più importante parte del messaggio consiste nel rendere possibile la risoluzione del problema.</span><span class="sxs-lookup"><span data-stu-id="b4821-182">The most important part of the message is helping the user fix the problem.</span></span> <span data-ttu-id="b4821-183">Il messaggio deve comprendere istruzioni o suggerimenti sugli elementi da controllare o da correggere per risolvere al problema.</span><span class="sxs-lookup"><span data-stu-id="b4821-183">The message should include some guidance or hints about what to check or fix to remedy the problem.</span></span> <span data-ttu-id="b4821-184">Ad esempio: "Impossibile aprire ServiceHost a causa di un errore di configurazione: impossibile aggiungere il trasporto myTransport all'associazione myBinding perché l'associazione dispone già di un trasporto denominato myTransport.</span><span class="sxs-lookup"><span data-stu-id="b4821-184">For example, "ServiceHost failed to Open due to a configuration error: Cannot add the transport named myTransport to the binding named myBinding because the binding already has a transport named myTransport.</span></span> <span data-ttu-id="b4821-185">Verificare che nell'associazione esista solo un trasporto".</span><span class="sxs-lookup"><span data-stu-id="b4821-185">Please ensure there is only one transport in the binding".</span></span>  
  
## <a name="communicating-faults"></a><span data-ttu-id="b4821-186">Comunicazione di errori</span><span class="sxs-lookup"><span data-stu-id="b4821-186">Communicating Faults</span></span>  
 <span data-ttu-id="b4821-187">SOAP 1.1 e SOAP 1.2 definiscono entrambi una struttura specifica per gli errori.</span><span class="sxs-lookup"><span data-stu-id="b4821-187">SOAP 1.1 and SOAP 1.2 both define a specific structure for faults.</span></span> <span data-ttu-id="b4821-188">Vi sono alcune differenze tra le due specifiche ma in genere i tipi Message e MessageFault vengono utilizzati per creare e utilizzare errori.</span><span class="sxs-lookup"><span data-stu-id="b4821-188">There are some differences between the two specifications but in general, the Message and MessageFault types are used to create and consume faults.</span></span>  
  
 <span data-ttu-id="b4821-189">![Gestione di eccezioni ed errori](./media/wcfc-soap1-1andsoap1-2faultcomparisonc.gif "wcfc_SOAP1-1AndSOAP1-2FaultComparisonc")</span><span class="sxs-lookup"><span data-stu-id="b4821-189">![Handling exceptions and faults](./media/wcfc-soap1-1andsoap1-2faultcomparisonc.gif "wcfc_SOAP1-1AndSOAP1-2FaultComparisonc")</span></span>  
<span data-ttu-id="b4821-190">Errore SOAP 1.2 (sinistra) ed errore SOAP 1.1 (destra).</span><span class="sxs-lookup"><span data-stu-id="b4821-190">SOAP 1.2 Fault (left) and SOAP 1.1 Fault (right).</span></span> <span data-ttu-id="b4821-191">Si noti che in SOAP 1.1 solo l'elemento Fault è qualificato con lo spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="b4821-191">Note that in SOAP 1.1 only the Fault element is namespace qualified.</span></span>  
  
 <span data-ttu-id="b4821-192">In SOAP un messaggio di errore viene definito come messaggio contenente solo un elemento Fault (un elemento denominato `<env:Fault>`.</span><span class="sxs-lookup"><span data-stu-id="b4821-192">SOAP defines a fault message as a message that contains only a fault element (an element whose name is `<env:Fault>`) as a child of `<env:Body>`.</span></span> <span data-ttu-id="b4821-193">Il contenuto dell'elemento errore differisce leggermente SOAP 1.1 e SOAP 1.2, come mostrato in Figura 1.</span><span class="sxs-lookup"><span data-stu-id="b4821-193">The contents of the fault element differ slightly between SOAP 1.1 and SOAP 1.2 as shown in figure 1.</span></span> <span data-ttu-id="b4821-194">Tuttavia, la classe <xref:System.ServiceModel.Channels.MessageFault?displayProperty=nameWithType> normalizza queste differenze in un unico modello a oggetti:</span><span class="sxs-lookup"><span data-stu-id="b4821-194">However, the <xref:System.ServiceModel.Channels.MessageFault?displayProperty=nameWithType> class normalizes these differences into one object model:</span></span>  
  
```csharp
public abstract class MessageFault  
{  
    protected MessageFault();  
  
    public virtual string Actor { get; }  
    public virtual string Node { get; }  
    public static string DefaultAction { get; }  
    public abstract FaultCode Code { get; }  
    public abstract bool HasDetail { get; }  
    public abstract FaultReason Reason { get; }  
  
    public T GetDetail<T>();  
    public T GetDetail<T>( XmlObjectSerializer serializer);  
    public System.Xml.XmlDictionaryReader GetReaderAtDetailContents();  
  
    // other methods omitted  
}  
```  
  
 <span data-ttu-id="b4821-195">La proprietà `Code` corrisponde a `env:Code` (o `faultCode` in SOAP 1.1) e identifica il tipo di errore.</span><span class="sxs-lookup"><span data-stu-id="b4821-195">The `Code` property corresponds to the `env:Code` (or `faultCode` in SOAP 1.1) and identifies the type of the fault.</span></span> <span data-ttu-id="b4821-196">In SOAP 1.2 sono definiti cinque valori consentiti per `faultCode` (ad esempio Sender e Receiver) ed è definito un elemento `Subcode` contenente qualsiasi valore del codice secondario.</span><span class="sxs-lookup"><span data-stu-id="b4821-196">SOAP 1.2 defines five allowable values for `faultCode` (for example, Sender and Receiver) and defines a `Subcode` element which can contain any subcode value.</span></span> <span data-ttu-id="b4821-197">(Vedere la [specifica SOAP 1.2](https://www.w3.org/TR/soap12-part1/#tabsoapfaultcodes) per l'elenco dei codici di errore consentiti e il relativo significato.) SOAP 1.1 ha un meccanismo leggermente diverso: definisce quattro `faultCode` valori (ad esempio, Client e Server) che possono essere `faultCodes`estesi definendo quelli completamente nuovi o utilizzando la notazione del punto per creare più specifici, ad esempio Client.Authentication.</span><span class="sxs-lookup"><span data-stu-id="b4821-197">(See the [SOAP 1.2 specification](https://www.w3.org/TR/soap12-part1/#tabsoapfaultcodes) for the list of allowable fault codes and their meaning.) SOAP 1.1 has a slightly different mechanism: It defines four `faultCode` values (for example, Client and Server) that can be extended either by defining entirely new ones or by using the dot notation to create more specific `faultCodes`, for example, Client.Authentication.</span></span>  
  
 <span data-ttu-id="b4821-198">Quando si utilizza MessageFault per programmare errori, FaultCode.Name e FaultCode.Namespace eseguono il mapping al nome e allo spazio dei nomi di `env:Code` SOAP 1.2 o di `faultCode` SOAP 1.1.</span><span class="sxs-lookup"><span data-stu-id="b4821-198">When you use MessageFault to program faults, the FaultCode.Name and FaultCode.Namespace maps to the name and namespace of the SOAP 1.2 `env:Code` or the SOAP 1.1 `faultCode`.</span></span> <span data-ttu-id="b4821-199">FaultCode.SubCode è associato a `env:Subcode` per SOAP 1.2 ed è null per SOAP 1.1.</span><span class="sxs-lookup"><span data-stu-id="b4821-199">The FaultCode.SubCode maps to `env:Subcode` for SOAP 1.2 and is null for SOAP 1.1.</span></span>  
  
 <span data-ttu-id="b4821-200">È necessario creare nuovi codici secondari di errore (o nuovi codici di errore se si utilizza SOAP 1.1) se è utile distinguere un errore a livello di programmazione.</span><span class="sxs-lookup"><span data-stu-id="b4821-200">You should create new fault subcodes (or new fault codes if using SOAP 1.1) if it is interesting to programmatically distinguish a fault.</span></span> <span data-ttu-id="b4821-201">Ciò ha valore analogo alla creazione di un nuovo tipo di eccezione.</span><span class="sxs-lookup"><span data-stu-id="b4821-201">This is analogous to creating a new exception type.</span></span> <span data-ttu-id="b4821-202">È consigliabile evitare di utilizzare la notazione del punto con i codici di errore SOAP 1.1.</span><span class="sxs-lookup"><span data-stu-id="b4821-202">You should avoid using the dot notation with SOAP 1.1 fault codes.</span></span> <span data-ttu-id="b4821-203">(Il [profilo di base WS-I](http://www.ws-i.org/Profiles/BasicProfile-1.1-2004-08-24.html#SOAP_Custom_Fault_Codes) scoraggia anche l'uso della notazione punto codice di errore.)</span><span class="sxs-lookup"><span data-stu-id="b4821-203">(The [WS-I Basic Profile](http://www.ws-i.org/Profiles/BasicProfile-1.1-2004-08-24.html#SOAP_Custom_Fault_Codes) also discourages the use of the fault code dot notation.)</span></span>  
  
```csharp
public class FaultCode  
{  
    public FaultCode(string name);  
    public FaultCode(string name, FaultCode subCode);  
    public FaultCode(string name, string ns);  
    public FaultCode(string name, string ns, FaultCode subCode);  
  
    public bool IsPredefinedFault { get; }  
    public bool IsReceiverFault { get; }  
    public bool IsSenderFault { get; }  
    public string Name { get; }  
    public string Namespace { get; }  
    public FaultCode SubCode { get; }  
  
//  methods omitted  
  
}  
```  
  
 <span data-ttu-id="b4821-204">La proprietà `Reason` corrisponde a `env:Reason` (o `faultString` in SOAP 1.1), una descrizione intelligibile della condizione di errore analoga a un messaggio di eccezione.</span><span class="sxs-lookup"><span data-stu-id="b4821-204">The `Reason` property corresponds to the `env:Reason` (or `faultString` in SOAP 1.1) a human-readable description of the error condition analogous to an exception’s message.</span></span> <span data-ttu-id="b4821-205">La classe `FaultReason` (e `env:Reason/faultString` SOAP) incorpora il supporto delle conversioni multiple nell'interesse della globalizzazione.</span><span class="sxs-lookup"><span data-stu-id="b4821-205">The `FaultReason` class (and SOAP `env:Reason/faultString`) has built-in support for having multiple translations in the interest of globalization.</span></span>  
  
```csharp
public class FaultReason  
{  
    public FaultReason(FaultReasonText translation);  
    public FaultReason(IEnumerable<FaultReasonText> translations);  
    public FaultReason(string text);  
  
    public SynchronizedReadOnlyCollection<FaultReasonText> Translations
    {
       get;
    }  
  
 }  
```  
  
 <span data-ttu-id="b4821-206">Il contenuto dei dettagli dell'errore `GetDetail` \<viene esposto `GetReaderAtDetailContents`su MessageFault usando vari metodi, tra cui T> e ().</span><span class="sxs-lookup"><span data-stu-id="b4821-206">The fault detail contents are exposed on MessageFault using various methods including the `GetDetail`\<T> and `GetReaderAtDetailContents`().</span></span> <span data-ttu-id="b4821-207">Il dettaglio dell'errore è un elemento opaco per trasferire ulteriori informazioni sull'errore.</span><span class="sxs-lookup"><span data-stu-id="b4821-207">The fault detail is an opaque element for carrying additional detail about the fault.</span></span> <span data-ttu-id="b4821-208">È utile in presenza di dettagli strutturati arbitrari che si desidera trasferire con l'errore.</span><span class="sxs-lookup"><span data-stu-id="b4821-208">This is useful if there is some arbitrary structured detail that you want to carry with the fault.</span></span>  
  
### <a name="generating-faults"></a><span data-ttu-id="b4821-209">Generazione di errori</span><span class="sxs-lookup"><span data-stu-id="b4821-209">Generating Faults</span></span>  
 <span data-ttu-id="b4821-210">Contenuto della sezione viene spiegato il processo di generazione di un messaggio di errore in risposta a una condizione di errore rilevata in un canale o in una proprietà di messaggio creata dal canale.</span><span class="sxs-lookup"><span data-stu-id="b4821-210">This section explains the process of generating a fault in response to an error condition detected in a channel or in a message property created by the channel.</span></span> <span data-ttu-id="b4821-211">Un esempio tipico è la restituzione di un errore in risposta a un messaggio di richiesta contenente dati non validi.</span><span class="sxs-lookup"><span data-stu-id="b4821-211">A typical example is sending back a fault in response to a request message that contains invalid data.</span></span>  
  
 <span data-ttu-id="b4821-212">Nel caso della generazione di un errore, è preferibile che il canale personalizzato non invii l'errore direttamente bensì generi un'eccezione e lasci al livello superiore la decisione di convertire l'eccezione in errore e la scelta della modalità di invio.</span><span class="sxs-lookup"><span data-stu-id="b4821-212">When generating a fault, the custom channel should not send the fault directly, rather, it should throw an exception and let the layer above decide whether to convert that exception to a fault and how to send it.</span></span> <span data-ttu-id="b4821-213">Per favorire questa conversione, è opportuno che il canale fornisca un'implementazione di `FaultConverter` in grado di convertire l'eccezione generata dal canale personalizzato nell'errore appropriato.</span><span class="sxs-lookup"><span data-stu-id="b4821-213">To aid in this conversion, the channel should provide a `FaultConverter` implementation that can convert the exception thrown by the custom channel to the appropriate fault.</span></span> <span data-ttu-id="b4821-214">L'oggetto `FaultConverter` viene definito come:</span><span class="sxs-lookup"><span data-stu-id="b4821-214">`FaultConverter` is defined as:</span></span>  
  
```csharp
public class FaultConverter  
{  
    public static FaultConverter GetDefaultFaultConverter(  
                                   MessageVersion version);  
    protected abstract bool OnTryCreateFaultMessage(  
                                   Exception exception,
                                   out Message message);  
    public bool TryCreateFaultMessage(  
                                   Exception exception,
                                   out Message message);  
}  
```  
  
 <span data-ttu-id="b4821-215">Ogni canale che genera errori personalizzati deve implementare `FaultConverter` e restituirlo da una chiamata a `GetProperty<FaultConverter>`.</span><span class="sxs-lookup"><span data-stu-id="b4821-215">Each channel that generates custom faults must implement `FaultConverter` and return it from a call to `GetProperty<FaultConverter>`.</span></span> <span data-ttu-id="b4821-216">L'implementazione personalizzata di `OnTryCreateFaultMessage` deve convertire l'eccezione in un errore o delegare all'elemento `FaultConverter` del canale interno.</span><span class="sxs-lookup"><span data-stu-id="b4821-216">The custom `OnTryCreateFaultMessage` implementation must either convert the exception to a fault or delegate to the inner channel’s `FaultConverter`.</span></span> <span data-ttu-id="b4821-217">Se il canale è un trasporto, deve convertire l'eccezione o il delegato nel codificatore `FaultConverter` o nel valore predefinito `FaultConverter` fornito in WCF.</span><span class="sxs-lookup"><span data-stu-id="b4821-217">If the channel is a transport it must either convert the exception or delegate to the encoder’s `FaultConverter` or the default `FaultConverter` provided in WCF .</span></span> <span data-ttu-id="b4821-218">`FaultConverter` predefinito converte errori corrispondenti ai messaggi di errore specificati da WS-Addressing e SOAP.</span><span class="sxs-lookup"><span data-stu-id="b4821-218">The default `FaultConverter` converts errors corresponding to fault messages specified by WS-Addressing and SOAP.</span></span> <span data-ttu-id="b4821-219">Di seguito è illustrata un'implementazione di `OnTryCreateFaultMessage` di esempio:</span><span class="sxs-lookup"><span data-stu-id="b4821-219">Here is an example `OnTryCreateFaultMessage` implementation.</span></span>  
  
```csharp
public override bool OnTryCreateFaultMessage(Exception exception,
                                             out Message message)  
{  
    if (exception is ...)  
    {  
        message = ...;  
        return true;  
    }  
  
#if IMPLEMENTING_TRANSPORT_CHANNEL  
    FaultConverter encoderConverter =
                    this.encoder.GetProperty<FaultConverter>();  
    if ((encoderConverter != null) &&
        (encoderConverter.TryCreateFaultMessage(  
         exception, out message)))  
    {  
        return true;  
    }  
  
    FaultConverter defaultConverter =
                   FaultConverter.GetDefaultFaultConverter(  
                   this.channel.messageVersion);  
    return defaultConverter.TryCreateFaultMessage(  
                   exception,
                   out message);  
#else  
    FaultConverter inner =
                   this.innerChannel.GetProperty<FaultConverter>();  
    if (inner != null)  
    {  
        return inner.TryCreateFaultMessage(exception, out message);  
    }  
    else  
    {  
        message = null;  
        return false;  
    }  
#endif  
}  
```  
  
 <span data-ttu-id="b4821-220">Un'implicazione di questo modello consiste nel fatto che le eccezioni generate tra livelli per condizioni di errore che richiedono messaggi di errore devono contenere informazioni sufficienti affinché il generatore dell'errore corrispondente crei il messaggio di errore corretto.</span><span class="sxs-lookup"><span data-stu-id="b4821-220">An implication of this pattern is that exceptions thrown between layers for error conditions that require faults must contain enough information for the corresponding fault generator to create the correct fault.</span></span> <span data-ttu-id="b4821-221">Gli autori di canali personalizzati possono definire tipi di eccezione che corrispondono a condizioni di errore diverse se tali eccezioni non esistono già.</span><span class="sxs-lookup"><span data-stu-id="b4821-221">As a custom channel author, you may define exception types that correspond to different fault conditions if such exceptions do not already exist.</span></span> <span data-ttu-id="b4821-222">Si noti che le eccezioni che attraversano i livelli di canale devono comunicare la condizione di errore anziché dati di errore opachi.</span><span class="sxs-lookup"><span data-stu-id="b4821-222">Note that exceptions traversing channel layers should communicate the error condition rather than opaque fault data.</span></span>  
  
### <a name="fault-categories"></a><span data-ttu-id="b4821-223">Categorie di errore</span><span class="sxs-lookup"><span data-stu-id="b4821-223">Fault Categories</span></span>  
 <span data-ttu-id="b4821-224">In genere le categorie di errore sono tre:</span><span class="sxs-lookup"><span data-stu-id="b4821-224">There are generally three categories of faults:</span></span>  
  
1. <span data-ttu-id="b4821-225">Errori penetranti in tutto lo stack.</span><span class="sxs-lookup"><span data-stu-id="b4821-225">Faults that are pervasive throughout the entire stack.</span></span> <span data-ttu-id="b4821-226">È possibile riscontrarli a qualsiasi livello dello stack di canali, ad esempio InvalidCardinalityAddressingException.</span><span class="sxs-lookup"><span data-stu-id="b4821-226">These faults could be encountered at any layer in the channel stack, for example InvalidCardinalityAddressingException.</span></span>  
  
2. <span data-ttu-id="b4821-227">Errori che possono essere riscontrati ovunque al di sopra di un certo livello dello stack, ad esempio errori relativi a una transazione propagata o a ruoli di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="b4821-227">Faults that can be encountered anywhere above a certain layer in the stack for example some errors that pertain to a flowed transaction or to security roles.</span></span>  
  
3. <span data-ttu-id="b4821-228">Errori diretti a un unico livello dello stack, ad esempio errori di numeri di sequenza WS-RM.</span><span class="sxs-lookup"><span data-stu-id="b4821-228">Faults that are directed at a single layer in the stack, for example errors like WS-RM sequence number faults.</span></span>  
  
 <span data-ttu-id="b4821-229">Categoria 1.</span><span class="sxs-lookup"><span data-stu-id="b4821-229">Category 1.</span></span> <span data-ttu-id="b4821-230">Gli errori sono in genere WS-Addressing e SOAP.</span><span class="sxs-lookup"><span data-stu-id="b4821-230">Faults are generally WS-Addressing and SOAP faults.</span></span> <span data-ttu-id="b4821-231">La `FaultConverter` classe base fornita da WCF converte gli errori corrispondenti ai messaggi di errore specificati da WS-Addressing e SOAP in modo che non sia necessario gestire manualmente la conversione di queste eccezioni.</span><span class="sxs-lookup"><span data-stu-id="b4821-231">The base `FaultConverter` class provided by WCF converts errors corresponding to fault messages specified by WS-Addressing and SOAP so you do not have to handle conversion of these exceptions yourself.</span></span>  
  
 <span data-ttu-id="b4821-232">Categoria 2.</span><span class="sxs-lookup"><span data-stu-id="b4821-232">Category 2.</span></span> <span data-ttu-id="b4821-233">Gli errori si verificano quando un livello aggiunge una proprietà al messaggio che non utilizza completamente le informazioni del messaggio relative a tale livello.</span><span class="sxs-lookup"><span data-stu-id="b4821-233">Faults occur when a layer adds a property to the message that does not completely consume message information that pertains to that layer.</span></span> <span data-ttu-id="b4821-234">Gli errori possono essere rilevati in un secondo momento quando un livello più elevato chiede alla proprietà del messaggio di elaborare ulteriormente le informazioni del messaggio.</span><span class="sxs-lookup"><span data-stu-id="b4821-234">Errors may be detected later when a higher layer asks the message property to process message information further.</span></span> <span data-ttu-id="b4821-235">È consigliabile che tali canali implementino la `GetProperty` specificata in precedenza per consentire al livello più elevato di restituire l'errore corretto.</span><span class="sxs-lookup"><span data-stu-id="b4821-235">Such channels should implement the `GetProperty` specified previously to enable the higher layer to send back the correct fault.</span></span> <span data-ttu-id="b4821-236">Ne è un esempio la TransactionMessageProperty.</span><span class="sxs-lookup"><span data-stu-id="b4821-236">An example of this is the TransactionMessageProperty.</span></span> <span data-ttu-id="b4821-237">Questa proprietà viene aggiunta al messaggio senza convalidare completamente tutti i dati dell'intestazione: una tale operazione potrebbe richiedere la necessità di contattare il DTC (Distributed Transaction Coordinator).</span><span class="sxs-lookup"><span data-stu-id="b4821-237">This property is added to the message without fully validating all the data in the header (doing so may involve contacting the distributed transaction coordinator (DTC).</span></span>  
  
 <span data-ttu-id="b4821-238">Categoria 3.</span><span class="sxs-lookup"><span data-stu-id="b4821-238">Category 3.</span></span> <span data-ttu-id="b4821-239">Gli errori vengono generati e inviati solo da un singolo livello all'interno del processore.</span><span class="sxs-lookup"><span data-stu-id="b4821-239">Faults are only generated and sent by a single layer in the processor.</span></span> <span data-ttu-id="b4821-240">Pertanto tutte le eccezioni sono contenute all'interno del livello.</span><span class="sxs-lookup"><span data-stu-id="b4821-240">Therefore all the exceptions are contained within the layer.</span></span> <span data-ttu-id="b4821-241">Per migliorare la coerenza fra i canali e semplificare la manutenzione, il canale personalizzato deve utilizzare il modello specificato in precedenza per generare messaggi di errore anche per errori interni.</span><span class="sxs-lookup"><span data-stu-id="b4821-241">To improve consistency among channels and ease maintenance, your custom channel should use the pattern specified previously to generate fault messages even for internal faults.</span></span>  
  
### <a name="interpreting-received-faults"></a><span data-ttu-id="b4821-242">Interpretazione degli errori ricevuti</span><span class="sxs-lookup"><span data-stu-id="b4821-242">Interpreting Received Faults</span></span>  
 <span data-ttu-id="b4821-243">Contenuto della sezione vengono fornite linee guida per la generazione dell'eccezione adatta in caso di ricezione di un messaggio di errore.</span><span class="sxs-lookup"><span data-stu-id="b4821-243">This section provides guidance for generating the appropriate exception when receiving a fault message.</span></span> <span data-ttu-id="b4821-244">L'albero delle decisioni per l'elaborazione di un messaggio a ogni livello dello stack è illustrata di seguito:</span><span class="sxs-lookup"><span data-stu-id="b4821-244">The decision tree for processing a message at every layer in the stack is as follows:</span></span>  
  
1. <span data-ttu-id="b4821-245">Se il livello ritiene il messaggio non valido, deve eseguire la propria elaborazione di 'messaggio non valido'.</span><span class="sxs-lookup"><span data-stu-id="b4821-245">If the layer considers the message to be invalid, the layer should do its ‘invalid message’ processing.</span></span> <span data-ttu-id="b4821-246">Si tratta di un'elaborazione specifica del livello che potrebbe però comprendere il rilascio del messaggio, la traccia o la generazione di un'eccezione che viene convertita in errore.</span><span class="sxs-lookup"><span data-stu-id="b4821-246">Such processing is specific to the layer but could include dropping the message, tracing, or throwing an exception that gets converted to a fault.</span></span> <span data-ttu-id="b4821-247">Ne sono esempi il sistema di sicurezza che riceve un messaggio protetto in modo inadeguato o RM che riceve un messaggio con un numero di sequenza errato.</span><span class="sxs-lookup"><span data-stu-id="b4821-247">Examples include security receiving a message that is not secured properly, or RM receiving a message with a bad sequence number.</span></span>  
  
2. <span data-ttu-id="b4821-248">In caso contrario, se il messaggio è un messaggio di errore specifico del livello e non è significativo al di fuori dell'interazione del livello, il livello deve gestire la condizione di errore.</span><span class="sxs-lookup"><span data-stu-id="b4821-248">Otherwise, if the message is a fault message that applies specifically to the layer, and the message is not meaningful outside the layer’s interaction, the layer should handle the error condition.</span></span> <span data-ttu-id="b4821-249">Ne è un esempio un errore RM di sequenza rifiutata, errore non significativo per i livelli superiori al canale RM e tale da determinare l'errore del canale RM e la generazione di eccezioni dalle operazioni in sospeso.</span><span class="sxs-lookup"><span data-stu-id="b4821-249">An example of this is an RM Sequence Refused fault that is meaningless to layers above the RM channel and that implies faulting the RM channel and throwing from pending operations.</span></span>  
  
3. <span data-ttu-id="b4821-250">In caso contrario, il messaggio deve essere restituito da Request() o Receive().</span><span class="sxs-lookup"><span data-stu-id="b4821-250">Otherwise, the message should be returned from Request() or Receive().</span></span> <span data-ttu-id="b4821-251">Sono compresi i casi in cui il livello riconosce l'errore ma l'errore si limita a indicare che una richiesta non è stata soddisfatta correttamente senza lasciare intendere che l'errore riguarda il canale e che è necessario generare eccezioni dalle operazioni in sospeso.</span><span class="sxs-lookup"><span data-stu-id="b4821-251">This includes cases where the layer recognizes the fault, but the fault just indicates that a request failed and does not imply faulting the channel and throwing from pending operations.</span></span> <span data-ttu-id="b4821-252">Per migliorare l'usabilità in un caso simile, il livello deve implementare `GetProperty<FaultConverter>``FaultConverter` e restituire una classe derivata di `OnTryCreateException` in grado di convertire l'errore in un'eccezione eseguendo l'override di .</span><span class="sxs-lookup"><span data-stu-id="b4821-252">To improve usability in such a case, the layer should implement `GetProperty<FaultConverter>` and return a `FaultConverter` derived class that can convert the fault to an exception by overriding `OnTryCreateException`.</span></span>  
  
 <span data-ttu-id="b4821-253">Il modello a oggetti seguente supporta la conversione dei messaggi in eccezioni:</span><span class="sxs-lookup"><span data-stu-id="b4821-253">The following object model supports converting messages to exceptions:</span></span>  
  
```csharp
public class FaultConverter  
{  
    public static FaultConverter GetDefaultFaultConverter(  
                                  MessageVersion version);  
    protected abstract bool OnTryCreateException(  
                                 Message message,
                                 MessageFault fault,
                                 out Exception exception);  
    public bool TryCreateException(  
                                 Message message,
                                 MessageFault fault,
                                 out Exception exception);  
}  
```  
  
 <span data-ttu-id="b4821-254">Un livello di canale può implementare `GetProperty<FaultConverter>` per supportare la conversione dei messaggi di errore in eccezioni.</span><span class="sxs-lookup"><span data-stu-id="b4821-254">A channel layer can implement `GetProperty<FaultConverter>` to support converting fault messages to exceptions.</span></span> <span data-ttu-id="b4821-255">A tale scopo, eseguire l'override di `OnTryCreateException` e controllare il messaggio di errore.</span><span class="sxs-lookup"><span data-stu-id="b4821-255">To do so, override `OnTryCreateException` and inspect the fault message.</span></span> <span data-ttu-id="b4821-256">Se riconosciuto, eseguire la conversione, in caso contrario chiedere al canale interno di convertirlo.</span><span class="sxs-lookup"><span data-stu-id="b4821-256">If recognized, do the conversion, otherwise ask the inner channel to convert it.</span></span> <span data-ttu-id="b4821-257">È consigliabile che i canali del trasporto deleghino a `FaultConverter.GetDefaultFaultConverter` di ottenere il FaultConverter SOAP/WS-Addressing predefinito.</span><span class="sxs-lookup"><span data-stu-id="b4821-257">Transport channels should delegate to `FaultConverter.GetDefaultFaultConverter` to get the default SOAP/WS-Addressing FaultConverter.</span></span>  
  
 <span data-ttu-id="b4821-258">Un'implementazione tipica si presenta come segue:</span><span class="sxs-lookup"><span data-stu-id="b4821-258">A typical implementation looks like this:</span></span>  
  
```csharp
public override bool OnTryCreateException(  
                            Message message,
                            MessageFault fault,
                            out Exception exception)  
{  
    if (message.Action == "...")  
    {  
        exception = ...;  
        return true;  
    }  
    // OR  
    if ((fault.Code.Name == "...") && (fault.Code.Namespace == "..."))  
    {  
        exception = ...;  
        return true;  
    }  
  
    if (fault.IsMustUnderstand)  
    {  
        if (fault.WasHeaderNotUnderstood(  
                   message.Headers, "...", "..."))  
        {  
            exception = new ProtocolException(...);  
            return true;  
        }  
    }  
  
#if IMPLEMENTING_TRANSPORT_CHANNEL  
    FaultConverter encoderConverter =
              this.encoder.GetProperty<FaultConverter>();  
    if ((encoderConverter != null) &&
        (encoderConverter.TryCreateException(  
                              message, fault, out exception)))  
    {  
        return true;  
    }  
  
    FaultConverter defaultConverter =  
             FaultConverter.GetDefaultFaultConverter(  
                             this.channel.messageVersion);  
    return defaultConverter.TryCreateException(  
                             message, fault, out exception);  
#else  
    FaultConverter inner =
                    this.innerChannel.GetProperty<FaultConverter>();  
    if (inner != null)  
    {  
        return inner.TryCreateException(message, fault, out exception);  
    }  
    else  
    {  
        exception = null;  
        return false;  
    }  
#endif  
}  
```  
  
 <span data-ttu-id="b4821-259">Per condizioni di errore specifiche con scenari di recupero distinti, prendere in considerazione la definizione di una classe derivata di `ProtocolException`.</span><span class="sxs-lookup"><span data-stu-id="b4821-259">For specific fault conditions that have distinct recovery scenarios, consider defining a derived class of `ProtocolException`.</span></span>  
  
### <a name="mustunderstand-processing"></a><span data-ttu-id="b4821-260">Elaborazione MustUnderstand</span><span class="sxs-lookup"><span data-stu-id="b4821-260">MustUnderstand Processing</span></span>  
 <span data-ttu-id="b4821-261">SOAP definisce un errore generale per segnalare che un'intestazione obbligatoria non è stata capita dal ricevitore.</span><span class="sxs-lookup"><span data-stu-id="b4821-261">SOAP defines a general fault for signaling that a required header was not understood by the receiver.</span></span> <span data-ttu-id="b4821-262">Questo errore è noto come errore `mustUnderstand`.</span><span class="sxs-lookup"><span data-stu-id="b4821-262">This fault is known as the `mustUnderstand` fault.</span></span> <span data-ttu-id="b4821-263">In WCF, i `mustUnderstand` canali personalizzati non generano mai errori.</span><span class="sxs-lookup"><span data-stu-id="b4821-263">In WCF, custom channels never generate `mustUnderstand` faults.</span></span> <span data-ttu-id="b4821-264">Al contrario, il Dispatcher WCF, che si trova nella parte superiore dello stack di comunicazione WCF, controlla che tutte le intestazioni che sono state contrassegnate come MustUnderstand-true sono stati compresi dallo stack sottostante.</span><span class="sxs-lookup"><span data-stu-id="b4821-264">Instead, the WCF Dispatcher, which is located at the top of the WCF communication stack, checks to see that all headers that were marked as MustUnderstand=true were understood by the underlying stack.</span></span> <span data-ttu-id="b4821-265">In caso contrario, viene generato un errore `mustUnderstand`.</span><span class="sxs-lookup"><span data-stu-id="b4821-265">If any were not understood, a `mustUnderstand` fault is generated at that point.</span></span> <span data-ttu-id="b4821-266">L'utente ha la possibilità di disattivare, se lo desidera, questa elaborazione `mustUnderstand` e di fare in modo che l'applicazione riceva tutte le intestazioni del messaggio.</span><span class="sxs-lookup"><span data-stu-id="b4821-266">(The user can choose to turn off this `mustUnderstand` processing and have the application receive all message headers.</span></span> <span data-ttu-id="b4821-267">In tal caso l'applicazione `mustUnderstand` è responsabile dell'esecuzione dell'elaborazione.) L'errore generato include un'intestazione NotUnderstood che contiene i nomi di tutte le intestazioni con MustUnderstand: true che non sono state comprese.</span><span class="sxs-lookup"><span data-stu-id="b4821-267">In that case the application is responsible for performing `mustUnderstand` processing.) The generated fault includes a NotUnderstood header that contains the names of all headers with MustUnderstand=true that were not understood.</span></span>  
  
 <span data-ttu-id="b4821-268">Se il canale del protocollo invia un'intestazione personalizzata con MustUnderstand=true e riceve un errore `mustUnderstand`, deve appurare se l'errore è dovuto all'intestazione inviata.</span><span class="sxs-lookup"><span data-stu-id="b4821-268">If your protocol channel sends a custom header with MustUnderstand=true and receives a `mustUnderstand` fault, it must figure out whether that fault is due to the header it sent.</span></span> <span data-ttu-id="b4821-269">A questo scopo tornano utili due membri nella classe `MessageFault`:</span><span class="sxs-lookup"><span data-stu-id="b4821-269">There are two members on the `MessageFault` class that are useful for this:</span></span>  
  
```csharp
public class MessageFault  
{  
    ...  
    public bool IsMustUnderstandFault { get; }  
    public static bool WasHeaderNotUnderstood(MessageHeaders headers,
        string name, string ns) { }  
    ...  
  
}  
```  
  
 <span data-ttu-id="b4821-270">`IsMustUnderstandFault` restituisce `true` se l'errore è un errore `mustUnderstand`.</span><span class="sxs-lookup"><span data-stu-id="b4821-270">`IsMustUnderstandFault` returns `true` if the fault is a `mustUnderstand` fault.</span></span> <span data-ttu-id="b4821-271">`WasHeaderNotUnderstood` restituisce `true` se l'intestazione con il nome e lo spazio dei nomi specificati è inclusa nell'errore come intestazione NotUnderstood.</span><span class="sxs-lookup"><span data-stu-id="b4821-271">`WasHeaderNotUnderstood` returns `true` if the header with the specified name and namespace is included in the fault as a NotUnderstood header.</span></span>  <span data-ttu-id="b4821-272">In caso contrario, viene restituito `false`.</span><span class="sxs-lookup"><span data-stu-id="b4821-272">Otherwise, it returns `false`.</span></span>  
  
 <span data-ttu-id="b4821-273">Se un canale genera un'intestazione contrassegnata con MustUnderstand = true, tale livello deve inoltre implementare il modello API di generazione delle eccezioni e convertire gli errori `mustUnderstand` causati da tale intestazione in un'eccezione più utile, come descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="b4821-273">If a channel emits a header that is marked MustUnderstand = true, then that layer should also implement the Exception Generation API pattern and should convert `mustUnderstand` faults caused by that header to a more useful exception as described previously.</span></span>  
  
## <a name="tracing"></a><span data-ttu-id="b4821-274">Traccia</span><span class="sxs-lookup"><span data-stu-id="b4821-274">Tracing</span></span>  
 <span data-ttu-id="b4821-275">In .NET Framework è disponibile un meccanismo per tenere traccia dell'esecuzione del programma che facilita la diagnosi delle applicazioni di produzione o di problemi intermittenti laddove non è possibile allegare semplicemente un debugger ed eseguire il codice.</span><span class="sxs-lookup"><span data-stu-id="b4821-275">The .NET Framework provides a mechanism to trace program execution as a way to aid diagnosing production applications or intermittent problems where it is not possible to just attach a debugger and step through the code.</span></span> <span data-ttu-id="b4821-276">I componenti principali di questo meccanismo si trovano nello spazio dei nomi <xref:System.Diagnostics?displayProperty=nameWithType> e consistono in:</span><span class="sxs-lookup"><span data-stu-id="b4821-276">The core components of this mechanism are in the <xref:System.Diagnostics?displayProperty=nameWithType> namespace and consist of:</span></span>  
  
- <span data-ttu-id="b4821-277"><xref:System.Diagnostics.TraceSource?displayProperty=nameWithType>, origine delle informazioni di traccia da scrivere, <xref:System.Diagnostics.TraceListener?displayProperty=nameWithType>, classe di base astratta per listener concreti che ricevono le informazioni da tracciare da <xref:System.Diagnostics.TraceSource> e le restituiscono a una destinazione specifica del listener.</span><span class="sxs-lookup"><span data-stu-id="b4821-277"><xref:System.Diagnostics.TraceSource?displayProperty=nameWithType>, which is the source of trace information to be written, <xref:System.Diagnostics.TraceListener?displayProperty=nameWithType>, which is an abstract base class for concrete listeners that receive the information to be traced from the <xref:System.Diagnostics.TraceSource> and output it to a listener-specific destination.</span></span> <span data-ttu-id="b4821-278"><xref:System.Diagnostics.XmlWriterTraceListener>, ad esempio, restituisce informazioni di traccia a un file XML.</span><span class="sxs-lookup"><span data-stu-id="b4821-278">For example, <xref:System.Diagnostics.XmlWriterTraceListener> outputs trace information to an XML file.</span></span> <span data-ttu-id="b4821-279"><xref:System.Diagnostics.TraceSwitch?displayProperty=nameWithType>, infine, che consente all'utente dell'applicazione di controllare il dettaglio della traccia ed è in genere specificato nella configurazione.</span><span class="sxs-lookup"><span data-stu-id="b4821-279">Finally, <xref:System.Diagnostics.TraceSwitch?displayProperty=nameWithType>, which lets the application user control the tracing verbosity and is typically specified in configuration.</span></span>  
  
- <span data-ttu-id="b4821-280">Oltre ai componenti di base, è possibile utilizzare lo strumento Visualizzatore di tracce del servizio [(SvcTraceViewer.exe)](../service-trace-viewer-tool-svctraceviewer-exe.md) per visualizzare ed eseguire ricerche nelle tracce WCF.</span><span class="sxs-lookup"><span data-stu-id="b4821-280">In addition to the core components, you can use the [Service Trace Viewer Tool (SvcTraceViewer.exe)](../service-trace-viewer-tool-svctraceviewer-exe.md) to view and search WCF traces.</span></span> <span data-ttu-id="b4821-281">Lo strumento è progettato specificamente per i <xref:System.Diagnostics.XmlWriterTraceListener>file di traccia generati da WCF e scritti utilizzando .</span><span class="sxs-lookup"><span data-stu-id="b4821-281">The tool is designed specifically for trace files generated by WCF and written out using <xref:System.Diagnostics.XmlWriterTraceListener>.</span></span> <span data-ttu-id="b4821-282">Nella figura seguente sono illustrati i vari componenti della traccia.</span><span class="sxs-lookup"><span data-stu-id="b4821-282">The following figure shows the various components involved in tracing.</span></span>  
  
 <span data-ttu-id="b4821-283">![Gestione di eccezioni ed errori](./media/wcfc-tracinginchannelsc.gif "wcfc_TracingInChannelsc")</span><span class="sxs-lookup"><span data-stu-id="b4821-283">![Handling exceptions and faults](./media/wcfc-tracinginchannelsc.gif "wcfc_TracingInChannelsc")</span></span>  
  
### <a name="tracing-from-a-custom-channel"></a><span data-ttu-id="b4821-284">Esecuzione della traccia da un canale personalizzato</span><span class="sxs-lookup"><span data-stu-id="b4821-284">Tracing from a Custom Channel</span></span>  
 <span data-ttu-id="b4821-285">È consigliabile che i canali personalizzati scrivano messaggi di traccia per favorire la diagnosi dei problemi laddove non è possibile allegare un debugger all'applicazione in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="b4821-285">Custom channels should write out trace messages to assist in diagnosing problems when it is not possible to attach a debugger to the running application.</span></span> <span data-ttu-id="b4821-286">Ciò comporta due attività di livello superiore: creare un'istanza di <xref:System.Diagnostics.TraceSource> e chiamarne i metodi per scrivere tracce.</span><span class="sxs-lookup"><span data-stu-id="b4821-286">This involves two high level tasks: Instantiating a <xref:System.Diagnostics.TraceSource> and calling its methods to write traces.</span></span>  
  
 <span data-ttu-id="b4821-287">Durante la creazione un'istanza di <xref:System.Diagnostics.TraceSource>, la stringa che si specifica diventa il nome dell'origine.</span><span class="sxs-lookup"><span data-stu-id="b4821-287">When instantiating a <xref:System.Diagnostics.TraceSource>, the string you specify becomes the name of that source.</span></span> <span data-ttu-id="b4821-288">Questo nome viene utilizzato per configurare (attivare/disattivare/impostare il livello traccia) l'origine della traccia.</span><span class="sxs-lookup"><span data-stu-id="b4821-288">This name is used to configure (enable/disable/set tracing level) the trace source.</span></span> <span data-ttu-id="b4821-289">Viene inoltre visualizzato nell'output della traccia stesso.</span><span class="sxs-lookup"><span data-stu-id="b4821-289">It also appears in the trace output itself.</span></span> <span data-ttu-id="b4821-290">È consigliabile che i canali personalizzati utilizzino un nome di origine univoco per consentire ai lettori dell'output di traccia di comprendere l'origine delle informazioni di traccia.</span><span class="sxs-lookup"><span data-stu-id="b4821-290">Custom channels should use a unique source name to help readers of the trace output understand where the trace information comes from.</span></span> <span data-ttu-id="b4821-291">La tecnica diffusa consiste nell'utilizzare il nome dell'assembly che scrive le informazioni come nome dell'origine di traccia.</span><span class="sxs-lookup"><span data-stu-id="b4821-291">Using the name of the assembly that is writing the information as the name of the trace source is the common practice.</span></span> <span data-ttu-id="b4821-292">Ad esempio, WCF utilizza System.ServiceModel come origine di traccia per le informazioni scritte dall'assembly System.ServiceModel.For example, WCF uses System.ServiceModel as the trace source for information written from the System.ServiceModel assembly.</span><span class="sxs-lookup"><span data-stu-id="b4821-292">For example, WCF uses System.ServiceModel as the trace source for information written from the System.ServiceModel assembly.</span></span>  
  
 <span data-ttu-id="b4821-293">Una volta in possesso di un'origine di traccia, chiamare i relativi metodi <xref:System.Diagnostics.TraceSource.TraceData%2A>, <xref:System.Diagnostics.TraceSource.TraceEvent%2A> o <xref:System.Diagnostics.TraceSource.TraceInformation%2A> per scrivere voci di traccia nei listener di traccia.</span><span class="sxs-lookup"><span data-stu-id="b4821-293">Once you have a trace source, you call its <xref:System.Diagnostics.TraceSource.TraceData%2A>, <xref:System.Diagnostics.TraceSource.TraceEvent%2A>, or <xref:System.Diagnostics.TraceSource.TraceInformation%2A> methods to write trace entries to the trace listeners.</span></span> <span data-ttu-id="b4821-294">Per ogni voce di traccia che si scrive, è necessario classificare il tipo di evento in base ai tipi definiti in <xref:System.Diagnostics.TraceEventType>.</span><span class="sxs-lookup"><span data-stu-id="b4821-294">For each trace entry you write, you need to classify the type of event as one of the event types defined in <xref:System.Diagnostics.TraceEventType>.</span></span> <span data-ttu-id="b4821-295">Questa classificazione e l'impostazione del livello di traccia nella configurazione determinano se la voce di traccia è restituita al listener.</span><span class="sxs-lookup"><span data-stu-id="b4821-295">This classification and the trace level setting in configuration determine whether the trace entry is output to the listener.</span></span> <span data-ttu-id="b4821-296">Impostando il livello di traccia nella configurazione su `Warning`, ad esempio, si consente la scrittura delle voci di traccia `Warning`, `Error` e `Critical` bloccando però le voci Informazioni e Dettagliato.</span><span class="sxs-lookup"><span data-stu-id="b4821-296">For example, setting the trace level in configuration to `Warning` allows `Warning`, `Error` and `Critical` trace entries to be written but blocks Information and Verbose entries.</span></span> <span data-ttu-id="b4821-297">Segue un esempio di creazione di un'istanza di un'origine di traccia e di scrittura di una voce al livello Informazioni:</span><span class="sxs-lookup"><span data-stu-id="b4821-297">Here is an example of instantiating a trace source and writing out an entry at Information level:</span></span>  
  
```csharp
using System.Diagnostics;  
//...  
TraceSource udpSource = new TraceSource("Microsoft.Samples.Udp");  
//...  
udpsource.TraceInformation("UdpInputChannel received a message");  
```  
  
> [!IMPORTANT]
> <span data-ttu-id="b4821-298">È consigliabile specificare un nome di origine di traccia specifico del canale personalizzato per consentire ai lettori dell'output di traccia di comprenderne l'origine.</span><span class="sxs-lookup"><span data-stu-id="b4821-298">It is highly recommended that you specify a trace source name that is unique to your custom channel to help trace output readers understand where the output came from.</span></span>  
  
#### <a name="integrating-with-the-trace-viewer"></a><span data-ttu-id="b4821-299">Integrazione con il visualizzatore di tracce</span><span class="sxs-lookup"><span data-stu-id="b4821-299">Integrating with the Trace Viewer</span></span>  
 <span data-ttu-id="b4821-300">Le tracce generate dal canale possono essere restituite in un formato leggibile dallo strumento <xref:System.Diagnostics.XmlWriterTraceListener?displayProperty=nameWithType> Visualizzatore di tracce del servizio [(SvcTraceViewer.exe)](../service-trace-viewer-tool-svctraceviewer-exe.md) utilizzando il listener di traccia.</span><span class="sxs-lookup"><span data-stu-id="b4821-300">Traces generated by your channel can be output in a format readable by the [Service Trace Viewer Tool (SvcTraceViewer.exe)](../service-trace-viewer-tool-svctraceviewer-exe.md) by using <xref:System.Diagnostics.XmlWriterTraceListener?displayProperty=nameWithType> as the trace listener.</span></span> <span data-ttu-id="b4821-301">Non è necessario che tale operazione venga eseguita dallo sviluppatori di canali.</span><span class="sxs-lookup"><span data-stu-id="b4821-301">This is not something you, as the channel developer, need to do.</span></span> <span data-ttu-id="b4821-302">Di fatto è l'utente dell'applicazione (o la persona che risolve i problemi dell'applicazione) che ha l'esigenza di configurare questo listener di traccia nel file di configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b4821-302">Rather, it is the application user (or the person troubleshooting the application) that needs to configure this trace listener in the application’s configuration file.</span></span> <span data-ttu-id="b4821-303">Nella configurazione seguente, ad esempio, le informazioni di traccia vengono restituite da <xref:System.ServiceModel?displayProperty=nameWithType> e da `Microsoft.Samples.Udp` al file denominato `TraceEventsFile.e2e`:</span><span class="sxs-lookup"><span data-stu-id="b4821-303">For example, the following configuration outputs trace information from both <xref:System.ServiceModel?displayProperty=nameWithType> and `Microsoft.Samples.Udp` to the file named `TraceEventsFile.e2e`:</span></span>  
  
```xml  
<configuration>  
  <system.diagnostics>  
    <sources>  
      <!-- configure System.ServiceModel trace source -->  
      <source name="System.ServiceModel" switchValue="Verbose"
              propagateActivity="true">  
        <listeners>  
          <add name="e2e" />  
        </listeners>  
      </source>  
      <!-- configure Microsoft.Samples.Udp trace source -->  
      <source name="Microsoft.Samples.Udp" switchValue="Verbose" >  
        <listeners>  
          <add name="e2e" />  
        </listeners>  
      </source>  
    </sources>  
    <!--   
    Define a shared trace listener that outputs to TraceFile.e2e  
    The listener name is e2e   
    -->  
    <sharedListeners>  
      <add name="e2e" type="System.Diagnostics.XmlWriterTraceListener"  
        initializeData=".\TraceFile.e2e"/>  
    </sharedListeners>  
    <trace autoflush="true" />  
  </system.diagnostics>  
</configuration>  
```  
  
#### <a name="tracing-structured-data"></a><span data-ttu-id="b4821-304">Analisi di dati strutturati</span><span class="sxs-lookup"><span data-stu-id="b4821-304">Tracing Structured Data</span></span>  
 <span data-ttu-id="b4821-305"><xref:System.Diagnostics.TraceSource?displayProperty=nameWithType> dispone di un metodo <xref:System.Diagnostics.TraceSource.TraceData%2A> che accetta uno o più oggetti che devono essere inclusi nella voce di traccia.</span><span class="sxs-lookup"><span data-stu-id="b4821-305"><xref:System.Diagnostics.TraceSource?displayProperty=nameWithType> has a <xref:System.Diagnostics.TraceSource.TraceData%2A> method that takes one or more objects that are to be included in the trace entry.</span></span> <span data-ttu-id="b4821-306">In genere il metodo <xref:System.Object.ToString%2A?displayProperty=nameWithType> viene chiamato su ogni oggetto e la stringa risultante viene scritta nell'ambito della voce di traccia.</span><span class="sxs-lookup"><span data-stu-id="b4821-306">In general, the <xref:System.Object.ToString%2A?displayProperty=nameWithType> method is called on each object and the resulting string is written as part of the trace entry.</span></span> <span data-ttu-id="b4821-307">Quando si utilizza <xref:System.Diagnostics.XmlWriterTraceListener?displayProperty=nameWithType> per restituire tracce, è possibile passare un <xref:System.Xml.XPath.IXPathNavigable?displayProperty=nameWithType> come oggetto dati a <xref:System.Diagnostics.TraceSource.TraceData%2A>.</span><span class="sxs-lookup"><span data-stu-id="b4821-307">When using <xref:System.Diagnostics.XmlWriterTraceListener?displayProperty=nameWithType> to output traces, you can pass an <xref:System.Xml.XPath.IXPathNavigable?displayProperty=nameWithType> as the data object to <xref:System.Diagnostics.TraceSource.TraceData%2A>.</span></span> <span data-ttu-id="b4821-308">La voce di traccia risultante comprende l'XML fornito da <xref:System.Xml.XPath.XPathNavigator?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="b4821-308">The resulting trace entry includes the XML provided by the <xref:System.Xml.XPath.XPathNavigator?displayProperty=nameWithType>.</span></span> <span data-ttu-id="b4821-309">Segue una voce di esempio con dati di applicazione XML:</span><span class="sxs-lookup"><span data-stu-id="b4821-309">Here is an example entry with XML application data:</span></span>  
  
```xml  
<E2ETraceEvent xmlns="http://schemas.microsoft.com/2004/06/E2ETraceEvent">  
  <System xmlns="...">  
    <EventID>12</EventID>  
    <Type>3</Type>  
    <SubType Name="Information">0</SubType>  
    <Level>8</Level>  
    <TimeCreated SystemTime="2006-01-13T22:58:03.0654832Z" />  
    <Source Name="Microsoft.ServiceModel.Samples.Udp" />  
    <Correlation ActivityID="{00000000-0000-0000-0000-000000000000}" />  
    <Execution  ProcessName="UdpTestConsole"
                ProcessID="3348" ThreadID="4" />  
    <Channel />  
    <Computer>COMPUTER-LT01</Computer>  
  </System>  
<!-- XML application data -->  
  <ApplicationData>  
  <TraceData>  
   <DataItem>  
   <TraceRecord
     Severity="Information"  
     xmlns="…">  
        <TraceIdentifier>some trace id</TraceIdentifier>  
        <Description>EndReceive called</Description>  
        <AppDomain>UdpTestConsole.exe</AppDomain>  
        <Source>UdpInputChannel</Source>  
      </TraceRecord>  
    </DataItem>  
  </TraceData>  
  </ApplicationData>  
</E2ETraceEvent>  
```  
  
 <span data-ttu-id="b4821-310">Il visualizzatore di tracce WCF `TraceRecord` riconosce lo schema dell'elemento mostrato in precedenza ed estrae i dati dai relativi elementi figlio e li visualizza in un formato tabulare.</span><span class="sxs-lookup"><span data-stu-id="b4821-310">The WCF trace viewer understands the schema of the `TraceRecord` element shown previously and extracts the data from its child elements and displays it in a tabular format.</span></span> <span data-ttu-id="b4821-311">Il canale deve utilizzare questo schema in caso di analisi di dati dell'applicazione strutturati per consentire agli utenti di Svctraceviewer.exe di leggere i dati.</span><span class="sxs-lookup"><span data-stu-id="b4821-311">Your channel should use this schema when tracing structured application data to help Svctraceviewer.exe users read the data.</span></span>
