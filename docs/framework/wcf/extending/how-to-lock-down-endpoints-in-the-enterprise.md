---
title: "Procedura: bloccare gli endpoint nell'organizzazione"
ms.date: 03/30/2017
ms.assetid: 1b7eaab7-da60-4cf7-9d6a-ec02709cf75d
ms.openlocfilehash: 35b9a1dbebce48823799689a581033d0483c3984
ms.sourcegitcommit: 7e2128d4a4c45b4274bea3b8e5760d4694569ca1
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/14/2020
ms.locfileid: "75937672"
---
# <a name="how-to-lock-down-endpoints-in-the-enterprise"></a><span data-ttu-id="a29e8-102">Procedura: bloccare gli endpoint nell'organizzazione</span><span class="sxs-lookup"><span data-stu-id="a29e8-102">How to: Lock Down Endpoints in the Enterprise</span></span>

<span data-ttu-id="a29e8-103">Le aziende di grandi dimensioni spesso richiedono che le applicazioni vengano sviluppate in conformità con i criteri di sicurezza aziendali.</span><span class="sxs-lookup"><span data-stu-id="a29e8-103">Large enterprises often require that applications are developed in compliance with enterprise security policies.</span></span> <span data-ttu-id="a29e8-104">Nell'argomento seguente viene illustrato come sviluppare e installare un validator dell'endpoint client che può essere utilizzato per convalidare tutte le applicazioni client Windows Communication Foundation (WCF) installate nei computer.</span><span class="sxs-lookup"><span data-stu-id="a29e8-104">The following topic discusses how to develop and install a client endpoint validator that can be used to validate all Windows Communication Foundation (WCF) client applications installed on computers.</span></span>

<span data-ttu-id="a29e8-105">In questo caso, il validator è un validator client perché questo comportamento dell'endpoint viene aggiunto alla sezione client [\<commonBehaviors >](../../configure-apps/file-schema/wcf/commonbehaviors.md) nel file Machine. config.</span><span class="sxs-lookup"><span data-stu-id="a29e8-105">In this case, the validator is a client validator because this endpoint behavior is added to the client [\<commonBehaviors>](../../configure-apps/file-schema/wcf/commonbehaviors.md) section in the machine.config file.</span></span> <span data-ttu-id="a29e8-106">WCF carica i comportamenti degli endpoint comuni solo per le applicazioni client e carica i comportamenti del servizio comuni solo per le applicazioni di servizio.</span><span class="sxs-lookup"><span data-stu-id="a29e8-106">WCF loads common endpoint behaviors only for client applications and loads common service behaviors only for service applications.</span></span> <span data-ttu-id="a29e8-107">Per installare questo stesso validator per le applicazioni di servizio, il validator deve essere un comportamento del servizio.</span><span class="sxs-lookup"><span data-stu-id="a29e8-107">To install this same validator for service applications, the validator must be a service behavior.</span></span> <span data-ttu-id="a29e8-108">Per ulteriori informazioni, vedere la sezione [\<> CommonBehaviors](../../configure-apps/file-schema/wcf/commonbehaviors.md) .</span><span class="sxs-lookup"><span data-stu-id="a29e8-108">For more information, see the [\<commonBehaviors>](../../configure-apps/file-schema/wcf/commonbehaviors.md) section.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a29e8-109">I comportamenti del servizio o dell'endpoint non contrassegnati con l'attributo <xref:System.Security.AllowPartiallyTrustedCallersAttribute> (APTCA) aggiunti alla sezione [\<commonBehaviors >](../../configure-apps/file-schema/wcf/commonbehaviors.md) di un file di configurazione non vengono eseguiti quando l'applicazione è in esecuzione in un ambiente parzialmente attendibile e non viene generata alcuna eccezione quando si verifica questa situazione.</span><span class="sxs-lookup"><span data-stu-id="a29e8-109">Service or endpoint behaviors not marked with the <xref:System.Security.AllowPartiallyTrustedCallersAttribute> attribute (APTCA) that are added to the [\<commonBehaviors>](../../configure-apps/file-schema/wcf/commonbehaviors.md) section of a configuration file are not run when the application runs in a partial trust environment, and no exception is thrown when this occurs.</span></span> <span data-ttu-id="a29e8-110">Per imporre l'esecuzione di comportamenti comuni, ad esempio validator, è necessario:</span><span class="sxs-lookup"><span data-stu-id="a29e8-110">To enforce the running of common behaviors such as validators, you must either:</span></span>
>
> - <span data-ttu-id="a29e8-111">Contrassegnare il comportamento comune con l'attributo <xref:System.Security.AllowPartiallyTrustedCallersAttribute> in modo che possa essere eseguito se distribuito come applicazione parzialmente attendibile.</span><span class="sxs-lookup"><span data-stu-id="a29e8-111">Mark your common behavior with the <xref:System.Security.AllowPartiallyTrustedCallersAttribute> attribute so that it can run when deployed as a Partial Trust application.</span></span> <span data-ttu-id="a29e8-112">Si noti che è possibile impostare nel computer una voce di registro per impedire l'esecuzione degli assembly APTCA.</span><span class="sxs-lookup"><span data-stu-id="a29e8-112">Note that a registry entry can be set on the computer to prevent APTCA-marked assemblies from running..</span></span>
>
> - <span data-ttu-id="a29e8-113">Assicurarsi che se l'applicazione viene distribuita come applicazione completamente attendibile che gli utenti non possono modificare le impostazioni di sicurezza per l'accesso al codice per eseguire l'applicazione in un ambiente parzialmente attendibile.</span><span class="sxs-lookup"><span data-stu-id="a29e8-113">Ensure that if the application is deployed as a fully-trusted application that users cannot modify the code-access security settings to run the application in a Partial Trust environment.</span></span> <span data-ttu-id="a29e8-114">In tal caso, il validator personalizzato non viene eseguito e non viene generata alcuna eccezione.</span><span class="sxs-lookup"><span data-stu-id="a29e8-114">If they can do so, the custom validator does not run and no exception is thrown.</span></span> <span data-ttu-id="a29e8-115">Per verificare questo aspetto, vedere l'opzione `levelfinal` tramite [lo strumento criteri di sicurezza dall'accesso di codice (Caspol. exe)](../../tools/caspol-exe-code-access-security-policy-tool.md).</span><span class="sxs-lookup"><span data-stu-id="a29e8-115">For one way to ensure this, see the `levelfinal` option using [Code Access Security Policy Tool (Caspol.exe)](../../tools/caspol-exe-code-access-security-policy-tool.md).</span></span>
>
> <span data-ttu-id="a29e8-116">Per ulteriori informazioni, vedere [procedure consigliate di attendibilità parziale](../feature-details/partial-trust-best-practices.md) e [scenari di distribuzione supportati](../feature-details/supported-deployment-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="a29e8-116">For more information, see [Partial Trust Best Practices](../feature-details/partial-trust-best-practices.md) and [Supported Deployment Scenarios](../feature-details/supported-deployment-scenarios.md).</span></span>

### <a name="to-create-the-endpoint-validator"></a><span data-ttu-id="a29e8-117">Creazione del validator dell'endpoint.</span><span class="sxs-lookup"><span data-stu-id="a29e8-117">To create the endpoint validator</span></span>

1. <span data-ttu-id="a29e8-118">Creare un oggetto <xref:System.ServiceModel.Description.IEndpointBehavior> con i passaggi di convalida desiderati nel metodo <xref:System.ServiceModel.Description.IEndpointBehavior.Validate%2A>.</span><span class="sxs-lookup"><span data-stu-id="a29e8-118">Create an <xref:System.ServiceModel.Description.IEndpointBehavior> with the desired validation steps in the <xref:System.ServiceModel.Description.IEndpointBehavior.Validate%2A> method.</span></span> <span data-ttu-id="a29e8-119">Nel codice seguente ne viene illustrato un esempio.</span><span class="sxs-lookup"><span data-stu-id="a29e8-119">The following code provides an example.</span></span> <span data-ttu-id="a29e8-120">Il `InternetClientValidatorBehavior` viene tratto dall'esempio di [convalida della sicurezza](../samples/security-validation.md) .</span><span class="sxs-lookup"><span data-stu-id="a29e8-120">(The `InternetClientValidatorBehavior` is taken from the [Security Validation](../samples/security-validation.md) sample.)</span></span>

    [!code-csharp[LockdownValidation#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/internetclientvalidatorbehavior.cs#2)]

2. <span data-ttu-id="a29e8-121">Creare un nuovo oggetto <xref:System.ServiceModel.Configuration.BehaviorExtensionElement> che registra il validator dell'endpoint creato nel passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="a29e8-121">Create new <xref:System.ServiceModel.Configuration.BehaviorExtensionElement> that registers the endpoint validator created in step 1.</span></span> <span data-ttu-id="a29e8-122">Nell'esempio di codice seguente viene illustrata questa operazione.</span><span class="sxs-lookup"><span data-stu-id="a29e8-122">The following code example shows this.</span></span> <span data-ttu-id="a29e8-123">Il codice originale per questo esempio è nell'esempio di [convalida della sicurezza](../samples/security-validation.md) .</span><span class="sxs-lookup"><span data-stu-id="a29e8-123">(The original code for this example is in the [Security Validation](../samples/security-validation.md) sample.)</span></span>

    [!code-csharp[LockdownValidation#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/internetclientvalidatorelement.cs#3)]

3. <span data-ttu-id="a29e8-124">Verificare che l'assembly compilato sia firmato con un nome sicuro.</span><span class="sxs-lookup"><span data-stu-id="a29e8-124">Make sure the compiled assembly is signed with a strong name.</span></span> <span data-ttu-id="a29e8-125">Per informazioni dettagliate, vedere lo [strumento nome sicuro (sn. EXE)](../../tools/sn-exe-strong-name-tool.md) e i comandi del compilatore per il linguaggio in uso.</span><span class="sxs-lookup"><span data-stu-id="a29e8-125">For details, see the [Strong Name Tool (SN.EXE)](../../tools/sn-exe-strong-name-tool.md) and the compiler commands for your language.</span></span>

### <a name="to-install-the-validator-into-the-target-computer"></a><span data-ttu-id="a29e8-126">Installazione del validator nel computer di destinazione</span><span class="sxs-lookup"><span data-stu-id="a29e8-126">To install the validator into the target computer</span></span>

1. <span data-ttu-id="a29e8-127">Installare il validator dell'endpoint utilizzando il meccanismo appropriato.</span><span class="sxs-lookup"><span data-stu-id="a29e8-127">Install the endpoint validator using the appropriate mechanism.</span></span> <span data-ttu-id="a29e8-128">In un'azienda, è possibile usare a tale fine Criteri di gruppo e Systems Management Server (SMS).</span><span class="sxs-lookup"><span data-stu-id="a29e8-128">In an enterprise, this can be using Group Policy and Systems Management Server (SMS).</span></span>

2. <span data-ttu-id="a29e8-129">Installare l'assembly con nome sicuro in Global Assembly Cache utilizzando [gacutil. exe (strumento Global assembly cache)](../../tools/gacutil-exe-gac-tool.md).</span><span class="sxs-lookup"><span data-stu-id="a29e8-129">Install the strongly-named assembly into the global assembly cache using the [Gacutil.exe (Global Assembly Cache Tool)](../../tools/gacutil-exe-gac-tool.md).</span></span>

3. <span data-ttu-id="a29e8-130">Usare i tipi di spazio dei nomi <xref:System.Configuration?displayProperty=nameWithType> per:</span><span class="sxs-lookup"><span data-stu-id="a29e8-130">Use the <xref:System.Configuration?displayProperty=nameWithType> namespace types to:</span></span>

    1. <span data-ttu-id="a29e8-131">Aggiungere l'estensione alla sezione [\<behaviorExtensions >](../../configure-apps/file-schema/wcf/behaviorextensions.md) utilizzando un nome di tipo completo e bloccare l'elemento.</span><span class="sxs-lookup"><span data-stu-id="a29e8-131">Add the extension to the [\<behaviorExtensions>](../../configure-apps/file-schema/wcf/behaviorextensions.md) section using a fully-qualified type name and lock the element.</span></span>

         [!code-csharp[LockdownValidation#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#5)]

    2. <span data-ttu-id="a29e8-132">Aggiungere l'elemento behavior alla proprietà `EndpointBehaviors` della sezione [\<commonBehaviors >](../../configure-apps/file-schema/wcf/commonbehaviors.md) e bloccare l'elemento.</span><span class="sxs-lookup"><span data-stu-id="a29e8-132">Add the behavior element to the `EndpointBehaviors` property of the [\<commonBehaviors>](../../configure-apps/file-schema/wcf/commonbehaviors.md) section and lock the element.</span></span> <span data-ttu-id="a29e8-133">Per installare il validator nel servizio, il validator deve essere un <xref:System.ServiceModel.Description.IServiceBehavior> e aggiungerlo alla proprietà `ServiceBehaviors`. Nell'esempio di codice seguente viene illustrata la configurazione corretta dopo i passaggi a.</span><span class="sxs-lookup"><span data-stu-id="a29e8-133">(To install the validator on the service, the validator must be an <xref:System.ServiceModel.Description.IServiceBehavior> and added to the `ServiceBehaviors` property.) The following code example shows the proper configuration after steps a.</span></span> <span data-ttu-id="a29e8-134">e b., con la sola eccezione che non è presente un nome sicuro.</span><span class="sxs-lookup"><span data-stu-id="a29e8-134">and b., with the sole exception that there is no strong name.</span></span>

        [!code-csharp[LockdownValidation#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#6)]

    3. <span data-ttu-id="a29e8-135">Salvare il file machine.config.</span><span class="sxs-lookup"><span data-stu-id="a29e8-135">Save the machine.config file.</span></span> <span data-ttu-id="a29e8-136">Nell'esempio di codice seguente vengono eseguite tutte le attività nel passaggio 3, ma viene salvata localmente una copia del file machine.config modificato.</span><span class="sxs-lookup"><span data-stu-id="a29e8-136">The following code example performs all the tasks in step 3 but saves a copy of the modified machine.config file locally.</span></span>

        [!code-csharp[LockdownValidation#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#7)]

## <a name="example"></a><span data-ttu-id="a29e8-137">Esempio</span><span class="sxs-lookup"><span data-stu-id="a29e8-137">Example</span></span>

<span data-ttu-id="a29e8-138">Nell'esempio di codice seguente viene illustrato come aggiungere un comportamento comune al file machine.config e salvare una copia sul disco.</span><span class="sxs-lookup"><span data-stu-id="a29e8-138">The following code example shows how to add a common behavior to the machine.config file and save a copy to the disk.</span></span> <span data-ttu-id="a29e8-139">Il `InternetClientValidatorBehavior` viene tratto dall'esempio di [convalida della sicurezza](../samples/security-validation.md) .</span><span class="sxs-lookup"><span data-stu-id="a29e8-139">The `InternetClientValidatorBehavior` is taken from the [Security Validation](../samples/security-validation.md) sample.</span></span>

[!code-csharp[LockdownValidation#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/lockdownvalidation/cs/hostapplication.cs#1)]

## <a name="net-framework-security"></a><span data-ttu-id="a29e8-140">Sicurezza di .NET Framework</span><span class="sxs-lookup"><span data-stu-id="a29e8-140">.NET Framework Security</span></span>

<span data-ttu-id="a29e8-141">Si potrebbe inoltre desiderare di crittografare gli elementi del file di configurazione.</span><span class="sxs-lookup"><span data-stu-id="a29e8-141">You may also want to encrypt the configuration file elements.</span></span> <span data-ttu-id="a29e8-142">Per altre informazioni, vedere la sezione Vedere anche.</span><span class="sxs-lookup"><span data-stu-id="a29e8-142">For more information, see the See Also section.</span></span>

## <a name="see-also"></a><span data-ttu-id="a29e8-143">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="a29e8-143">See also</span></span>

- <span data-ttu-id="a29e8-144">[Crittografia di elementi del file di configurazione tramite DPAPI](https://docs.microsoft.com/previous-versions/msp-n-p/ff647398(v=pandp.10))</span><span class="sxs-lookup"><span data-stu-id="a29e8-144">[Encrypting configuration file elements using DPAPI](https://docs.microsoft.com/previous-versions/msp-n-p/ff647398(v=pandp.10))</span></span>
- <span data-ttu-id="a29e8-145">[Crittografia di elementi del file di configurazione tramite RSA](https://docs.microsoft.com/previous-versions/msp-n-p/ff650304(v=pandp.10))</span><span class="sxs-lookup"><span data-stu-id="a29e8-145">[Encrypting configuration file elements using RSA](https://docs.microsoft.com/previous-versions/msp-n-p/ff650304(v=pandp.10))</span></span>
