---
title: 'Procedura: creare un autenticatore di token di sicurezza personalizzatoHow to: create a custom security token authenticator'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
ms.assetid: 10e245f7-d31e-42e7-82a2-d5780325d372
ms.openlocfilehash: 7bbe59958f59f76046c0a112463cfa64d09c14d3
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/12/2020
ms.locfileid: "79185583"
---
# <a name="how-to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="ee616-102">Procedura: creare un autenticatore di token di sicurezza personalizzatoHow to: create a custom security token authenticator</span><span class="sxs-lookup"><span data-stu-id="ee616-102">How to: create a custom security token authenticator</span></span>
<span data-ttu-id="ee616-103">In questo argomento viene illustrato come creare un autenticatore del token di sicurezza personalizzato e come integrarlo con un gestore del token di sicurezza personalizzato.</span><span class="sxs-lookup"><span data-stu-id="ee616-103">This topic shows how to create a custom security token authenticator and how to integrate it with a custom security token manager.</span></span> <span data-ttu-id="ee616-104">Un autenticatore del token di sicurezza codi sicurezzantenuto di un token di sicurezza fornito con un messaggio in ingresso.</span><span class="sxs-lookup"><span data-stu-id="ee616-104">A security token authenticator validates the content of a security token provided with an incoming message.</span></span> <span data-ttu-id="ee616-105">Se la convalida ha esito positivo, l'autenticatore restituisce una raccolta di istanze <xref:System.IdentityModel.Policy.IAuthorizationPolicy> che, quando valutata, restituisce un set di attestazioni.</span><span class="sxs-lookup"><span data-stu-id="ee616-105">If the validation succeeds, the authenticator returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances that, when evaluated, returns a set of claims.</span></span>  
  
 <span data-ttu-id="ee616-106">Per usare un autenticatore di token di sicurezza personalizzato in Windows Communication Foundation (WCF), è innanzitutto necessario creare credenziali personalizzate e implementazioni del gestore di token di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="ee616-106">To use a custom security token authenticator in Windows Communication Foundation (WCF), you must first create custom credentials and security token manager implementations.</span></span> <span data-ttu-id="ee616-107">Per ulteriori informazioni sulla creazione di credenziali personalizzate e un gestore di token di sicurezza, vedere [Procedura dettagliata: creazione](walkthrough-creating-custom-client-and-service-credentials.md)di credenziali client e del servizio personalizzate .</span><span class="sxs-lookup"><span data-stu-id="ee616-107">For more information about creating custom credentials and a security token manager, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>
  
## <a name="procedures"></a><span data-ttu-id="ee616-108">Procedure</span><span class="sxs-lookup"><span data-stu-id="ee616-108">Procedures</span></span>  
  
#### <a name="to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="ee616-109">Per creare un autenticatore del token di sicurezza personalizzato</span><span class="sxs-lookup"><span data-stu-id="ee616-109">To create a custom security token authenticator</span></span>  
  
1. <span data-ttu-id="ee616-110">Definire una nuova classe derivata dalla classe <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>.</span><span class="sxs-lookup"><span data-stu-id="ee616-110">Define a new class derived from the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> class.</span></span>  
  
2. <span data-ttu-id="ee616-111">Eseguire l'override del metodo <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> .</span><span class="sxs-lookup"><span data-stu-id="ee616-111">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> method.</span></span> <span data-ttu-id="ee616-112">Il metodo restituisce `true` o `false` a seconda che l'autenticatore personalizzato possa convalidare o meno il tipo di token in ingresso.</span><span class="sxs-lookup"><span data-stu-id="ee616-112">The method returns `true` or `false` depending on whether the custom authenticator can validate the incoming token type or not.</span></span>  
  
3. <span data-ttu-id="ee616-113">Eseguire l'override del metodo <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> .</span><span class="sxs-lookup"><span data-stu-id="ee616-113">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> method.</span></span> <span data-ttu-id="ee616-114">Questo metodo deve convalidare in modo appropriato il contenuto del token.</span><span class="sxs-lookup"><span data-stu-id="ee616-114">This method needs to validate the token contents appropriately.</span></span> <span data-ttu-id="ee616-115">Se il token supera il passo di convalida, restituisce una raccolta di istanze <xref:System.IdentityModel.Policy.IAuthorizationPolicy>.</span><span class="sxs-lookup"><span data-stu-id="ee616-115">If the token passes the validation step, it returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances.</span></span> <span data-ttu-id="ee616-116">Nell'esempio seguente viene utilizzata un'implementazione di criteri di autorizzazione personalizzata che verrà creata nella procedura successiva.</span><span class="sxs-lookup"><span data-stu-id="ee616-116">The following example uses a custom authorization policy implementation that will be created in the next procedure.</span></span>  
  
     [!code-csharp[C_CustomTokenAuthenticator#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#1)]
     [!code-vb[C_CustomTokenAuthenticator#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#1)]  
  
 <span data-ttu-id="ee616-117">Il codice precedente restituisce una raccolta di criteri di autorizzazione nel metodo <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29>.</span><span class="sxs-lookup"><span data-stu-id="ee616-117">The previous code returns a collection of authorization policies in the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="ee616-118">WCF non fornisce un'implementazione pubblica di questa interfaccia.</span><span class="sxs-lookup"><span data-stu-id="ee616-118">WCF does not provide a public implementation of this interface.</span></span> <span data-ttu-id="ee616-119">Nella procedura seguente viene illustrato come eseguire l'operazione in base ai propri requisiti.</span><span class="sxs-lookup"><span data-stu-id="ee616-119">The following procedure shows how to do so for your own requirements.</span></span>  
  
#### <a name="to-create-a-custom-authorization-policy"></a><span data-ttu-id="ee616-120">Per creare un criterio di autorizzazione personalizzato</span><span class="sxs-lookup"><span data-stu-id="ee616-120">To create a custom authorization policy</span></span>  
  
1. <span data-ttu-id="ee616-121">Definire una nuova classe che implementa l'interfaccia <xref:System.IdentityModel.Policy.IAuthorizationPolicy>.</span><span class="sxs-lookup"><span data-stu-id="ee616-121">Define a new class implementing the <xref:System.IdentityModel.Policy.IAuthorizationPolicy> interface.</span></span>  
  
2. <span data-ttu-id="ee616-122">Implementare la proprietà di sola lettura <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A>.</span><span class="sxs-lookup"><span data-stu-id="ee616-122">Implement the <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> read-only property.</span></span> <span data-ttu-id="ee616-123">Un sistema per implementare questa proprietà consiste nel generare un identificatore univoco globale (GUID, Globally Unique Identifier) nel costruttore della classe e restituirlo ogni volta che viene richiesto il valore per questa proprietà.</span><span class="sxs-lookup"><span data-stu-id="ee616-123">One way to implement this property is to generate a globally unique identifier (GUID) in the class constructor and return it every time the value for this property is requested.</span></span>  
  
3. <span data-ttu-id="ee616-124">Implementare la proprietà di sola lettura <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A>.</span><span class="sxs-lookup"><span data-stu-id="ee616-124">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> read-only property.</span></span> <span data-ttu-id="ee616-125">Questa proprietà deve restituire un emittente dei set di attestazioni ottenuti dal token.</span><span class="sxs-lookup"><span data-stu-id="ee616-125">This property needs to return an issuer of the claim sets that are obtained from the token.</span></span> <span data-ttu-id="ee616-126">Tale emittente deve corrispondere all'emittente del token o a un'autorità responsabile della convalida del contenuto del token.</span><span class="sxs-lookup"><span data-stu-id="ee616-126">This issuer should correspond to the issuer of the token or an authority that is responsible for validating the token contents.</span></span> <span data-ttu-id="ee616-127">Nell'esempio seguente viene utilizzata l'attestazione dell'emittente passata alla classe dall'autenticatore del token di sicurezza personalizzato creato nella procedura precedente.</span><span class="sxs-lookup"><span data-stu-id="ee616-127">The following example uses the issuer claim that passed to this class from the custom security token authenticator created in the previous procedure.</span></span> <span data-ttu-id="ee616-128">L'autenticatore del token di sicurezza personalizzato utilizza il set di attestazioni fornito dal sistema (restituito dalla proprietà <xref:System.IdentityModel.Claims.ClaimSet.System%2A>) per rappresentare l'emittente del token nome utente.</span><span class="sxs-lookup"><span data-stu-id="ee616-128">The custom security token authenticator uses the system-provided claim set (returned by the <xref:System.IdentityModel.Claims.ClaimSet.System%2A> property) to represent the issuer of the username token.</span></span>  
  
4. <span data-ttu-id="ee616-129">Implementare il metodo <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A>.</span><span class="sxs-lookup"><span data-stu-id="ee616-129">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> method.</span></span> <span data-ttu-id="ee616-130">Questo metodo compila un'istanza della classe <xref:System.IdentityModel.Policy.EvaluationContext> (passata come argomento) con attestazioni basate sul contenuto del token di sicurezza in ingresso.</span><span class="sxs-lookup"><span data-stu-id="ee616-130">This method populates an instance of the <xref:System.IdentityModel.Policy.EvaluationContext> class (passed in as an argument) with claims that are based on the incoming security token content.</span></span> <span data-ttu-id="ee616-131">Il metodo restituisce `true` al termine della valutazione.</span><span class="sxs-lookup"><span data-stu-id="ee616-131">The method returns `true` when it is done with the evaluation.</span></span> <span data-ttu-id="ee616-132">Nei casi in cui l'implementazione si basa sulla presenza di altri criteri di autorizzazione che forniscono informazioni aggiuntive al contesto di valutazione, questo metodo può restituire `false` se le informazioni necessarie non sono ancora presenti nel contesto di valutazione.</span><span class="sxs-lookup"><span data-stu-id="ee616-132">In cases when the implementation relies on the presence of other authorization policies that provide additional information to the evaluation context, this method can return `false` if the required information is not present yet in the evaluation context.</span></span> <span data-ttu-id="ee616-133">In tal caso, WCF chiamerà nuovamente il metodo dopo la valutazione di tutti gli altri criteri di autorizzazione generati per il messaggio in arrivo se almeno uno di questi criteri di autorizzazione ha modificato il contesto di valutazione.</span><span class="sxs-lookup"><span data-stu-id="ee616-133">In that case, WCF will call the method again after evaluating all other authorization policies generated for the incoming message if at least one of those authorization policies modified the evaluation context.</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#3)]
     [!code-vb[c_CustomTokenAuthenticator#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#3)]  

 <span data-ttu-id="ee616-134">[Procedura dettagliata: creazione di credenziali client e del servizio personalizzate](walkthrough-creating-custom-client-and-service-credentials.md) viene descritto come creare credenziali personalizzate e un gestore di token di sicurezza personalizzato.</span><span class="sxs-lookup"><span data-stu-id="ee616-134">[Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md) describes how to create custom credentials and a custom security token manager.</span></span> <span data-ttu-id="ee616-135">Per utilizzare l'autenticatore del token di sicurezza personalizzato qui creato, viene modificata un'implementazione del gestore del token di sicurezza per restituire l'autenticatore personalizzato dal metodo <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A>.</span><span class="sxs-lookup"><span data-stu-id="ee616-135">To use the custom security token authenticator created here, an implementation of the security token manager is modified to return the custom authenticator from the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method.</span></span> <span data-ttu-id="ee616-136">Il metodo restituisce un autenticatore quando viene passato un requisito di token di sicurezza appropriato.</span><span class="sxs-lookup"><span data-stu-id="ee616-136">The method returns an authenticator when an appropriate security token requirement is passed in.</span></span>  
  
#### <a name="to-integrate-a-custom-security-token-authenticator-with-a-custom-security-token-manager"></a><span data-ttu-id="ee616-137">Per integrare un autenticatore del token di sicurezza personalizzato con un gestore del token di sicurezza personalizzato</span><span class="sxs-lookup"><span data-stu-id="ee616-137">To integrate a custom security token authenticator with a custom security token manager</span></span>  
  
1. <span data-ttu-id="ee616-138">Eseguire l'override del metodo <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> nell'implementazione del gestore del token di sicurezza personalizzato.</span><span class="sxs-lookup"><span data-stu-id="ee616-138">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method in your custom security token manager implementation.</span></span>  
  
2. <span data-ttu-id="ee616-139">Aggiungere logica al metodo per consentire la restituzione dell'autenticatore del token di sicurezza personalizzato in base al parametro <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>.</span><span class="sxs-lookup"><span data-stu-id="ee616-139">Add logic to the method to enable it to return your custom security token authenticator based on the <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parameter.</span></span> <span data-ttu-id="ee616-140">Nell'esempio seguente viene restituito un autenticatore del token di sicurezza personalizzato se il tipo di token dei requisiti di token è un nome utente (rappresentato dalla proprietà <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A>) e la direzione del messaggio per cui viene richiesto l'autenticatore del token di sicurezza è di input (rappresentata dal campo <xref:System.ServiceModel.Description.MessageDirection.Input>).</span><span class="sxs-lookup"><span data-stu-id="ee616-140">The following example returns a custom security token authenticator if the token requirements token type is a user name (represented by the <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> property) and the message direction for which the security token authenticator is being requested is input (represented by the <xref:System.ServiceModel.Description.MessageDirection.Input> field).</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#2)]
     [!code-vb[c_CustomTokenAuthenticator#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#2)]  

## <a name="see-also"></a><span data-ttu-id="ee616-141">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="ee616-141">See also</span></span>

- <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>
- <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>
- <xref:System.IdentityModel.Selectors.SecurityTokenManager>
- <xref:System.IdentityModel.Tokens.UserNameSecurityToken>
- [<span data-ttu-id="ee616-142">Procedura dettagliata: creazione di credenziali client e del servizio personalizzate</span><span class="sxs-lookup"><span data-stu-id="ee616-142">Walkthrough: Creating Custom Client and Service Credentials</span></span>](walkthrough-creating-custom-client-and-service-credentials.md)
- [<span data-ttu-id="ee616-143">Procedura: creare un provider di token di sicurezza personalizzati</span><span class="sxs-lookup"><span data-stu-id="ee616-143">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)
