---
title: Toolkit di RuleSet esterno
ms.date: 03/30/2017
ms.assetid: a306d283-a031-475e-aa01-9ae86e7adcb0
ms.openlocfilehash: eb59b02d469788b23126f4e02c5b7ae5a63081f0
ms.sourcegitcommit: 011314e0c8eb4cf4a11d92078f58176c8c3efd2d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/09/2020
ms.locfileid: "77094670"
---
# <a name="external-ruleset-toolkit"></a><span data-ttu-id="e10eb-102">Toolkit di RuleSet esterno</span><span class="sxs-lookup"><span data-stu-id="e10eb-102">External Ruleset Toolkit</span></span>

<span data-ttu-id="e10eb-103">Normalmente quando vengono usate all'interno di un'applicazione del flusso di lavoro, le regole fanno parte dell'assembly.</span><span class="sxs-lookup"><span data-stu-id="e10eb-103">Normally when rules are used within a workflow application, the rules are part of the assembly.</span></span> <span data-ttu-id="e10eb-104">In alcuni scenari, può essere necessario gestire il RuleSet separatamente dall'assembly così che possano essere aggiornati senza ricompilare e distribuire l'assembly del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="e10eb-104">In some scenarios, you may want to maintain the RuleSets separately from the assembly so that they can be updated without rebuilding and deploying the workflow assembly.</span></span> <span data-ttu-id="e10eb-105">In questo esempio viene illustrato come gestire e modificare il RuleSet in un database e accedere ai RuleSet da un flusso di lavoro durante il runtime.</span><span class="sxs-lookup"><span data-stu-id="e10eb-105">This sample allows you to manage and edit RuleSets in a database and access those RuleSets from a workflow at runtime.</span></span> <span data-ttu-id="e10eb-106">Abilita l'esecuzione di istanze del flusso di lavoro per incorporare automaticamente le modifiche del RuleSet.</span><span class="sxs-lookup"><span data-stu-id="e10eb-106">This enables running workflow instances to automatically incorporate RuleSet changes.</span></span>

<span data-ttu-id="e10eb-107">L'esempio di toolkit di RuleSet esterno contiene uno strumento basato su Windows Form che può essere usato per gestire e modificare le versioni di RuleSet in un database.</span><span class="sxs-lookup"><span data-stu-id="e10eb-107">The External RuleSet Toolkit sample contains a Windows Forms-based tool that you can use to manage and edit RuleSet versions in a database.</span></span> <span data-ttu-id="e10eb-108">Include inoltre un'attività e un servizio host per l'esecuzione di tali regole.</span><span class="sxs-lookup"><span data-stu-id="e10eb-108">It also includes an activity and a host service for executing those rules.</span></span>

> [!NOTE]
> <span data-ttu-id="e10eb-109">Questo esempio richiede [Microsoft SQL Server](/sql).</span><span class="sxs-lookup"><span data-stu-id="e10eb-109">This sample requires [Microsoft SQL Server](/sql).</span></span>

<span data-ttu-id="e10eb-110">Visual Studio fornisce un editor di RuleSet come parte del Windows Workflow Foundation (WF).</span><span class="sxs-lookup"><span data-stu-id="e10eb-110">Visual Studio provides a RuleSet editor as part of the Windows Workflow Foundation (WF).</span></span> <span data-ttu-id="e10eb-111">È possibile avviare questo editor facendo doppio clic sull'attività `Policy` in un flusso di lavoro; serializza l'oggetto di RuleSet definito al file con estensione rules associato al flusso di lavoro (un'attività `Policy` esegue un'istanza di RuleSet in base al flusso di lavoro).</span><span class="sxs-lookup"><span data-stu-id="e10eb-111">You can start this editor by double-clicking the `Policy` activity in a workflow; it serializes the defined RuleSet object to the .rules file associated with the workflow (a `Policy` activity runs a RuleSet instance against the workflow).</span></span> <span data-ttu-id="e10eb-112">Il file con estensione rules viene compilato nell'assembly come una risorsa quando si compila il progetto del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="e10eb-112">The .rules file is compiled into the assembly as a resource when you build the workflow project.</span></span>

<span data-ttu-id="e10eb-113">L'esempio è costituito dai componenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="e10eb-113">The components of this sample include:</span></span>

- <span data-ttu-id="e10eb-114">Interfaccia utente grafica di RuleSet che può essere usato per modificare e gestire le versioni di RuleSet nel database.</span><span class="sxs-lookup"><span data-stu-id="e10eb-114">A RuleSet graphical user interface tool that you can use to edit and manage RuleSet versions in the database.</span></span>

- <span data-ttu-id="e10eb-115">Un servizio RuleSet configurato sull'applicazione host che accede al RuleSet dal database.</span><span class="sxs-lookup"><span data-stu-id="e10eb-115">A RuleSet service that is configured on the host application and accesses RuleSets from the database.</span></span>

- <span data-ttu-id="e10eb-116">Un'attività `ExternalPolicy` che richiede un RuleSet dal servizio di RuleSet e lo esegue in base al flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="e10eb-116">An `ExternalPolicy` activity that requests a RuleSet from the RuleSet service and runs the RuleSet against the workflow.</span></span>

<span data-ttu-id="e10eb-117">L'interazione dei componenti è illustrata nell'immagine seguente.</span><span class="sxs-lookup"><span data-stu-id="e10eb-117">The interaction of the components is shown in the following image.</span></span> <span data-ttu-id="e10eb-118">Nelle sezioni seguenti viene descritto ogni componente.</span><span class="sxs-lookup"><span data-stu-id="e10eb-118">The sections that follow describe each component.</span></span>

![Diagramma che illustra la panoramica dell'esempio External RuleSet Toolkit.](./media/external-ruleset-toolkit/ruleset-toolkit-overview.gif)

> [!IMPORTANT]
> <span data-ttu-id="e10eb-120">È possibile che gli esempi siano già installati nel computer.</span><span class="sxs-lookup"><span data-stu-id="e10eb-120">The samples may already be installed on your machine.</span></span> <span data-ttu-id="e10eb-121">Verificare la directory seguente (impostazione predefinita) prima di continuare.</span><span class="sxs-lookup"><span data-stu-id="e10eb-121">Check for the following (default) directory before continuing.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples`
>
> <span data-ttu-id="e10eb-122">Se questa directory non esiste, passare a [Windows Communication Foundation (WCF) ed esempi di Windows Workflow Foundation (WF) per .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) per scaricare tutti i Windows Communication Foundation (WCF) e [!INCLUDE[wf1](../../../../includes/wf1-md.md)] esempi.</span><span class="sxs-lookup"><span data-stu-id="e10eb-122">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://www.microsoft.com/download/details.aspx?id=21459) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="e10eb-123">Questo esempio si trova nella directory seguente.</span><span class="sxs-lookup"><span data-stu-id="e10eb-123">This sample is located in the following directory.</span></span>
>
> `<InstallDrive>:\WF_WCF_Samples\WF\Scenario\ExternalRuleSetToolKit`

## <a name="ruleset-tool"></a><span data-ttu-id="e10eb-124">Strumento di RuleSet</span><span class="sxs-lookup"><span data-stu-id="e10eb-124">RuleSet Tool</span></span>

<span data-ttu-id="e10eb-125">L'immagine seguente è una schermata dello strumento di RuleSet.</span><span class="sxs-lookup"><span data-stu-id="e10eb-125">The following image is a screenshot of the RuleSet tool.</span></span> <span data-ttu-id="e10eb-126">Dal menu **archivio regole** è possibile caricare i RuleSet disponibili dal database e salvare di nuovo i RuleSet modificati nell'archivio.</span><span class="sxs-lookup"><span data-stu-id="e10eb-126">From the **Rule Store** menu, you can load the available RuleSets from the database and save modified RuleSets back to the store.</span></span> <span data-ttu-id="e10eb-127">Un file di configurazione dell'applicazione fornisce una stringa di connessione al database per il database di RuleSet.</span><span class="sxs-lookup"><span data-stu-id="e10eb-127">An application configuration file provides a database connection string for the RuleSet database.</span></span> <span data-ttu-id="e10eb-128">Quando si avvia lo strumento, carica automaticamente RuleSet dal database configurato.</span><span class="sxs-lookup"><span data-stu-id="e10eb-128">When you start the tool, it automatically loads the RuleSets from the configured database.</span></span>

![Screenshot che illustra il browser di RuleSet.](./media/external-ruleset-toolkit/ruleset-browser-dialog.gif)

<span data-ttu-id="e10eb-130">Lo strumento di RuleSet applica numeri di versioni principali e secondarie ai RuleSet, consentendo di gestire e archiviare simultaneamente più versioni (lo strumento non fornisce blocco o altra funzionalità di gestione della configurazione oltre alla funzionalità di controllo delle versioni).</span><span class="sxs-lookup"><span data-stu-id="e10eb-130">The RuleSet tool applies major and minor version numbers to the RuleSets, allowing you to simultaneously maintain and store multiple versions (the tool provides no locking or other configuration management features in addition to the versioning capability).</span></span> <span data-ttu-id="e10eb-131">Usando lo strumento, è possibile creare nuove versioni di RuleSet o eliminare versioni esistenti.</span><span class="sxs-lookup"><span data-stu-id="e10eb-131">Using the tool, you can create new RuleSet versions or delete existing versions.</span></span> <span data-ttu-id="e10eb-132">Quando si fa clic su **nuovo**, lo strumento crea un nuovo nome di RuleSet e applica la versione 1,0.</span><span class="sxs-lookup"><span data-stu-id="e10eb-132">When you click **New**, the tool creates a new RuleSet name and applies version 1.0.</span></span> <span data-ttu-id="e10eb-133">Quando si copia una versione, lo strumento crea una copia della versione dell'oggetto RuleSet selezionata, incluse le regole contenute e assegna numeri di versione nuovi e univoci.</span><span class="sxs-lookup"><span data-stu-id="e10eb-133">When you copy a version, the tool creates a copy of the selected RuleSet version, including the contained rules, and assigns new, unique version numbers.</span></span> <span data-ttu-id="e10eb-134">Questi numeri di versione sono basati sui numeri di versione di RuleSet esistenti.</span><span class="sxs-lookup"><span data-stu-id="e10eb-134">These version numbers are based on the version numbers of existing RuleSets.</span></span> <span data-ttu-id="e10eb-135">È possibile modificare il nome e i numeri di versione di RuleSet usando i campi associati sulla maschera.</span><span class="sxs-lookup"><span data-stu-id="e10eb-135">You can change the RuleSet name and version numbers using the associated fields on the form.</span></span>

<span data-ttu-id="e10eb-136">Quando si fa clic su **modifica regole**, viene avviato l'editor di RuleSet, come illustrato nell'immagine seguente:</span><span class="sxs-lookup"><span data-stu-id="e10eb-136">When you click **Edit Rules**, the RuleSet editor starts, as shown in the following image:</span></span>

![Screenshot che illustra l'editor di RuleSet.](./media/external-ruleset-toolkit/ruleset-editor-dialog.gif)

<span data-ttu-id="e10eb-138">Si tratta di un nuovo hosting della finestra di dialogo dell'editor che fa parte del componente aggiuntivo Windows Workflow Foundation Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e10eb-138">This is a re-hosting of the editor dialog that is part of the Windows Workflow Foundation Visual Studio add-in.</span></span> <span data-ttu-id="e10eb-139">Fornisce la stessa funzionalità, incluso il supporto di Intellisense.</span><span class="sxs-lookup"><span data-stu-id="e10eb-139">It provides the same functionality, including Intellisense support.</span></span> <span data-ttu-id="e10eb-140">Le regole vengono create in base a un tipo di destinazione, ad esempio un flusso di lavoro, associato al RuleSet nello strumento. Quando si fa clic su **Sfoglia** nella finestra di dialogo principale dello strumento, viene visualizzata la finestra di dialogo **flusso di lavoro/Selettore tipo** , come illustrato nella figura 4.</span><span class="sxs-lookup"><span data-stu-id="e10eb-140">The rules are authored against a target type (such as a workflow) that is associated with the RuleSet in the tool; when you click **Browse** in the main tool dialog, the **Workflow/Type Selector** dialog appears, as shown in Figure 4.</span></span>

<span data-ttu-id="e10eb-141">![Selezione &#47;tipo di flusso di lavoro](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span><span class="sxs-lookup"><span data-stu-id="e10eb-141">![Workflow &#47;Type Selection](./media/71f08d57-e8f2-499e-8151-ece2cbdcabfd.gif "71f08d57-e8f2-499e-8151-ece2cbdcabfd")</span></span>

<span data-ttu-id="e10eb-142">Figura 4: Flusso di lavoro/Selettore del tipo</span><span class="sxs-lookup"><span data-stu-id="e10eb-142">Figure 4: Workflow/Type Selector</span></span>

<span data-ttu-id="e10eb-143">È possibile utilizzare la finestra di dialogo **flusso di lavoro/Selettore del tipo** per specificare un assembly e un tipo specifico all'interno di tale assembly.</span><span class="sxs-lookup"><span data-stu-id="e10eb-143">You can use the **Workflow/Type Selector** dialog to specify an assembly and a specific type within that assembly.</span></span> <span data-ttu-id="e10eb-144">Questo tipo è il tipo di destinazione in base al quale vengono create (ed eseguite) le regole.</span><span class="sxs-lookup"><span data-stu-id="e10eb-144">This type is the target type against which the rules are authored (and run).</span></span> <span data-ttu-id="e10eb-145">In molti casi, il tipo di destinazione è un flusso di lavoro o un altro tipo di attività.</span><span class="sxs-lookup"><span data-stu-id="e10eb-145">In many cases, the target type is a workflow or some other activity type.</span></span> <span data-ttu-id="e10eb-146">Tuttavia, è possibile eseguire un RuleSet in base a qualsiasi tipo .NET.</span><span class="sxs-lookup"><span data-stu-id="e10eb-146">However, you can run a RuleSet against any .NET type.</span></span>

<span data-ttu-id="e10eb-147">Il percorso del file di assembly e il tipo `name are stored with the` RuleSet nel database, in modo che quando il set di regole viene recuperato dal database, lo strumento tenta di caricare automaticamente il tipo di destinazione.</span><span class="sxs-lookup"><span data-stu-id="e10eb-147">The path to the assembly file and the type `name are stored with the` RuleSet in the database, so that when the RuleSet is retrieved from the database, the tool attempts to automatically load the target type.</span></span>

<span data-ttu-id="e10eb-148">Quando si fa clic su **OK** nella finestra di dialogo **flusso di lavoro/Selettore del tipo** , il tipo selezionato viene convalidato in base al set di regole per garantire che il tipo di destinazione includa tutti i membri a cui fanno riferimento le regole.</span><span class="sxs-lookup"><span data-stu-id="e10eb-148">When you click **OK** in the **Workflow/Type Selector** dialog, it validates the selected type against the RuleSet, to ensure that the target type has all the members referenced by the rules.</span></span> <span data-ttu-id="e10eb-149">Gli errori vengono visualizzati nella finestra di dialogo **errori di convalida** .</span><span class="sxs-lookup"><span data-stu-id="e10eb-149">Errors are shown in a **Validation Errors** dialog.</span></span> <span data-ttu-id="e10eb-150">È possibile scegliere di continuare con la modifica nonostante gli errori oppure fare clic su **Annulla**.</span><span class="sxs-lookup"><span data-stu-id="e10eb-150">You can choose to continue with the change despite the errors, or click **Cancel**.</span></span> <span data-ttu-id="e10eb-151">Dal menu **strumenti** della finestra di dialogo principale dello strumento è possibile fare clic su **convalida** per convalidare nuovamente la versione di RuleSet rispetto all'attività di destinazione.</span><span class="sxs-lookup"><span data-stu-id="e10eb-151">From the **Tools** menu in the main tool dialog, you can click **Validate** to re-validate the RuleSet version against the target activity.</span></span>

![Screenshot che mostra la finestra di dialogo errori di convalida.](./media/external-ruleset-toolkit/validation-errors-dialog.png)

<span data-ttu-id="e10eb-153">Dal menu **dati** dello strumento è possibile importare ed esportare i RuleSet.</span><span class="sxs-lookup"><span data-stu-id="e10eb-153">From the **Data** menu in the tool, you can import and export RuleSets.</span></span> <span data-ttu-id="e10eb-154">Quando si fa clic su **Importa**, viene visualizzata una finestra di dialogo di selezione dei file dalla quale è possibile selezionare un file con estensione rules.</span><span class="sxs-lookup"><span data-stu-id="e10eb-154">When you click **Import**, a file-chooser dialog appears, from which you can select a .rules file.</span></span> <span data-ttu-id="e10eb-155">Questo potrebbe essere un file creato inizialmente in Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e10eb-155">This may or may not be a file initially created in Visual Studio.</span></span> <span data-ttu-id="e10eb-156">Il file con estensione rules deve contenere un'istanza `RuleDefinitions` serializzata contenente una raccolta di condizioni e una raccolta di RuleSet.</span><span class="sxs-lookup"><span data-stu-id="e10eb-156">The .rules file should contain a serialized `RuleDefinitions` instance that contains a collection of conditions and a collection of RuleSets.</span></span> <span data-ttu-id="e10eb-157">Lo strumento non usa la raccolta Conditions, ma usa il formato `RuleDefinitions`. Rules per consentire l'interazione con l'ambiente di Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e10eb-157">The tool does not use the conditions collection, but it does use the `RuleDefinitions` .rules format to allow interaction with the Visual Studio environment.</span></span>

<span data-ttu-id="e10eb-158">Dopo aver selezionato un file con estensione rules, viene visualizzata una finestra di dialogo di **selezione di RuleSet** .</span><span class="sxs-lookup"><span data-stu-id="e10eb-158">After selecting a .rules file, a **RuleSet Selector** dialog appears.</span></span> <span data-ttu-id="e10eb-159">È possibile usare la finestra di dialogo per selezionare gli oggetti RuleSet dal file che si desidera importare (l'impostazione predefinita specifica tutti gli oggetti RuleSet).</span><span class="sxs-lookup"><span data-stu-id="e10eb-159">You can use the dialog to select the RuleSets from the file that you want to import (the default specifies all RuleSets).</span></span> <span data-ttu-id="e10eb-160">I RuleSet nel file con estensione rules non hanno numeri di versione, in quanto il loro controllo delle versioni all’interno di un progetto WF corrisponde alla versione dell'assembly.</span><span class="sxs-lookup"><span data-stu-id="e10eb-160">RuleSets in the .rules file do not have version numbers, because their versioning within a WF project is the same as the version of the assembly.</span></span> <span data-ttu-id="e10eb-161">Durante il processo di importazione, lo strumento assegna automaticamente il successivo numero di versione principale disponibile, che può essere modificato dopo l'importazione. è possibile visualizzare i numeri di versione assegnati nell'elenco dei **selettori di RuleSet** .</span><span class="sxs-lookup"><span data-stu-id="e10eb-161">During the importing process, the tool automatically assigns the next available major version number (which you can change after importing); you can see the assigned version numbers in the **RuleSet Selector** list.</span></span>

<span data-ttu-id="e10eb-162">Per ogni RuleSet importato, lo strumento tenta di individuare il tipo associato dalla cartella bin\Debug nel percorso del file con estensione rules (se esiste), basato sui membri usati in RuleSet.</span><span class="sxs-lookup"><span data-stu-id="e10eb-162">For each RuleSet it imports, the tool attempts to locate the associated type from the bin\Debug folder under the location of the .rules file (if it exists), based on the members used in the RuleSet.</span></span> <span data-ttu-id="e10eb-163">Se trova più tipi corrispondenti, lo strumento tenta di scegliere un tipo in base alla corrispondenza tra il nome del file con estensione rules e il nome del tipo (ad esempio, il tipo `Workflow1` corrisponde a Workflow1.rules).</span><span class="sxs-lookup"><span data-stu-id="e10eb-163">If the tool finds multiple matching types, it attempts to choose a type based on a match between the .rules file name and the type name (for example, the `Workflow1` type corresponds to Workflow1.rules).</span></span> <span data-ttu-id="e10eb-164">Se esistono più corrispondenze, viene richiesto di selezionare il tipo.</span><span class="sxs-lookup"><span data-stu-id="e10eb-164">If multiple matches exist, you are prompted to select the type.</span></span> <span data-ttu-id="e10eb-165">Se il meccanismo di identificazione automatica non riesce a individuare un assembly o un tipo corrispondente, dopo l'importazione è possibile fare clic su **Sfoglia** nella finestra di dialogo principale dello strumento per passare al tipo associato.</span><span class="sxs-lookup"><span data-stu-id="e10eb-165">If this auto-identification mechanism fails to locate a matching assembly or type, then after importing you can click **Browse** on the main tool dialog to navigate to the associated type.</span></span> <span data-ttu-id="e10eb-166">La figura seguente illustra il selettore di RuleSet:</span><span class="sxs-lookup"><span data-stu-id="e10eb-166">The following image shows the RuleSet Selector:</span></span>

![Screenshot che mostra la finestra di dialogo del Selettore RuleSet](./media/external-ruleset-toolkit/ruleset-selector-dialog.gif)

<span data-ttu-id="e10eb-168">Quando si fa clic su **Data-Export** dal menu principale dello strumento, viene nuovamente visualizzata la finestra di dialogo del **selettore di RuleSet** , da cui è possibile determinare i RuleSet dal database che deve essere esportato.</span><span class="sxs-lookup"><span data-stu-id="e10eb-168">When you click **Data-Export** from the main tool menu, the **RuleSet Selector** dialog appears again, from which you can determine the RuleSets from the database that should be exported.</span></span> <span data-ttu-id="e10eb-169">Quando si fa clic su **OK**, viene visualizzata la finestra di dialogo **Salva file** , nella quale è possibile specificare il nome e il percorso del file con estensione rules risultante.</span><span class="sxs-lookup"><span data-stu-id="e10eb-169">When you click **OK**, a **Save File** dialog appears, in which you can specify the name and location of the resulting .rules file.</span></span> <span data-ttu-id="e10eb-170">Dato che il file con estensione rules non contiene informazioni sulla versione, è possibile selezionare soltanto una versione di RuleSet con un determinato nome di RuleSet.</span><span class="sxs-lookup"><span data-stu-id="e10eb-170">Because the .rules file does not contain version information, you can only select one RuleSet version with a given RuleSet name.</span></span>

## <a name="policyfromservice-activity"></a><span data-ttu-id="e10eb-171">Attività PolicyFromService</span><span class="sxs-lookup"><span data-stu-id="e10eb-171">PolicyFromService Activity</span></span>

<span data-ttu-id="e10eb-172">Il codice dell’attività `PolicyFromService` è semplice.</span><span class="sxs-lookup"><span data-stu-id="e10eb-172">The code for the `PolicyFromService` activity is straightforward.</span></span> <span data-ttu-id="e10eb-173">Funziona in modo molto simile all’attività `Policy` fornita con WF, ma invece di recuperare il RuleSet di destinazione dal file con estensione rules, chiama un servizio host per ottenere l'istanza di RuleSet.</span><span class="sxs-lookup"><span data-stu-id="e10eb-173">It works much like the `Policy` activity provided with WF, but instead of retrieving the target RuleSet from the .rules file, it calls a host service to obtain the RuleSet instance.</span></span> <span data-ttu-id="e10eb-174">Esegue quindi il RuleSet in base all’istanza dell'attività del flusso di lavoro radice.</span><span class="sxs-lookup"><span data-stu-id="e10eb-174">It then runs the RuleSet against the root workflow activity instance.</span></span>

<span data-ttu-id="e10eb-175">Per usare l’attività in un flusso di lavoro, aggiungere un riferimento agli assembly `PolicyActivities` e `RuleSetService` dal progetto flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="e10eb-175">To use the activity in a workflow, add a reference to the `PolicyActivities` and `RuleSetService` assemblies from your workflow project.</span></span> <span data-ttu-id="e10eb-176">Vedere la procedura riportata alla fine di questo argomento per una discussione su come aggiungere l'attività alla casella degli strumenti.</span><span class="sxs-lookup"><span data-stu-id="e10eb-176">See the procedure at the end of this topic for a discussion of how to add the activity to the toolbox.</span></span>

<span data-ttu-id="e10eb-177">Dopo avere posizionato l'attività nel flusso di lavoro, è necessario fornire il nome del RuleSet da eseguire.</span><span class="sxs-lookup"><span data-stu-id="e10eb-177">After placing the activity in your workflow, you must provide the name of the RuleSet to be run.</span></span> <span data-ttu-id="e10eb-178">È possibile immettere il nome come valore letterale o creare un’associazione a una variabile o proprietà del flusso di lavoro di un'altra attività.</span><span class="sxs-lookup"><span data-stu-id="e10eb-178">You can enter the name as a literal value, or bind to a workflow variable or property of another activity.</span></span> <span data-ttu-id="e10eb-179">Facoltativamente, è possibile immettere numeri di versione per l’esecuzione di un RuleSet specifico.</span><span class="sxs-lookup"><span data-stu-id="e10eb-179">Optionally, you can enter version numbers for the specific RuleSet that should be run.</span></span> <span data-ttu-id="e10eb-180">Se si lascia il valore predefinito di 0 per i numeri di versioni principali e secondarie, il numero della versione più recente nel database viene fornito automaticamente per l'attività.</span><span class="sxs-lookup"><span data-stu-id="e10eb-180">If you leave the default value of 0 for the major and minor version numbers, the latest version number in the database is automatically provided for the activity.</span></span>

## <a name="ruleset-service"></a><span data-ttu-id="e10eb-181">Servizio RuleSet</span><span class="sxs-lookup"><span data-stu-id="e10eb-181">RuleSet Service</span></span>

<span data-ttu-id="e10eb-182">Il servizio è responsabile del recupero della versione di RuleSet specificata dal database e della sua restituzione all'attività chiamante.</span><span class="sxs-lookup"><span data-stu-id="e10eb-182">The service is responsible for retrieving the specified RuleSet version from the database and returning it to the calling activity.</span></span> <span data-ttu-id="e10eb-183">Come già indicato, se i valori delle versioni principali e secondarie passati nella chiamata `GetRuleSet` sono entrambi 0, il servizio recupera la versione più recente.</span><span class="sxs-lookup"><span data-stu-id="e10eb-183">As previously discussed, if the major and minor version values passed in the `GetRuleSet` call are both 0, the service retrieves the latest version.</span></span> <span data-ttu-id="e10eb-184">In questa fase, non avviene nessuna memorizzazione nella cache di definizioni o istanze di RuleSet; analogamente, non sono previste funzionalità per contrassegnare le versioni di RuleSet come "distribuite" per differenziarle dai RuleSet in corso.</span><span class="sxs-lookup"><span data-stu-id="e10eb-184">At this point, there is no caching of RuleSet definitions or instances; similarly, there are no features for marking RuleSet versions as "deployed" to differentiate them from in-progress RuleSets.</span></span>

<span data-ttu-id="e10eb-185">Per accedere dal servizio, il database deve essere configurato sull’host usando un file di configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="e10eb-185">The database to be accessed by the service should be configured on the host using an application configuration file.</span></span>

#### <a name="to-run-the-tool"></a><span data-ttu-id="e10eb-186">Per eseguire lo strumento</span><span class="sxs-lookup"><span data-stu-id="e10eb-186">To run the tool</span></span>

1. <span data-ttu-id="e10eb-187">La cartella che configura la tabella di RuleSet usata dallo strumento e dal servizio contiene un file Setup.sql.</span><span class="sxs-lookup"><span data-stu-id="e10eb-187">The folder that sets up the RuleSet table used by the tool and the service contains a Setup.sql file.</span></span> <span data-ttu-id="e10eb-188">È possibile eseguire il file batch Setup.cmd per creare il database delle regole in SQL Express e configurare la tabella di RuleSet.</span><span class="sxs-lookup"><span data-stu-id="e10eb-188">You can run the Setup.cmd batch file to create the Rules database on SQL Express and to set up the RuleSet table.</span></span>

2. <span data-ttu-id="e10eb-189">Se si modifica il file batch o Setup.sql e si specifica di non usare SQL Express o di posizionare la tabella in un database con un nome diverso da `Rules`, i file di configurazione dell'applicazione nello strumento di RuleSet e i progetti `UsageSample` devono essere modificati con le stesse informazioni.</span><span class="sxs-lookup"><span data-stu-id="e10eb-189">If you edit the batch file or Setup.sql and specify not to use SQL Express or to place the table in a database named something other than `Rules`, the application configuration files in the RuleSet tool and `UsageSample` projects should be edited with the same information.</span></span>

3. <span data-ttu-id="e10eb-190">Dopo avere eseguito lo script Setup.sql, è possibile compilare la soluzione `ExternalRuleSetToolkit` e avviare quindi lo strumento di RuleSet dal progetto ExternalRuleSetTool.</span><span class="sxs-lookup"><span data-stu-id="e10eb-190">After you run the Setup.sql script, you can build the `ExternalRuleSetToolkit` solution and then launch the RuleSet tool from the ExternalRuleSetTool project.</span></span>

4. <span data-ttu-id="e10eb-191">La soluzione Applicazione console del flusso di lavoro sequenziale `RuleSetToolkitUsageSample` include un flusso di lavoro di esempio.</span><span class="sxs-lookup"><span data-stu-id="e10eb-191">The `RuleSetToolkitUsageSample` Sequential Workflow Console Application solution includes a sample workflow.</span></span> <span data-ttu-id="e10eb-192">Il flusso di lavoro è costituito da un'attività `PolicyFromService` e da due variabili, `orderValue` e `discount`, in base alle quali avviene l’esecuzione del RuleSet di destinazione.</span><span class="sxs-lookup"><span data-stu-id="e10eb-192">The workflow consists of a `PolicyFromService` activity and two variables, `orderValue` and `discount`, against which the target RuleSet runs.</span></span>

5. <span data-ttu-id="e10eb-193">Per eseguire l'esempio è necessario compilare la soluzione `RuleSetToolkitUsageSample`.</span><span class="sxs-lookup"><span data-stu-id="e10eb-193">To use the sample, build the `RuleSetToolkitUsageSample` solution.</span></span> <span data-ttu-id="e10eb-194">Quindi, dal menu principale dello strumento RuleSet, fare clic su **importazione dati** e puntare al file DiscountRuleSet. Rules nella cartella RuleSetToolkitUsageSample.</span><span class="sxs-lookup"><span data-stu-id="e10eb-194">Then from the RuleSet tool main menu, click **Data-Import** and point to the DiscountRuleSet.rules file in the RuleSetToolkitUsageSample folder.</span></span> <span data-ttu-id="e10eb-195">Fare clic sull'opzione di menu **archivio regole-Salva** per salvare il set di regole importato nel database.</span><span class="sxs-lookup"><span data-stu-id="e10eb-195">Click the **Rule Store-Save** menu option to save the imported RuleSet to the database.</span></span>

6. <span data-ttu-id="e10eb-196">Dato che il progetto del flusso di lavoro di esempio fa riferimento all’assembly `PolicyActivities`, l'attività `PolicyFromService` viene visualizzata nel flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="e10eb-196">Because the `PolicyActivities` assembly is referenced from the sample workflow project, the `PolicyFromService` activity appears in the workflow.</span></span> <span data-ttu-id="e10eb-197">Tuttavia, non viene visualizzata nella casella degli strumenti per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="e10eb-197">It does not, however, appear in the toolbox by default.</span></span> <span data-ttu-id="e10eb-198">Per aggiungerla alla casella degli strumenti, effettuare le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="e10eb-198">To add it to the toolbox, do the following:</span></span>

    - <span data-ttu-id="e10eb-199">Fare clic con il pulsante destro del mouse sulla casella degli strumenti e **scegliere Scegli elementi** . l'operazione potrebbe richiedere alcuni minuti.</span><span class="sxs-lookup"><span data-stu-id="e10eb-199">Right-click the toolbox and select **Choose Items** (this may take a while).</span></span>

    - <span data-ttu-id="e10eb-200">Quando viene visualizzata la finestra di dialogo **Scegli elementi della casella degli strumenti** , fare clic sulla scheda **attività** .</span><span class="sxs-lookup"><span data-stu-id="e10eb-200">When the **Choose Toolbox Items** dialog appears, click the **Activities** tab.</span></span>

    - <span data-ttu-id="e10eb-201">Passare all'assembly `PolicyActivities` nella soluzione `ExternalRuleSetToolkit` e fare clic su **Apri**.</span><span class="sxs-lookup"><span data-stu-id="e10eb-201">Browse to the `PolicyActivities` assembly in the `ExternalRuleSetToolkit` solution and click **Open**.</span></span>

    - <span data-ttu-id="e10eb-202">Verificare che l'attività `PolicyFromService` sia selezionata nella finestra di dialogo **Scegli elementi della casella degli strumenti** e quindi fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="e10eb-202">Ensure that the `PolicyFromService` activity is selected in the **Choose Toolbox Items** dialog and then click **OK**.</span></span>

    - <span data-ttu-id="e10eb-203">L'attività dovrebbe essere ora visualizzata nella casella degli strumenti nella categoria **componenti RuleSetToolkitUsageSample** .</span><span class="sxs-lookup"><span data-stu-id="e10eb-203">The activity should now appear in the toolbox in the **RuleSetToolkitUsageSample Components** category.</span></span>

7. <span data-ttu-id="e10eb-204">Il servizio di RuleSet viene già configurato sull’host dell'applicazione console usando l'istruzione seguente in Program.cs.</span><span class="sxs-lookup"><span data-stu-id="e10eb-204">The RuleSet service is already configured on the console application host using the following statement in Program.cs.</span></span>

    ```csharp
    workflowRuntime.AddService(new RuleSetService());
    ```

8. <span data-ttu-id="e10eb-205">È inoltre possibile configurare il servizio sull’host usando un file di configurazione; per ulteriori informazioni, vedere la documentazione SDK.</span><span class="sxs-lookup"><span data-stu-id="e10eb-205">You can also configure the service on the host using a configuration file; see the SDK documentation for details.</span></span>

9. <span data-ttu-id="e10eb-206">Un file di configurazione dell'applicazione viene aggiunto al progetto flusso di lavoro per specificare la stringa di connessione per il database che deve essere usato dal servizio.</span><span class="sxs-lookup"><span data-stu-id="e10eb-206">An application configuration file is added to the workflow project to specify the connection string for the database to be used by the service.</span></span> <span data-ttu-id="e10eb-207">Deve trattarsi della stessa stringa di connessione usata dallo strumento di RuleSet che punta al database contenente la tabella di RuleSet.</span><span class="sxs-lookup"><span data-stu-id="e10eb-207">This should be the same connection string used by the RuleSet tool, which points to the database that contains the RuleSet table.</span></span>

10. <span data-ttu-id="e10eb-208">È ora possibile eseguire il progetto `RuleSetToolkitUsageSample` nello stesso modo in cui si eseguirebbe qualsiasi altra applicazione console del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="e10eb-208">You can now run the `RuleSetToolkitUsageSample` project as you would any other workflow console application.</span></span> <span data-ttu-id="e10eb-209">Premere F5 o CTRL + F5 in Visual Studio oppure eseguire direttamente il file RuleSetToolkitUsageSample. exe.</span><span class="sxs-lookup"><span data-stu-id="e10eb-209">Press F5 or Ctrl+F5 within Visual Studio or run the RuleSetToolkitUsageSample.exe file directly.</span></span>

    > [!NOTE]
    > <span data-ttu-id="e10eb-210">È necessario chiudere lo strumento di RuleSet per ricompilare l'esempio di utilizzo, in quanto lo strumento carica l'assembly dell'esempio di utilizzo.</span><span class="sxs-lookup"><span data-stu-id="e10eb-210">You must close the RuleSet tool to recompile the usage sample, because the tool loads the usage sample assembly.</span></span>
