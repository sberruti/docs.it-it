---
title: Utilizzo di feed OData da un flusso di lavoro-WF
ms.date: 03/30/2017
ms.assetid: 1b26617c-53e9-476a-81af-675c36d95919
ms.openlocfilehash: ceac2c2d07351fcb79e2345068f07fa22f356411
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/24/2020
ms.locfileid: "76743788"
---
# <a name="consuming-odata-feeds-from-a-workflow"></a><span data-ttu-id="3e58b-102">Utilizzo di feed OData da un flusso di lavoro</span><span class="sxs-lookup"><span data-stu-id="3e58b-102">Consuming OData feeds from a workflow</span></span>

<span data-ttu-id="3e58b-103">WCF Data Services è un componente del .NET Framework che consente di creare servizi che utilizzano il Open Data Protocol (OData) per esporre e utilizzare dati sul Web o su Intranet tramite la semantica REST (Representational State Transfer).</span><span class="sxs-lookup"><span data-stu-id="3e58b-103">WCF Data Services is a component of the .NET Framework that enables you to create services that use the Open Data Protocol (OData) to expose and consume data over the Web or intranet by using the semantics of representational state transfer (REST).</span></span> <span data-ttu-id="3e58b-104">OData espone i dati come risorse indirizzabili tramite URI.</span><span class="sxs-lookup"><span data-stu-id="3e58b-104">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="3e58b-105">Un'applicazione può interagire con un servizio dati basato su OData quando è in grado di inviare una richiesta HTTP e di elaborare il feed OData restituito da un servizio dati.</span><span class="sxs-lookup"><span data-stu-id="3e58b-105">Any application can interact with an OData-based data service if it can send an HTTP request and process the OData feed that a data service returns.</span></span> <span data-ttu-id="3e58b-106">Inoltre, WCF Data Services include librerie client che forniscono un'esperienza di programmazione più completa quando si utilizzano feed OData da .NET Framework applicazioni.</span><span class="sxs-lookup"><span data-stu-id="3e58b-106">In addition, WCF Data Services includes client libraries that provide a richer programming experience when you consume OData feeds from .NET Framework applications.</span></span> <span data-ttu-id="3e58b-107">In questo argomento viene fornita una panoramica sull'uso di un feed OData in un flusso di lavoro con e senza librerie client.</span><span class="sxs-lookup"><span data-stu-id="3e58b-107">This topic provides an overview of consuming an OData feed in a workflow with and without using the client libraries.</span></span>

## <a name="using-the-sample-northwind-odata-service"></a><span data-ttu-id="3e58b-108">Utilizzo del servizio Northwind OData di esempio</span><span class="sxs-lookup"><span data-stu-id="3e58b-108">Using the sample Northwind OData service</span></span>

<span data-ttu-id="3e58b-109">Gli esempi in questo argomento usano il servizio dati Northwind di esempio disponibile in <https://services.odata.org/Northwind/Northwind.svc/>.</span><span class="sxs-lookup"><span data-stu-id="3e58b-109">The examples in this topic use the sample Northwind data service located at <https://services.odata.org/Northwind/Northwind.svc/>.</span></span> <span data-ttu-id="3e58b-110">Il servizio viene fornito come parte di [OData SDK](https://www.odata.org/ecosystem/#sdk) e consente di accedere in sola lettura al database Northwind di esempio.</span><span class="sxs-lookup"><span data-stu-id="3e58b-110">This service is provided as part of the [OData SDK](https://www.odata.org/ecosystem/#sdk) and provides read-only access to the sample Northwind database.</span></span> <span data-ttu-id="3e58b-111">Se si desidera ottenere l'accesso in scrittura o un'istanza di WCF Data Services locale, seguire la procedura descritta in [Guida rapida (WCF Data Services)](../data/wcf/quickstart-wcf-data-services.md) per creare un servizio OData locale che consenta di accedere al database Northwind.</span><span class="sxs-lookup"><span data-stu-id="3e58b-111">If write access is desired, or if a local WCF Data Service is desired, you can follow the steps of the [WCF Data Services Quickstart](../data/wcf/quickstart-wcf-data-services.md) to create a local OData service that provides access to the Northwind database.</span></span> <span data-ttu-id="3e58b-112">Se si eseguono le operazioni indicate nella guida rapida, sostituire l'URI locale a quello indicato nel codice di esempio in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="3e58b-112">If you follow the quickstart, substitute the local URI for the one provided in the example code in this topic.</span></span>

## <a name="consuming-an-odata-feed-using-the-client-libraries"></a><span data-ttu-id="3e58b-113">Utilizzo di un feed OData tramite le librerie client</span><span class="sxs-lookup"><span data-stu-id="3e58b-113">Consuming an OData feed using the client libraries</span></span>

<span data-ttu-id="3e58b-114">WCF Data Services include librerie client che consentono di utilizzare più facilmente un feed OData da .NET Framework e applicazioni client.</span><span class="sxs-lookup"><span data-stu-id="3e58b-114">WCF Data Services includes client libraries that enable you to more easily consume an OData feed from .NET Framework and client applications.</span></span> <span data-ttu-id="3e58b-115">Queste librerie semplificano l'invio e la ricezione di messaggi HTTP,</span><span class="sxs-lookup"><span data-stu-id="3e58b-115">These libraries simplify sending and receiving HTTP messages.</span></span> <span data-ttu-id="3e58b-116">oltre a convertire il payload del messaggio in oggetti CLR che rappresentano dati di entità.</span><span class="sxs-lookup"><span data-stu-id="3e58b-116">They also translate the message payload into CLR objects that represent entity data.</span></span> <span data-ttu-id="3e58b-117">Le librerie client rendono disponibili le due classi principali <xref:System.Data.Services.Client.DataServiceContext> e <xref:System.Data.Services.Client.DataServiceQuery%601></span><span class="sxs-lookup"><span data-stu-id="3e58b-117">The client libraries feature the two core classes <xref:System.Data.Services.Client.DataServiceContext> and <xref:System.Data.Services.Client.DataServiceQuery%601>.</span></span> <span data-ttu-id="3e58b-118">che consentono di eseguire una query su un servizio dati e di usare quindi i dati di entità restituiti come oggetti CLR.</span><span class="sxs-lookup"><span data-stu-id="3e58b-118">These classes enable you to query a data service and then work with the returned entity data as CLR objects.</span></span> <span data-ttu-id="3e58b-119">Contenuto della sezione vengono descritti due approcci alla creazione di attività che usano le librerie client.</span><span class="sxs-lookup"><span data-stu-id="3e58b-119">This section covers two approaches to creating activities that use the client libraries.</span></span>

### <a name="adding-a-service-reference-to-the-wcf-data-service"></a><span data-ttu-id="3e58b-120">Aggiunta di un riferimento al servizio WCF Data Services</span><span class="sxs-lookup"><span data-stu-id="3e58b-120">Adding a service reference to the WCF Data service</span></span>

<span data-ttu-id="3e58b-121">Per generare le librerie client Northwind, è possibile usare la finestra di dialogo **Aggiungi riferimento al servizio** in Visual Studio 2012 per aggiungere un riferimento al servizio Northwind OData.</span><span class="sxs-lookup"><span data-stu-id="3e58b-121">To generate the Northwind client libraries, you can use the **Add Service Reference** dialog box in Visual Studio 2012 to add a reference to the Northwind OData service.</span></span>

![Screenshot che mostra la finestra di dialogo Aggiungi riferimento al servizio.](./media/consuming-odata-feeds-from-a-workflow/add-service-reference-dialog.gif)

<span data-ttu-id="3e58b-123">Si noti che non sono presenti operazioni del servizio esposte dal servizio stesso e che nell'elenco **Servizi** sono contenuti elementi che rappresentano le entità esposte dal servizio dati Northwind.</span><span class="sxs-lookup"><span data-stu-id="3e58b-123">Note that there are no service operations exposed by the service, and in the **Services** list there are items representing the entities exposed by the Northwind data service.</span></span> <span data-ttu-id="3e58b-124">Quando si aggiunge il riferimento al servizio, le classi verranno generate per queste entità e sarà possibile usarle nel codice client.</span><span class="sxs-lookup"><span data-stu-id="3e58b-124">When the service reference is added, classes will be generated for these entities and they can be used in the client code.</span></span> <span data-ttu-id="3e58b-125">Negli esempi di questo argomento vengono usate tali classi e la classe `NorthwindEntities` per eseguire le query.</span><span class="sxs-lookup"><span data-stu-id="3e58b-125">The examples in this topic use these classes and the `NorthwindEntities` class to perform the queries.</span></span>

> [!NOTE]
> <span data-ttu-id="3e58b-126">Per ulteriori informazioni, vedere [generazione della libreria client del servizio dati (WCF Data Services)](../data/wcf/generating-the-data-service-client-library-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="3e58b-126">For more information, see [Generating the Data Service Client Library (WCF Data Services)](../data/wcf/generating-the-data-service-client-library-wcf-data-services.md).</span></span>

### <a name="using-asynchronous-methods"></a><span data-ttu-id="3e58b-127">Uso di metodi asincroni</span><span class="sxs-lookup"><span data-stu-id="3e58b-127">Using asynchronous methods</span></span>

<span data-ttu-id="3e58b-128">Per risolvere possibili problemi di latenza che potrebbero verificarsi quando si accede a risorse sul Web, è consigliabile accedere a WCF Data Services in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="3e58b-128">To address possible latency issues that may occur when accessing resources over the Web, we recommend accessing WCF Data Services asynchronously.</span></span> <span data-ttu-id="3e58b-129">Le librerie client di WCF Data Services includono metodi asincroni per richiamare query e Windows Workflow Foundation (WF) fornisce la classe <xref:System.Activities.AsyncCodeActivity> per la creazione di attività asincrone.</span><span class="sxs-lookup"><span data-stu-id="3e58b-129">The WCF Data Services client libraries include asynchronous methods for invoking queries, and Windows Workflow Foundation (WF) provides the <xref:System.Activities.AsyncCodeActivity> class for authoring asynchronous activities.</span></span> <span data-ttu-id="3e58b-130"><xref:System.Activities.AsyncCodeActivity> è possibile scrivere attività derivate per sfruttare i vantaggi delle classi .NET Framework con metodi asincroni oppure il codice da eseguire in modo asincrono può essere inserito in un metodo e richiamato tramite un delegato.</span><span class="sxs-lookup"><span data-stu-id="3e58b-130"><xref:System.Activities.AsyncCodeActivity> derived activities can be written to take advantage of .NET Framework classes that have asynchronous methods, or the code to be executed asynchronously can be put into a method and invoked by using a delegate.</span></span> <span data-ttu-id="3e58b-131">Contenuto della sezione vengono forniti due esempi di un'attività derivata <xref:System.Activities.AsyncCodeActivity> : in uno vengono usati i metodi asincroni delle librerie client di WCF Data Services e nell'altro viene usato un delegato.</span><span class="sxs-lookup"><span data-stu-id="3e58b-131">This section provides two examples of an <xref:System.Activities.AsyncCodeActivity> derived activity; one that uses the asynchronous methods of the WCF Data Services client libraries and one that uses a delegate.</span></span>

> [!NOTE]
> <span data-ttu-id="3e58b-132">Per altre informazioni, vedere [operazioni asincrone (WCF Data Services)](../data/wcf/asynchronous-operations-wcf-data-services.md) e [creazione di attività asincrone](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="3e58b-132">For more information, see [Asynchronous Operations (WCF Data Services)](../data/wcf/asynchronous-operations-wcf-data-services.md) and [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>

### <a name="using-client-library-asynchronous-methods"></a><span data-ttu-id="3e58b-133">Uso di metodi asincroni della libreria client</span><span class="sxs-lookup"><span data-stu-id="3e58b-133">Using client library asynchronous methods</span></span>

<span data-ttu-id="3e58b-134">La classe <xref:System.Data.Services.Client.DataServiceQuery%601> fornisce i metodi <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> e <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> per l'esecuzione asincrona di una query su un servizio OData.</span><span class="sxs-lookup"><span data-stu-id="3e58b-134">The <xref:System.Data.Services.Client.DataServiceQuery%601> class provides <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> and <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> methods for querying an OData service asynchronously.</span></span> <span data-ttu-id="3e58b-135">Tali metodi possono essere chiamati da <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> , mentre <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> esegue l'override di una classe <xref:System.Activities.AsyncCodeActivity> derivata.</span><span class="sxs-lookup"><span data-stu-id="3e58b-135">These methods can be called from the <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> overrides of an <xref:System.Activities.AsyncCodeActivity> derived class.</span></span> <span data-ttu-id="3e58b-136">Quando viene restituito il <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override, il flusso di lavoro può diventare inattivo (ma non persistente) e, al termine del lavoro asincrono, <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> viene richiamato dal runtime.</span><span class="sxs-lookup"><span data-stu-id="3e58b-136">When the <xref:System.Activities.AsyncCodeActivity> <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override returns, the workflow can go idle (but not persist), and when the asynchronous work is completed, <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> is invoked by the runtime.</span></span>

<span data-ttu-id="3e58b-137">Nell'esempio seguente viene definita un'attività `OrdersByCustomer` che dispone di due argomenti di input.</span><span class="sxs-lookup"><span data-stu-id="3e58b-137">In the following example, an `OrdersByCustomer` activity is defined that has two input arguments.</span></span> <span data-ttu-id="3e58b-138">L'argomento `CustomerId` rappresenta il cliente che identifica gli ordini da restituire, mentre l'argomento `ServiceUri` rappresenta l'URI del servizio OData su cui eseguire una query.</span><span class="sxs-lookup"><span data-stu-id="3e58b-138">The `CustomerId` argument represents the customer who identifies which orders to return, and the `ServiceUri` argument represents the URI of the OData service to be queried.</span></span> <span data-ttu-id="3e58b-139">Poiché l'attività deriva da `AsyncCodeActivity<IEnumerable<Order>>` , è presente anche un argomento di output <xref:System.Activities.Activity%601.Result%2A> usato per restituire i risultati della query.</span><span class="sxs-lookup"><span data-stu-id="3e58b-139">Because the activity derives from `AsyncCodeActivity<IEnumerable<Order>>` there is also a <xref:System.Activities.Activity%601.Result%2A> output argument that is used to return the results of the query.</span></span> <span data-ttu-id="3e58b-140">L'override <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> crea una query LINQ che seleziona tutti gli ordini del cliente specificato.</span><span class="sxs-lookup"><span data-stu-id="3e58b-140">The <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override creates a LINQ query that selects all orders of the specified customer.</span></span> <span data-ttu-id="3e58b-141">Tale query viene specificata come la proprietà <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> dell'oggetto <xref:System.Activities.AsyncCodeActivityContext>passato e successivamente viene chiamato il metodo <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> della query.</span><span class="sxs-lookup"><span data-stu-id="3e58b-141">This query is specified as the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A> of the passed <xref:System.Activities.AsyncCodeActivityContext>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> method is called.</span></span> <span data-ttu-id="3e58b-142">Si noti che il callback e lo stato passati al metodo <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> della query sono gli stessi passati al metodo <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> dell'attività.</span><span class="sxs-lookup"><span data-stu-id="3e58b-142">Note that the callback and state that are passed into the query's <xref:System.Data.Services.Client.DataServiceQuery%601.BeginExecute%2A> are the ones that are passed in to the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> method.</span></span> <span data-ttu-id="3e58b-143">Dopo che la query è stata eseguita, viene richiamato il metodo <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> dell'attività.</span><span class="sxs-lookup"><span data-stu-id="3e58b-143">When the query has finished executing, the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> method is invoked.</span></span> <span data-ttu-id="3e58b-144">Successivamente, la query viene recuperata da <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>e viene chiamato il metodo <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> della query</span><span class="sxs-lookup"><span data-stu-id="3e58b-144">The query is retrieved from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then the query's <xref:System.Data.Services.Client.DataServiceQuery%601.EndExecute%2A> method is called.</span></span> <span data-ttu-id="3e58b-145">che restituisce un oggetto <xref:System.Collections.Generic.IEnumerable%601> del tipo di entità specificato, in questo caso `Order`.</span><span class="sxs-lookup"><span data-stu-id="3e58b-145">This method returns an <xref:System.Collections.Generic.IEnumerable%601> of the specified entity type; in this case `Order`.</span></span> <span data-ttu-id="3e58b-146">Poiché `IEnumerable<Order>` è il tipo generico di <xref:System.Activities.AsyncCodeActivity%601>, questo <xref:System.Collections.IEnumerable> viene impostato come <xref:System.Activities.OutArgument%601> <xref:System.Activities.Activity%601.Result%2A> dell'attività.</span><span class="sxs-lookup"><span data-stu-id="3e58b-146">Since `IEnumerable<Order>` is the generic type of the <xref:System.Activities.AsyncCodeActivity%601>, this <xref:System.Collections.IEnumerable> is set as the <xref:System.Activities.Activity%601.Result%2A> <xref:System.Activities.OutArgument%601> of the activity.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#100](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#100)]

<span data-ttu-id="3e58b-147">Nell'esempio seguente l'attività `OrdersByCustomer` recupera un elenco di ordini per il cliente specificato e successivamente un'attività <xref:System.Activities.Statements.ForEach%601> enumera gli ordini restituiti e scrive la data di ogni ordine nella console.</span><span class="sxs-lookup"><span data-stu-id="3e58b-147">In the following example, the `OrdersByCustomer` activity retrieves a list of orders for the specified customer, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates the returned orders and writes the date of each order to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#10](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#10)]

<span data-ttu-id="3e58b-148">Quando questo flusso di lavoro viene richiamato, nella console vengono scritti i dati seguenti:</span><span class="sxs-lookup"><span data-stu-id="3e58b-148">When this workflow is invoked, the following data is written to the console:</span></span>

```console
Calling WCF Data Service...
8/25/1997
10/3/1997
10/13/1997
1/15/1998
3/16/1998
4/9/1998
```

> [!NOTE]
> <span data-ttu-id="3e58b-149">Se non è possibile stabilire una connessione al server OData, verrà generata un'eccezione analoga alla seguente:</span><span class="sxs-lookup"><span data-stu-id="3e58b-149">If a connection to the OData server cannot be established, you will get an exception similar to the following exception:</span></span>
>
> <span data-ttu-id="3e58b-150">Eccezione non gestita: System.InvalidOperationException: Errore durante l'elaborazione della richiesta.</span><span class="sxs-lookup"><span data-stu-id="3e58b-150">Unhandled Exception: System.InvalidOperationException: An error occurred while processing this request.</span></span> <span data-ttu-id="3e58b-151">---> System.Net.WebException: Impossibile effettuare la connessione al server remoto ---> System.Net.Sockets.SocketException: Tentativo di connessione non riuscito. Risposta non corretta della parte connessa dopo un intervallo di tempo oppure mancata risposta dall'host connesso.</span><span class="sxs-lookup"><span data-stu-id="3e58b-151">---> System.Net.WebException: Unable to connect to the remote server ---> System.Net.Sockets.SocketException: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond.</span></span>

<span data-ttu-id="3e58b-152">Se è necessaria un'elaborazione aggiuntiva dei dati restituiti dalla query, è possibile usare l'override <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> dell'attività.</span><span class="sxs-lookup"><span data-stu-id="3e58b-152">If any additional processing of the data returned by the query is required, it can be done in the activity's <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> override.</span></span> <span data-ttu-id="3e58b-153">Sia <xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A> che <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> vengono richiamati tramite il thread del flusso di lavoro e nessun codice in tali override viene eseguito in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="3e58b-153">Both <xref:System.Activities.AsyncCodeActivity%601.BeginExecute%2A> and <xref:System.Activities.AsyncCodeActivity%601.EndExecute%2A> are invoked by using the workflow thread, and any code in these overrides does not run asynchronously.</span></span> <span data-ttu-id="3e58b-154">Se l'elaborazione aggiuntiva è estesa o di lunga durata o se viene eseguito il paging dei risultati della query, è opportuno prendere in considerazione l'approccio discusso nella sezione seguente in cui viene usato un delegato per eseguire la query e completare l'elaborazione aggiuntiva in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="3e58b-154">If the additional processing is extensive or long-running, or the query results are paged, you should consider the approach discussed in the next section, which uses a delegate to execute the query and perform additional processing asynchronously.</span></span>

### <a name="using-a-delegate"></a><span data-ttu-id="3e58b-155">Uso di un delegato</span><span class="sxs-lookup"><span data-stu-id="3e58b-155">Using a delegate</span></span>

<span data-ttu-id="3e58b-156">Oltre a richiamare il metodo asincrono di una classe .NET Framework, un'attività basata su <xref:System.Activities.AsyncCodeActivity>può definire anche la logica asincrona in uno dei relativi metodi.</span><span class="sxs-lookup"><span data-stu-id="3e58b-156">In addition to invoking the asynchronous method of a .NET Framework class, an <xref:System.Activities.AsyncCodeActivity>-based activity can also define the asynchronous logic in one of its methods.</span></span> <span data-ttu-id="3e58b-157">Questo metodo viene specificato tramite un delegato nell'override <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> dell'attività.</span><span class="sxs-lookup"><span data-stu-id="3e58b-157">This method is specified by using a delegate in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="3e58b-158">Quando il metodo restituisce un risultato, il runtime richiama l'override <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> dell'attività.</span><span class="sxs-lookup"><span data-stu-id="3e58b-158">When the method returns, the runtime invokes the activity's <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> override.</span></span> <span data-ttu-id="3e58b-159">In caso di chiamata di un servizio OData da un flusso di lavoro, il metodo può essere usato per eseguire una query sul servizio e completare eventuali elaborazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="3e58b-159">When calling an OData service from a workflow, this method can be used to query the service and provide any additional processing.</span></span>

<span data-ttu-id="3e58b-160">Nell'esempio seguente viene definita un'attività `ListCustomers` .</span><span class="sxs-lookup"><span data-stu-id="3e58b-160">In the following example, a `ListCustomers` activity is defined.</span></span> <span data-ttu-id="3e58b-161">che esegue una query sul servizio dati Northwind di esempio e restituisce un elemento `List<Customer>` che contiene tutti i clienti del database Northwind.</span><span class="sxs-lookup"><span data-stu-id="3e58b-161">This activity queries the sample Northwind data service and returns a `List<Customer>` that contains all of the customers in the Northwind database.</span></span> <span data-ttu-id="3e58b-162">Il lavoro asincrono viene eseguito dal metodo `GetCustomers`</span><span class="sxs-lookup"><span data-stu-id="3e58b-162">The asynchronous work is performed by the `GetCustomers` method.</span></span> <span data-ttu-id="3e58b-163">che esegue una query sul servizio per tutti i clienti, li copia in un elemento `List<Customer>`</span><span class="sxs-lookup"><span data-stu-id="3e58b-163">This method queries the service for all customers, and then copies them into a `List<Customer>`.</span></span> <span data-ttu-id="3e58b-164">e controlla se è stato eseguito il paging dei risultati.</span><span class="sxs-lookup"><span data-stu-id="3e58b-164">It then checks to see if the results are paged.</span></span> <span data-ttu-id="3e58b-165">In caso affermativo, esegue una query sul servizio per la successiva pagina di risultati, li aggiunge all'elenco e continua fino a quando non sono stati recuperati tutti i dati del cliente.</span><span class="sxs-lookup"><span data-stu-id="3e58b-165">If so, it queries the service for the next page of results, adds them to the list, and continues until all of the customer data has been retrieved.</span></span>

> [!NOTE]
> <span data-ttu-id="3e58b-166">Per ulteriori informazioni sul paging in WCF Data Services, vedere [procedura: caricare risultati di paging (WCF Data Services)](../data/wcf/how-to-load-paged-results-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="3e58b-166">For more information about paging in WCF Data Services, see [How to: Load Paged Results (WCF Data Services)](../data/wcf/how-to-load-paged-results-wcf-data-services.md).</span></span>

<span data-ttu-id="3e58b-167">Una volta aggiunti tutti i clienti, viene restituito l'elenco.</span><span class="sxs-lookup"><span data-stu-id="3e58b-167">Once all customers are added, the list is returned.</span></span> <span data-ttu-id="3e58b-168">Il metodo `GetCustomers` viene specificato nell'override <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> dell'attività.</span><span class="sxs-lookup"><span data-stu-id="3e58b-168">The `GetCustomers` method is specified in the activity's <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A> override.</span></span> <span data-ttu-id="3e58b-169">Poiché il metodo restituisce un valore, viene creato un elemento `Func<string, List<Customer>>` per specificarlo.</span><span class="sxs-lookup"><span data-stu-id="3e58b-169">Since the method has a return value, a `Func<string, List<Customer>>` is created to specify the method.</span></span>

> [!NOTE]
> <span data-ttu-id="3e58b-170">Se il metodo che esegue il lavoro asincrono non restituisce un valore, viene usato un oggetto <xref:System.Action> anziché un oggetto <xref:System.Func%601>.</span><span class="sxs-lookup"><span data-stu-id="3e58b-170">If the method that performs the asynchronous work does not have a return value, an <xref:System.Action> is used instead of a <xref:System.Func%601>.</span></span> <span data-ttu-id="3e58b-171">Per esempi di creazione di un esempio asincrono usando entrambi gli approcci, vedere [creazione di attività asincrone](creating-asynchronous-activities-in-wf.md).</span><span class="sxs-lookup"><span data-stu-id="3e58b-171">For examples of creating an asynchronous example using both approaches, see [Creating Asynchronous Activities](creating-asynchronous-activities-in-wf.md).</span></span>

<span data-ttu-id="3e58b-172">Questo oggetto <xref:System.Func%601> viene assegnato a <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, quindi viene chiamato `BeginInvoke`.</span><span class="sxs-lookup"><span data-stu-id="3e58b-172">This <xref:System.Func%601> is assigned to the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, and then `BeginInvoke` is called.</span></span> <span data-ttu-id="3e58b-173">Poiché il metodo da richiamare non dispone dell'accesso all'ambiente di argomenti dell'attività, il valore dell'argomento `ServiceUri` viene passato come primo parametro, insieme con il callback e lo stato passati a <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="3e58b-173">Since the method to be invoked does not have access to the activity's environment of arguments, the value of the `ServiceUri` argument is passed as the first parameter, together with the callback and state that were passed into <xref:System.Activities.AsyncCodeActivity.BeginExecute%2A>.</span></span> <span data-ttu-id="3e58b-174">Quando `GetCustomers` restituisce un risultato, il runtime richiama <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span><span class="sxs-lookup"><span data-stu-id="3e58b-174">When `GetCustomers` returns, the runtime invokes <xref:System.Activities.AsyncCodeActivity.EndExecute%2A>.</span></span> <span data-ttu-id="3e58b-175">Il codice in <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> recupera il delegato da <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, chiama `EndInvoke`e restituisce il risultato, ovvero l'elenco di clienti restituito dal metodo `GetCustomers` .</span><span class="sxs-lookup"><span data-stu-id="3e58b-175">The code in <xref:System.Activities.AsyncCodeActivity.EndExecute%2A> retrieves the delegate from the <xref:System.Activities.AsyncCodeActivityContext.UserState%2A>, calls `EndInvoke`, and returns the result, which is the list of customers returned from the `GetCustomers` method.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#200](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#200)]

<span data-ttu-id="3e58b-176">Nell'esempio seguente l'attività `ListCustomers` recupera un elenco di clienti e successivamente un'attività <xref:System.Activities.Statements.ForEach%601> li enumera e scrive il nome dell'azienda e del contatto di ogni cliente nella console.</span><span class="sxs-lookup"><span data-stu-id="3e58b-176">In the following example, the `ListCustomers` activity retrieves a list of customers, and then a <xref:System.Activities.Statements.ForEach%601> activity enumerates them and writes the company name and contact name of each customer to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#20](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#20)]

<span data-ttu-id="3e58b-177">Quando questo flusso di lavoro viene richiamato, nella console vengono scritti i dati seguenti.</span><span class="sxs-lookup"><span data-stu-id="3e58b-177">When this workflow is invoked, the following data is written to the console.</span></span> <span data-ttu-id="3e58b-178">Poiché la query restituisce numerosi clienti, in questo contesto viene visualizzata solo una parte dell'output.</span><span class="sxs-lookup"><span data-stu-id="3e58b-178">Since this query returns many customers, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Alfreds Futterkiste, Contact: Maria Anders
Ana Trujillo Emparedados y helados, Contact: Ana Trujillo
Antonio Moreno Taquería, Contact: Antonio Moreno
Around the Horn, Contact: Thomas Hardy
Berglunds snabbköp, Contact: Christina Berglund
...
```

## <a name="consuming-an-odata-feed-without-using-the-client-libraries"></a><span data-ttu-id="3e58b-179">Utilizzo di un feed OData senza le librerie client</span><span class="sxs-lookup"><span data-stu-id="3e58b-179">Consuming an OData feed without using the client libraries</span></span>

<span data-ttu-id="3e58b-180">OData espone i dati come risorse indirizzabili tramite URI.</span><span class="sxs-lookup"><span data-stu-id="3e58b-180">OData exposes data as resources that are addressable by URIs.</span></span> <span data-ttu-id="3e58b-181">Tali URI vengono creati automaticamente quando si usano le librerie client, sebbene queste ultime non siano sempre necessarie.</span><span class="sxs-lookup"><span data-stu-id="3e58b-181">When you use the client libraries these URIs are created for you, but you do not have to use the client libraries.</span></span> <span data-ttu-id="3e58b-182">È infatti possibile accedere direttamente ai servizi OData senza usare le librerie client.</span><span class="sxs-lookup"><span data-stu-id="3e58b-182">If desired, OData services can be accessed directly without using the client libraries.</span></span> <span data-ttu-id="3e58b-183">In questo caso il percorso del servizio e i dati desiderati vengono specificati dagli URI e i risultati vengono restituiti nella risposta alla richiesta HTTP.</span><span class="sxs-lookup"><span data-stu-id="3e58b-183">When not using the client libraries the location of the service and the desired data are specified by the URI and the results are returned in the response to the HTTP request.</span></span> <span data-ttu-id="3e58b-184">Tali dati possono quindi essere elaborati o modificati nel modo desiderato.</span><span class="sxs-lookup"><span data-stu-id="3e58b-184">This raw data can then be processed or manipulated in the desired manner.</span></span> <span data-ttu-id="3e58b-185">Per recuperare i risultati di una query OData, è possibile usare la classe <xref:System.Net.WebClient> .</span><span class="sxs-lookup"><span data-stu-id="3e58b-185">One way to retrieve the results of an OData query is by using the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="3e58b-186">In questo esempio viene recuperato il nome del contatto per il cliente rappresentato dalla chiave ALFKI.</span><span class="sxs-lookup"><span data-stu-id="3e58b-186">In this example, the contact name for the customer represented by the key ALFKI is retrieved.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#2](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#2)]

<span data-ttu-id="3e58b-187">Quando questo codice viene eseguito, nella console viene visualizzato l'output seguente:</span><span class="sxs-lookup"><span data-stu-id="3e58b-187">When this code is run, the following output is displayed to the console:</span></span>

```console
Raw data returned:
<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<ContactName xmlns="http://schemas.microsoft.com/ado/2007/08/dataservices">Maria Anders</ContactName>
```

<span data-ttu-id="3e58b-188">In un flusso di lavoro il codice dell'esempio potrebbe essere incorporato nell'override <xref:System.Activities.CodeActivity.Execute%2A> di un'attività personalizzata basata su <xref:System.Activities.CodeActivity>, ma la stessa funzionalità può essere realizzata anche tramite l'attività <xref:System.Activities.Expressions.InvokeMethod%601>.</span><span class="sxs-lookup"><span data-stu-id="3e58b-188">In a workflow, the code from this example could be incorporated into the <xref:System.Activities.CodeActivity.Execute%2A> override of a <xref:System.Activities.CodeActivity>-based custom activity, but the same functionality can also be accomplished by using the <xref:System.Activities.Expressions.InvokeMethod%601> activity.</span></span> <span data-ttu-id="3e58b-189">L'attività <xref:System.Activities.Expressions.InvokeMethod%601> consente agli autori del flusso di lavoro di richiamare metodi statici e di istanza di una classe e dispone inoltre di un'opzione per richiamare il metodo specificato in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="3e58b-189">The <xref:System.Activities.Expressions.InvokeMethod%601> activity enables workflow authors to invoke static and instance methods of a class, and also has an option to invoke the specified method asynchronously.</span></span> <span data-ttu-id="3e58b-190">Nell'esempio seguente un'attività <xref:System.Activities.Expressions.InvokeMethod%601> viene configurata per chiamare il metodo <xref:System.Net.WebClient.DownloadString%2A> della classe <xref:System.Net.WebClient> e per restituire un elenco di clienti.</span><span class="sxs-lookup"><span data-stu-id="3e58b-190">In the following example, an <xref:System.Activities.Expressions.InvokeMethod%601> activity is configured to call the <xref:System.Net.WebClient.DownloadString%2A> method of the <xref:System.Net.WebClient> class and return a list of customers.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#3](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#3)]

<span data-ttu-id="3e58b-191"><xref:System.Activities.Expressions.InvokeMethod%601> può chiamare sia metodi statici che di istanza di una classe.</span><span class="sxs-lookup"><span data-stu-id="3e58b-191"><xref:System.Activities.Expressions.InvokeMethod%601> can call both static and instance methods of a class.</span></span> <span data-ttu-id="3e58b-192">Poiché <xref:System.Net.WebClient.DownloadString%2A> è un metodo di istanza della classe <xref:System.Net.WebClient> , viene specificata una nuova istanza della classe <xref:System.Net.WebClient> per <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span><span class="sxs-lookup"><span data-stu-id="3e58b-192">Since <xref:System.Net.WebClient.DownloadString%2A> is an instance method of the <xref:System.Net.WebClient> class, a new instance of the <xref:System.Net.WebClient> class is specified for the <xref:System.Activities.Expressions.InvokeMethod%601.TargetObject%2A>.</span></span> <span data-ttu-id="3e58b-193">`DownloadString` viene specificato come <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>, l'URI che contiene la query viene specificato nella raccolta <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A> e il valore restituito viene assegnato al valore di <xref:System.Activities.Activity%601.Result%2A> .</span><span class="sxs-lookup"><span data-stu-id="3e58b-193">`DownloadString` is specified as the <xref:System.Activities.Expressions.InvokeMethod%601.MethodName%2A>, the URI that contains the query is specified in the <xref:System.Activities.Expressions.InvokeMethod%601.Parameters%2A> collection, and the return value is assigned to the <xref:System.Activities.Activity%601.Result%2A> value.</span></span> <span data-ttu-id="3e58b-194">Il valore <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> viene impostato su `true`per indicare che la chiamata al metodo verrà eseguita in modo asincrono rispetto al flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="3e58b-194">The <xref:System.Activities.Expressions.InvokeMethod%601.RunAsynchronously%2A> value is set to `true`, which means that the method invocation will run asynchronously with regard to the workflow.</span></span> <span data-ttu-id="3e58b-195">Nell'esempio seguente viene creato un flusso di lavoro che usa l'attività <xref:System.Activities.Expressions.InvokeMethod%601> per eseguire una query sul servizio dati Northwind di esempio per ottenere un elenco di ordini per un cliente specifico. Successivamente i dati restituiti vengono scritti nella console.</span><span class="sxs-lookup"><span data-stu-id="3e58b-195">In the following example, a workflow is constructed that uses the <xref:System.Activities.Expressions.InvokeMethod%601> activity to query the sample Northwind data service for a list of orders for a specific customer, and then the returned data is written to the console.</span></span>

[!code-csharp[CFX_WCFDataServicesActivityExample#1](~/samples/snippets/csharp/VS_Snippets_CFX/CFX_WCFDataServicesActivityExample/cs/Program.cs#1)]

<span data-ttu-id="3e58b-196">Quando questo flusso di lavoro viene richiamato, nella console viene visualizzato l'output seguente.</span><span class="sxs-lookup"><span data-stu-id="3e58b-196">When this workflow is invoked, the following output is displayed to the console.</span></span> <span data-ttu-id="3e58b-197">Poiché la query restituisce numerosi ordini, in questo contesto viene visualizzata solo una parte dell'output.</span><span class="sxs-lookup"><span data-stu-id="3e58b-197">Since this query returns several orders, only part of the output is displayed here.</span></span>

```console
Calling WCF Data Service...
Raw data returned:

<?xml version="1.0" encoding="utf-8" standalone="yes"?>*
<feed
xml:base="http://services.odata.org/Northwind/Northwind.svc/"
xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices"
xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata"
xmlns="http://www.w3.org/2005/Atom">
<title type="text">Orders\</title>
<id>http://services.odata.org/Northwind/Northwind.svc/Customers('ALFKI')/Orders\</id>
<updated>2010-05-19T19:37:07Z\</updated>
<link rel="self" title="Orders" href="Orders" />
<entry>
<id>http://services.odata.org/Northwind/Northwind.svc/Orders(10643)\</id>
<title type="text">\</title>
<updated>2010-05-19T19:37:07Z\</updated>
<author>
<name />
</author>
<link rel="edit" title="Order" href="Orders(10643)" />
<link rel="http://schemas.microsoft.com/ado/2007/08/dataservices/related/Customer" type="application/atom+xml;type=entry" title="Customer" href="Orders(10643)/Customer" />
...
```

<span data-ttu-id="3e58b-198">L'esempio fornisce un metodo a disposizione degli autori delle applicazioni flusso di lavoro per usare i dati non elaborati restituiti da un servizio OData.</span><span class="sxs-lookup"><span data-stu-id="3e58b-198">This example provides one method that workflow application authors can use to consume the raw data returned from an OData service.</span></span> <span data-ttu-id="3e58b-199">Per ulteriori informazioni sull'accesso WCF Data Services tramite URI, vedere [accesso alle risorse del servizio dati (WCF Data Services)](../data/wcf/accessing-data-service-resources-wcf-data-services.md) e [OData: convenzioni URI](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span><span class="sxs-lookup"><span data-stu-id="3e58b-199">For more information about accessing WCF Data Services using URIs, see [Accessing Data Service Resources (WCF Data Services)](../data/wcf/accessing-data-service-resources-wcf-data-services.md) and [OData: URI Conventions](https://www.odata.org/documentation/odata-version-2-0/uri-conventions/).</span></span>
