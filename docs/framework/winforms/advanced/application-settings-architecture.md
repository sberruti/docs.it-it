---
title: Architettura Impostazioni applicazione
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- application settings [Windows Forms], architecture
ms.assetid: c8eb2ad0-fac6-4ea2-9140-675a4a44d562
ms.openlocfilehash: 078b5f3fc1cd4273af282580f41e68ca9bd8ff51
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/12/2020
ms.locfileid: "79182617"
---
# <a name="application-settings-architecture"></a><span data-ttu-id="60c31-102">Architettura Impostazioni applicazione</span><span class="sxs-lookup"><span data-stu-id="60c31-102">Application Settings Architecture</span></span>
<span data-ttu-id="60c31-103">Questo argomento descrive il funzionamento dell'architettura Impostazioni applicazione e ne analizza le funzionalità avanzate, come i raggruppamenti e le chiavi delle impostazioni.</span><span class="sxs-lookup"><span data-stu-id="60c31-103">This topic describes how the Application Settings architecture works, and explores advanced features of the architecture, such as grouped settings and settings keys.</span></span>

 <span data-ttu-id="60c31-104">L'architettura di Impostazioni applicazione supporta la definizione delle impostazioni fortemente tipizzate con ambito di applicazione o utente e la persistenza delle impostazioni tra sessioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="60c31-104">The application settings architecture supports defining strongly typed settings with either application or user scope, and persisting the settings between application sessions.</span></span> <span data-ttu-id="60c31-105">L'architettura fornisce un motore di persistenza predefinito per salvare le impostazioni e caricarle dal file system locale.</span><span class="sxs-lookup"><span data-stu-id="60c31-105">The architecture provides a default persistence engine for saving settings to and loading them from the local file system.</span></span> <span data-ttu-id="60c31-106">L'architettura definisce inoltre le interfacce per offrire un motore di persistenza personalizzato.</span><span class="sxs-lookup"><span data-stu-id="60c31-106">The architecture also defines interfaces for supplying a custom persistence engine.</span></span>

 <span data-ttu-id="60c31-107">Si tratta di interfacce che consentono ai componenti personalizzati di mantenere le proprie impostazioni quando sono ospitati in un'applicazione.</span><span class="sxs-lookup"><span data-stu-id="60c31-107">Interfaces are provided that enable custom components to persist their own settings when they are hosted in an application.</span></span> <span data-ttu-id="60c31-108">Usando le chiavi delle impostazioni, i componenti possono mantenere le impostazioni per più istanze del componente separato.</span><span class="sxs-lookup"><span data-stu-id="60c31-108">By using settings keys, components can keep settings for multiple instances of the component separate.</span></span>

## <a name="defining-settings"></a><span data-ttu-id="60c31-109">Definizione delle impostazioni</span><span class="sxs-lookup"><span data-stu-id="60c31-109">Defining Settings</span></span>
 <span data-ttu-id="60c31-110">L'architettura delle impostazioni dell'applicazione viene utilizzata sia all'interno di ASP.NET e Windows Form e contiene una serie di classi di base condivise in entrambi gli ambienti.</span><span class="sxs-lookup"><span data-stu-id="60c31-110">The application settings architecture is used within both ASP.NET and Windows Forms, and it contains a number of base classes that are shared across both environments.</span></span> <span data-ttu-id="60c31-111">Il più <xref:System.Configuration.SettingsBase>importante è , che fornisce l'accesso alle impostazioni tramite una raccolta e fornisce metodi di basso livello per il caricamento e il salvataggio delle impostazioni.</span><span class="sxs-lookup"><span data-stu-id="60c31-111">The most important is <xref:System.Configuration.SettingsBase>, which provides access to settings through a collection, and provides low-level methods for loading and saving settings.</span></span> <span data-ttu-id="60c31-112">Ogni ambiente implementa la <xref:System.Configuration.SettingsBase> propria classe derivata da per fornire funzionalità di impostazioni aggiuntive per tale ambiente.</span><span class="sxs-lookup"><span data-stu-id="60c31-112">Each environment implements its own class derived from <xref:System.Configuration.SettingsBase> to provide additional settings functionality for that environment.</span></span> <span data-ttu-id="60c31-113">In un'applicazione basata su Windows Form, tutte le <xref:System.Configuration.ApplicationSettingsBase> impostazioni dell'applicazione devono essere definite in una classe derivata dalla classe , che aggiunge la seguente funzionalità alla classe base:</span><span class="sxs-lookup"><span data-stu-id="60c31-113">In a Windows Forms-based application, all application settings must be defined on a class derived from the <xref:System.Configuration.ApplicationSettingsBase> class, which adds the following functionality to the base class:</span></span>

- <span data-ttu-id="60c31-114">Caricamento e salvataggio delle operazioni di livello superiore</span><span class="sxs-lookup"><span data-stu-id="60c31-114">Higher-level loading and saving operations</span></span>

- <span data-ttu-id="60c31-115">Supporto per le impostazioni con ambito utente</span><span class="sxs-lookup"><span data-stu-id="60c31-115">Support for user-scoped settings</span></span>

- <span data-ttu-id="60c31-116">Ripristino delle impostazioni dell'utente alle impostazioni predefinite</span><span class="sxs-lookup"><span data-stu-id="60c31-116">Reverting a user's settings to the predefined defaults</span></span>

- <span data-ttu-id="60c31-117">Aggiornamento delle impostazioni da una versione precedente dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="60c31-117">Upgrading settings from a previous application version</span></span>

- <span data-ttu-id="60c31-118">Convalida delle impostazioni, prima che vengano modificate o prima che vengano salvate</span><span class="sxs-lookup"><span data-stu-id="60c31-118">Validating settings, either before they are changed or before they are saved</span></span>

 <span data-ttu-id="60c31-119">Le impostazioni possono essere descritte utilizzando <xref:System.Configuration> una serie di attributi definiti all'interno dello spazio dei nomi; questi sono descritti in [Attributi delle impostazioni dell'applicazione](application-settings-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="60c31-119">The settings can be described using a number of attributes defined within the <xref:System.Configuration> namespace; these are described in [Application Settings Attributes](application-settings-attributes.md).</span></span> <span data-ttu-id="60c31-120">Quando si definisce un'impostazione, <xref:System.Configuration.ApplicationScopedSettingAttribute> <xref:System.Configuration.UserScopedSettingAttribute>è necessario applicarla con o , che descrive se l'impostazione si applica all'intera applicazione o solo all'utente corrente.</span><span class="sxs-lookup"><span data-stu-id="60c31-120">When you define a setting, you must apply it with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>, which describes whether the setting applies to the entire application or just to the current user.</span></span>

 <span data-ttu-id="60c31-121">L'esempio di codice seguente definisce una classe di impostazioni personalizzate con una singola impostazione, `BackgroundColor`.</span><span class="sxs-lookup"><span data-stu-id="60c31-121">The following code example defines a custom settings class with a single setting, `BackgroundColor`.</span></span>

 [!code-csharp[ApplicationSettings.Create#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Create/CS/MyAppSettings.cs#1)]
 [!code-vb[ApplicationSettings.Create#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Create/VB/MyAppSettings.vb#1)]

## <a name="settings-persistence"></a><span data-ttu-id="60c31-122">Persistenza delle impostazioni</span><span class="sxs-lookup"><span data-stu-id="60c31-122">Settings Persistence</span></span>
 <span data-ttu-id="60c31-123">La <xref:System.Configuration.ApplicationSettingsBase> classe non mantiene o carica le impostazioni; questo processo ricade sul provider di impostazioni, una classe che deriva da <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="60c31-123">The <xref:System.Configuration.ApplicationSettingsBase> class does not itself persist or load settings; this job falls to the settings provider, a class that derives from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="60c31-124">Se una classe <xref:System.Configuration.ApplicationSettingsBase> derivata di non <xref:System.Configuration.SettingsProviderAttribute>specifica un provider <xref:System.Configuration.LocalFileSettingsProvider>di impostazioni tramite il , viene utilizzato il provider predefinito , , , .</span><span class="sxs-lookup"><span data-stu-id="60c31-124">If a derived class of <xref:System.Configuration.ApplicationSettingsBase> does not specify a settings provider through the <xref:System.Configuration.SettingsProviderAttribute>, then the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span>

 <span data-ttu-id="60c31-125">Il sistema di configurazione originariamente rilasciato con .NET Framework supporta la fornitura di dati statici `app.`di configurazione dell'applicazione tramite il file machine.config del computer locale o all'interno di un file exe.config distribuito con l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="60c31-125">The configuration system that was originally released with the .NET Framework supports providing static application configuration data through either the local computer's machine.config file or within an `app.`exe.config file that you deploy with your application.</span></span> <span data-ttu-id="60c31-126">La <xref:System.Configuration.LocalFileSettingsProvider> classe espande questo supporto nativo nei modi seguenti:The class expands this native support in the following ways:</span><span class="sxs-lookup"><span data-stu-id="60c31-126">The <xref:System.Configuration.LocalFileSettingsProvider> class expands this native support in the following ways:</span></span>

- <span data-ttu-id="60c31-127">Le impostazioni con ambito applicazione possono essere archiviate in entrambi i file machine.config o `app.`exe.config.</span><span class="sxs-lookup"><span data-stu-id="60c31-127">Application-scoped settings can be stored in either the machine.config or `app.`exe.config files.</span></span> <span data-ttu-id="60c31-128">Il file machine.config è sempre di sola lettura, mentre `app`.exe.config è limitato dalle considerazioni sulla sicurezza alla sola lettura per la maggior parte delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="60c31-128">Machine.config is always read-only, while `app`.exe.config is restricted by security considerations to read-only for most applications.</span></span>

- <span data-ttu-id="60c31-129">Le impostazioni con ambito di utente possono essere archiviate in `app`.exe.config, in questo caso vengono considerate come valori predefiniti statici.</span><span class="sxs-lookup"><span data-stu-id="60c31-129">User-scoped settings can be stored in `app`.exe.config files, in which case they are treated as static defaults.</span></span>

- <span data-ttu-id="60c31-130">Le impostazioni con ambito di utente non predefinite sono archiviate in un nuovo file *utente*.config, dove *user* è il nome dell'utente che esegue l'applicazione in quel momento.</span><span class="sxs-lookup"><span data-stu-id="60c31-130">Non-default user-scoped settings are stored in a new file, *user*.config, where *user* is the user name of the person currently executing the application.</span></span> <span data-ttu-id="60c31-131">È possibile specificare un valore predefinito <xref:System.Configuration.DefaultSettingValueAttribute>per un'impostazione con ambito di utente con .</span><span class="sxs-lookup"><span data-stu-id="60c31-131">You can specify a default for a user-scoped setting with <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="60c31-132">Poiché le impostazioni con ambito utente spesso cambiano durante l'esecuzione dell'applicazione, `user`.config è sempre di lettura o scrittura.</span><span class="sxs-lookup"><span data-stu-id="60c31-132">Because user-scoped settings often change during application execution, `user`.config is always read/write.</span></span>

 <span data-ttu-id="60c31-133">I tre file di configurazione archiviano le impostazioni in formato XML.</span><span class="sxs-lookup"><span data-stu-id="60c31-133">All three configuration files store settings in XML format.</span></span> <span data-ttu-id="60c31-134">L'elemento XML di livello superiore per le impostazioni con ambito di applicazione è `<appSettings>`, mentre `<userSettings>` viene usato per le impostazioni con ambito di utente.</span><span class="sxs-lookup"><span data-stu-id="60c31-134">The top-level XML element for application-scoped settings is `<appSettings>`, while `<userSettings>` is used for user-scoped settings.</span></span> <span data-ttu-id="60c31-135">Un file `app`.exe.config che contiene sia le impostazioni con ambito di applicazione che quelle predefinite per le impostazioni con ambito utente si presenta come segue:</span><span class="sxs-lookup"><span data-stu-id="60c31-135">An `app`.exe.config file which contains both application-scoped settings and defaults for user-scoped settings would look like this:</span></span>

```xml
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <configSections>
        <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
        </sectionGroup>
        <sectionGroup name="userSettings" type="System.Configuration.UserSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" allowExeDefinition="MachineToLocalUser" />
        </sectionGroup>
    </configSections>
    <applicationSettings>
        <WindowsApplication1.Properties.Settings>
            <setting name="Cursor" serializeAs="String">
                <value>Default</value>
            </setting>
            <setting name="DoubleBuffering" serializeAs="String">
                <value>False</value>
            </setting>
        </WindowsApplication1.Properties.Settings>
    </applicationSettings>
    <userSettings>
        <WindowsApplication1.Properties.Settings>
            <setting name="FormTitle" serializeAs="String">
                <value>Form1</value>
            </setting>
            <setting name="FormSize" serializeAs="String">
                <value>595, 536</value>
            </setting>
        </WindowsApplication1.Properties.Settings>
    </userSettings>
</configuration>
```

 <span data-ttu-id="60c31-136">Per una definizione degli elementi all'interno della sezione di impostazioni applicazione di un file di configurazione, vedere [Application Settings Schema](../../configure-apps/file-schema/application-settings-schema.md) (Schema di impostazioni applicazione).</span><span class="sxs-lookup"><span data-stu-id="60c31-136">For a definition of the elements within the application settings section of a configuration file, see [Application Settings Schema](../../configure-apps/file-schema/application-settings-schema.md).</span></span>

### <a name="settings-bindings"></a><span data-ttu-id="60c31-137">Associazioni delle impostazioni</span><span class="sxs-lookup"><span data-stu-id="60c31-137">Settings Bindings</span></span>
 <span data-ttu-id="60c31-138">Le impostazioni applicazione usano l'architettura di associazione dati di Windows Form per consentire la comunicazione bidirezionale degli aggiornamenti delle impostazioni tra i componenti e l'oggetto impostazioni.</span><span class="sxs-lookup"><span data-stu-id="60c31-138">Application settings uses the Windows Forms data binding architecture to provide two-way communication of settings updates between the settings object and components.</span></span> <span data-ttu-id="60c31-139">Se si usa Visual Studio per creare le impostazioni dell'applicazione e assegnarle alle proprietà del componente, queste associazioni vengono generate automaticamente.</span><span class="sxs-lookup"><span data-stu-id="60c31-139">If you use Visual Studio to create application settings and assign them to component properties, these bindings are generated automatically.</span></span>

 <span data-ttu-id="60c31-140">È possibile associare un'impostazione dell'applicazione solo a un componente che supporta l'interfaccia. <xref:System.Windows.Forms.IBindableComponent></span><span class="sxs-lookup"><span data-stu-id="60c31-140">You can only bind an application setting to a component that supports the <xref:System.Windows.Forms.IBindableComponent> interface.</span></span> <span data-ttu-id="60c31-141">Inoltre, il componente deve implementare un evento di modifica per una proprietà <xref:System.ComponentModel.INotifyPropertyChanged> associata specifica o notificare alle impostazioni dell'applicazione che la proprietà è stata modificata tramite l'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="60c31-141">Also, the component must implement a change event for a specific bound property, or notify application settings that the property has changed through the <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span></span> <span data-ttu-id="60c31-142">Se il componente <xref:System.Windows.Forms.IBindableComponent> non implementa e si esegue l'associazione tramite Visual Studio, le proprietà associate verranno impostate la prima volta, ma non verranno aggiornate.</span><span class="sxs-lookup"><span data-stu-id="60c31-142">If the component does not implement <xref:System.Windows.Forms.IBindableComponent> and you are binding through Visual Studio, the bound properties will be set the first time, but will not update.</span></span> <span data-ttu-id="60c31-143">Se il <xref:System.Windows.Forms.IBindableComponent> componente implementa ma non supporta le notifiche di modifica delle proprietà, l'associazione non verrà aggiornata nel file di impostazioni quando la proprietà viene modificata.</span><span class="sxs-lookup"><span data-stu-id="60c31-143">If the component implements <xref:System.Windows.Forms.IBindableComponent> but does not support property change notifications, the binding will not update in the settings file when the property is changed.</span></span>

 <span data-ttu-id="60c31-144">Alcuni componenti di Windows <xref:System.Windows.Forms.ToolStripItem>Form, ad esempio , non supportano le associazioni delle impostazioni.</span><span class="sxs-lookup"><span data-stu-id="60c31-144">Some Windows Forms components, such as <xref:System.Windows.Forms.ToolStripItem>, do not support settings bindings.</span></span>

### <a name="settings-serialization"></a><span data-ttu-id="60c31-145">Serializzazione delle impostazioni</span><span class="sxs-lookup"><span data-stu-id="60c31-145">Settings Serialization</span></span>
 <span data-ttu-id="60c31-146">Quando <xref:System.Configuration.LocalFileSettingsProvider> è necessario salvare le impostazioni su disco, esegue le seguenti azioni:</span><span class="sxs-lookup"><span data-stu-id="60c31-146">When <xref:System.Configuration.LocalFileSettingsProvider> must save settings to disk, it performs the following actions:</span></span>

1. <span data-ttu-id="60c31-147">Utilizza la reflection per esaminare <xref:System.Configuration.ApplicationSettingsBase> tutte le proprietà definite nella <xref:System.Configuration.ApplicationScopedSettingAttribute> classe <xref:System.Configuration.UserScopedSettingAttribute>derivata, individuando quelle applicate con o .</span><span class="sxs-lookup"><span data-stu-id="60c31-147">Uses reflection to examine all of the properties defined on your <xref:System.Configuration.ApplicationSettingsBase> derived class, finding those that are applied with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>.</span></span>

2. <span data-ttu-id="60c31-148">Serializza la proprietà su disco.</span><span class="sxs-lookup"><span data-stu-id="60c31-148">Serializes the property to disk.</span></span> <span data-ttu-id="60c31-149">Tenta innanzitutto di <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> chiamare il o <xref:System.ComponentModel.TypeConverter>sul tipo associato .</span><span class="sxs-lookup"><span data-stu-id="60c31-149">It first attempts to call the <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> or <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> on the type's associated <xref:System.ComponentModel.TypeConverter>.</span></span> <span data-ttu-id="60c31-150">Se il tentativo non riesce, usa la serializzazione XML.</span><span class="sxs-lookup"><span data-stu-id="60c31-150">If this does not succeed, it uses XML serialization instead.</span></span>

3. <span data-ttu-id="60c31-151">Determina quali impostazioni vanno inserite in ciascun file, in base all'attributo dell'impostazione.</span><span class="sxs-lookup"><span data-stu-id="60c31-151">Determines which settings go in which files, based on the setting's attribute.</span></span>

 <span data-ttu-id="60c31-152">Se si implementa una classe di <xref:System.Configuration.SettingsSerializeAsAttribute> impostazioni personalizzata, è possibile usare <xref:System.Configuration.SettingsSerializeAs> l'oggetto per contrassegnare un'impostazione per la serializzazione binaria o personalizzata utilizzando l'enumerazione .</span><span class="sxs-lookup"><span data-stu-id="60c31-152">If you implement your own settings class, you can use the <xref:System.Configuration.SettingsSerializeAsAttribute> to mark a setting for either binary or custom serialization using the <xref:System.Configuration.SettingsSerializeAs> enumeration.</span></span> <span data-ttu-id="60c31-153">Per altre informazioni sulla creazione della propria classe di impostazioni nel codice, vedere [How to: Create Application Settings](how-to-create-application-settings.md) (Procedura: creare impostazioni applicazioni).</span><span class="sxs-lookup"><span data-stu-id="60c31-153">For more information on creating your own settings class in code, see [How to: Create Application Settings](how-to-create-application-settings.md).</span></span>

### <a name="settings-file-locations"></a><span data-ttu-id="60c31-154">Percorsi del file delle installazioni</span><span class="sxs-lookup"><span data-stu-id="60c31-154">Settings File Locations</span></span>
 <span data-ttu-id="60c31-155">Il percorso dei file `app`.exe.config e *user*.config variano in base alle modalità di installazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="60c31-155">The location of the `app`.exe.config and *user*.config files will differ based on how the application is installed.</span></span> <span data-ttu-id="60c31-156">Per un'applicazione basata su Windows Form `app`copiata nel computer locale, exe.config risiederà nella stessa directory della directory di base del file <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> eseguibile principale dell'applicazione e *user*.config risiederà nel percorso specificato dalla proprietà .</span><span class="sxs-lookup"><span data-stu-id="60c31-156">For a Windows Forms-based application copied onto the local computer, `app`.exe.config will reside in the same directory as the base directory of the application's main executable file, and *user*.config will reside in the location specified by the <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="60c31-157">Per un'applicazione installata tramite ClickOnce, entrambi questi file risiederanno nella directory dei\\dati ClickOnce sotto %InstallRoot%, Documents and Settings*nomeutente*: Impostazioni locali.</span><span class="sxs-lookup"><span data-stu-id="60c31-157">For an application installed by means of ClickOnce, both of these files will reside in the ClickOnce Data Directory underneath %InstallRoot%\Documents and Settings\\*username*\Local Settings.</span></span>

 <span data-ttu-id="60c31-158">Il percorso di archiviazione di questi file è leggermente diverso se un utente ha abilitato i profili comuni, che consente a un utente di definire diverse impostazioni di Windows e dell'applicazione quando utilizzano altri computer all'interno di un dominio.</span><span class="sxs-lookup"><span data-stu-id="60c31-158">The storage location of these files is slightly different if a user has enabled roaming profiles, which enables a user to define different Windows and application settings when they are using other computers within a domain.</span></span> <span data-ttu-id="60c31-159">In tal caso, sia le applicazioni ClickOnce che `app`le applicazioni non ClickOnce disfaranno dei file\\.exe.config e *user.config*archiviati in %InstallRoot%, Documents and Settings*nomeutente*: Dati applicazioni.</span><span class="sxs-lookup"><span data-stu-id="60c31-159">In that case, both ClickOnce applications and non-ClickOnce applications will have their `app`.exe.config and *user*.config files stored under %InstallRoot%\Documents and Settings\\*username*\Application Data.</span></span>

 <span data-ttu-id="60c31-160">Per altre informazioni sul funzionamento delle funzioni di Impostazioni applicazione con la nuova tecnologia di distribuzione, vedere [Impostazioni dell'applicazione e ClickOnce](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="60c31-160">For more information about how the Application Settings feature works with the new deployment technology, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span> <span data-ttu-id="60c31-161">Per ulteriori informazioni sulla directory dei dati ClickOnce, vedere [Accesso a dati locali e remoti nelle applicazioni ClickOnce](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span><span class="sxs-lookup"><span data-stu-id="60c31-161">For more information about the ClickOnce Data Directory, see [Accessing Local and Remote Data in ClickOnce Applications](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span></span>

## <a name="application-settings-and-security"></a><span data-ttu-id="60c31-162">Impostazioni e sicurezza dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="60c31-162">Application Settings and Security</span></span>
 <span data-ttu-id="60c31-163">Le impostazioni dell'applicazione sono progettate per funzionare in attendibilità parziale, un ambiente con restrizioni predefinito per le applicazioni di Windows Form ospitate in Internet o intranet.</span><span class="sxs-lookup"><span data-stu-id="60c31-163">Application settings are designed to work in partial trust, a restricted environment that is the default for Windows Forms applications hosted over the Internet or an intranet.</span></span> <span data-ttu-id="60c31-164">Non sono necessarie autorizzazioni speciali oltre all'attendibilità parziale per usare le impostazioni dell'applicazione con il provider di impostazioni predefinito.</span><span class="sxs-lookup"><span data-stu-id="60c31-164">No special permissions beyond partial trust are needed to use application settings with the default settings provider.</span></span>

 <span data-ttu-id="60c31-165">Quando le impostazioni dell'applicazione vengono `user`utilizzate in un'applicazione ClickOnce, il file con estensione config viene archiviato nella directory dei dati ClickOnce.</span><span class="sxs-lookup"><span data-stu-id="60c31-165">When application settings are used in a ClickOnce application, the `user`.config file is stored in the ClickOnce data directory.</span></span> <span data-ttu-id="60c31-166">La dimensione del file `user`config dell'applicazione non può superare la quota della directory dei dati impostata da ClickOnce.</span><span class="sxs-lookup"><span data-stu-id="60c31-166">The size of the application's `user`.config file cannot exceed the data directory quota set by ClickOnce.</span></span> <span data-ttu-id="60c31-167">Per altre informazioni, vedere [Impostazioni dell'applicazione e ClickOnce](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="60c31-167">For more information, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span>

## <a name="custom-settings-providers"></a><span data-ttu-id="60c31-168">Provider di impostazioni personalizzate</span><span class="sxs-lookup"><span data-stu-id="60c31-168">Custom Settings Providers</span></span>
 <span data-ttu-id="60c31-169">Nell'architettura Impostazioni applicazione è presente un accoppiamento libero tra la <xref:System.Configuration.ApplicationSettingsBase>classe wrapper delle impostazioni delle applicazioni, derivata da , e il provider o i provider di impostazioni associati, derivati da <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="60c31-169">In the Application Settings architecture, there is a loose coupling between the applications settings wrapper class, derived from <xref:System.Configuration.ApplicationSettingsBase>, and the associated settings provider or providers, derived from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="60c31-170">Questa associazione è <xref:System.Configuration.SettingsProviderAttribute> definita solo dall'oggetto applicato alla classe wrapper o alle singole proprietà.</span><span class="sxs-lookup"><span data-stu-id="60c31-170">This association is defined only by the <xref:System.Configuration.SettingsProviderAttribute> applied to the wrapper class or its individual properties.</span></span> <span data-ttu-id="60c31-171">Se un provider di impostazioni non viene <xref:System.Configuration.LocalFileSettingsProvider>specificato in modo esplicito, viene utilizzato il provider predefinito, , .</span><span class="sxs-lookup"><span data-stu-id="60c31-171">If a settings provider is not explicitly specified, the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span> <span data-ttu-id="60c31-172">Di conseguenza, questa architettura supporta la creazione e l'uso di provider di impostazioni personalizzate.</span><span class="sxs-lookup"><span data-stu-id="60c31-172">As a result, this architecture supports creating and using custom settings providers.</span></span>

 <span data-ttu-id="60c31-173">Si supponga, ad esempio, di voler sviluppare e usare `SqlSettingsProvider`, un provider che archivierà tutti i dati delle impostazioni in un database Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="60c31-173">For example, suppose that you want to develop and use `SqlSettingsProvider`, a provider that will store all settings data in a Microsoft SQL Server database.</span></span> <span data-ttu-id="60c31-174">La <xref:System.Configuration.SettingsProvider>classe derivata dalla classe `Initialize` riceverà queste <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>informazioni nel relativo metodo come parametro di tipo .</span><span class="sxs-lookup"><span data-stu-id="60c31-174">Your <xref:System.Configuration.SettingsProvider>-derived class would receive this information in its `Initialize` method as a parameter of type <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span></span> <span data-ttu-id="60c31-175">È quindi necessario <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> implementare il metodo per recuperare <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> le impostazioni dall'archivio dati e salvarle.</span><span class="sxs-lookup"><span data-stu-id="60c31-175">You would then implement the <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> method to retrieve your settings from the data store, and <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> to save them.</span></span> <span data-ttu-id="60c31-176">Il provider può <xref:System.Configuration.SettingsPropertyCollection> utilizzare <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> l'oggetto fornito per determinare il nome, il tipo e l'ambito della proprietà, nonché qualsiasi altro attributo di impostazioni definito per tale proprietà.</span><span class="sxs-lookup"><span data-stu-id="60c31-176">Your provider can use the <xref:System.Configuration.SettingsPropertyCollection> supplied to <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> to determine the property's name, type, and scope, as well as any other settings attributes defined for that property.</span></span>

 <span data-ttu-id="60c31-177">Il provider dovrà implementare una proprietà e un metodo le cui implementazioni possono non essere evidenti.</span><span class="sxs-lookup"><span data-stu-id="60c31-177">Your provider will need to implement one property and one method whose implementations may not be obvious.</span></span> <span data-ttu-id="60c31-178">La <xref:System.Configuration.SettingsProvider.ApplicationName%2A> proprietà è una <xref:System.Configuration.SettingsProvider>proprietà astratta di ; è necessario programmarlo per restituire quanto segue:</span><span class="sxs-lookup"><span data-stu-id="60c31-178">The <xref:System.Configuration.SettingsProvider.ApplicationName%2A> property is an abstract property of <xref:System.Configuration.SettingsProvider>; you should program it to return the following:</span></span>

 [!code-csharp[ApplicationSettings.Architecture#2](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#2)]
 [!code-vb[ApplicationSettings.Architecture#2](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#2)]

 <span data-ttu-id="60c31-179">La classe derivata deve implementare anche un metodo `Initialize` che non accetta argomenti e non restituisce alcun valore.</span><span class="sxs-lookup"><span data-stu-id="60c31-179">Your derived class must also implement an `Initialize` method that takes no arguments and returns no value.</span></span> <span data-ttu-id="60c31-180">Questo metodo non <xref:System.Configuration.SettingsProvider>è definito da .</span><span class="sxs-lookup"><span data-stu-id="60c31-180">This method is not defined by <xref:System.Configuration.SettingsProvider>.</span></span>

 <span data-ttu-id="60c31-181">Infine, è <xref:System.Configuration.IApplicationSettingsProvider> possibile implementare nel provider per fornire il supporto per l'aggiornamento delle impostazioni, il ripristino delle impostazioni ai valori predefiniti e l'aggiornamento delle impostazioni da una versione dell'applicazione a un'altra.</span><span class="sxs-lookup"><span data-stu-id="60c31-181">Finally, you implement <xref:System.Configuration.IApplicationSettingsProvider> on your provider to provide support for refreshing settings, reverting settings to their defaults, and upgrading settings from one application version to another.</span></span>

 <span data-ttu-id="60c31-182">Dopo aver implementato e compilato il provider, è necessario istruire una classe di impostazioni affinché usi questo provider invece di quello predefinito.</span><span class="sxs-lookup"><span data-stu-id="60c31-182">Once you have implemented and compiled your provider, you need to instruct your settings class to use this provider instead of the default.</span></span> <span data-ttu-id="60c31-183">È possibile eseguire <xref:System.Configuration.SettingsProviderAttribute>questa operazione tramite il file .</span><span class="sxs-lookup"><span data-stu-id="60c31-183">You accomplish this through the <xref:System.Configuration.SettingsProviderAttribute>.</span></span> <span data-ttu-id="60c31-184">Se applicato a un'intera classe di impostazioni, il provider viene utilizzato per ogni impostazione definita dalla classe; Se applicata alle singole impostazioni, l'architettura Impostazioni applicazione <xref:System.Configuration.LocalFileSettingsProvider> utilizza tale provider solo per tali impostazioni e viene utilizzato per il resto.</span><span class="sxs-lookup"><span data-stu-id="60c31-184">If applied to an entire settings class, the provider is used for each setting that the class defines; if applied to individual settings, Application Settings architecture uses that provider for those settings only, and uses <xref:System.Configuration.LocalFileSettingsProvider> for the rest.</span></span> <span data-ttu-id="60c31-185">L'esempio di codice seguente illustra come indicare alla classe di impostazioni l'uso del provider personalizzato.</span><span class="sxs-lookup"><span data-stu-id="60c31-185">The following code example shows how to instruct the settings class to use your custom provider.</span></span>

 [!code-csharp[ApplicationSettings.Architecture#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#1)]
 [!code-vb[ApplicationSettings.Architecture#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#1)]

 <span data-ttu-id="60c31-186">Un provider può essere chiamato da più thread contemporaneamente, ma scriverà sempre nello stesso percorso di archiviazione; pertanto l'architettura di Impostazioni applicazione creerà sempre una sola istanza della classe del provider.</span><span class="sxs-lookup"><span data-stu-id="60c31-186">A provider may be called from multiple threads simultaneously, but it will always write to the same storage location; therefore, the Application Settings architecture will only ever instantiate a single instance of your provider class.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="60c31-187">È necessario assicurarsi che il provider sia thread-safe e che consenta solo a un thread alla volta di scrivere i file di configurazione.</span><span class="sxs-lookup"><span data-stu-id="60c31-187">You should ensure that your provider is thread-safe, and only allows one thread at a time to write to the configuration files.</span></span>

 <span data-ttu-id="60c31-188">Non è necessario che il provider supporti <xref:System.Configuration?displayProperty=nameWithType> tutti gli attributi delle impostazioni <xref:System.Configuration.ApplicationScopedSettingAttribute> <xref:System.Configuration.UserScopedSettingAttribute>definiti nello spazio <xref:System.Configuration.DefaultSettingValueAttribute>dei nomi, sebbene sia supportato almeno e , e inoltre .</span><span class="sxs-lookup"><span data-stu-id="60c31-188">Your provider does not need to support all of the settings attributes defined in the <xref:System.Configuration?displayProperty=nameWithType> namespace, though it must at a minimum support <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute>, and should also support <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="60c31-189">Per gli attributi che non supporta, il provider deve semplicemente dare esito negativo senza notifica e non deve generare un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="60c31-189">For those attributes that it does not support, your provider should just fail without notification; it should not throw an exception.</span></span> <span data-ttu-id="60c31-190">Se la classe di impostazioni utilizza una combinazione non <xref:System.Configuration.ApplicationScopedSettingAttribute> <xref:System.Configuration.UserScopedSettingAttribute> valida di attributi, tuttavia, ad esempio l'applicazione e la stessa impostazione, il provider deve generare un'eccezione e interrompere l'operazione.</span><span class="sxs-lookup"><span data-stu-id="60c31-190">If the settings class uses an invalid combination of attributes, however — such as applying <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute> to the same setting — your provider should throw an exception and cease operation.</span></span>

## <a name="see-also"></a><span data-ttu-id="60c31-191">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="60c31-191">See also</span></span>

- <xref:System.Configuration.ApplicationSettingsBase>
- <xref:System.Configuration.SettingsProvider>
- <xref:System.Configuration.LocalFileSettingsProvider>
- [<span data-ttu-id="60c31-192">Panoramica delle impostazioni dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="60c31-192">Application Settings Overview</span></span>](application-settings-overview.md)
- [<span data-ttu-id="60c31-193">Impostazioni delle applicazioni per i controlli personalizzati</span><span class="sxs-lookup"><span data-stu-id="60c31-193">Application Settings for Custom Controls</span></span>](application-settings-for-custom-controls.md)
- [<span data-ttu-id="60c31-194">ClickOnce e impostazioni dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="60c31-194">ClickOnce and Application Settings</span></span>](/visualstudio/deployment/clickonce-and-application-settings)
- [<span data-ttu-id="60c31-195">Schema delle impostazioni delle applicazioni</span><span class="sxs-lookup"><span data-stu-id="60c31-195">Application Settings Schema</span></span>](../../configure-apps/file-schema/application-settings-schema.md)
