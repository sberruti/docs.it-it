---
title: Pool di thread gestiti
description: Informazioni sui pool di thread .NET che include thread di lavoro in background
ms.date: 08/02/2018
ms.technology: dotnet-standard
helpviewer_keywords:
- thread pooling [.NET]
- thread pools [.NET]
- threading [.NET], thread pool
- threading [.NET], pooling
ms.assetid: 2be05b06-a42e-4c9d-a739-96c21d673927
ms.openlocfilehash: 2671ce7c9721b15de8a3805da27040e973a62804
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/15/2020
ms.locfileid: "79400631"
---
# <a name="the-managed-thread-pool"></a><span data-ttu-id="64b26-103">Pool di thread gestiti</span><span class="sxs-lookup"><span data-stu-id="64b26-103">The managed thread pool</span></span>

<span data-ttu-id="64b26-104">La classe <xref:System.Threading.ThreadPool?displayProperty=nameWithType> fornisce all'applicazione un pool di thread di lavoro gestiti dal sistema, per consentire di concentrarsi sulle attività dell'applicazione anziché sulla gestione dei thread.</span><span class="sxs-lookup"><span data-stu-id="64b26-104">The <xref:System.Threading.ThreadPool?displayProperty=nameWithType> class provides your application with a pool of worker threads that are managed by the system, allowing you to concentrate on application tasks rather than thread management.</span></span> <span data-ttu-id="64b26-105">Se si dispone di attività brevi che richiedono l'elaborazione in background, il pool di thread gestiti consente di sfruttare in modo semplice i vantaggi di più thread.</span><span class="sxs-lookup"><span data-stu-id="64b26-105">If you have short tasks that require background processing, the managed thread pool is an easy way to take advantage of multiple threads.</span></span> <span data-ttu-id="64b26-106">L'uso del pool di thread è molto più semplice in Framework 4 e versioni successive, perché è possibile creare oggetti <xref:System.Threading.Tasks.Task> e <xref:System.Threading.Tasks.Task%601> che eseguono attività asincrone nei thread del pool.</span><span class="sxs-lookup"><span data-stu-id="64b26-106">Use of the thread pool is significantly easier in Framework 4 and later, since you can create <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> objects that perform asynchronous tasks on thread pool threads.</span></span>  
  
<span data-ttu-id="64b26-107">.NET usa i thread del pool per numerosi scopi, tra cui operazioni [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md), completamento I/O asincrono, callback [timer](timers.md), operazioni di attesa registrate, chiamate asincrone di metodi tramite delegati e connessioni socket <xref:System.Net?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="64b26-107">.NET uses thread pool threads for many purposes, including [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md) operations, asynchronous I/O completion, [timer](timers.md) callbacks, registered wait operations, asynchronous method calls using delegates, and <xref:System.Net?displayProperty=nameWithType> socket connections.</span></span>  

## <a name="thread-pool-characteristics"></a><span data-ttu-id="64b26-108">Caratteristiche del pool di thread</span><span class="sxs-lookup"><span data-stu-id="64b26-108">Thread pool characteristics</span></span>

<span data-ttu-id="64b26-109">I thread del pool sono thread in [background](foreground-and-background-threads.md).</span><span class="sxs-lookup"><span data-stu-id="64b26-109">Thread pool threads are [background](foreground-and-background-threads.md) threads.</span></span> <span data-ttu-id="64b26-110">Ogni thread usa la dimensione dello stack predefinita, viene eseguito con la priorità predefinita e si trova in un apartment a thread multipli.</span><span class="sxs-lookup"><span data-stu-id="64b26-110">Each thread uses the default stack size, runs at the default priority, and is in the multithreaded apartment.</span></span> <span data-ttu-id="64b26-111">Dopo il completamento dell'attività, il thread del pool torna in una coda di thread in attesa.</span><span class="sxs-lookup"><span data-stu-id="64b26-111">Once a thread in the thread pool completes its task, it's returned to a queue of waiting threads.</span></span> <span data-ttu-id="64b26-112">Da questo momento il thread può essere riusato,</span><span class="sxs-lookup"><span data-stu-id="64b26-112">From this moment it can be reused.</span></span> <span data-ttu-id="64b26-113">evitando in questo modo la necessità di creare un nuovo thread per ogni attività.</span><span class="sxs-lookup"><span data-stu-id="64b26-113">This reuse enables applications to avoid the cost of creating a new thread for each task.</span></span>
  
<span data-ttu-id="64b26-114">È presente un solo pool di thread per processo.</span><span class="sxs-lookup"><span data-stu-id="64b26-114">There is only one thread pool per process.</span></span>  
  
### <a name="exceptions-in-thread-pool-threads"></a><span data-ttu-id="64b26-115">Eccezioni nei thread del pool</span><span class="sxs-lookup"><span data-stu-id="64b26-115">Exceptions in thread pool threads</span></span>

<span data-ttu-id="64b26-116">Le eccezioni non gestite nei thread del pool terminano il processo.</span><span class="sxs-lookup"><span data-stu-id="64b26-116">Unhandled exceptions in thread pool threads terminate the process.</span></span> <span data-ttu-id="64b26-117">Sono previste tre eccezioni a questa regola:</span><span class="sxs-lookup"><span data-stu-id="64b26-117">There are three exceptions to this rule:</span></span>  
  
- <span data-ttu-id="64b26-118">L'eccezione <xref:System.Threading.ThreadAbortException?displayProperty=nameWithType> viene generata in un thread del pool perché è stato chiamato <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="64b26-118">A <xref:System.Threading.ThreadAbortException?displayProperty=nameWithType> is thrown in a thread pool thread because <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> was called.</span></span>  
- <span data-ttu-id="64b26-119">L'eccezione <xref:System.AppDomainUnloadedException?displayProperty=nameWithType> viene generata in un thread del pool perché è in corso lo scaricamento del dominio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="64b26-119">A <xref:System.AppDomainUnloadedException?displayProperty=nameWithType> is thrown in a thread pool thread because the application domain is being unloaded.</span></span>  
- <span data-ttu-id="64b26-120">Common Language Runtime o un processo host termina il thread.</span><span class="sxs-lookup"><span data-stu-id="64b26-120">The common language runtime or a host process terminates the thread.</span></span>  
  
<span data-ttu-id="64b26-121">Per altre informazioni, vedere [Eccezioni in thread gestiti](exceptions-in-managed-threads.md).</span><span class="sxs-lookup"><span data-stu-id="64b26-121">For more information, see [Exceptions in Managed Threads](exceptions-in-managed-threads.md).</span></span>  
  
### <a name="maximum-number-of-thread-pool-threads"></a><span data-ttu-id="64b26-122">Numero massimo di thread del pool</span><span class="sxs-lookup"><span data-stu-id="64b26-122">Maximum number of thread pool threads</span></span>

<span data-ttu-id="64b26-123">Il numero di operazioni che possono essere accodate al pool di thread è limitato solo dalla memoria disponibile.</span><span class="sxs-lookup"><span data-stu-id="64b26-123">The number of operations that can be queued to the thread pool is limited only by available memory.</span></span> <span data-ttu-id="64b26-124">Tuttavia il pool di thread limita il numero di thread che possono essere attivi contemporaneamente nel processo.</span><span class="sxs-lookup"><span data-stu-id="64b26-124">However, the thread pool limits the number of threads that can be active in the process simultaneously.</span></span> <span data-ttu-id="64b26-125">Se tutti i thread del pool sono occupati, gli elementi di lavoro aggiuntivi vengono accodati fino a quando non tornano disponibili thread per l'esecuzione degli elementi stessi.</span><span class="sxs-lookup"><span data-stu-id="64b26-125">If all thread pool threads are busy, additional work items are queued until threads to execute them become available.</span></span> <span data-ttu-id="64b26-126">A partire da .NET Framework 4 la dimensione predefinita del pool di thread per un processo dipende da diversi fattori, ad esempio la dimensione dello spazio degli indirizzi virtuali.</span><span class="sxs-lookup"><span data-stu-id="64b26-126">Beginning with the .NET Framework 4, the default size of the thread pool for a process depends on several factors, such as the size of the virtual address space.</span></span> <span data-ttu-id="64b26-127">Un processo può chiamare il metodo <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> per determinare il numero di thread.</span><span class="sxs-lookup"><span data-stu-id="64b26-127">A process can call the <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> method to determine the number of threads.</span></span>  
  
<span data-ttu-id="64b26-128">È possibile controllare il numero massimo di thread usando i metodi <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> e <xref:System.Threading.ThreadPool.SetMaxThreads%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="64b26-128">You can control the maximum number of threads by using the <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> and <xref:System.Threading.ThreadPool.SetMaxThreads%2A?displayProperty=nameWithType> methods.</span></span>  

> [!NOTE]
> <span data-ttu-id="64b26-129">Il codice che ospita Common Language Runtime [`ICorThreadpool::CorSetMaxThreads`](../../framework/unmanaged-api/hosting/icorthreadpool-corsetmaxthreads-method.md) può impostare la dimensione utilizzando il metodo .</span><span class="sxs-lookup"><span data-stu-id="64b26-129">Code that hosts the common language runtime can set the size using the [`ICorThreadpool::CorSetMaxThreads`](../../framework/unmanaged-api/hosting/icorthreadpool-corsetmaxthreads-method.md) method.</span></span>  
  
### <a name="thread-pool-minimums"></a><span data-ttu-id="64b26-130">Valori minimi del pool di thread</span><span class="sxs-lookup"><span data-stu-id="64b26-130">Thread pool minimums</span></span>

<span data-ttu-id="64b26-131">Il pool di thread fornisce nuovi thread di lavoro o thread di completamento di I/O su richiesta fino a raggiungere un valore minimo specificato per ogni categoria.</span><span class="sxs-lookup"><span data-stu-id="64b26-131">The thread pool provides new worker threads or I/O completion threads on demand until it reaches a specified minimum for each category.</span></span> <span data-ttu-id="64b26-132">È possibile usare il metodo <xref:System.Threading.ThreadPool.GetMinThreads%2A?displayProperty=nameWithType> per ottenere questi valori minimi.</span><span class="sxs-lookup"><span data-stu-id="64b26-132">You can use the <xref:System.Threading.ThreadPool.GetMinThreads%2A?displayProperty=nameWithType> method to obtain these minimum values.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="64b26-133">Quando la richiesta è bassa, il numero effettivo di thread del pool può scendere sotto i valori minimi.</span><span class="sxs-lookup"><span data-stu-id="64b26-133">When demand is low, the actual number of thread pool threads can fall below the minimum values.</span></span>  
  
<span data-ttu-id="64b26-134">Quando viene raggiunto un valore minimo, il pool di thread può creare thread aggiuntivi o attendere il completamento di alcune attività.</span><span class="sxs-lookup"><span data-stu-id="64b26-134">When a minimum is reached, the thread pool can create additional threads or wait until some tasks complete.</span></span> <span data-ttu-id="64b26-135">A partire da .NET Framework 4 il pool di thread crea ed elimina thread di lavoro per ottimizzare la velocità effettiva, definita come numero di attività completate per unità di tempo.</span><span class="sxs-lookup"><span data-stu-id="64b26-135">Beginning with the .NET Framework 4, the thread pool creates and destroys worker threads in order to optimize throughput, which is defined as the number of tasks that complete per unit of time.</span></span> <span data-ttu-id="64b26-136">Un numero troppo ridotto di thread potrebbe non usare in modo ottimale le risorse disponibili, mentre troppi thread potrebbero aumentare il conflitto per le risorse.</span><span class="sxs-lookup"><span data-stu-id="64b26-136">Too few threads might not make optimal use of available resources, whereas too many threads could increase resource contention.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="64b26-137">È possibile usare il metodo <xref:System.Threading.ThreadPool.SetMinThreads%2A?displayProperty=nameWithType> per aumentare il numero minimo di thread inattivi.</span><span class="sxs-lookup"><span data-stu-id="64b26-137">You can use the <xref:System.Threading.ThreadPool.SetMinThreads%2A?displayProperty=nameWithType> method to increase the minimum number of idle threads.</span></span> <span data-ttu-id="64b26-138">Tuttavia, un aumento non necessario di questi valori può provocare problemi di prestazioni.</span><span class="sxs-lookup"><span data-stu-id="64b26-138">However, unnecessarily increasing these values can cause performance problems.</span></span> <span data-ttu-id="64b26-139">Se si avviano troppe attività contemporaneamente, potrebbero sembrare tutte lente.</span><span class="sxs-lookup"><span data-stu-id="64b26-139">If too many tasks start at the same time, all of them might appear to be slow.</span></span> <span data-ttu-id="64b26-140">Nella maggior parte dei casi, il pool di thread offre prestazioni migliori con il proprio algoritmo per l'allocazione dei thread.</span><span class="sxs-lookup"><span data-stu-id="64b26-140">In most cases the thread pool will perform better with its own algorithm for allocating threads.</span></span>  

## <a name="using-the-thread-pool"></a><span data-ttu-id="64b26-141">Uso del pool di thread</span><span class="sxs-lookup"><span data-stu-id="64b26-141">Using the thread pool</span></span>

<span data-ttu-id="64b26-142">A partire da .NET Framework 4 il modo più semplice per usare il pool di thread consiste nell'uso di [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="64b26-142">Beginning with the .NET Framework 4, the easiest way to use the thread pool is to use the [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md).</span></span> <span data-ttu-id="64b26-143">Per impostazione predefinita i tipi TPL come <xref:System.Threading.Tasks.Task> e <xref:System.Threading.Tasks.Task%601> usano i thread del pool per eseguire le attività.</span><span class="sxs-lookup"><span data-stu-id="64b26-143">By default, TPL types like <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> use thread pool threads to run tasks.</span></span>

<span data-ttu-id="64b26-144">È inoltre possibile utilizzare il <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> pool di [`ICorThreadpool::CorQueueUserWorkItem`](../../framework/unmanaged-api/hosting/icorthreadpool-corqueueuserworkitem-method.md) thread chiamando da codice <xref:System.Threading.WaitCallback?displayProperty=nameWithType> gestito (o da codice non gestito) e passando un delegato che rappresenta il metodo che esegue l'attività.</span><span class="sxs-lookup"><span data-stu-id="64b26-144">You can also use the thread pool by calling <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> from managed code (or [`ICorThreadpool::CorQueueUserWorkItem`](../../framework/unmanaged-api/hosting/icorthreadpool-corqueueuserworkitem-method.md) from unmanaged code) and passing a <xref:System.Threading.WaitCallback?displayProperty=nameWithType> delegate representing the method that performs the task.</span></span>

<span data-ttu-id="64b26-145">Un altro metodo per usare il pool di thread consiste nell'accodare gli elementi di lavoro correlati a un'operazione di attesa usando il metodo <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> e passando un oggetto <xref:System.Threading.WaitHandle?displayProperty=nameWithType> che, quando viene segnalato o in caso di time out, chiama il metodo rappresentato dal delegato <xref:System.Threading.WaitOrTimerCallback?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="64b26-145">Another way to use the thread pool is to queue work items that are related to a wait operation by using the <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> method and passing a <xref:System.Threading.WaitHandle?displayProperty=nameWithType> that, when signaled or when timed out, calls the method represented by the <xref:System.Threading.WaitOrTimerCallback?displayProperty=nameWithType> delegate.</span></span> <span data-ttu-id="64b26-146">I thread del pool vengono usati per richiamare i metodi di callback.</span><span class="sxs-lookup"><span data-stu-id="64b26-146">Thread pool threads are used to invoke callback methods.</span></span>  

<span data-ttu-id="64b26-147">Per esempi, vedere le pagine delle API di riferimento.</span><span class="sxs-lookup"><span data-stu-id="64b26-147">For the examples, check the referenced API pages.</span></span>
  
## <a name="skipping-security-checks"></a><span data-ttu-id="64b26-148">Ignorare i controlli di sicurezza</span><span class="sxs-lookup"><span data-stu-id="64b26-148">Skipping security checks</span></span>

<span data-ttu-id="64b26-149">Il pool di thread fornisce anche i metodi <xref:System.Threading.ThreadPool.UnsafeQueueUserWorkItem%2A?displayProperty=nameWithType> e <xref:System.Threading.ThreadPool.UnsafeRegisterWaitForSingleObject%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="64b26-149">The thread pool also provides the <xref:System.Threading.ThreadPool.UnsafeQueueUserWorkItem%2A?displayProperty=nameWithType> and <xref:System.Threading.ThreadPool.UnsafeRegisterWaitForSingleObject%2A?displayProperty=nameWithType> methods.</span></span> <span data-ttu-id="64b26-150">Usare questi metodi solo quando si è certi che lo stack del chiamante non sia rilevante per i controlli di sicurezza svolti durante l'esecuzione dell'attività in coda.</span><span class="sxs-lookup"><span data-stu-id="64b26-150">Use these methods only when you are certain that the caller's stack is irrelevant to any security checks performed during the execution of the queued task.</span></span> <span data-ttu-id="64b26-151">I metodi <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> e <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> consentono entrambi di acquisire lo stack del chiamante, che viene unito nello stack del thread del pool quando il thread inizia a eseguire un'attività.</span><span class="sxs-lookup"><span data-stu-id="64b26-151"><xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> and <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> both capture the caller's stack, which is merged into the stack of the thread pool thread when the thread begins to execute a task.</span></span> <span data-ttu-id="64b26-152">Se è necessario un controllo di sicurezza, deve essere controllato l'intero stack.</span><span class="sxs-lookup"><span data-stu-id="64b26-152">If a security check is required, the entire stack must be checked.</span></span> <span data-ttu-id="64b26-153">Sebbene il controllo garantisca la sicurezza, comporta anche una riduzione delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="64b26-153">Although the check provides safety, it also has a performance cost.</span></span>  

## <a name="when-not-to-use-thread-pool-threads"></a><span data-ttu-id="64b26-154">Quando non usare i thread del pool</span><span class="sxs-lookup"><span data-stu-id="64b26-154">When not to use thread pool threads</span></span>

<span data-ttu-id="64b26-155">Vi sono diversi scenari in cui è opportuno creare e gestire i propri thread anziché usare i thread del pool, come nei casi seguenti:</span><span class="sxs-lookup"><span data-stu-id="64b26-155">There are several scenarios in which it's appropriate to create and manage your own threads instead of using thread pool threads:</span></span>  
  
- <span data-ttu-id="64b26-156">È necessario un thread in primo piano.</span><span class="sxs-lookup"><span data-stu-id="64b26-156">You require a foreground thread.</span></span>  
- <span data-ttu-id="64b26-157">È necessario che un thread abbia una priorità specifica.</span><span class="sxs-lookup"><span data-stu-id="64b26-157">You require a thread to have a particular priority.</span></span>  
- <span data-ttu-id="64b26-158">Sono presenti attività che causano il blocco del thread per lunghi periodi di tempo.</span><span class="sxs-lookup"><span data-stu-id="64b26-158">You have tasks that cause the thread to block for long periods of time.</span></span> <span data-ttu-id="64b26-159">Il pool di thread prevede un numero massimo di thread, pertanto un numero elevato di thread del pool bloccati potrebbe impedire l'avvio delle attività.</span><span class="sxs-lookup"><span data-stu-id="64b26-159">The thread pool has a maximum number of threads, so a large number of blocked thread pool threads might prevent tasks from starting.</span></span>  
- <span data-ttu-id="64b26-160">È necessario inserire thread di un apartment a thread singolo.</span><span class="sxs-lookup"><span data-stu-id="64b26-160">You need to place threads into a single-threaded apartment.</span></span> <span data-ttu-id="64b26-161">Tutti i thread di <xref:System.Threading.ThreadPool> sono inclusi in apartment a thread multipli.</span><span class="sxs-lookup"><span data-stu-id="64b26-161">All <xref:System.Threading.ThreadPool> threads are in the multithreaded apartment.</span></span>  
- <span data-ttu-id="64b26-162">È necessario disporre di un'identità stabile associata al thread o dedicare un thread a un'attività.</span><span class="sxs-lookup"><span data-stu-id="64b26-162">You need to have a stable identity associated with the thread, or to dedicate a thread to a task.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="64b26-163">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="64b26-163">See also</span></span>

- <xref:System.Threading.ThreadPool?displayProperty=nameWithType>
- <xref:System.Threading.Tasks.Task?displayProperty=nameWithType>
- <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>
- [<span data-ttu-id="64b26-164">Task Parallel Library (TPL)</span><span class="sxs-lookup"><span data-stu-id="64b26-164">Task Parallel Library (TPL)</span></span>](../parallel-programming/task-parallel-library-tpl.md)
- [<span data-ttu-id="64b26-165">Procedura: Restituire un valore da un'attività</span><span class="sxs-lookup"><span data-stu-id="64b26-165">How to: Return a Value from a Task</span></span>](../parallel-programming/how-to-return-a-value-from-a-task.md)
- [<span data-ttu-id="64b26-166">Funzionalità e oggetti di threading</span><span class="sxs-lookup"><span data-stu-id="64b26-166">Threading Objects and Features</span></span>](threading-objects-and-features.md)
- [<span data-ttu-id="64b26-167">Thread e threading</span><span class="sxs-lookup"><span data-stu-id="64b26-167">Threads and Threading</span></span>](threads-and-threading.md)
- [<span data-ttu-id="64b26-168">I/O di file asincrono</span><span class="sxs-lookup"><span data-stu-id="64b26-168">Asynchronous File I/O</span></span>](../io/asynchronous-file-i-o.md)
- [<span data-ttu-id="64b26-169">Timer</span><span class="sxs-lookup"><span data-stu-id="64b26-169">Timers</span></span>](timers.md)
