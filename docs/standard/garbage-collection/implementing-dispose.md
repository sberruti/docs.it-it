---
title: Implementazione di un metodo Dispose
ms.date: 04/07/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Dispose method
- garbage collection, Dispose method
ms.assetid: eb4e1af0-3b48-4fbc-ad4e-fc2f64138bf9
ms.openlocfilehash: f3d3269ccf56954f963762503d2bc1c53b9e6b83
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/15/2020
ms.locfileid: "78238988"
---
# <a name="implementing-a-dispose-method"></a><span data-ttu-id="d943c-102">Implementazione di un metodo Dispose</span><span class="sxs-lookup"><span data-stu-id="d943c-102">Implementing a Dispose method</span></span>

<span data-ttu-id="d943c-103">Implementare un metodo <xref:System.IDisposable.Dispose%2A> per rilasciare le risorse non gestite usate dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d943c-103">You implement a <xref:System.IDisposable.Dispose%2A> method to release unmanaged resources used by your application.</span></span> <span data-ttu-id="d943c-104">Garbage Collector di .NET non alloca e non rilascia la memoria non gestita.</span><span class="sxs-lookup"><span data-stu-id="d943c-104">The .NET garbage collector does not allocate or release unmanaged memory.</span></span>  
  
<span data-ttu-id="d943c-105">Il criterio per eliminare un oggetto, definito [criterio Dispose](implementing-dispose.md), definisce un ordine in base alla durata di un oggetto.</span><span class="sxs-lookup"><span data-stu-id="d943c-105">The pattern for disposing an object, referred to as a [dispose pattern](implementing-dispose.md), imposes order on the lifetime of an object.</span></span> <span data-ttu-id="d943c-106">Il modello Dispose viene usato solo per gli oggetti che accedono a risorse non gestite, quali handle di file e pipe, handle del Registro di sistema, handle di attesa o puntatori ai blocchi di memoria non gestita.</span><span class="sxs-lookup"><span data-stu-id="d943c-106">The dispose pattern is used only for objects that access unmanaged resources, such as file and pipe handles, registry handles, wait handles, or pointers to blocks of unmanaged memory.</span></span> <span data-ttu-id="d943c-107">Ciò è dovuto al fatto che il Garbage Collector è molto efficiente nel recupero degli oggetti gestiti inutilizzati, ma non è in grado di recuperare gli oggetti non gestiti.</span><span class="sxs-lookup"><span data-stu-id="d943c-107">This is because the garbage collector is very efficient at reclaiming unused managed objects, but it is unable to reclaim unmanaged objects.</span></span>  
  
<span data-ttu-id="d943c-108">Il modello Dispose precede due variazioni:</span><span class="sxs-lookup"><span data-stu-id="d943c-108">The dispose pattern has two variations:</span></span>  
  
- <span data-ttu-id="d943c-109">Viene eseguito il wrapping di ogni risorsa non gestita utilizzata da un tipo in un handle sicuro (ovvero in una classe derivata da <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType>).</span><span class="sxs-lookup"><span data-stu-id="d943c-109">You wrap each unmanaged resource that a type uses in a safe handle (that is, in a class derived from <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType>).</span></span> <span data-ttu-id="d943c-110">In questo caso, viene implementata l'interfaccia <xref:System.IDisposable> e un ulteriore metodo `Dispose(Boolean)`.</span><span class="sxs-lookup"><span data-stu-id="d943c-110">In this case, you implement the <xref:System.IDisposable> interface and an additional `Dispose(Boolean)` method.</span></span> <span data-ttu-id="d943c-111">Questa è la variazione consigliata e non richiede l'override del metodo <xref:System.Object.Finalize%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d943c-111">This is the recommended variation and doesn't require overriding the <xref:System.Object.Finalize%2A?displayProperty=nameWithType> method.</span></span>  
  
  > [!NOTE]
  > <span data-ttu-id="d943c-112">Lo spazio dei nomi <xref:Microsoft.Win32.SafeHandles?displayProperty=nameWithType> fornisce un set di classi derivate da <xref:System.Runtime.InteropServices.SafeHandle>, elencate nella sezione [Uso di handle sicuri](#SafeHandles).</span><span class="sxs-lookup"><span data-stu-id="d943c-112">The <xref:Microsoft.Win32.SafeHandles?displayProperty=nameWithType> namespace provides a set of classes derived from <xref:System.Runtime.InteropServices.SafeHandle>, which are listed in the [Using safe handles](#SafeHandles) section.</span></span> <span data-ttu-id="d943c-113">Se non è possibile trovare una classe in grado di rilasciare la risorsa non gestita, è possibile implementare una propria sottoclasse di <xref:System.Runtime.InteropServices.SafeHandle>.</span><span class="sxs-lookup"><span data-stu-id="d943c-113">If you can't find a class that is suitable for releasing your unmanaged resource, you can implement your own subclass of <xref:System.Runtime.InteropServices.SafeHandle>.</span></span>  
  
- <span data-ttu-id="d943c-114">Viene implementata l'interfaccia <xref:System.IDisposable> e un ulteriore metodo `Dispose(Boolean)` e viene inoltre eseguito l'override del metodo <xref:System.Object.Finalize%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d943c-114">You implement the <xref:System.IDisposable> interface and an additional `Dispose(Boolean)` method, and you also override the <xref:System.Object.Finalize%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="d943c-115">È necessario eseguire l'override di <xref:System.Object.Finalize%2A> per assicurarsi che le risorse non gestite vengano eliminate quando l'implementazione <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> non viene chiamata da un consumer del tipo.</span><span class="sxs-lookup"><span data-stu-id="d943c-115">You must override <xref:System.Object.Finalize%2A> to ensure that unmanaged resources are disposed of if your <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation is not called by a consumer of your type.</span></span> <span data-ttu-id="d943c-116">Se si usa la tecnica consigliata discussa nel precedente punto, questa operazione viene eseguita automaticamente dalla classe <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d943c-116">If you use the recommended technique discussed in the previous bullet, the <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType> class does this on your behalf.</span></span>  
  
<span data-ttu-id="d943c-117">Al fine di garantire la corretta pulitura delle risorse in ogni occasione, deve essere possibile chiamare il metodo <xref:System.IDisposable.Dispose%2A> più volte senza che venga generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="d943c-117">To help ensure that resources are always cleaned up appropriately, a <xref:System.IDisposable.Dispose%2A> method should be callable multiple times without throwing an exception.</span></span>  
  
<span data-ttu-id="d943c-118">Nell'esempio di <xref:System.GC.KeepAlive%2A?displayProperty=nameWithType> codice fornito per il metodo viene illustrato come la procedura di Garbage Collection può causare l'esecuzione di un finalizzatore, mentre un riferimento non gestito all'oggetto o ai relativi membri è ancora in uso.</span><span class="sxs-lookup"><span data-stu-id="d943c-118">The code example provided for the <xref:System.GC.KeepAlive%2A?displayProperty=nameWithType> method shows how garbage collection can cause a finalizer to run, while an unmanaged reference to the object or its members is still in use.</span></span> <span data-ttu-id="d943c-119">Può essere utile <xref:System.GC.KeepAlive%2A?displayProperty=nameWithType> utilizzare per rendere l'oggetto non idoneo per la procedura di Garbage Collection dall'inizio della routine corrente fino al punto in cui viene chiamato questo metodo.</span><span class="sxs-lookup"><span data-stu-id="d943c-119">It may make sense to utilize <xref:System.GC.KeepAlive%2A?displayProperty=nameWithType> to make the object ineligible for garbage collection from the start of the current routine to the point where this method is called.</span></span>
  
<a name="Dispose2"></a>
## <a name="dispose-and-disposeboolean"></a><span data-ttu-id="d943c-120">Dispose() e Dispose(Boolean)</span><span class="sxs-lookup"><span data-stu-id="d943c-120">Dispose() and Dispose(Boolean)</span></span>  

<span data-ttu-id="d943c-121">L'interfaccia <xref:System.IDisposable> richiede l'implementazione di un singolo metodo senza parametri, <xref:System.IDisposable.Dispose%2A>.</span><span class="sxs-lookup"><span data-stu-id="d943c-121">The <xref:System.IDisposable> interface requires the implementation of a single parameterless method, <xref:System.IDisposable.Dispose%2A>.</span></span> <span data-ttu-id="d943c-122">Tuttavia, il modello Dispose richiede due metodi `Dispose` per essere implementato:</span><span class="sxs-lookup"><span data-stu-id="d943c-122">However, the dispose pattern requires two `Dispose` methods to be implemented:</span></span>  
  
- <span data-ttu-id="d943c-123">Un'implementazione `NonInheritable` pubblica non virtuale (<xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> in Visual Basic) senza parametri.</span><span class="sxs-lookup"><span data-stu-id="d943c-123">A public non-virtual (`NonInheritable` in Visual Basic) <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation that has no parameters.</span></span>  
  
- <span data-ttu-id="d943c-124">Un metodo `Overridable` protetto virtuale (`Dispose` in Visual Basic) la cui firma è indicata di seguito:</span><span class="sxs-lookup"><span data-stu-id="d943c-124">A protected virtual (`Overridable` in Visual Basic) `Dispose` method whose signature is:</span></span>  
  
  [!code-csharp[Conceptual.Disposable#8](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.disposable/cs/dispose1.cs#8)]
  [!code-vb[Conceptual.Disposable#8](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.disposable/vb/dispose1.vb#8)]  
  
### <a name="the-dispose-overload"></a><span data-ttu-id="d943c-125">Overload Dispose()</span><span class="sxs-lookup"><span data-stu-id="d943c-125">The Dispose() overload</span></span>

<span data-ttu-id="d943c-126">Poiché il metodo pubblico, non virtuale (`NonInheritable` in Visual Basic), privo di parametri `Dispose` è chiamato da un consumer del tipo, lo scopo è liberare le risorse non gestite e indicare che non è necessario eseguire il finalizzatore, se disponibili.</span><span class="sxs-lookup"><span data-stu-id="d943c-126">Because the public, non-virtual (`NonInheritable` in Visual Basic), parameterless `Dispose` method is called by a consumer of the type, its purpose is to free unmanaged resources and to indicate that the finalizer, if one is present, doesn't have to run.</span></span> <span data-ttu-id="d943c-127">Per questo motivo il metodo ha un'implementazione standard:</span><span class="sxs-lookup"><span data-stu-id="d943c-127">Because of this, it has a standard implementation:</span></span>  
  
[!code-csharp[Conceptual.Disposable#7](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.disposable/cs/dispose1.cs#7)]
[!code-vb[Conceptual.Disposable#7](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.disposable/vb/dispose1.vb#7)]  
  
<span data-ttu-id="d943c-128">Il metodo `Dispose` esegue la pulizia di tutti gli oggetti, quindi il Garbage Collector non deve più chiamare l'override <xref:System.Object.Finalize%2A?displayProperty=nameWithType> degli oggetti.</span><span class="sxs-lookup"><span data-stu-id="d943c-128">The `Dispose` method performs all object cleanup, so the garbage collector no longer needs to call the objects' <xref:System.Object.Finalize%2A?displayProperty=nameWithType> override.</span></span> <span data-ttu-id="d943c-129">Pertanto, la chiamata al metodo <xref:System.GC.SuppressFinalize%2A> impedisce al Garbage Collector di eseguire il finalizzatore.</span><span class="sxs-lookup"><span data-stu-id="d943c-129">Therefore, the call to the <xref:System.GC.SuppressFinalize%2A> method prevents the garbage collector from running the finalizer.</span></span> <span data-ttu-id="d943c-130">Se il tipo non dispone di un finalizzatore, la chiamata a <xref:System.GC.SuppressFinalize%2A?displayProperty=nameWithType> non ha alcun effetto.</span><span class="sxs-lookup"><span data-stu-id="d943c-130">If the type has no finalizer, the call to <xref:System.GC.SuppressFinalize%2A?displayProperty=nameWithType> has no effect.</span></span> <span data-ttu-id="d943c-131">Si noti che l'effettiva operazione di rilascio delle risorse non gestite viene eseguita dal secondo overload del metodo `Dispose`.</span><span class="sxs-lookup"><span data-stu-id="d943c-131">Note that the actual work of releasing unmanaged resources is performed by the second overload of the `Dispose` method.</span></span>  
  
### <a name="the-disposeboolean-overload"></a><span data-ttu-id="d943c-132">Overload Dispose(Boolean)</span><span class="sxs-lookup"><span data-stu-id="d943c-132">The Dispose(Boolean) overload</span></span>

<span data-ttu-id="d943c-133">Nel secondo overload il parametro *disposing* è un oggetto <xref:System.Boolean> che indica se la chiamata al metodo proviene da un metodo <xref:System.IDisposable.Dispose%2A> (il valore è `true`) o da un finalizzatore (il valore è `false`).</span><span class="sxs-lookup"><span data-stu-id="d943c-133">In the second overload, the *disposing* parameter is a <xref:System.Boolean> that indicates whether the method call comes from a <xref:System.IDisposable.Dispose%2A> method (its value is `true`) or from a finalizer (its value is `false`).</span></span>  
  
<span data-ttu-id="d943c-134">Il corpo del metodo è costituito da due blocchi di codice:</span><span class="sxs-lookup"><span data-stu-id="d943c-134">The body of the method consists of two blocks of code:</span></span>  
  
- <span data-ttu-id="d943c-135">Un blocco che libera le risorse non gestite.</span><span class="sxs-lookup"><span data-stu-id="d943c-135">A block that frees unmanaged resources.</span></span> <span data-ttu-id="d943c-136">Questo blocco viene eseguito indipendentemente dal valore del parametro `disposing`.</span><span class="sxs-lookup"><span data-stu-id="d943c-136">This block executes regardless of the value of the `disposing` parameter.</span></span>  
  
- <span data-ttu-id="d943c-137">Un blocco condizionale che libera le risorse gestite.</span><span class="sxs-lookup"><span data-stu-id="d943c-137">A conditional block that frees managed resources.</span></span> <span data-ttu-id="d943c-138">Il blocco è eseguito se il valore di `disposing` è `true`.</span><span class="sxs-lookup"><span data-stu-id="d943c-138">This block executes if the value of `disposing` is `true`.</span></span> <span data-ttu-id="d943c-139">Le risorse gestite liberate possono includere:</span><span class="sxs-lookup"><span data-stu-id="d943c-139">The managed resources that it frees can include:</span></span>  
  
  <span data-ttu-id="d943c-140">**Oggetti gestiti che implementano <xref:System.IDisposable>.**</span><span class="sxs-lookup"><span data-stu-id="d943c-140">**Managed objects that implement <xref:System.IDisposable>.**</span></span> <span data-ttu-id="d943c-141">Il blocco condizionale può essere usato per chiamare la relativa implementazione <xref:System.IDisposable.Dispose%2A>.</span><span class="sxs-lookup"><span data-stu-id="d943c-141">The conditional block can be used to call their <xref:System.IDisposable.Dispose%2A> implementation.</span></span> <span data-ttu-id="d943c-142">Se è stato utilizzato un handle sicuro per eseguire il wrapping della risorsa non gestita, l'implementazione <xref:System.Runtime.InteropServices.SafeHandle.Dispose%28System.Boolean%29?displayProperty=nameWithType> dovrebbe essere chiamata in questo punto.</span><span class="sxs-lookup"><span data-stu-id="d943c-142">If you have used a safe handle to wrap your unmanaged resource, you should call the <xref:System.Runtime.InteropServices.SafeHandle.Dispose%28System.Boolean%29?displayProperty=nameWithType> implementation here.</span></span>  
  
  <span data-ttu-id="d943c-143">**Oggetti gestiti che usano grandi quantità di memoria o risorse insufficienti.**</span><span class="sxs-lookup"><span data-stu-id="d943c-143">**Managed objects that consume large amounts of memory or consume scarce resources.**</span></span> <span data-ttu-id="d943c-144">La liberazione esplicita di questi oggetti nel metodo `Dispose` ne consente un rilascio più veloce rispetto al recupero non deterministico eseguito dal Garbage Collector.</span><span class="sxs-lookup"><span data-stu-id="d943c-144">Freeing these objects explicitly in the `Dispose` method releases them faster than if they were reclaimed non-deterministically by the garbage collector.</span></span>  
  
<span data-ttu-id="d943c-145">Se la chiamata al metodo proviene da un finalizzatore (ovvero se *disposing* è `false`), viene eseguito solo il codice che libera le risorse non gestite.</span><span class="sxs-lookup"><span data-stu-id="d943c-145">If the method call comes from a finalizer (that is, if *disposing* is `false`), only the code that frees unmanaged resources executes.</span></span> <span data-ttu-id="d943c-146">Poiché l'ordine in cui il Garbage Collector elimina gli oggetti gestiti durante la finalizzazione non è definito, la chiamata a questo overload `Dispose` con valore `false` impedisce che il finalizzatore tenti di liberare risorse gestite che potrebbero essere già state recuperate.</span><span class="sxs-lookup"><span data-stu-id="d943c-146">Because the order in which the garbage collector destroys managed objects during finalization is not defined, calling this `Dispose` overload with a value of `false` prevents the finalizer from trying to release managed resources that may have already been reclaimed.</span></span>  
  
## <a name="implementing-the-dispose-pattern-for-a-base-class"></a><span data-ttu-id="d943c-147">Implementazione del modello Dispose per una classe di base</span><span class="sxs-lookup"><span data-stu-id="d943c-147">Implementing the dispose pattern for a base class</span></span>

<span data-ttu-id="d943c-148">Per implementare il modello Dispose per una classe di base, è necessario predisporre quanto segue:</span><span class="sxs-lookup"><span data-stu-id="d943c-148">If you implement the dispose pattern for a base class, you must provide the following:</span></span>  
  
> [!IMPORTANT]
> <span data-ttu-id="d943c-149">È consigliabile implementare questo modello per tutte le classi di base che implementano <xref:System.IDisposable.Dispose> e non sono `sealed` (`NotInheritable` in Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="d943c-149">You should implement this pattern for all base classes that implement <xref:System.IDisposable.Dispose> and are not `sealed` (`NotInheritable` in Visual Basic).</span></span>  
  
- <span data-ttu-id="d943c-150">Un'implementazione <xref:System.IDisposable.Dispose%2A> che chiami il metodo `Dispose(Boolean)`.</span><span class="sxs-lookup"><span data-stu-id="d943c-150">A <xref:System.IDisposable.Dispose%2A> implementation that calls the `Dispose(Boolean)` method.</span></span>  
  
- <span data-ttu-id="d943c-151">Un metodo `Dispose(Boolean)` che esegua l'effettiva operazione di rilascio delle risorse.</span><span class="sxs-lookup"><span data-stu-id="d943c-151">A `Dispose(Boolean)` method that performs the actual work of releasing resources.</span></span>  
  
- <span data-ttu-id="d943c-152">Una classe derivata da <xref:System.Runtime.InteropServices.SafeHandle> che esegua il wrapping della risorsa non gestita (consigliato) o un override al metodo <xref:System.Object.Finalize%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d943c-152">Either a class derived from <xref:System.Runtime.InteropServices.SafeHandle> that wraps your unmanaged resource (recommended), or an override to the <xref:System.Object.Finalize%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="d943c-153">La classe <xref:System.Runtime.InteropServices.SafeHandle> fornisce un finalizzatore, evitando la necessità di codificarne uno.</span><span class="sxs-lookup"><span data-stu-id="d943c-153">The <xref:System.Runtime.InteropServices.SafeHandle> class provides a finalizer that frees you from having to code one.</span></span>  
  
<span data-ttu-id="d943c-154">Di seguito è illustrato il modello generale per implementare il modello Dispose per una classe di base che usa un handle sicuro.</span><span class="sxs-lookup"><span data-stu-id="d943c-154">Here's the general pattern for implementing the dispose pattern for a base class that uses a safe handle.</span></span>  
  
[!code-csharp[System.IDisposable#3](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.idisposable/cs/base1.cs#3)]
[!code-vb[System.IDisposable#3](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.idisposable/vb/base1.vb#3)]  
  
> [!NOTE]
> <span data-ttu-id="d943c-155">L'esempio precedente usa un oggetto <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> per illustrato il criterio; sarebbe possibile usare invece qualsiasi oggetto derivato da <xref:System.Runtime.InteropServices.SafeHandle>.</span><span class="sxs-lookup"><span data-stu-id="d943c-155">The previous example uses a <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> object to illustrate the pattern; any object derived from <xref:System.Runtime.InteropServices.SafeHandle> could be used instead.</span></span> <span data-ttu-id="d943c-156">Si noti che l'esempio non crea correttamente un'istanza del relativo oggetto <xref:Microsoft.Win32.SafeHandles.SafeFileHandle>.</span><span class="sxs-lookup"><span data-stu-id="d943c-156">Note that the example does not properly instantiate its <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> object.</span></span>  
  
<span data-ttu-id="d943c-157">Di seguito è illustrato il modello generale per implementare il modello Dispose per una classe di base che esegue l'override di <xref:System.Object.Finalize%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d943c-157">Here's the general pattern for implementing the dispose pattern for a base class that overrides <xref:System.Object.Finalize%2A?displayProperty=nameWithType>.</span></span>  
  
[!code-csharp[System.IDisposable#5](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.idisposable/cs/base2.cs#5)]
[!code-vb[System.IDisposable#5](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.idisposable/vb/base2.vb#5)]  
  
> [!NOTE]
> <span data-ttu-id="d943c-158">In C# si esegue l'override di <xref:System.Object.Finalize%2A?displayProperty=nameWithType> definendo un [distruttore](../../csharp/programming-guide/classes-and-structs/destructors.md).</span><span class="sxs-lookup"><span data-stu-id="d943c-158">In C#, you override <xref:System.Object.Finalize%2A?displayProperty=nameWithType> by defining a [destructor](../../csharp/programming-guide/classes-and-structs/destructors.md).</span></span>  
  
## <a name="implementing-the-dispose-pattern-for-a-derived-class"></a><span data-ttu-id="d943c-159">Implementazione del modello Dispose per una classe derivata</span><span class="sxs-lookup"><span data-stu-id="d943c-159">Implementing the dispose pattern for a derived class</span></span>

<span data-ttu-id="d943c-160">Una classe derivata da una classe che implementa l'interfaccia <xref:System.IDisposable> non deve implementare <xref:System.IDisposable>, poiché l'implementazione della classe di base di <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> viene ereditata dalle classi derivate.</span><span class="sxs-lookup"><span data-stu-id="d943c-160">A class derived from a class that implements the <xref:System.IDisposable> interface shouldn't implement <xref:System.IDisposable>, because the base class implementation of <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> is inherited by its derived classes.</span></span> <span data-ttu-id="d943c-161">Al contrario, per rilasciare le risorse di una classe derivata, è necessario fornire quanto segue:Instead, to release resources of a derived class, you provide the following:</span><span class="sxs-lookup"><span data-stu-id="d943c-161">Instead, to release resources of a derived class, you provide the following:</span></span>  
  
- <span data-ttu-id="d943c-162">Un metodo `protected Dispose(Boolean)` che esegua l'override del metodo della classe di base ed esegua l'effettiva operazione di rilascio delle risorse della classe derivata.</span><span class="sxs-lookup"><span data-stu-id="d943c-162">A `protected Dispose(Boolean)` method that overrides the base class method and performs the actual work of releasing the resources of the derived class.</span></span> <span data-ttu-id="d943c-163">Questo metodo deve anche chiamare il metodo `Dispose(Boolean)` della classe di base e passarne lo stato di eliminazione per l'argomento.</span><span class="sxs-lookup"><span data-stu-id="d943c-163">This method should also call the `Dispose(Boolean)` method of the base class and pass its disposing status for the argument.</span></span>  
  
- <span data-ttu-id="d943c-164">Una classe derivata da <xref:System.Runtime.InteropServices.SafeHandle> che esegua il wrapping della risorsa non gestita (consigliato) o un override al metodo <xref:System.Object.Finalize%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d943c-164">Either a class derived from <xref:System.Runtime.InteropServices.SafeHandle> that wraps your unmanaged resource (recommended), or an override to the <xref:System.Object.Finalize%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="d943c-165">La classe <xref:System.Runtime.InteropServices.SafeHandle> fornisce un finalizzatore, evitando la necessità di codificarne uno.</span><span class="sxs-lookup"><span data-stu-id="d943c-165">The <xref:System.Runtime.InteropServices.SafeHandle> class provides a finalizer that frees you from having to code one.</span></span> <span data-ttu-id="d943c-166">Se si specifica un finalizzatore, questo deve chiamare l'overload di `Dispose(Boolean)` con un argomento *disposing* di `false`.</span><span class="sxs-lookup"><span data-stu-id="d943c-166">If you do provide a finalizer, it should call the `Dispose(Boolean)` overload with a *disposing* argument of `false`.</span></span>  
  
<span data-ttu-id="d943c-167">Di seguito è illustrato il modello generale per implementare il modello Dispose per una classe derivata che usa un handle sicuro:</span><span class="sxs-lookup"><span data-stu-id="d943c-167">Here's the general pattern for implementing the dispose pattern for a derived class that uses a safe handle:</span></span>  
  
[!code-csharp[System.IDisposable#4](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.idisposable/cs/derived1.cs#4)]
[!code-vb[System.IDisposable#4](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.idisposable/vb/derived1.vb#4)]  
  
> [!NOTE]
> <span data-ttu-id="d943c-168">L'esempio precedente usa un oggetto <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> per illustrato il criterio; sarebbe possibile usare invece qualsiasi oggetto derivato da <xref:System.Runtime.InteropServices.SafeHandle>.</span><span class="sxs-lookup"><span data-stu-id="d943c-168">The previous example uses a <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> object to illustrate the pattern; any object derived from <xref:System.Runtime.InteropServices.SafeHandle> could be used instead.</span></span> <span data-ttu-id="d943c-169">Si noti che l'esempio non crea correttamente un'istanza del relativo oggetto <xref:Microsoft.Win32.SafeHandles.SafeFileHandle>.</span><span class="sxs-lookup"><span data-stu-id="d943c-169">Note that the example does not properly instantiate its <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> object.</span></span>  
  
<span data-ttu-id="d943c-170">Di seguito è illustrato il modello generale per implementare il modello Dispose per una classe derivata che esegue l'override di <xref:System.Object.Finalize%2A?displayProperty=nameWithType>:</span><span class="sxs-lookup"><span data-stu-id="d943c-170">Here's the general pattern for implementing the dispose pattern for a derived class that overrides <xref:System.Object.Finalize%2A?displayProperty=nameWithType>:</span></span>  
  
[!code-csharp[System.IDisposable#6](../../../samples/snippets/csharp/VS_Snippets_CLR_System/system.idisposable/cs/derived2.cs#6)]
[!code-vb[System.IDisposable#6](../../../samples/snippets/visualbasic/VS_Snippets_CLR_System/system.idisposable/vb/derived2.vb#6)]  
  
> [!NOTE]
> <span data-ttu-id="d943c-171">In C# si esegue l'override di <xref:System.Object.Finalize%2A?displayProperty=nameWithType> definendo un [distruttore](../../csharp/programming-guide/classes-and-structs/destructors.md).</span><span class="sxs-lookup"><span data-stu-id="d943c-171">In C#, you override <xref:System.Object.Finalize%2A?displayProperty=nameWithType> by defining a [destructor](../../csharp/programming-guide/classes-and-structs/destructors.md).</span></span>  
  
<a name="SafeHandles"></a>
## <a name="using-safe-handles"></a><span data-ttu-id="d943c-172">Utilizzo degli handle sicuri</span><span class="sxs-lookup"><span data-stu-id="d943c-172">Using safe handles</span></span>

<span data-ttu-id="d943c-173">La scrittura di codice per il finalizzatore di un oggetto è un'attività complessa che può causare problemi se non eseguita correttamente.</span><span class="sxs-lookup"><span data-stu-id="d943c-173">Writing code for an object's finalizer is a complex task that can cause problems if not done correctly.</span></span> <span data-ttu-id="d943c-174">È pertanto consigliabile costruire oggetti <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType> anziché implementare un finalizzatore.</span><span class="sxs-lookup"><span data-stu-id="d943c-174">Therefore, we recommend that you construct <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType> objects instead of implementing a finalizer.</span></span>  
  
<span data-ttu-id="d943c-175">Le classi derivate dalla classe <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType> semplificano i problemi di durata degli oggetti assegnando e rilasciando handle senza interruzione.</span><span class="sxs-lookup"><span data-stu-id="d943c-175">Classes derived from the <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType> class simplify object lifetime issues by assigning and releasing handles without interruption.</span></span> <span data-ttu-id="d943c-176">Contengono un finalizzatore critico la cui esecuzione è garantita durante lo scaricamento di un dominio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="d943c-176">They contain a critical finalizer that is guaranteed to run while an application domain is unloading.</span></span> <span data-ttu-id="d943c-177">Per altre informazioni sui vantaggi dell'utilizzo di un handle sicuro, vedere <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="d943c-177">For more information about the advantages of using a safe handle, see <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType>.</span></span> <span data-ttu-id="d943c-178">Le seguenti classi derivate nello spazio dei nomi <xref:Microsoft.Win32.SafeHandles> forniscono handle sicuri:</span><span class="sxs-lookup"><span data-stu-id="d943c-178">The following derived classes in the <xref:Microsoft.Win32.SafeHandles> namespace provide safe handles:</span></span>  
  
- <span data-ttu-id="d943c-179">Le classi <xref:Microsoft.Win32.SafeHandles.SafeFileHandle>, <xref:Microsoft.Win32.SafeHandles.SafeMemoryMappedFileHandle> e <xref:Microsoft.Win32.SafeHandles.SafePipeHandle> per file, file mappati alla memoria e pipe.</span><span class="sxs-lookup"><span data-stu-id="d943c-179">The <xref:Microsoft.Win32.SafeHandles.SafeFileHandle>, <xref:Microsoft.Win32.SafeHandles.SafeMemoryMappedFileHandle>, and <xref:Microsoft.Win32.SafeHandles.SafePipeHandle> class, for files, memory mapped files, and pipes.</span></span>  
  
- <span data-ttu-id="d943c-180">La classe <xref:Microsoft.Win32.SafeHandles.SafeMemoryMappedViewHandle> per visualizzazioni di memoria.</span><span class="sxs-lookup"><span data-stu-id="d943c-180">The <xref:Microsoft.Win32.SafeHandles.SafeMemoryMappedViewHandle> class, for memory views.</span></span>  
  
- <span data-ttu-id="d943c-181">Le classi <xref:Microsoft.Win32.SafeHandles.SafeNCryptKeyHandle>, <xref:Microsoft.Win32.SafeHandles.SafeNCryptProviderHandle> e <xref:Microsoft.Win32.SafeHandles.SafeNCryptSecretHandle> per i costrutti di crittografia.</span><span class="sxs-lookup"><span data-stu-id="d943c-181">The <xref:Microsoft.Win32.SafeHandles.SafeNCryptKeyHandle>, <xref:Microsoft.Win32.SafeHandles.SafeNCryptProviderHandle>, and <xref:Microsoft.Win32.SafeHandles.SafeNCryptSecretHandle> classes, for cryptography constructs.</span></span>  
  
- <span data-ttu-id="d943c-182">La classe <xref:Microsoft.Win32.SafeHandles.SafeRegistryHandle> per le chiavi del Registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="d943c-182">The <xref:Microsoft.Win32.SafeHandles.SafeRegistryHandle> class, for registry keys.</span></span>  
  
- <span data-ttu-id="d943c-183">La classe <xref:Microsoft.Win32.SafeHandles.SafeWaitHandle> per gli handle di attesa.</span><span class="sxs-lookup"><span data-stu-id="d943c-183">The <xref:Microsoft.Win32.SafeHandles.SafeWaitHandle> class, for wait handles.</span></span>  
  
<a name="base"></a>
## <a name="using-a-safe-handle-to-implement-the-dispose-pattern-for-a-base-class"></a><span data-ttu-id="d943c-184">Uso di un handle sicuro per implementare il modello Dispose per una classe di base</span><span class="sxs-lookup"><span data-stu-id="d943c-184">Using a safe handle to implement the dispose pattern for a base class</span></span>

<span data-ttu-id="d943c-185">L'esempio seguente illustra il modello Dispose per una classe di base, `DisposableStreamResource`, che usa handle sicuri per incapsulare le risorse non gestite.</span><span class="sxs-lookup"><span data-stu-id="d943c-185">The following example illustrates the dispose pattern for a base class, `DisposableStreamResource`, that uses a safe handle to encapsulate unmanaged resources.</span></span> <span data-ttu-id="d943c-186">Viene definita una classe `DisposableResource` che usa <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> per eseguire il wrapping di un oggetto <xref:System.IO.Stream> che rappresenta un file aperto.</span><span class="sxs-lookup"><span data-stu-id="d943c-186">It defines a `DisposableResource` class that uses a <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> to wrap a <xref:System.IO.Stream> object that represents an open file.</span></span> <span data-ttu-id="d943c-187">Il metodo `DisposableResource` include anche una singola proprietà, `Size`, che restituisce il numero totale di byte nel flusso di file.</span><span class="sxs-lookup"><span data-stu-id="d943c-187">The `DisposableResource` method also includes a single property, `Size`, that returns the total number of bytes in the file stream.</span></span>  
  
[!code-csharp[Conceptual.Disposable#9](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.disposable/cs/base1.cs#9)]
[!code-vb[Conceptual.Disposable#9](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.disposable/vb/base1.vb#9)]  
  
<a name="derived"></a>
## <a name="using-a-safe-handle-to-implement-the-dispose-pattern-for-a-derived-class"></a><span data-ttu-id="d943c-188">Utilizzo di un handle sicuro per implementare il modello Dispose per una classe derivata</span><span class="sxs-lookup"><span data-stu-id="d943c-188">Using a safe handle to implement the dispose pattern for a derived class</span></span>

<span data-ttu-id="d943c-189">Nell'esempio seguente viene illustrato il modello Dispose per una classe derivata, `DisposableStreamResource2`, che eredita dalla classe `DisposableStreamResource` presentata nell'esempio precedente.</span><span class="sxs-lookup"><span data-stu-id="d943c-189">The following example illustrates the dispose pattern for a derived class, `DisposableStreamResource2`, that inherits from the `DisposableStreamResource` class presented in the previous example.</span></span> <span data-ttu-id="d943c-190">La classe aggiunge un metodo aggiuntivo, `WriteFileInfo`, e usa un oggetto <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> per il wrapping dell'handle del file modificabile.</span><span class="sxs-lookup"><span data-stu-id="d943c-190">The class adds an additional method, `WriteFileInfo`, and uses a <xref:Microsoft.Win32.SafeHandles.SafeFileHandle> object to wrap the handle of the writable file.</span></span>  
  
[!code-csharp[Conceptual.Disposable#10](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.disposable/cs/derived1.cs#10)]
[!code-vb[Conceptual.Disposable#10](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.disposable/vb/derived1.vb#10)]  
  
## <a name="see-also"></a><span data-ttu-id="d943c-191">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="d943c-191">See also</span></span>

- <xref:System.GC.SuppressFinalize%2A>
- <xref:System.IDisposable>
- <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType>
- <xref:Microsoft.Win32.SafeHandles>
- <xref:System.Runtime.InteropServices.SafeHandle?displayProperty=nameWithType>
- <xref:System.Object.Finalize%2A?displayProperty=nameWithType>
- [<span data-ttu-id="d943c-192">Procedura: Definire e usare classi e struct (C++/CLI)</span><span class="sxs-lookup"><span data-stu-id="d943c-192">How to: Define and Consume Classes and Structs (C++/CLI)</span></span>](/cpp/dotnet/how-to-define-and-consume-classes-and-structs-cpp-cli)
- [<span data-ttu-id="d943c-193">Modello Dispose</span><span class="sxs-lookup"><span data-stu-id="d943c-193">Dispose Pattern</span></span>](implementing-dispose.md)
