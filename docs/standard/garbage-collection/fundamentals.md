---
title: Principi fondamentali di Garbage Collection
description: Informazioni su come funziona il Garbage Collector e su come può essere configurato per ottenere prestazioni ottimali.
ms.date: 11/15/2019
ms.technology: dotnet-standard
helpviewer_keywords:
- garbage collection, generations
- garbage collection, background
- garbage collection, concurrent
- garbage collection, server
- garbage collection, workstation
- garbage collection, managed heap
ms.assetid: 67c5a20d-1be1-4ea7-8a9a-92b0b08658d2
ms.openlocfilehash: ea8aef03d2f5837f35ecb31209e57853c0c8257b
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/15/2020
ms.locfileid: "79400540"
---
# <a name="fundamentals-of-garbage-collection"></a><span data-ttu-id="06241-103">Principi fondamentali di Garbage Collection</span><span class="sxs-lookup"><span data-stu-id="06241-103">Fundamentals of garbage collection</span></span>

<span data-ttu-id="06241-104">In Common Language Runtime (CLR), il Garbage Collector (GC) funge da gestore automatico della memoria.</span><span class="sxs-lookup"><span data-stu-id="06241-104">In the common language runtime (CLR), the garbage collector (GC) serves as an automatic memory manager.</span></span> <span data-ttu-id="06241-105">offrendo i seguenti vantaggi:</span><span class="sxs-lookup"><span data-stu-id="06241-105">It provides the following benefits:</span></span>

- <span data-ttu-id="06241-106">Consente di sviluppare l'applicazione senza dover liberare manualmente memoria.</span><span class="sxs-lookup"><span data-stu-id="06241-106">Enables you to develop your application without having to manually free memory.</span></span>

- <span data-ttu-id="06241-107">Alloca gli oggetti nell'heap gestito in maniera efficiente.</span><span class="sxs-lookup"><span data-stu-id="06241-107">Allocates objects on the managed heap efficiently.</span></span>

- <span data-ttu-id="06241-108">Recupera gli oggetti inutilizzati, ne cancella la memoria e tiene la memoria a disposizione per le future allocazioni.</span><span class="sxs-lookup"><span data-stu-id="06241-108">Reclaims objects that are no longer being used, clears their memory, and keeps the memory available for future allocations.</span></span> <span data-ttu-id="06241-109">Gli oggetti gestiti ottengono automaticamente contenuto pulito con il quale iniziare, pertanto i costruttori non devono inizializzare ogni campo dati.</span><span class="sxs-lookup"><span data-stu-id="06241-109">Managed objects automatically get clean content to start with, so their constructors do not have to initialize every data field.</span></span>

- <span data-ttu-id="06241-110">Garantisce protezione per la memoria assicurando che un oggetto non possa usare il contenuto di un altro oggetto.</span><span class="sxs-lookup"><span data-stu-id="06241-110">Provides memory safety by making sure that an object cannot use the content of another object.</span></span>

<span data-ttu-id="06241-111">In questo articolo vengono descritti i concetti di base della procedura di Garbage Collection.This article describes the core concepts of garbage collection.</span><span class="sxs-lookup"><span data-stu-id="06241-111">This article describes the core concepts of garbage collection.</span></span>

## <a name="fundamentals-of-memory"></a><span data-ttu-id="06241-112">Nozioni fondamentali sulla memoria</span><span class="sxs-lookup"><span data-stu-id="06241-112">Fundamentals of memory</span></span>

<span data-ttu-id="06241-113">Nell'elenco seguente sono riepilogati concetti importanti relativi alla memoria CLR.</span><span class="sxs-lookup"><span data-stu-id="06241-113">The following list summarizes important CLR memory concepts.</span></span>

- <span data-ttu-id="06241-114">Ogni processo dispone di un proprio spazio degli indirizzi virtuali distinto.</span><span class="sxs-lookup"><span data-stu-id="06241-114">Each process has its own, separate virtual address space.</span></span> <span data-ttu-id="06241-115">Tutti i processi nello stesso computer condividono la stessa memoria fisica e il file di paging, se presente.</span><span class="sxs-lookup"><span data-stu-id="06241-115">All processes on the same computer share the same physical memory and the page file, if there is one.</span></span>

- <span data-ttu-id="06241-116">Per impostazione predefinita, nei computer a 32 bit ogni processo dispone di uno spazio degli indirizzi virtuali in modalità utente da 2 GB.</span><span class="sxs-lookup"><span data-stu-id="06241-116">By default, on 32-bit computers, each process has a 2-GB user-mode virtual address space.</span></span>

- <span data-ttu-id="06241-117">Uno sviluppatore di applicazioni usa solo lo spazio degli indirizzi virtuali e non modifica mai direttamente la memoria fisica.</span><span class="sxs-lookup"><span data-stu-id="06241-117">As an application developer, you work only with virtual address space and never manipulate physical memory directly.</span></span> <span data-ttu-id="06241-118">Il Garbage Collector alloca e libera automaticamente la memoria virtuale nell'heap gestito.</span><span class="sxs-lookup"><span data-stu-id="06241-118">The garbage collector allocates and frees virtual memory for you on the managed heap.</span></span>

  <span data-ttu-id="06241-119">Se si scrive codice nativo, utilizzare le funzioni di Windows per lavorare con lo spazio di indirizzi virtuali.</span><span class="sxs-lookup"><span data-stu-id="06241-119">If you are writing native code, you use Windows functions to work with the virtual address space.</span></span> <span data-ttu-id="06241-120">Queste funzioni allocano e liberano automaticamente la memoria virtuale negli heap nativi.</span><span class="sxs-lookup"><span data-stu-id="06241-120">These functions allocate and free virtual memory for you on native heaps.</span></span>

- <span data-ttu-id="06241-121">La memoria virtuale può trovarsi in tre stati:</span><span class="sxs-lookup"><span data-stu-id="06241-121">Virtual memory can be in three states:</span></span>

  - <span data-ttu-id="06241-122">Libero.</span><span class="sxs-lookup"><span data-stu-id="06241-122">Free.</span></span> <span data-ttu-id="06241-123">Non vi sono riferimenti al blocco di memoria, che è disponibile per l'allocazione.</span><span class="sxs-lookup"><span data-stu-id="06241-123">The block of memory has no references to it and is available for allocation.</span></span>

  - <span data-ttu-id="06241-124">Riservato.</span><span class="sxs-lookup"><span data-stu-id="06241-124">Reserved.</span></span> <span data-ttu-id="06241-125">Il blocco di memoria è disponibile per l'utilizzo e non può essere usato da un'altra richiesta di allocazione.</span><span class="sxs-lookup"><span data-stu-id="06241-125">The block of memory is available for your use and cannot be used for any other allocation request.</span></span> <span data-ttu-id="06241-126">Non è tuttavia possibile archiviare i dati in questo blocco di memoria fino a quando non viene eseguito il commit.</span><span class="sxs-lookup"><span data-stu-id="06241-126">However, you cannot store data to this memory block until it is committed.</span></span>

  - <span data-ttu-id="06241-127">Eseguito.</span><span class="sxs-lookup"><span data-stu-id="06241-127">Committed.</span></span> <span data-ttu-id="06241-128">Il blocco di memoria è assegnato all'archiviazione fisica.</span><span class="sxs-lookup"><span data-stu-id="06241-128">The block of memory is assigned to physical storage.</span></span>

- <span data-ttu-id="06241-129">Lo spazio degli indirizzi virtuali può diventare frammentato.</span><span class="sxs-lookup"><span data-stu-id="06241-129">Virtual address space can get fragmented.</span></span> <span data-ttu-id="06241-130">Ciò significa che sono presenti blocchi liberi, noti anche come buchi, nello spazio degli indirizzi.</span><span class="sxs-lookup"><span data-stu-id="06241-130">This means that there are free blocks, also known as holes, in the address space.</span></span> <span data-ttu-id="06241-131">Quando viene richiesta un'allocazione della memoria virtuale, il gestore di memoria virtuale deve trovare un singolo blocco libero con dimensioni sufficienti per soddisfare la richiesta di allocazione.</span><span class="sxs-lookup"><span data-stu-id="06241-131">When a virtual memory allocation is requested, the virtual memory manager has to find a single free block that is large enough to satisfy that allocation request.</span></span> <span data-ttu-id="06241-132">Anche se si hanno 2 GB di spazio disponibile, l'allocazione che richiede 2 GB avrà esito negativo a meno che tutto lo spazio disponibile si trovi in un unico blocco di indirizzi.</span><span class="sxs-lookup"><span data-stu-id="06241-132">Even if you have 2 GB of free space, the allocation that requires 2 GB will be unsuccessful unless all of that free space is in a single address block.</span></span>

- <span data-ttu-id="06241-133">È possibile esaurire la memoria se lo spazio degli indirizzi virtuali non è sufficiente per riservare o spazio fisico di cui eseguire il commit.</span><span class="sxs-lookup"><span data-stu-id="06241-133">You can run out of memory if there isn't enough virtual address space to reserve or physical space to commit.</span></span>

  <span data-ttu-id="06241-134">Il file di paging viene utilizzato anche se la pressione della memoria fisica, ovvero la richiesta di memoria fisica, è bassa.</span><span class="sxs-lookup"><span data-stu-id="06241-134">The page file is used even if physical memory pressure (that is, demand for physical memory) is low.</span></span> <span data-ttu-id="06241-135">La prima volta che la pressione della memoria fisica è elevata, il sistema operativo deve lasciare spazio nella memoria fisica per archiviare i dati ed esegue il backup di alcuni dei dati che si trova nella memoria fisica nel file di paging.</span><span class="sxs-lookup"><span data-stu-id="06241-135">The first time physical memory pressure is high, the operating system must make room in physical memory to store data, and it backs up some of the data that is in physical memory to the page file.</span></span> <span data-ttu-id="06241-136">Tali dati non viene paginato fino a quando non è necessario, quindi è possibile incontrare il paging in situazioni in cui la pressione della memoria fisica è bassa.</span><span class="sxs-lookup"><span data-stu-id="06241-136">That data is not paged until it's needed, so it's possible to encounter paging in situations where the physical memory pressure is low.</span></span>

## <a name="conditions-for-a-garbage-collection"></a><span data-ttu-id="06241-137">Condizioni per un'operazione di Garbage Collection</span><span class="sxs-lookup"><span data-stu-id="06241-137">Conditions for a garbage collection</span></span>

<span data-ttu-id="06241-138">Le operazioni di Garbage Collection vengono eseguite in presenza di una delle seguenti condizioni:</span><span class="sxs-lookup"><span data-stu-id="06241-138">Garbage collection occurs when one of the following conditions is true:</span></span>

- <span data-ttu-id="06241-139">La memoria fisica del sistema è insufficiente.</span><span class="sxs-lookup"><span data-stu-id="06241-139">The system has low physical memory.</span></span> <span data-ttu-id="06241-140">Questo viene rilevato dalla notifica di memoria insufficiente dal sistema operativo o dalla memoria insufficiente come indicato dall'host.</span><span class="sxs-lookup"><span data-stu-id="06241-140">This is detected by either the low memory notification from the OS or low memory as indicated by the host.</span></span>

- <span data-ttu-id="06241-141">La memoria usata dagli oggetti allocati nell'heap gestito supera una soglia accettabile.</span><span class="sxs-lookup"><span data-stu-id="06241-141">The memory that is used by allocated objects on the managed heap surpasses an acceptable threshold.</span></span> <span data-ttu-id="06241-142">Questa soglia viene continuamente modificata durante l'esecuzione del processo.</span><span class="sxs-lookup"><span data-stu-id="06241-142">This threshold is continuously adjusted as the process runs.</span></span>

- <span data-ttu-id="06241-143">Viene chiamato il metodo <xref:System.GC.Collect%2A?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="06241-143">The <xref:System.GC.Collect%2A?displayProperty=nameWithType> method is called.</span></span> <span data-ttu-id="06241-144">Nella quasi totalità dei casi non è necessario chiamare questo metodo, in quanto il Garbage Collector viene eseguito senza interruzioni.</span><span class="sxs-lookup"><span data-stu-id="06241-144">In almost all cases, you do not have to call this method, because the garbage collector runs continuously.</span></span> <span data-ttu-id="06241-145">Il metodo viene usato principalmente in situazioni eccezionali e per scopi di test.</span><span class="sxs-lookup"><span data-stu-id="06241-145">This method is primarily used for unique situations and testing.</span></span>

## <a name="the-managed-heap"></a><span data-ttu-id="06241-146">Heap gestito</span><span class="sxs-lookup"><span data-stu-id="06241-146">The managed heap</span></span>

<span data-ttu-id="06241-147">Dopo essere stato inizializzato da CLR, il Garbage Collector alloca un segmento di memoria per archiviare e gestire oggetti.</span><span class="sxs-lookup"><span data-stu-id="06241-147">After the garbage collector is initialized by the CLR, it allocates a segment of memory to store and manage objects.</span></span> <span data-ttu-id="06241-148">Questa memoria è definita heap gestito, in contrapposizione a un heap nativo presente nel sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="06241-148">This memory is called the managed heap, as opposed to a native heap in the operating system.</span></span>

<span data-ttu-id="06241-149">Per ogni processo gestito esiste un heap gestito.</span><span class="sxs-lookup"><span data-stu-id="06241-149">There is a managed heap for each managed process.</span></span> <span data-ttu-id="06241-150">Tutti i thread nel processo allocano memoria per gli oggetti sullo stesso heap.</span><span class="sxs-lookup"><span data-stu-id="06241-150">All threads in the process allocate memory for objects on the same heap.</span></span>

<span data-ttu-id="06241-151">Per riservare memoria, il Garbage Collector chiama la funzione [VirtualAlloc](/windows/desktop/api/memoryapi/nf-memoryapi-virtualalloc) di Windows e riserva un segmento di memoria alla volta per le applicazioni gestite.</span><span class="sxs-lookup"><span data-stu-id="06241-151">To reserve memory, the garbage collector calls the Windows [VirtualAlloc](/windows/desktop/api/memoryapi/nf-memoryapi-virtualalloc) function and reserves one segment of memory at a time for managed applications.</span></span> <span data-ttu-id="06241-152">Il Garbage Collector riserva anche i segmenti, se necessario, e rilascia i segmenti al sistema operativo (dopo averli cancellati da qualsiasi oggetto) chiamando la funzione [VirtualFree](/windows/desktop/api/memoryapi/nf-memoryapi-virtualfree) di Windows.</span><span class="sxs-lookup"><span data-stu-id="06241-152">The garbage collector also reserves segments, as needed, and releases segments back to the operating system (after clearing them of any objects) by calling the Windows [VirtualFree](/windows/desktop/api/memoryapi/nf-memoryapi-virtualfree) function.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="06241-153">La dimensione dei segmenti allocati dal Garbage Collector è specifica dell'implementazione ed è soggetta a modifiche in qualsiasi momento, tra cui aggiornamenti periodici.</span><span class="sxs-lookup"><span data-stu-id="06241-153">The size of segments allocated by the garbage collector is implementation-specific and is subject to change at any time, including in periodic updates.</span></span> <span data-ttu-id="06241-154">L'applicazione non deve dare per scontata o dipendere da una particolare dimensione del segmento, né provare a configurare la quantità di memoria disponibile per le allocazioni di segmenti.</span><span class="sxs-lookup"><span data-stu-id="06241-154">Your app should never make assumptions about or depend on a particular segment size, nor should it attempt to configure the amount of memory available for segment allocations.</span></span>

<span data-ttu-id="06241-155">Minore è il numero di oggetti allocati nell'heap, minore sarà il lavoro del Garbage Collector.</span><span class="sxs-lookup"><span data-stu-id="06241-155">The fewer objects allocated on the heap, the less work the garbage collector has to do.</span></span> <span data-ttu-id="06241-156">Quando si allocano oggetti, non usare valori arrotondati per eccesso che superino le proprie esigenze, ad esempio non allocare una matrice di 32 byte se sono necessari solo 15 byte.</span><span class="sxs-lookup"><span data-stu-id="06241-156">When you allocate objects, do not use rounded-up values that exceed your needs, such as allocating an array of 32 bytes when you need only 15 bytes.</span></span>

<span data-ttu-id="06241-157">Quando viene attivata un'operazione di Garbage Collection, il Garbage Collector recupera la memoria occupata dagli oggetti inutilizzati.</span><span class="sxs-lookup"><span data-stu-id="06241-157">When a garbage collection is triggered, the garbage collector reclaims the memory that is occupied by dead objects.</span></span> <span data-ttu-id="06241-158">Durante il processo di recupero, gli oggetti attivi vengono compattati in modo da poter essere spostati insieme e lo spazio inutilizzato viene rimosso, riducendo le dimensioni dell'heap.</span><span class="sxs-lookup"><span data-stu-id="06241-158">The reclaiming process compacts live objects so that they are moved together, and the dead space is removed, thereby making the heap smaller.</span></span> <span data-ttu-id="06241-159">In questo modo si garantisce che gli oggetti allocati insieme restino uniti nell'heap gestito, preservandone la vicinanza.</span><span class="sxs-lookup"><span data-stu-id="06241-159">This ensures that objects that are allocated together stay together on the managed heap, to preserve their locality.</span></span>

<span data-ttu-id="06241-160">L'impatto (frequenza e durata) delle operazioni di Garbage Collection è il risultato del volume di allocazioni e della quantità di memoria esclusa nell'heap gestito.</span><span class="sxs-lookup"><span data-stu-id="06241-160">The intrusiveness (frequency and duration) of garbage collections is the result of the volume of allocations and the amount of survived memory on the managed heap.</span></span>

<span data-ttu-id="06241-161">L'heap può essere considerato l'insieme di due heap: l'[heap degli oggetti grandi](large-object-heap.md) e l'heap degli oggetti piccoli.</span><span class="sxs-lookup"><span data-stu-id="06241-161">The heap can be considered as the accumulation of two heaps: the [large object heap](large-object-heap.md) and the small object heap.</span></span>

<span data-ttu-id="06241-162">L'[heap degli oggetti grandi](large-object-heap.md) contiene oggetti molto grandi di dimensioni pari o superiori a 85.000 byte.</span><span class="sxs-lookup"><span data-stu-id="06241-162">The [large object heap](large-object-heap.md) contains very large objects that are 85,000 bytes and larger.</span></span> <span data-ttu-id="06241-163">Gli oggetti sull'heap oggetti grandi sono in genere matrici.</span><span class="sxs-lookup"><span data-stu-id="06241-163">The objects on the large object heap are usually arrays.</span></span> <span data-ttu-id="06241-164">È raro che un oggetto istanza sia particolarmente grande.</span><span class="sxs-lookup"><span data-stu-id="06241-164">It is rare for an instance object to be extremely large.</span></span>

> [!TIP]
> <span data-ttu-id="06241-165">È possibile [configurare la dimensione di soglia](../../core/run-time-config/garbage-collector.md#large-object-heap-threshold) per gli oggetti da utilizzare nell'heap oggetti grandi.</span><span class="sxs-lookup"><span data-stu-id="06241-165">You can [configure the threshold size](../../core/run-time-config/garbage-collector.md#large-object-heap-threshold) for objects to go on the large object heap.</span></span>

## <a name="generations"></a><span data-ttu-id="06241-166">Generazioni</span><span class="sxs-lookup"><span data-stu-id="06241-166">Generations</span></span>

<span data-ttu-id="06241-167">L'heap è organizzato in generazioni, così da poter gestire oggetti di lunga durata e di breve durata.</span><span class="sxs-lookup"><span data-stu-id="06241-167">The heap is organized into generations so it can handle long-lived and short-lived objects.</span></span> <span data-ttu-id="06241-168">Durante un'operazione di Garbage Collection vengono recuperati per primi gli oggetti di breve durata, che in genere occupano solo una piccola parte dell'heap.</span><span class="sxs-lookup"><span data-stu-id="06241-168">Garbage collection primarily occurs with the reclamation of short-lived objects that typically occupy only a small part of the heap.</span></span> <span data-ttu-id="06241-169">Esistono tre generazioni di oggetti nell'heap:</span><span class="sxs-lookup"><span data-stu-id="06241-169">There are three generations of objects on the heap:</span></span>

- <span data-ttu-id="06241-170">**Generazione 0**.</span><span class="sxs-lookup"><span data-stu-id="06241-170">**Generation 0**.</span></span> <span data-ttu-id="06241-171">È la generazione più recente e contiene oggetti di breve durata.</span><span class="sxs-lookup"><span data-stu-id="06241-171">This is the youngest generation and contains short-lived objects.</span></span> <span data-ttu-id="06241-172">Un esempio di oggetto di breve durata è una variabile temporanea.</span><span class="sxs-lookup"><span data-stu-id="06241-172">An example of a short-lived object is a temporary variable.</span></span> <span data-ttu-id="06241-173">Le operazioni di Garbage Collection vengono eseguite il più delle volte in questa generazione.</span><span class="sxs-lookup"><span data-stu-id="06241-173">Garbage collection occurs most frequently in this generation.</span></span>

  <span data-ttu-id="06241-174">Gli oggetti appena allocati formano una nuova generazione di oggetti e sono implicitamente raccolte di generazione 0.</span><span class="sxs-lookup"><span data-stu-id="06241-174">Newly allocated objects form a new generation of objects and are implicitly generation 0 collections.</span></span> <span data-ttu-id="06241-175">Tuttavia, se sono oggetti di grandi dimensioni, vengono attivati nell'heap oggetti grandi in una raccolta di generazione 2.However, if they are large objects, they go on the large object heap in a generation 2 collection.</span><span class="sxs-lookup"><span data-stu-id="06241-175">However, if they are large objects, they go on the large object heap in a generation 2 collection.</span></span>

  <span data-ttu-id="06241-176">Gran parte degli oggetti vengono recuperati tramite Garbage Collection nella generazione 0 e non passano alla generazione successiva.</span><span class="sxs-lookup"><span data-stu-id="06241-176">Most objects are reclaimed for garbage collection in generation 0 and do not survive to the next generation.</span></span>

- <span data-ttu-id="06241-177">**Generazione 1**.</span><span class="sxs-lookup"><span data-stu-id="06241-177">**Generation 1**.</span></span> <span data-ttu-id="06241-178">Questa generazione contiene oggetti di breve durata e funge da buffer tra gli oggetti di breve durata e gli oggetti di lunga durata.</span><span class="sxs-lookup"><span data-stu-id="06241-178">This generation contains short-lived objects and serves as a buffer between short-lived objects and long-lived objects.</span></span>

- <span data-ttu-id="06241-179">**Generazione 2**.</span><span class="sxs-lookup"><span data-stu-id="06241-179">**Generation 2**.</span></span> <span data-ttu-id="06241-180">Questa generazione contiene oggetti di lunga durata.</span><span class="sxs-lookup"><span data-stu-id="06241-180">This generation contains long-lived objects.</span></span> <span data-ttu-id="06241-181">Un esempio di oggetto di lunga durata è un oggetto in un'applicazione server che contiene dati statici attivi per la durata del processo.</span><span class="sxs-lookup"><span data-stu-id="06241-181">An example of a long-lived object is an object in a server application that contains static data that's live for the duration of the process.</span></span>

<span data-ttu-id="06241-182">Le operazioni di Garbage Collection vengono eseguite in generazioni specifiche a seconda delle condizioni.</span><span class="sxs-lookup"><span data-stu-id="06241-182">Garbage collections occur on specific generations as conditions warrant.</span></span> <span data-ttu-id="06241-183">Raccogliere una generazione significa raccogliere gli oggetti in quella generazione e in tutte le generazioni più recenti.</span><span class="sxs-lookup"><span data-stu-id="06241-183">Collecting a generation means collecting objects in that generation and all its younger generations.</span></span> <span data-ttu-id="06241-184">Un'operazione di Garbage Collection di generazione 2 viene definita completa, in quanto recupera tutti gli oggetti in tutte le generazioni, vale a dire tutti gli oggetti nell'heap gestito.</span><span class="sxs-lookup"><span data-stu-id="06241-184">A generation 2 garbage collection is also known as a full garbage collection, because it reclaims all objects in all generations (that is, all objects in the managed heap).</span></span>

### <a name="survival-and-promotions"></a><span data-ttu-id="06241-185">Esclusione e promozioni</span><span class="sxs-lookup"><span data-stu-id="06241-185">Survival and promotions</span></span>

<span data-ttu-id="06241-186">Gli oggetti che non vengono recuperati in un'operazione di Garbage Collection sono noti come sopravvissuti e vengono promossi alla generazione successiva.</span><span class="sxs-lookup"><span data-stu-id="06241-186">Objects that are not reclaimed in a garbage collection are known as survivors and are promoted to the next generation.</span></span> <span data-ttu-id="06241-187">Gli oggetti esclusi da un'operazione di Garbage Collection di generazione 0 vengono promossi alla generazione 1; gli oggetti esclusi da un'operazione di Garbage Collection di generazione 1 vengono promossi alla generazione 2; gli oggetti esclusi da un'operazione di Garbage Collection di generazione 2 restano nella generazione 2.</span><span class="sxs-lookup"><span data-stu-id="06241-187">Objects that survive a generation 0 garbage collection are promoted to generation 1; objects that survive a generation 1 garbage collection are promoted to generation 2; and objects that survive a generation 2 garbage collection remain in generation 2.</span></span>

<span data-ttu-id="06241-188">Quando il Garbage Collector rileva che il tasso di sopravvivenza è elevato in una generazione, aumenta la soglia delle allocazioni per tale generazione.</span><span class="sxs-lookup"><span data-stu-id="06241-188">When the garbage collector detects that the survival rate is high in a generation, it increases the threshold of allocations for that generation.</span></span> <span data-ttu-id="06241-189">La raccolta successiva ottiene una dimensione sostanziale della memoria recuperata.</span><span class="sxs-lookup"><span data-stu-id="06241-189">The next collection gets a substantial size of reclaimed memory.</span></span> <span data-ttu-id="06241-190">CLR bilancia continuamente due priorità: non lasciare che il working set di un'applicazione sia troppo grande ritardando l'operazione di Garbage Collection e non lasciando che l'operazione di Garbage Collection venga eseguita troppo frequentemente.</span><span class="sxs-lookup"><span data-stu-id="06241-190">The CLR continually balances two priorities: not letting an application's working set get too large by delaying garbage collection and not letting the garbage collection run too frequently.</span></span>

### <a name="ephemeral-generations-and-segments"></a><span data-ttu-id="06241-191">Generazioni e segmenti temporanei</span><span class="sxs-lookup"><span data-stu-id="06241-191">Ephemeral generations and segments</span></span>

<span data-ttu-id="06241-192">Poiché gli oggetti nelle generazioni 0 e 1 sono di breve durata, queste vengono definite generazioni temporanee.</span><span class="sxs-lookup"><span data-stu-id="06241-192">Because objects in generations 0 and 1 are short-lived, these generations are known as the ephemeral generations.</span></span>

<span data-ttu-id="06241-193">Le generazioni temporanee devono essere allocate nel segmento di memoria noto come segmento temporaneo.</span><span class="sxs-lookup"><span data-stu-id="06241-193">Ephemeral generations must be allocated in the memory segment that is known as the ephemeral segment.</span></span> <span data-ttu-id="06241-194">Ogni nuovo segmento acquisito dal Garbage Collector diventa il nuovo segmento temporaneo e contiene gli oggetti esclusi da un'operazione di Garbage Collection di generazione 0.</span><span class="sxs-lookup"><span data-stu-id="06241-194">Each new segment acquired by the garbage collector becomes the new ephemeral segment and contains the objects that survived a generation 0 garbage collection.</span></span> <span data-ttu-id="06241-195">Il segmento temporaneo precedente diventa il nuovo segmento di generazione 2.</span><span class="sxs-lookup"><span data-stu-id="06241-195">The old ephemeral segment becomes the new generation 2 segment.</span></span>

<span data-ttu-id="06241-196">La dimensione del segmento temporaneo varia a seconda che un sistema sia a 32 bit o a 64 bit e dal tipo di Garbage Collector in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="06241-196">The size of the ephemeral segment varies depending on whether a system is 32-bit or 64-bit, and on the type of garbage collector it is running.</span></span> <span data-ttu-id="06241-197">Nella tabella che segue sono riportati i valori predefiniti.</span><span class="sxs-lookup"><span data-stu-id="06241-197">Default values are shown in the following table.</span></span>

||<span data-ttu-id="06241-198">32 bit</span><span class="sxs-lookup"><span data-stu-id="06241-198">32-bit</span></span>|<span data-ttu-id="06241-199">64 bit</span><span class="sxs-lookup"><span data-stu-id="06241-199">64-bit</span></span>|
|-|-------------|-------------|
|<span data-ttu-id="06241-200">GC workstation</span><span class="sxs-lookup"><span data-stu-id="06241-200">Workstation GC</span></span>|<span data-ttu-id="06241-201">16 MB</span><span class="sxs-lookup"><span data-stu-id="06241-201">16 MB</span></span>|<span data-ttu-id="06241-202">256 MB</span><span class="sxs-lookup"><span data-stu-id="06241-202">256 MB</span></span>|
|<span data-ttu-id="06241-203">GC server</span><span class="sxs-lookup"><span data-stu-id="06241-203">Server GC</span></span>|<span data-ttu-id="06241-204">64 MB</span><span class="sxs-lookup"><span data-stu-id="06241-204">64 MB</span></span>|<span data-ttu-id="06241-205">4 GB</span><span class="sxs-lookup"><span data-stu-id="06241-205">4 GB</span></span>|
|<span data-ttu-id="06241-206">GC server con > 4 CPU logiche</span><span class="sxs-lookup"><span data-stu-id="06241-206">Server GC with > 4 logical CPUs</span></span>|<span data-ttu-id="06241-207">32 MB</span><span class="sxs-lookup"><span data-stu-id="06241-207">32 MB</span></span>|<span data-ttu-id="06241-208">2 GB</span><span class="sxs-lookup"><span data-stu-id="06241-208">2 GB</span></span>|
|<span data-ttu-id="06241-209">GC server con > 8 CPU logiche</span><span class="sxs-lookup"><span data-stu-id="06241-209">Server GC with > 8 logical CPUs</span></span>|<span data-ttu-id="06241-210">16 MB</span><span class="sxs-lookup"><span data-stu-id="06241-210">16 MB</span></span>|<span data-ttu-id="06241-211">1 GB</span><span class="sxs-lookup"><span data-stu-id="06241-211">1 GB</span></span>|

<span data-ttu-id="06241-212">Il segmento temporaneo può includere oggetti di generazione 2,</span><span class="sxs-lookup"><span data-stu-id="06241-212">The ephemeral segment can include generation 2 objects.</span></span> <span data-ttu-id="06241-213">i quali possono usare più segmenti (nella misura richiesta dal processo e consentita dalla memoria).</span><span class="sxs-lookup"><span data-stu-id="06241-213">Generation 2 objects can use multiple segments (as many as your process requires and memory allows for).</span></span>

<span data-ttu-id="06241-214">La quantità di memoria liberata da un'operazione di Garbage Collection temporanea è limitata alla dimensione del segmento temporaneo.</span><span class="sxs-lookup"><span data-stu-id="06241-214">The amount of freed memory from an ephemeral garbage collection is limited to the size of the ephemeral segment.</span></span> <span data-ttu-id="06241-215">Tale quantità di memoria è proporzionale allo spazio occupato dagli oggetti inutilizzati.</span><span class="sxs-lookup"><span data-stu-id="06241-215">The amount of memory that is freed is proportional to the space that was occupied by the dead objects.</span></span>

## <a name="what-happens-during-a-garbage-collection"></a><span data-ttu-id="06241-216">Fasi di un'operazione di Garbage Collection</span><span class="sxs-lookup"><span data-stu-id="06241-216">What happens during a garbage collection</span></span>

<span data-ttu-id="06241-217">Un'operazione di Garbage Collection si compone delle seguenti fasi:</span><span class="sxs-lookup"><span data-stu-id="06241-217">A garbage collection has the following phases:</span></span>

- <span data-ttu-id="06241-218">Una fase di contrassegno in cui vengono individuati tutti gli oggetti attivi e ne viene creato un elenco.</span><span class="sxs-lookup"><span data-stu-id="06241-218">A marking phase that finds and creates a list of all live objects.</span></span>

- <span data-ttu-id="06241-219">Una fase di rilocazione in cui vengono aggiornati i riferimenti agli oggetti che saranno compattati.</span><span class="sxs-lookup"><span data-stu-id="06241-219">A relocating phase that updates the references to the objects that will be compacted.</span></span>

- <span data-ttu-id="06241-220">Una fase di compattazione in cui lo spazio occupato dagli oggetti inutilizzati viene recuperato e gli oggetti esclusi compattati.</span><span class="sxs-lookup"><span data-stu-id="06241-220">A compacting phase that reclaims the space occupied by the dead objects and compacts the surviving objects.</span></span> <span data-ttu-id="06241-221">Durante questa fase, gli oggetti rimasti dopo un'operazione di Garbage Collection vengono spostati verso l'estremità meno recente del segmento.</span><span class="sxs-lookup"><span data-stu-id="06241-221">The compacting phase moves objects that have survived a garbage collection toward the older end of the segment.</span></span>

  <span data-ttu-id="06241-222">Poiché le raccolte di generazione 2 possono occupare più segmenti, gli oggetti promossi alla generazione 2 possono essere spostati in un segmento meno recente.</span><span class="sxs-lookup"><span data-stu-id="06241-222">Because generation 2 collections can occupy multiple segments, objects that are promoted into generation 2 can be moved into an older segment.</span></span> <span data-ttu-id="06241-223">Gli oggetti esclusi di generazione 1 e 2 possono essere spostati in un segmento diverso, in quanto vengono promossi alla generazione 2.</span><span class="sxs-lookup"><span data-stu-id="06241-223">Both generation 1 and generation 2 survivors can be moved to a different segment, because they are promoted to generation 2.</span></span>

  <span data-ttu-id="06241-224">In genere, l'heap oggetti grandi (LOH) non viene compattato, perché la copia di oggetti di grandi dimensioni comporta una riduzione delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="06241-224">Ordinarily, the large object heap (LOH) is not compacted, because copying large objects imposes a performance penalty.</span></span> <span data-ttu-id="06241-225">Tuttavia, in .NET Core e in.NET Framework 4.5.1 e versioni successive, è possibile utilizzare la <xref:System.Runtime.GCSettings.LargeObjectHeapCompactionMode%2A?displayProperty=nameWithType> proprietà per compattare l'heap oggetti grandi su richiesta.</span><span class="sxs-lookup"><span data-stu-id="06241-225">However, in .NET Core and in .NET Framework 4.5.1 and later, you can use the <xref:System.Runtime.GCSettings.LargeObjectHeapCompactionMode%2A?displayProperty=nameWithType> property to compact the large object heap on demand.</span></span> <span data-ttu-id="06241-226">Inoltre, il LOH viene compattato automaticamente quando viene impostato un limite rigido specificando:</span><span class="sxs-lookup"><span data-stu-id="06241-226">In addition, the LOH is automatically compacted when a hard limit is set by specifying either:</span></span>

  - <span data-ttu-id="06241-227">un limite di memoria su un contenitore, o</span><span class="sxs-lookup"><span data-stu-id="06241-227">a memory limit on a container, or</span></span>
  - <span data-ttu-id="06241-228">Le opzioni di configurazione di runtime [GCHeapHardLimit](../../core/run-time-config/garbage-collector.md#systemgcheaphardlimitcomplus_gcheaphardlimit) o [GCHeapHardLimitPercent](../../core/run-time-config/garbage-collector.md#systemgcheaphardlimitpercentcomplus_gcheaphardlimitpercent)</span><span class="sxs-lookup"><span data-stu-id="06241-228">the [GCHeapHardLimit](../../core/run-time-config/garbage-collector.md#systemgcheaphardlimitcomplus_gcheaphardlimit) or [GCHeapHardLimitPercent](../../core/run-time-config/garbage-collector.md#systemgcheaphardlimitpercentcomplus_gcheaphardlimitpercent) run-time configuration options</span></span>

<span data-ttu-id="06241-229">Per stabilire se gli oggetti sono attivi, il Garbage Collector usa le seguenti informazioni:</span><span class="sxs-lookup"><span data-stu-id="06241-229">The garbage collector uses the following information to determine whether objects are live:</span></span>

- <span data-ttu-id="06241-230">**Radici dello stack**.</span><span class="sxs-lookup"><span data-stu-id="06241-230">**Stack roots**.</span></span> <span data-ttu-id="06241-231">Variabili dello stack fornite dal compilatore JIT e dal percorso di chiamate nello stack.</span><span class="sxs-lookup"><span data-stu-id="06241-231">Stack variables provided by the just-in-time (JIT) compiler and stack walker.</span></span> <span data-ttu-id="06241-232">Le ottimizzazioni JIT possono allungare o accorciare le aree del codice all'interno delle quali le variabili dello stack vengono segnalate al Garbage Collector.</span><span class="sxs-lookup"><span data-stu-id="06241-232">JIT optimizations can lengthen or shorten regions of code within which stack variables are reported to the garbage collector.</span></span>

- <span data-ttu-id="06241-233">**Maniglie di Garbage Collection**.</span><span class="sxs-lookup"><span data-stu-id="06241-233">**Garbage collection handles**.</span></span> <span data-ttu-id="06241-234">Handle che puntano agli oggetti gestiti e che possono essere allocati mediante codice utente o Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="06241-234">Handles that point to managed objects and that can be allocated by user code or by the common language runtime.</span></span>

- <span data-ttu-id="06241-235">**Dati statici**.</span><span class="sxs-lookup"><span data-stu-id="06241-235">**Static data**.</span></span> <span data-ttu-id="06241-236">Oggetti statici nei domini applicazione che possono fare riferimento ad altri oggetti.</span><span class="sxs-lookup"><span data-stu-id="06241-236">Static objects in application domains that could be referencing other objects.</span></span> <span data-ttu-id="06241-237">Ogni dominio applicazione tiene traccia dei rispettivi oggetti statici.</span><span class="sxs-lookup"><span data-stu-id="06241-237">Each application domain keeps track of its static objects.</span></span>

<span data-ttu-id="06241-238">Prima di eseguire un'operazione di Garbage Collection, tutti i thread gestiti vengono sospesi, eccetto il thread che attiva l'operazione.</span><span class="sxs-lookup"><span data-stu-id="06241-238">Before a garbage collection starts, all managed threads are suspended except for the thread that triggered the garbage collection.</span></span>

<span data-ttu-id="06241-239">Nell'illustrazione seguente viene illustrato un thread che attiva un'operazione di Garbage Collection causando la sospensione degli altri thread.</span><span class="sxs-lookup"><span data-stu-id="06241-239">The following illustration shows a thread that triggers a garbage collection and causes the other threads to be suspended.</span></span>

![Thread che attiva un'operazione di Garbage Collection](./media/gc-triggered.png)

## <a name="manipulate-unmanaged-resources"></a><span data-ttu-id="06241-241">Manipolare le risorse non gestite</span><span class="sxs-lookup"><span data-stu-id="06241-241">Manipulate unmanaged resources</span></span>

<span data-ttu-id="06241-242">Se gli oggetti gestiti fanno riferimento a oggetti non gestiti utilizzando i relativi handle di file nativi, è necessario liberare in modo esplicito gli oggetti non gestiti, poiché il Garbage Collector tiene traccia solo della memoria nell'heap gestito.</span><span class="sxs-lookup"><span data-stu-id="06241-242">If managed objects reference unmanaged objects by using their native file handles, you have to explicitly free the unmanaged objects, because the garbage collector only tracks memory on the managed heap.</span></span>

<span data-ttu-id="06241-243">Gli utenti dell'oggetto gestito non possono eliminare le risorse native utilizzate dall'oggetto.</span><span class="sxs-lookup"><span data-stu-id="06241-243">Users of the managed object may not dispose the native resources used by the object.</span></span> <span data-ttu-id="06241-244">Per eseguire la pulizia, è possibile rendere finalizzabile l'oggetto gestito.</span><span class="sxs-lookup"><span data-stu-id="06241-244">To perform the cleanup, you can make the managed object finalizable.</span></span> <span data-ttu-id="06241-245">La finalizzazione è costituita da azioni di pulitura che vengono eseguite quando l'oggetto non è più in uso.</span><span class="sxs-lookup"><span data-stu-id="06241-245">Finalization consists of cleanup actions that execute when the object is no longer in use.</span></span> <span data-ttu-id="06241-246">Quando l'oggetto gestito muore, esegue le azioni di pulizia specificate nel relativo metodo finalizzatore.</span><span class="sxs-lookup"><span data-stu-id="06241-246">When the managed object dies, it performs cleanup actions that are specified in its finalizer method.</span></span>

<span data-ttu-id="06241-247">Quando viene individuato un oggetto finalizzabile inutilizzato, il relativo finalizzatore viene inserito in una coda in modo che vengano eseguite le azioni di pulizia, mentre l'oggetto stesso viene promosso alla generazione successiva.</span><span class="sxs-lookup"><span data-stu-id="06241-247">When a finalizable object is discovered to be dead, its finalizer is put in a queue so that its cleanup actions are executed, but the object itself is promoted to the next generation.</span></span> <span data-ttu-id="06241-248">Sarà pertanto necessario attendere l'operazione di Garbage Collection successiva eseguita in tale generazione, che non sarà necessariamente l'operazione immediatamente successiva, per stabilire se l'oggetto è stato recuperato.</span><span class="sxs-lookup"><span data-stu-id="06241-248">Therefore, you have to wait until the next garbage collection that occurs on that generation (which is not necessarily the next garbage collection) to determine whether the object has been reclaimed.</span></span>

<span data-ttu-id="06241-249">Per ulteriori informazioni sulla <xref:System.Object.Finalize?displayProperty=nameWithType>finalizzazione, vedere .</span><span class="sxs-lookup"><span data-stu-id="06241-249">For more information about finalization, see <xref:System.Object.Finalize?displayProperty=nameWithType>.</span></span>

## <a name="workstation-and-server-garbage-collection"></a><span data-ttu-id="06241-250">Operazione di Garbage Collection per workstation e server</span><span class="sxs-lookup"><span data-stu-id="06241-250">Workstation and server garbage collection</span></span>

<span data-ttu-id="06241-251">Il Garbage Collector si regola da sé e può funzionare in un'ampia varietà di scenari.</span><span class="sxs-lookup"><span data-stu-id="06241-251">The garbage collector is self-tuning and can work in a wide variety of scenarios.</span></span> <span data-ttu-id="06241-252">È possibile utilizzare [un'impostazione](../../core/run-time-config/garbage-collector.md#flavors-of-garbage-collection) del file di configurazione per impostare il tipo di Garbage Collection in base alle caratteristiche del carico di lavoro.</span><span class="sxs-lookup"><span data-stu-id="06241-252">You can use a [configuration file setting](../../core/run-time-config/garbage-collector.md#flavors-of-garbage-collection) to set the type of garbage collection based on the characteristics of the workload.</span></span> <span data-ttu-id="06241-253">CLR fornisce i seguenti tipi di Garbage Collection:</span><span class="sxs-lookup"><span data-stu-id="06241-253">The CLR provides the following types of garbage collection:</span></span>

- <span data-ttu-id="06241-254">La raccolta di rifiuti per workstation (GC) è progettata per le app client.</span><span class="sxs-lookup"><span data-stu-id="06241-254">Workstation garbage collection (GC) is designed for client apps.</span></span> <span data-ttu-id="06241-255">È la versione GC predefinita per le app autonome.</span><span class="sxs-lookup"><span data-stu-id="06241-255">It is the default GC flavor for standalone apps.</span></span> <span data-ttu-id="06241-256">Per le app ospitate, ad esempio quelle ospitate da ASP.NET, l'host determina la versione GC predefinita.</span><span class="sxs-lookup"><span data-stu-id="06241-256">For hosted apps, for example, those hosted by ASP.NET, the host determines the default GC flavor.</span></span>

  <span data-ttu-id="06241-257">Le operazioni di Garbage Collection per workstation possono essere eseguite in modalità simultanea o non simultanea.</span><span class="sxs-lookup"><span data-stu-id="06241-257">Workstation garbage collection can be concurrent or non-concurrent.</span></span> <span data-ttu-id="06241-258">La modalità simultanea consente ai thread gestiti di continuare le operazioni durante un'operazione di Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="06241-258">Concurrent garbage collection enables managed threads to continue operations during a garbage collection.</span></span> <span data-ttu-id="06241-259">[L'operazione di Garbage Collection](#background-workstation-garbage-collection) in background sostituisce la [garbage collection simultanea](#concurrent-garbage-collection) in .NET Framework 4 e versioni successive.</span><span class="sxs-lookup"><span data-stu-id="06241-259">[Background garbage collection](#background-workstation-garbage-collection) replaces [concurrent garbage collection](#concurrent-garbage-collection) in .NET Framework 4 and later versions.</span></span>

- <span data-ttu-id="06241-260">Garbage Collection per server, per le applicazioni server che richiedono scalabilità e velocità effettiva elevata.</span><span class="sxs-lookup"><span data-stu-id="06241-260">Server garbage collection, which is intended for server applications that need high throughput and scalability.</span></span>

  - <span data-ttu-id="06241-261">In .NET Core la procedura di Garbage Collection per server può essere non simultanea o in background.</span><span class="sxs-lookup"><span data-stu-id="06241-261">In .NET Core, server garbage collection can be non-concurrent or background.</span></span>

  - <span data-ttu-id="06241-262">In .NET Framework 4.5.NET Framework 4.5 e versioni successive, l'operazione di Garbage Collection per server può essere non simultanea o in background (l'operazione di Garbage Collection in background sostituisce l'operazione di Garbage Collection simultanea).</span><span class="sxs-lookup"><span data-stu-id="06241-262">In .NET Framework 4.5 and later versions, server garbage collection can be non-concurrent or background (background garbage collection replaces concurrent garbage collection).</span></span> <span data-ttu-id="06241-263">In .NET Framework 4 e versioni precedenti, la procedura di Garbage Collection per server non è simultanea.</span><span class="sxs-lookup"><span data-stu-id="06241-263">In .NET Framework 4 and previous versions, server garbage collection is non-concurrent.</span></span>

<span data-ttu-id="06241-264">Nella figura seguente vengono illustrati i thread dedicati che eseguono l'operazione di Garbage Collection in un server:The following illustration shows the dedicated threads that perform the garbage collection on a server:</span><span class="sxs-lookup"><span data-stu-id="06241-264">The following illustration shows the dedicated threads that perform the garbage collection on a server:</span></span>

![Thread di Garbage Collection server](./media/gc-server.png)

### <a name="compare-workstation-and-server-garbage-collection"></a><span data-ttu-id="06241-266">Confrontare le operazioni di Garbage Collection per workstation e server</span><span class="sxs-lookup"><span data-stu-id="06241-266">Compare workstation and server garbage collection</span></span>

<span data-ttu-id="06241-267">Di seguito sono riportate alcune considerazioni su threading e prestazioni per l'operazione di Garbage Collection per workstation:</span><span class="sxs-lookup"><span data-stu-id="06241-267">The following are threading and performance considerations for workstation garbage collection:</span></span>

- <span data-ttu-id="06241-268">La raccolta viene eseguita nel thread dell'utente che ha attivato l'operazione di Garbage Collection e mantiene la stessa priorità.</span><span class="sxs-lookup"><span data-stu-id="06241-268">The collection occurs on the user thread that triggered the garbage collection and remains at the same priority.</span></span> <span data-ttu-id="06241-269">Poiché i thread dell'utente vengono in genere eseguiti con priorità normale, il Garbage Collector (eseguito in un thread con priorità normale) deve competere con altri thread per il tempo CPU.</span><span class="sxs-lookup"><span data-stu-id="06241-269">Because user threads typically run at normal priority, the garbage collector (which runs on a normal priority thread) must compete with other threads for CPU time.</span></span> <span data-ttu-id="06241-270">I thread che eseguono codice nativo non vengono sospesi in caso di Garbage Collection per server o workstation.</span><span class="sxs-lookup"><span data-stu-id="06241-270">(Threads that run native code are not suspended on either server or workstation garbage collection.)</span></span>

- <span data-ttu-id="06241-271">La procedura di Garbage Collection per workstation viene sempre utilizzata in un computer che dispone di un solo processore, indipendentemente [dall'impostazione](../../core/run-time-config/garbage-collector.md#systemgcservercomplus_gcserver)di configurazione.</span><span class="sxs-lookup"><span data-stu-id="06241-271">Workstation garbage collection is always used on a computer that has only one processor, regardless of the [configuration setting](../../core/run-time-config/garbage-collector.md#systemgcservercomplus_gcserver).</span></span>

<span data-ttu-id="06241-272">Di seguito sono riportate alcune considerazioni su threading e prestazioni per l'operazione di Garbage Collection per server:</span><span class="sxs-lookup"><span data-stu-id="06241-272">The following are threading and performance considerations for server garbage collection:</span></span>

- <span data-ttu-id="06241-273">La raccolta viene eseguita in più thread dedicati eseguiti con livello di priorità `THREAD_PRIORITY_HIGHEST` .</span><span class="sxs-lookup"><span data-stu-id="06241-273">The collection occurs on multiple dedicated threads that are running at `THREAD_PRIORITY_HIGHEST` priority level.</span></span>

- <span data-ttu-id="06241-274">Per ogni CPU vengono forniti un heap e un thread dedicato per l'esecuzione dell'operazione di Garbage Collection. Gli heap vengono raccolti contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="06241-274">A heap and a dedicated thread to perform garbage collection are provided for each CPU, and the heaps are collected at the same time.</span></span> <span data-ttu-id="06241-275">Ogni heap contiene un heap degli oggetti piccoli e un heap degli oggetti grandi; è possibile accedere a tutti gli heap tramite codice utente.</span><span class="sxs-lookup"><span data-stu-id="06241-275">Each heap contains a small object heap and a large object heap, and all heaps can be accessed by user code.</span></span> <span data-ttu-id="06241-276">Gli oggetti contenuti in heap diversi possono fare riferimento l'un l'altro.</span><span class="sxs-lookup"><span data-stu-id="06241-276">Objects on different heaps can refer to each other.</span></span>

- <span data-ttu-id="06241-277">Grazie all'utilizzo congiunto di più thread di Garbage Collection, le operazioni di Garbage Collection per server saranno più veloci delle operazioni per workstation in un heap di pari dimensioni.</span><span class="sxs-lookup"><span data-stu-id="06241-277">Because multiple garbage collection threads work together, server garbage collection is faster than workstation garbage collection on the same size heap.</span></span>

- <span data-ttu-id="06241-278">I segmenti di Garbage Collection per server sono spesso di dimensioni maggiori.</span><span class="sxs-lookup"><span data-stu-id="06241-278">Server garbage collection often has larger size segments.</span></span> <span data-ttu-id="06241-279">Tuttavia, questa è solo una generalizzazione: la dimensione del segmento è specifica dell'implementazione ed è soggetta a modifiche.</span><span class="sxs-lookup"><span data-stu-id="06241-279">However, this is only a generalization: segment size is implementation-specific and is subject to change.</span></span> <span data-ttu-id="06241-280">Non fare supposizioni sulle dimensioni dei segmenti allocati dal Garbage Collector durante l'ottimizzazione dell'app.</span><span class="sxs-lookup"><span data-stu-id="06241-280">Don't make assumptions about the size of segments allocated by the garbage collector when tuning your app.</span></span>

- <span data-ttu-id="06241-281">Le operazioni di Garbage Collection per server possono richiedere un utilizzo di risorse elevato.</span><span class="sxs-lookup"><span data-stu-id="06241-281">Server garbage collection can be resource-intensive.</span></span> <span data-ttu-id="06241-282">Si supponga, ad esempio, che siano presenti 12 processi che utilizzano il catalogo globale del server in esecuzione in un computer con 4 processori.</span><span class="sxs-lookup"><span data-stu-id="06241-282">For example, imagine that there are 12 processes that use server GC running on a computer that has 4 processors.</span></span> <span data-ttu-id="06241-283">Se tutti i processi si verificano per raccogliere spazzatura allo stesso tempo, avrebbero interferire con l'altro, come ci sarebbero 12 thread pianificati sullo stesso processore.</span><span class="sxs-lookup"><span data-stu-id="06241-283">If all the processes happen to collect garbage at the same time, they would interfere with each other, as there would be 12 threads scheduled on the same processor.</span></span> <span data-ttu-id="06241-284">Se i processi sono attivi, non è una buona idea che tutti utilizzino il catalogo globale del server.</span><span class="sxs-lookup"><span data-stu-id="06241-284">If the processes are active, it's not a good idea to have them all use server GC.</span></span>

<span data-ttu-id="06241-285">Se si eseguono centinaia di istanze di un'applicazione, prendere in considerazione l'utilizzo di Garbage Collection per workstation con l'operazione di Garbage Collection simultanea disabilitata.</span><span class="sxs-lookup"><span data-stu-id="06241-285">If you're running hundreds of instances of an application, consider using workstation garbage collection with concurrent garbage collection disabled.</span></span> <span data-ttu-id="06241-286">Si avranno meno cambi di contesto e un possibile miglioramento delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="06241-286">This will result in less context switching, which can improve performance.</span></span>

## <a name="background-workstation-garbage-collection"></a><span data-ttu-id="06241-287">Garbage Collection della workstation in background</span><span class="sxs-lookup"><span data-stu-id="06241-287">Background workstation garbage collection</span></span>

<span data-ttu-id="06241-288">Nelle operazioni di Garbage Collection per workstation in background, le generazioni effimere (0 e 1) vengono raccolte in base alle esigenze mentre è in corso la raccolta della generazione 2.</span><span class="sxs-lookup"><span data-stu-id="06241-288">In background workstation garbage collection, ephemeral generations (0 and 1) are collected as needed while the collection of generation 2 is in progress.</span></span> <span data-ttu-id="06241-289">L'operazione di Garbage Collection per workstation in background viene eseguita su un thread dedicato e si applica solo alle raccolte di generazione 2.Background workstation garbage collection is performed on a dedicated thread and applies only to generation 2 collections.</span><span class="sxs-lookup"><span data-stu-id="06241-289">Background workstation garbage collection is performed on a dedicated thread and applies only to generation 2 collections.</span></span>

<span data-ttu-id="06241-290">L'operazione di Garbage Collection in background è abilitata per impostazione predefinita e può essere abilitata o disabilitata con l'impostazione di configurazione [gcConcurrent](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) nelle app di .NET Framework o l'impostazione [System.GC.Concurrent](../../core/run-time-config/garbage-collector.md#systemgcconcurrentcomplus_gcconcurrent) nelle app .NET Core.</span><span class="sxs-lookup"><span data-stu-id="06241-290">Background garbage collection is enabled by default and can be enabled or disabled with the [gcConcurrent](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md) configuration setting in .NET Framework apps or the [System.GC.Concurrent](../../core/run-time-config/garbage-collector.md#systemgcconcurrentcomplus_gcconcurrent) setting in .NET Core apps.</span></span>

> [!NOTE]
> <span data-ttu-id="06241-291">L'operazione di Garbage Collection in background sostituisce [l'operazione di Garbage Collection simultanea](#concurrent-garbage-collection) ed è disponibile in .NET Framework 4 e versioni successive.</span><span class="sxs-lookup"><span data-stu-id="06241-291">Background garbage collection replaces [concurrent garbage collection](#concurrent-garbage-collection) and is available in .NET Framework 4 and later versions.</span></span> <span data-ttu-id="06241-292">In .NET Framework 4 è supportato solo per l'operazione di Garbage Collection per workstation.</span><span class="sxs-lookup"><span data-stu-id="06241-292">In .NET Framework 4, it's supported only for workstation garbage collection.</span></span> <span data-ttu-id="06241-293">A partire da .NET Framework 4.5.NET Framework 4.5, l'operazione di Garbage Collection in background è disponibile sia per le operazioni di Garbage Collection per workstation che per i server.</span><span class="sxs-lookup"><span data-stu-id="06241-293">Starting with .NET Framework 4.5, background garbage collection is available for both workstation and server garbage collection.</span></span>

<span data-ttu-id="06241-294">Una raccolta nelle generazioni temporanee durante un'operazione in background è definita Garbage Collection in primo piano.</span><span class="sxs-lookup"><span data-stu-id="06241-294">A collection on ephemeral generations during background garbage collection is known as foreground garbage collection.</span></span> <span data-ttu-id="06241-295">Durante l'esecuzione di un'operazione di Garbage Collection in primo piano, tutti i thread gestiti vengono sospesi.</span><span class="sxs-lookup"><span data-stu-id="06241-295">When foreground garbage collections occur, all managed threads are suspended.</span></span>

<span data-ttu-id="06241-296">Quando è in corso un'operazione di Garbage Collection in background e sono stati allocati un numero sufficiente di oggetti nella generazione 0, CLR esegue un'operazione di Garbage Collection in primo piano di generazione 0 o generazione 1.When background garbage collection is in progress and you've allocated enough objects in generation 0, the CLR performs a generation 0 or generation 1 foreground garbage collection.</span><span class="sxs-lookup"><span data-stu-id="06241-296">When background garbage collection is in progress and you've allocated enough objects in generation 0, the CLR performs a generation 0 or generation 1 foreground garbage collection.</span></span> <span data-ttu-id="06241-297">Il thread di Garbage Collection in background dedicato esegue controlli in corrispondenza di punti sicuri frequenti per stabilire se vi sia una richiesta di Garbage Collection in primo piano.</span><span class="sxs-lookup"><span data-stu-id="06241-297">The dedicated background garbage collection thread checks at frequent safe points to determine whether there is a request for foreground garbage collection.</span></span> <span data-ttu-id="06241-298">In caso affermativo, la raccolta in background si autosospende in modo che possa essere eseguita l'operazione in primo piano.</span><span class="sxs-lookup"><span data-stu-id="06241-298">If there is, the background collection suspends itself so that foreground garbage collection can occur.</span></span> <span data-ttu-id="06241-299">Una volta completata tale operazione, si ha la ripresa del thread di Garbage Collection in background dedicato e dei thread dell'utente.</span><span class="sxs-lookup"><span data-stu-id="06241-299">After the foreground garbage collection is completed, the dedicated background garbage collection thread and user threads resume.</span></span>

<span data-ttu-id="06241-300">La modalità in background elimina le restrizioni di allocazione imposte dalla modalità simultanea, dal momento che durante un'operazione di Garbage Collection in background è possibile eseguire operazioni temporanee.</span><span class="sxs-lookup"><span data-stu-id="06241-300">Background garbage collection removes allocation restrictions imposed by concurrent garbage collection, because ephemeral garbage collections can occur during background garbage collection.</span></span> <span data-ttu-id="06241-301">La procedura di Garbage Collection in background può rimuovere oggetti morti in generazioni effimere.</span><span class="sxs-lookup"><span data-stu-id="06241-301">Background garbage collection can remove dead objects in ephemeral generations.</span></span> <span data-ttu-id="06241-302">Può anche espandere l'heap se necessario durante un'operazione di Garbage Collection di generazione 1.It can also expand the heap if needed during a generation 1 garbage collection.</span><span class="sxs-lookup"><span data-stu-id="06241-302">It can also expand the heap if needed during a generation 1 garbage collection.</span></span>

<span data-ttu-id="06241-303">La figura seguente illustra l'esecuzione in background di un'operazione di Garbage Collection in un thread dedicato separato su una workstation:</span><span class="sxs-lookup"><span data-stu-id="06241-303">The following illustration shows background garbage collection performed on a separate dedicated thread on a workstation:</span></span>

![Garbage Collection della workstation in background](./media/fundamentals/background-workstation-garbage-collection.png)

### <a name="background-server-garbage-collection"></a><span data-ttu-id="06241-305">Garbage Collection del server in background</span><span class="sxs-lookup"><span data-stu-id="06241-305">Background server garbage collection</span></span>

<span data-ttu-id="06241-306">A partire da .NET Framework 4.5.NET Framework 4.5.NET Framework 4.5.NET Framework 4.5.NET Framework 4.5.NET Framework 4.5.NET Framework 4.5, background server garbage collection è la modalità predefinita per l'operazione di Garbage Collection per server.</span><span class="sxs-lookup"><span data-stu-id="06241-306">Starting with .NET Framework 4.5, background server garbage collection is the default mode for server garbage collection.</span></span>

<span data-ttu-id="06241-307">L'operazione di Garbage Collection per server in background funziona in modo simile all'operazione di Garbage Collection per workstation in background, descritta nella sezione precedente, ma esistono alcune differenze:</span><span class="sxs-lookup"><span data-stu-id="06241-307">Background server garbage collection functions similarly to background workstation garbage collection, described in the previous section, but there are a few differences:</span></span>

- <span data-ttu-id="06241-308">L'operazione di Garbage Collection per workstation in background utilizza un thread di Garbage Collection in background dedicato, mentre l'operazione di Garbage Collection per server in background utilizza più thread.</span><span class="sxs-lookup"><span data-stu-id="06241-308">Background workstation garbage collection uses one dedicated background garbage collection thread, whereas background server garbage collection uses multiple threads.</span></span> <span data-ttu-id="06241-309">In genere, è presente un thread dedicato per ogni processore logico.</span><span class="sxs-lookup"><span data-stu-id="06241-309">Typically, there's a dedicated thread for each logical processor.</span></span>

- <span data-ttu-id="06241-310">A differenza del thread di Garbage Collection in background per workstation, questi thread non scadono.</span><span class="sxs-lookup"><span data-stu-id="06241-310">Unlike the workstation background garbage collection thread, these threads do not time out.</span></span>

<span data-ttu-id="06241-311">La figura seguente illustra l'esecuzione in background di un'operazione di Garbage Collection in un thread dedicato separato su un server:</span><span class="sxs-lookup"><span data-stu-id="06241-311">The following illustration shows background garbage collection performed on a separate dedicated thread on a server:</span></span>

![Garbage Collection del server in background](./media/fundamentals/background-server-garbage-collection.png)

## <a name="concurrent-garbage-collection"></a><span data-ttu-id="06241-313">Garbage Collection contemporanea</span><span class="sxs-lookup"><span data-stu-id="06241-313">Concurrent garbage collection</span></span>

> [!TIP]
> <span data-ttu-id="06241-314">Questa sezione si applica a:</span><span class="sxs-lookup"><span data-stu-id="06241-314">This section applies to:</span></span>
>
> - <span data-ttu-id="06241-315">.NET Framework 3.5 e versioni precedenti per l'operazione di Garbage Collection per workstation</span><span class="sxs-lookup"><span data-stu-id="06241-315">.NET Framework 3.5 and earlier for workstation garbage collection</span></span>
> - <span data-ttu-id="06241-316">.NET Framework 4 e versioni precedenti per l'operazione di Garbage Collection per server</span><span class="sxs-lookup"><span data-stu-id="06241-316">.NET Framework 4 and earlier for server garbage collection</span></span>
>
> <span data-ttu-id="06241-317">I rifiuti simultanei vengono sostituiti da [garbage collection](#background-workstation-garbage-collection) in background nelle versioni successive.</span><span class="sxs-lookup"><span data-stu-id="06241-317">Concurrent garbage is replaced by [background garbage collection](#background-workstation-garbage-collection) in later versions.</span></span>

<span data-ttu-id="06241-318">Nell'operazione di Garbage Collection per workstation o server è possibile [abilitare l'operazione](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md)di Garbage Collection simultanea, che consente l'esecuzione simultanea dei thread con un thread dedicato che esegue l'operazione di Garbage Collection per la maggior parte della durata dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="06241-318">In workstation or server garbage collection, you can [enable concurrent garbage collection](../../../docs/framework/configure-apps/file-schema/runtime/gcconcurrent-element.md), which enables threads to run concurrently with a dedicated thread that performs the garbage collection for most of the duration of the collection.</span></span> <span data-ttu-id="06241-319">Questa opzione riguarda solo le operazioni di Garbage Collection nella generazione 2; le generazioni 0 e 1 sono sempre non simultanee in quanto terminano molto velocemente.</span><span class="sxs-lookup"><span data-stu-id="06241-319">This option affects only garbage collections in generation 2; generations 0 and 1 are always non-concurrent because they finish very fast.</span></span>

<span data-ttu-id="06241-320">La modalità simultanea consente alle applicazioni interattive una maggiore efficienza di risposta riducendo al minimo le pause di una raccolta.</span><span class="sxs-lookup"><span data-stu-id="06241-320">Concurrent garbage collection enables interactive applications to be more responsive by minimizing pauses for a collection.</span></span> <span data-ttu-id="06241-321">È possibile continuare a eseguire i thread gestiti per la maggior parte del tempo in cui viene eseguito il thread di Garbage Collection in modalità simultanea.</span><span class="sxs-lookup"><span data-stu-id="06241-321">Managed threads can continue to run most of the time while the concurrent garbage collection thread is running.</span></span> <span data-ttu-id="06241-322">Il risultato saranno pause più brevi durante l'esecuzione di un'operazione di Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="06241-322">This results in shorter pauses while a garbage collection is occurring.</span></span>

<span data-ttu-id="06241-323">La modalità simultanea di Garbage Collection viene eseguita in un thread dedicato.</span><span class="sxs-lookup"><span data-stu-id="06241-323">Concurrent garbage collection is performed on a dedicated thread.</span></span> <span data-ttu-id="06241-324">Per impostazione predefinita, CLR esegue le operazioni di Garbage Collection per workstation con la modalità simultanea abilitata.</span><span class="sxs-lookup"><span data-stu-id="06241-324">By default, the CLR runs workstation garbage collection with concurrent garbage collection enabled.</span></span> <span data-ttu-id="06241-325">Ciò vale tanto per i computer a processore singolo quanto per quelli multiprocessore.</span><span class="sxs-lookup"><span data-stu-id="06241-325">This is true for single-processor and multi-processor computers.</span></span>

<span data-ttu-id="06241-326">Nell'illustrazione riportata di seguito viene mostrata l'esecuzione simultanea di un'operazione di Garbage Collection in un thread dedicato separato.</span><span class="sxs-lookup"><span data-stu-id="06241-326">The following illustration shows concurrent garbage collection performed on a separate dedicated thread.</span></span>

![Thread di Garbage Collection simultanei](./media/gc-concurrent.png)

## <a name="see-also"></a><span data-ttu-id="06241-328">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="06241-328">See also</span></span>

- [<span data-ttu-id="06241-329">Opzioni di configurazione per GC</span><span class="sxs-lookup"><span data-stu-id="06241-329">Configuration options for GC</span></span>](../../core/run-time-config/garbage-collector.md)
- [<span data-ttu-id="06241-330">Garbage Collection</span><span class="sxs-lookup"><span data-stu-id="06241-330">Garbage collection</span></span>](index.md)
